<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
      <title>C++ API Reference: hwPhongShader/hwPhongShader.cpp</title>
      
	  
      
      
      
      
      
      
      
    

</head>
   <body height="100%"><div class="body_content" id="body-content"><link rel="stylesheet" type="text/css" href="cpp_ref/navtree.css"><link rel="stylesheet" type="text/css" href="cpp_ref/doxygen.css"><link rel="stylesheet" type="text/css" href="cpp_ref/tabs.css"><link rel="stylesheet" type="text/css" href="style/adsk.cpm.css"><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('hw_phong_shader_2hw_phong_shader_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
      <div>
         <div class="head">
            <h1>C++ API Reference: hwPhongShader/hwPhongShader.cpp</h1>
         </div>

<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->

  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="#!/url=./cpp_ref/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="#!/url=./cpp_ref/pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="#!/url=./cpp_ref/modules.html"><span>Modules</span></a></li>
      <li><a href="#!/url=./cpp_ref/namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="#!/url=./cpp_ref/annotated.html"><span>Classes</span></a></li>
      <li><a href="#!/url=./cpp_ref/examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="cpp_ref/search/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="cpp_ref/search/close.png" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>

<div id="doc-content">
<!-- window showing the filter options -->


<!-- iframe showing the search results (closed by default) -->


<div class="header">
  <div class="headertitle">
<div class="title">hwPhongShader/hwPhongShader.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// DESCRIPTION:</span></div>
<div class="line"><span class="comment">//      This example uses a cube-environment map</span></div>
<div class="line"><span class="comment">//      to perform per pixel Phong shading.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//      The light direction is currently fixed at the eye</span></div>
<div class="line"><span class="comment">//      position. This could be changed to track an actual</span></div>
<div class="line"><span class="comment">//      light but has not been coded for this example.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//      If multiple lights are to be supported, than the environment</span></div>
<div class="line"><span class="comment">//      map would need to be looked up for each light either</span></div>
<div class="line"><span class="comment">//      using multitexturing or multipass.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//      This example also supports animated attributes.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="preprocessor">#ifdef WIN32</span></div>
<div class="line"><span class="preprocessor">#pragma warning( disable : 4786 )       // Disable STL warnings.</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MIOStream.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGlobal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MString.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPlug.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDataBlock.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDataHandle.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnNumericAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnCompoundAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFloatVector.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnPlugin.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnDependencyNode.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MSceneMessage.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MUserData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MUintArray.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MHWShaderSwatchGenerator.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MRenderUtilities.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MImage.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MMatrix.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Viewport 2.0 includes</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDrawRegistry.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPxShaderOverride.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDrawContext.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MStateManager.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MViewport2Renderer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MTextureManager.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MShaderManager.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGLdefinitions.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGL.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#undef ENABLE_TRACE_API_CALLS</span></div>
<div class="line"><span class="preprocessor">#ifdef ENABLE_TRACE_API_CALLS</span></div>
<div class="line"><span class="preprocessor">#define TRACE_API_CALLS(x) cerr &lt;&lt; &quot;hwPhongShader: &quot;&lt;&lt;(x)&lt;&lt;&quot;\n&quot;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#define TRACE_API_CALLS(x)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef GL_EXT_texture_cube_map</span></div>
<div class="line"><span class="preprocessor"># define GL_NORMAL_MAP_EXT                   0x8511</span></div>
<div class="line"><span class="preprocessor"># define GL_REFLECTION_MAP_EXT               0x8512</span></div>
<div class="line"><span class="preprocessor"># define GL_TEXTURE_CUBE_MAP_EXT             0x8513</span></div>
<div class="line"><span class="preprocessor"># define GL_TEXTURE_BINDING_CUBE_MAP_EXT     0x8514</span></div>
<div class="line"><span class="preprocessor"># define GL_TEXTURE_CUBE_MAP_POSITIVE_X_EXT  0x8515</span></div>
<div class="line"><span class="preprocessor"># define GL_TEXTURE_CUBE_MAP_NEGATIVE_X_EXT  0x8516</span></div>
<div class="line"><span class="preprocessor"># define GL_TEXTURE_CUBE_MAP_POSITIVE_Y_EXT  0x8517</span></div>
<div class="line"><span class="preprocessor"># define GL_TEXTURE_CUBE_MAP_NEGATIVE_Y_EXT  0x8518</span></div>
<div class="line"><span class="preprocessor"># define GL_TEXTURE_CUBE_MAP_POSITIVE_Z_EXT  0x8519</span></div>
<div class="line"><span class="preprocessor"># define GL_TEXTURE_CUBE_MAP_NEGATIVE_Z_EXT  0x851A</span></div>
<div class="line"><span class="preprocessor"># define GL_PROXY_TEXTURE_CUBE_MAP_EXT       0x851B</span></div>
<div class="line"><span class="preprocessor"># define GL_MAX_CUBE_MAP_TEXTURE_SIZE_EXT    0x851C</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;hwPhongShader.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;hwPhongShaderBehavior.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Set this env var to print vertex id and face id for both VP1 and VP2.</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> sTestVertexIdAndFaceId = (getenv(<span class="stringliteral">&quot;MAYA_HWPHONG_TEST_VERTEXID_AND_FACEID&quot;</span>) != NULL);</div>
<div class="line"><span class="comment">// Set this env var to debug trace consolidation</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> sDebugConsolidation = (getenv(<span class="stringliteral">&quot;MAYA_HWPHONG_TEST_DEBUG_CONSOLIDATION&quot;</span>) != NULL);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> sTestLocalUVCoord = (getenv(<span class="stringliteral">&quot;MAYA_HWPHONG_TEST_LOCALUVCOORD&quot;</span>) != NULL);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> sTestIndexing = (getenv(<span class="stringliteral">&quot;MAYA_HWPHONG_TEST_INDEXING&quot;</span>) != NULL);</div>
<div class="line"></div>
<div class="line"><a name="_a0"></a><a class="code" href="#!/url=./cpp_ref/class_m_type_id.html">MTypeId</a> hwPhongShader::id( 0x00105449 );</div>
<div class="line"></div>
<div class="line"><a name="_a1"></a><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>  hwPhongShader::aColor;</div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>  hwPhongShader::aTransparency;</div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>  hwPhongShader::aDiffuseColor;</div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>  hwPhongShader::aSpecularColor;</div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>  hwPhongShader::aShininessX;</div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>  hwPhongShader::aShininessY;</div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>  hwPhongShader::aShininessZ;</div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>  hwPhongShader::aShininess;</div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>  hwPhongShader::aGeometryShape;</div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// DESCRIPTION:</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="keywordtype">void</span> hwPhongShader::setTransparency(<span class="keyword">const</span> <span class="keywordtype">float</span> fTransparency)</div>
<div class="line">{</div>
<div class="line">    mTransparency = fTransparency; </div>
<div class="line">    mAttributesChanged = <span class="keyword">true</span>;</div>
<div class="line">    mAttributesChangedVP2 = <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> hwPhongShader::setAmbient(<span class="keyword">const</span> float3 &amp;fambient) </div>
<div class="line">{ </div>
<div class="line">    mAmbientColor[0] = fambient[0];</div>
<div class="line">    mAmbientColor[1] = fambient[1];</div>
<div class="line">    mAmbientColor[2] = fambient[2];</div>
<div class="line">    mAttributesChanged = <span class="keyword">true</span>;</div>
<div class="line">    mAttributesChangedVP2 = <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> hwPhongShader::setDiffuse(<span class="keyword">const</span> float3 &amp;fDiffuse)</div>
<div class="line">{</div>
<div class="line">    mDiffuseColor[0] = fDiffuse[0];</div>
<div class="line">    mDiffuseColor[1] = fDiffuse[1];</div>
<div class="line">    mDiffuseColor[2] = fDiffuse[2];</div>
<div class="line">    mAttributesChanged = <span class="keyword">true</span>;</div>
<div class="line">    mAttributesChangedVP2 = <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> hwPhongShader::setSpecular(<span class="keyword">const</span> float3 &amp;fSpecular)</div>
<div class="line">{</div>
<div class="line">    mSpecularColor[0] = fSpecular[0];</div>
<div class="line">    mSpecularColor[1] = fSpecular[1];</div>
<div class="line">    mSpecularColor[2] = fSpecular[2];</div>
<div class="line">    mAttributesChanged = <span class="keyword">true</span>;</div>
<div class="line">    mAttributesChangedVP2 = <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> hwPhongShader::setShininess(<span class="keyword">const</span> float3 &amp;fShininess)</div>
<div class="line">{</div>
<div class="line">    mShininess[0] = fShininess[0];</div>
<div class="line">    mShininess[1] = fShininess[1];</div>
<div class="line">    mShininess[2] = fShininess[2];</div>
<div class="line">    mAttributesChanged = <span class="keyword">true</span>;</div>
<div class="line">    mAttributesChangedVP2 = <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">hwPhongShader::hwPhongShader()</div>
<div class="line">{</div>
<div class="line">    TRACE_API_CALLS(<span class="stringliteral">&quot;hwPhongShader&quot;</span>);</div>
<div class="line"></div>
<div class="line">    mAmbientColor[0] = mAmbientColor[1] = mAmbientColor[2] = 0.1f;</div>
<div class="line">    mDiffuseColor[0] = mDiffuseColor[1] = mDiffuseColor[2] = 0.5f;</div>
<div class="line">    mSpecularColor[0] = mSpecularColor[1] = mSpecularColor[2] = 0.5f;</div>
<div class="line">    mShininess[0] = mShininess[1] = mShininess[2] = 100.0f;</div>
<div class="line">    mAttributesChanged = <span class="keyword">false</span>;</div>
<div class="line">    markAttributesChangedVP2();</div>
<div class="line"></div>
<div class="line">    mGeometryShape = 0;</div>
<div class="line">    mTransparency = 0.0f;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">hwPhongShader::~hwPhongShader()</div>
<div class="line">{</div>
<div class="line">    TRACE_API_CALLS(<span class="stringliteral">&quot;~hwPhongShader&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a name="_a2"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> sHWPhongShaderRegistrantId(<span class="stringliteral">&quot;HWPhongShaderRegistrantId&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Custom data for using Viewport 2.0 implementation of shader</span></div>
<div class="line"><span class="keyword">class </span>hwPhongShaderData : <span class="keyword">public</span> <a name="_a3"></a><a class="code" href="#!/url=./cpp_ref/class_m_user_data.html">MUserData</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    hwPhongShaderData() {}</div>
<div class="line">    ~hwPhongShaderData()<span class="keyword"> override </span>{}</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> fPath;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// Viewport 2.0 implementation for the shader</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Options:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  - The shader has the option either use a built in shader or using a fixed function texture lookup</span></div>
<div class="line"><span class="comment">//    as is used in the OpenGL based VP1 implementation. (fDrawUsingShader member)</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  - The shader has the option to use the built in geometry drawing method drawGeometry() or a</span></div>
<div class="line"><span class="comment">//    custom drawing method called customDraw(). (fUseCustomDraw member). From within that draw, information about</span></div>
<div class="line"><span class="comment">//    consolidation, geometry streams and index streams are extracted to perform a custom OpenGL draw.</span></div>
<div class="line"><span class="comment">// </span></div>
<div class="line"><span class="comment">//  - The shader has the option to debug various information. (fDebugConsolidation) can be used</span></div>
<div class="line"><span class="comment">//    to debug consolidation information.</span></div>
<div class="line"><span class="comment">//    </span></div>
<div class="line"><span class="comment">//  - The shader has the option to disable handling of consolidated geometry explicitly (fHandlesConsolidateGeometry)</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  - The shader has the option to set custom data which will keep track of a dag path string. (fUseCustomData)</span></div>
<div class="line"><span class="comment">//    See the notes for this code as this will implicitly disable consolidation.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span><span class="keyword">class </span>hwPhongShaderOverride : <span class="keyword">public</span> <a name="_a4"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html">MHWRender::MPxShaderOverride</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">static</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html">MHWRender::MPxShaderOverride</a>* Creator(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>&amp; obj)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">new</span> hwPhongShaderOverride(obj);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ~hwPhongShaderOverride()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="comment">// It is possible for the MPxShaderOverride object to be deleted when</span></div>
<div class="line">        <span class="comment">// the fShaderNode is not.  If this happens we need to be sure that the</span></div>
<div class="line">        <span class="comment">// next hwPhongShaderOverride created sets the parameters on the shader</span></div>
<div class="line">        <span class="comment">// instance at least once, or we&#39;ll render with unititialized parameters.</span></div>
<div class="line">        <span class="keywordflow">if</span> (fShaderNode) fShaderNode-&gt;markAttributesChangedVP2();</div>
<div class="line">        fShaderNode = NULL;</div>
<div class="line"></div>
<div class="line">        <a name="_a5"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html">MHWRender::MRenderer</a>* theRenderer = <a name="a6"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (theRenderer)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <a name="_a7"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html">MHWRender::MShaderManager</a>* shaderMgr = theRenderer-&gt;<a name="a8"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4603e18a1b89b798a2e4a4f36d9b5125">getShaderManager</a>();</div>
<div class="line">            <span class="keywordflow">if</span> (shaderMgr)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (fColorShaderInstance)</div>
<div class="line">                {</div>
<div class="line">                    shaderMgr-&gt;<a name="a9"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a0c7deb55edc231cbb2365b271ecd55f8">releaseShader</a>(fColorShaderInstance);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (fShadowShaderInstance)</div>
<div class="line">                {</div>
<div class="line">                    shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a0c7deb55edc231cbb2365b271ecd55f8">releaseShader</a>(fShadowShaderInstance);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (fPointLightShadowShaderInstance)</div>
<div class="line">                {</div>
<div class="line">                    shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a0c7deb55edc231cbb2365b271ecd55f8">releaseShader</a>(fPointLightShadowShaderInstance);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (fNTColorShaderInstance)</div>
<div class="line">                {</div>
<div class="line">                    shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a0c7deb55edc231cbb2365b271ecd55f8">releaseShader</a>(fNTColorShaderInstance);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        fColorShaderInstance = NULL;</div>
<div class="line">        fShadowShaderInstance = NULL;</div>
<div class="line">        fPointLightShadowShaderInstance = NULL;</div>
<div class="line">        fNTColorShaderInstance = NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Turn this on to indicate that render items using this shader</span></div>
<div class="line">    <span class="comment">// should not be considered for consolidation.</span></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a10"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a19006d5cfe9051bab45477aea767f346">handlesConsolidatedGeometry</a>()<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="comment">// Return true to allow consolidation if possible.</span></div>
<div class="line">        <span class="keywordflow">return</span> fHandlesConsolidateGeometry;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// When vertex id, face id or local uv coord are required, we need to expand the geometric</span></div>
<div class="line">    <span class="comment">// streams so that face id is the unshared version that can be used.</span></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a11"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a64b871ddc6c792f6c11eb6d46129d9ac">requiresUnsharedGeometricStreams</a>()<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">return</span> sTestVertexIdAndFaceId || sTestLocalUVCoord || sTestIndexing;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Initialize phase</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> <a name="a12"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a0212be7dfc693d9d7a0f95ddcb81ba8d">initialize</a>(</div>
<div class="line">        <span class="keyword">const</span> MInitContext&amp; initContext,</div>
<div class="line">        <a name="_a13"></a><a class="code" href="#!/url=./cpp_ref/class_m_shared_ptr.html">MSharedPtr&lt;MUserData&gt;</a>&amp; userData)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        TRACE_API_CALLS(<span class="stringliteral">&quot;hwPhongShaderOverride::initialize&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">bool</span> setRequirementsFromShader = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (fColorShaderInstance)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Use the requirements for the color shader which is a superset</span></div>
<div class="line">            <span class="comment">// of the requirements for the color and shadow shadowers.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// - Generally this is the easiest way to set geometry requirements since they</span></div>
<div class="line">            <span class="comment">// are taken directly from the shader. To use the custom primitive types</span></div>
<div class="line">            <span class="comment">// branch this has been disabled so that explicit requirments can be set.</span></div>
<div class="line">            <span class="comment">// - The type and format should be made to exactly match the shader.</span></div>
<div class="line">            <span class="keywordflow">if</span> (setRequirementsFromShader)</div>
<div class="line">                <a name="a14"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#abd43fa3203bf4c9df6e3b3cdb7b4d117">setGeometryRequirements</a>( *fColorShaderInstance );</div>
<div class="line"></div>
<div class="line">            <span class="comment">// This plugin is using the utility method</span></div>
<div class="line">            <span class="comment">// MPxShaderOverride::drawGeometry(). For DX11 drawing,</span></div>
<div class="line">            <span class="comment">// a shader signature is required. We use</span></div>
<div class="line">            <span class="comment">// the signature from the same MShaderInstance used to</span></div>
<div class="line">            <span class="comment">// set the geometry requirements so that the signature</span></div>
<div class="line">            <span class="comment">// will match the requirements.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <a name="a15"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#ac57354226fd39a0000138d98e224d7b3">addShaderSignature</a>( *fColorShaderInstance );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!setRequirementsFromShader)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Set the geometry requirements for drawing. Only need</span></div>
<div class="line">            <span class="comment">// position and normals.</span></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> empty;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// custom primitive types can be used by shader overrides.</span></div>
<div class="line">            <span class="comment">// This code is a simple example to show the mechanics of how that works.</span></div>
<div class="line">            <span class="comment">// Here we declare a custom custom indexing requirements.</span></div>
<div class="line">            <span class="comment">// The name &quot;customPrimitiveTest&quot; will be used to look up a registered</span></div>
<div class="line">            <span class="comment">// MPxPrimitiveGenerator that will handle the generation of the index buffer.</span></div>
<div class="line">            <span class="comment">// The example primitive generator is registered at startup by this plugin.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// As part of this example the plugin customPrimitiveGenerator should</span></div>
<div class="line">            <span class="comment">// be loaded. Note that this plugin will only handle polygonal meshes</span></div>
<div class="line">            <span class="comment">// where &quot;Smooth Mesh Preview&quot; has not be turned on. That is it will only</span></div>
<div class="line">            <span class="comment">// rebuild indexing apropriately for the original non-smoothed mesh.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="keyword">static</span> <span class="keywordtype">bool</span> useCustomPrimitiveGenerator = (getenv(<span class="stringliteral">&quot;MAYA_USE_CUSTOMPRIMITIVEGENERATOR&quot;</span>) != NULL);</div>
<div class="line">            <span class="keywordflow">if</span>(useCustomPrimitiveGenerator)</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> customPrimitiveName(<span class="stringliteral">&quot;customPrimitiveTest&quot;</span>);</div>
<div class="line">                <a name="_a16"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer_descriptor.html">MHWRender::MIndexBufferDescriptor</a> indexingRequirement(</div>
<div class="line">                    MHWRender::MIndexBufferDescriptor::kCustom,</div>
<div class="line">                    customPrimitiveName,</div>
<div class="line">                    <a name="a17"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a08260379b97fd733e30ea92e891ede1eaa2c70dd76c8172a9298334473c914304">MHWRender::MGeometry::kTriangles</a>);</div>
<div class="line"></div>
<div class="line">                <a name="a18"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#ab5115ac0288ba1c49ae9c73a4e4dd783">addIndexingRequirement</a>(indexingRequirement);</div>
<div class="line"></div>
<div class="line">                <a name="_a19"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html">MHWRender::MVertexBufferDescriptor</a> positionDesc(</div>
<div class="line">                    empty,</div>
<div class="line">                    <a name="a20"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a5a5b1d8320f94d3c3d142753f5527fc4aa20581584e5f9447cb96afb4f2e10703">MHWRender::MGeometry::kPosition</a>,</div>
<div class="line">                    <a name="a21"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#ad8ed01ff3ff33333d8e19db4d2818bb6a5686197bafb177bdc82550848416a1ad">MHWRender::MGeometry::kFloat</a>,</div>
<div class="line">                    3);</div>
<div class="line">                positionDesc.setSemanticName(<span class="stringliteral">&quot;customPositionStream&quot;</span>);</div>
<div class="line"></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html">MHWRender::MVertexBufferDescriptor</a> normalDesc(</div>
<div class="line">                    empty,</div>
<div class="line">                    <a name="a22"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a5a5b1d8320f94d3c3d142753f5527fc4a227e8416235cd3b43077ca91504a463f">MHWRender::MGeometry::kNormal</a>,</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#ad8ed01ff3ff33333d8e19db4d2818bb6a5686197bafb177bdc82550848416a1ad">MHWRender::MGeometry::kFloat</a>,</div>
<div class="line">                    3);</div>
<div class="line">                normalDesc.setSemanticName(<span class="stringliteral">&quot;customNormalStream&quot;</span>);</div>
<div class="line"></div>
<div class="line">                <a name="a23"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a1293e58405a12d8024512b733e2396d1">addGeometryRequirement</a>(positionDesc);</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a1293e58405a12d8024512b733e2396d1">addGeometryRequirement</a>(normalDesc);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html">MHWRender::MVertexBufferDescriptor</a> positionDesc(</div>
<div class="line">                    empty,</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a5a5b1d8320f94d3c3d142753f5527fc4aa20581584e5f9447cb96afb4f2e10703">MHWRender::MGeometry::kPosition</a>,</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#ad8ed01ff3ff33333d8e19db4d2818bb6a5686197bafb177bdc82550848416a1ad">MHWRender::MGeometry::kFloat</a>,</div>
<div class="line">                    3);</div>
<div class="line">                <span class="comment">// Use the custom semantic name &quot;swizzlePosition&quot;</span></div>
<div class="line">                <span class="comment">// When the vertexBufferMutator plugin is loaded,</span></div>
<div class="line">                <span class="comment">// this will swap the x,y and z values of the vertex buffer.</span></div>
<div class="line">                positionDesc.setSemanticName(<span class="stringliteral">&quot;swizzlePosition&quot;</span>);</div>
<div class="line"></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html">MHWRender::MVertexBufferDescriptor</a> normalDesc(</div>
<div class="line">                    empty,</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a5a5b1d8320f94d3c3d142753f5527fc4a227e8416235cd3b43077ca91504a463f">MHWRender::MGeometry::kNormal</a>,</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#ad8ed01ff3ff33333d8e19db4d2818bb6a5686197bafb177bdc82550848416a1ad">MHWRender::MGeometry::kFloat</a>,</div>
<div class="line">                    3);</div>
<div class="line"></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a1293e58405a12d8024512b733e2396d1">addGeometryRequirement</a>(positionDesc);</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a1293e58405a12d8024512b733e2396d1">addGeometryRequirement</a>(normalDesc);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (sTestVertexIdAndFaceId || sTestIndexing)</div>
<div class="line">                {</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html">MHWRender::MVertexBufferDescriptor</a> vertexIdDesc(</div>
<div class="line">                        empty,</div>
<div class="line">                        <a name="a24"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a5a5b1d8320f94d3c3d142753f5527fc4a6de4261b95102b5402b425d62e1bda93">MHWRender::MGeometry::kTexture</a>,</div>
<div class="line">                        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#ad8ed01ff3ff33333d8e19db4d2818bb6a5686197bafb177bdc82550848416a1ad">MHWRender::MGeometry::kFloat</a>,</div>
<div class="line">                        1);</div>
<div class="line">                    vertexIdDesc.setSemanticName(<span class="stringliteral">&quot;vertexid&quot;</span>);</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a1293e58405a12d8024512b733e2396d1">addGeometryRequirement</a>(vertexIdDesc);</div>
<div class="line"></div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html">MHWRender::MVertexBufferDescriptor</a> faceIdDesc(</div>
<div class="line">                        empty,</div>
<div class="line">                        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a5a5b1d8320f94d3c3d142753f5527fc4a6de4261b95102b5402b425d62e1bda93">MHWRender::MGeometry::kTexture</a>,</div>
<div class="line">                        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#ad8ed01ff3ff33333d8e19db4d2818bb6a5686197bafb177bdc82550848416a1ad">MHWRender::MGeometry::kFloat</a>,</div>
<div class="line">                        1);</div>
<div class="line">                    faceIdDesc.setSemanticName(<span class="stringliteral">&quot;faceid&quot;</span>);</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a1293e58405a12d8024512b733e2396d1">addGeometryRequirement</a>(faceIdDesc);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (sTestLocalUVCoord || sTestIndexing)</div>
<div class="line">                {</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html">MHWRender::MVertexBufferDescriptor</a> localUVCoordDesc(</div>
<div class="line">                        empty,</div>
<div class="line">                        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a5a5b1d8320f94d3c3d142753f5527fc4a6de4261b95102b5402b425d62e1bda93">MHWRender::MGeometry::kTexture</a>,</div>
<div class="line">                        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#ad8ed01ff3ff33333d8e19db4d2818bb6a5686197bafb177bdc82550848416a1ad">MHWRender::MGeometry::kFloat</a>,</div>
<div class="line">                        2);</div>
<div class="line">                    localUVCoordDesc.setSemanticName(<span class="stringliteral">&quot;localuvcoord&quot;</span>);</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a1293e58405a12d8024512b733e2396d1">addGeometryRequirement</a>(localUVCoordDesc);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Store path name as string to show Maya source on draw</span></div>
<div class="line">        <span class="comment">// NOTE 1: We cannot use the path to access the DAG object during the</span></div>
<div class="line">        <span class="comment">//         draw callback since that could trigger DG evaluation, we</span></div>
<div class="line">        <span class="comment">//         just use the string for debugging info.</span></div>
<div class="line">        <span class="comment">// NOTE 2: Adding custom data here makes consolidation of objects</span></div>
<div class="line">        <span class="comment">//         sharing the same hwPhongShader impossible. Performance will</span></div>
<div class="line">        <span class="comment">//         suffer in that case. If we set handlesConsolidatedGeometry()</span></div>
<div class="line">        <span class="comment">//         to be true then we don&#39;t want to add in the user data.</span></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a19006d5cfe9051bab45477aea767f346">handlesConsolidatedGeometry</a>() &amp;&amp; fUseCustomData)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">auto</span> data = <a name="a25"></a><a class="code" href="#!/url=./cpp_ref/class_m_shared_ptr.html#ac80990f055a39623e29922ee6e984338">MSharedPtr&lt;hwPhongShaderData&gt;::make</a>();</div>
<div class="line">            data-&gt;fPath = initContext.dagPath.fullPathName();</div>
<div class="line">            userData = data;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>(<span class="stringliteral">&quot;Autodesk Maya hwPhongShaderOverride&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Update phase</span></div>
<div class="line">    <span class="keywordtype">void</span> <a name="a26"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a3b74f9aeed8e4a00450e3d2045b53b39">updateDG</a>(<a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> <span class="keywordtype">object</span>)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        TRACE_API_CALLS(<span class="stringliteral">&quot;hwPhongShaderOverride::updateDG&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<span class="keywordtype">object</span> != <a name="a27"></a><a class="code" href="#!/url=./cpp_ref/class_m_object.html#af2a707b4254eb54763167aeced863e63">MObject::kNullObj</a>)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Get the hardware shader node from the MObject.</span></div>
<div class="line">            fShaderNode = (hwPhongShader *) <a name="a28"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_hw_shader_node.html#a49e2f0b3db50d2e4b0a916713977450d">MPxHwShaderNode::getHwShaderNodePtr</a>( <span class="keywordtype">object</span> );</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">if</span> (fShaderNode)</div>
<div class="line">            {</div>
<div class="line">                <a name="_a29"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line">                <a name="_a30"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> node(<span class="keywordtype">object</span>, &amp;status);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (status)</div>
<div class="line">                {</div>
<div class="line">                    node.findPlug(<span class="stringliteral">&quot;transparency&quot;</span>, <span class="keyword">true</span>).getValue(fTransparency);</div>
<div class="line">                    fShaderNode-&gt;setTransparency(fTransparency);</div>
<div class="line"></div>
<div class="line">                    node.findPlug(<span class="stringliteral">&quot;colorR&quot;</span>, <span class="keyword">true</span>).getValue(fAmbient[0]);</div>
<div class="line">                    node.findPlug(<span class="stringliteral">&quot;colorG&quot;</span>, <span class="keyword">true</span>).getValue(fAmbient[1]);</div>
<div class="line">                    node.findPlug(<span class="stringliteral">&quot;colorB&quot;</span>, <span class="keyword">true</span>).getValue(fAmbient[2]);</div>
<div class="line">                    fShaderNode-&gt;setAmbient(fAmbient);</div>
<div class="line"></div>
<div class="line">                    node.findPlug(<span class="stringliteral">&quot;diffuseColorR&quot;</span>, <span class="keyword">true</span>).getValue(fDiffuse[0]);</div>
<div class="line">                    node.findPlug(<span class="stringliteral">&quot;diffuseColorG&quot;</span>, <span class="keyword">true</span>).getValue(fDiffuse[1]);</div>
<div class="line">                    node.findPlug(<span class="stringliteral">&quot;diffuseColorB&quot;</span>, <span class="keyword">true</span>).getValue(fDiffuse[2]);</div>
<div class="line">                    float3 fDiffuse_RGB = {fDiffuse[0], fDiffuse[1], fDiffuse[2]};</div>
<div class="line">                    fShaderNode-&gt;setDiffuse(fDiffuse_RGB);</div>
<div class="line">                    fDiffuse[3] = 1.0f - fTransparency;</div>
<div class="line">                    </div>
<div class="line">                    node.findPlug(<span class="stringliteral">&quot;specularColorR&quot;</span>, <span class="keyword">true</span>).getValue(fSpecular[0]);</div>
<div class="line">                    node.findPlug(<span class="stringliteral">&quot;specularColorG&quot;</span>, <span class="keyword">true</span>).getValue(fSpecular[1]);</div>
<div class="line">                    node.findPlug(<span class="stringliteral">&quot;specularColorB&quot;</span>, <span class="keyword">true</span>).getValue(fSpecular[2]);</div>
<div class="line">                    fShaderNode-&gt;setSpecular(fSpecular);</div>
<div class="line"></div>
<div class="line">                    node.findPlug(<span class="stringliteral">&quot;shininessX&quot;</span>, <span class="keyword">true</span>).getValue(fShininess[0]);</div>
<div class="line">                    node.findPlug(<span class="stringliteral">&quot;shininessY&quot;</span>, <span class="keyword">true</span>).getValue(fShininess[1]);</div>
<div class="line">                    node.findPlug(<span class="stringliteral">&quot;shininessZ&quot;</span>, <span class="keyword">true</span>).getValue(fShininess[2]);</div>
<div class="line">                    fShaderNode-&gt;setShininess(fShininess);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                fTransparency = 0.0f;</div>
<div class="line">            }   </div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> <a name="a31"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a84ad0250e8df6abe4a2bab23778c24de">updateDevice</a>()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        TRACE_API_CALLS(<span class="stringliteral">&quot;hwPhongShaderOverride::updateDevice&quot;</span>);</div>
<div class="line"></div>
<div class="line">        updateShaderInstance();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> <a name="a32"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#ae75638d96ce77bea32eb76333b76cbc5">endUpdate</a>()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        TRACE_API_CALLS(<span class="stringliteral">&quot;hwPhongShaderOverride::endUpdate&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Draw phase</span></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a33"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a3b5dcab1b6940e042c0d4843a6ab6787">handlesDraw</a>(<a name="_a34"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a>&amp; context)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keyword">const</span> <a name="_a35"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html">MHWRender::MPassContext</a> &amp; passCtx = context.<a name="a36"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#ad3f9422688a9ffbe815c374ece46c1ea">getPassContext</a>();</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> &amp; passId = passCtx.<a name="a37"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html#ae90d4b4c8175e81800d8eb16ee126e1f">passIdentifier</a>();</div>
<div class="line">        <span class="keyword">const</span> <a name="_a38"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> &amp; passSem = passCtx.<a name="a39"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html#a9737189d5cfffd795336d711a678d627">passSemantics</a>();</div>
<div class="line"></div>
<div class="line">        fInShadowPass = <span class="keyword">false</span>;</div>
<div class="line">        fInPointLightShadowPass = <span class="keyword">false</span>;</div>
<div class="line">        fInColorPass = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Enable to debug what is occuring in handlesDraw()</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordtype">bool</span> debugHandlesDraw = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (debugHandlesDraw)</div>
<div class="line">            printf(<span class="stringliteral">&quot;In hwPhong shader handlesDraw(). Pass Identifier = %s\n&quot;</span>, passId.<a name="a40"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>());</div>
<div class="line">        <span class="keywordtype">bool</span> handlePass = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;passSem.<a name="a41"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); i++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (passSem[i] == <a name="a42"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html#a97ffcfc5e6c4bd512eab6727c58a9ae8">MHWRender::MPassContext::kColorPassSemantic</a>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">bool</span> hasOverrideShader = passCtx.<a name="a43"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html#a54cb1ff5e4a10ffc51cb05ddab8e69ab">hasShaderOverride</a>();</div>
<div class="line">                <span class="keywordflow">if</span> (!hasOverrideShader)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (debugHandlesDraw)</div>
<div class="line">                        printf(<span class="stringliteral">&quot;-&gt; handle semantic[%d][%s]\n&quot;</span>, i, passSem[i].asChar());</div>
<div class="line">                    handlePass = <span class="keyword">true</span>;</div>
<div class="line">                    fInColorPass = <span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (passSem[i] == <a name="a44"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html#ab0d481f367db0fa41c2b3a1aeb2074c8">MHWRender::MPassContext::kShadowPassSemantic</a>)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Only if we can load in a shadow shader will we handle</span></div>
<div class="line">                <span class="comment">// the shadow pass.</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="keywordflow">if</span> (fShadowShaderInstance)</div>
<div class="line">                    handlePass = <span class="keyword">true</span>;</div>
<div class="line">                <span class="keywordflow">if</span> (debugHandlesDraw)</div>
<div class="line">                    printf(<span class="stringliteral">&quot;-&gt; handle semantic[%d][%s] = %d\n&quot;</span>, i, passSem[i].asChar(), handlePass);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Remember that we are currently drawing in a shadow pass</span></div>
<div class="line">                fInShadowPass = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (passSem[i] == <a name="a45"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html#a9c065e94d2a953c1d1fc069c957ab861">MHWRender::MPassContext::kPointLightShadowPassSemantic</a>)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Only if we can load in a point light shadow shader will we handle</span></div>
<div class="line">                <span class="comment">// the point light shadow pass.</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="keywordflow">if</span> (fPointLightShadowShaderInstance)</div>
<div class="line">                    handlePass = <span class="keyword">true</span>;</div>
<div class="line">                <span class="keywordflow">if</span> (debugHandlesDraw)</div>
<div class="line">                    printf(<span class="stringliteral">&quot;-&gt; handle semantic[%d][%s] = %d\n&quot;</span>, i, passSem[i].asChar(), handlePass);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Remember that we are currently drawing in a point light shadow pass</span></div>
<div class="line">                fInPointLightShadowPass = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (passSem[i] == <a name="a46"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html#a67e11eaab888b31695e3bc19dc1c26ef">MHWRender::MPassContext::kDepthPassSemantic</a>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (debugHandlesDraw)</div>
<div class="line">                    printf(<span class="stringliteral">&quot;-&gt; don&#39;t handle semantic[%d][%s]\n&quot;</span>, i, passSem[i].asChar());</div>
<div class="line">                handlePass = <span class="keyword">false</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (passSem[i] == <a name="a47"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html#a30804db03c6cccf4fd8d480fe4af0660">MHWRender::MPassContext::kNormalDepthPassSemantic</a>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (debugHandlesDraw)</div>
<div class="line">                    printf(<span class="stringliteral">&quot;-&gt; don&#39;t handle semantic[%d][%s]\n&quot;</span>, i, passSem[i].asChar());</div>
<div class="line">                handlePass = <span class="keyword">false</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (debugHandlesDraw)</div>
<div class="line">                    printf(<span class="stringliteral">&quot;-&gt; additional semantic[%d][%s]\n&quot;</span>, i, passSem[i].asChar());</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Any other passes, don&#39;t override drawing</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">return</span> handlePass;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a name="_a48"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html">MHWRender::MShaderInstance</a>* <a name="a49"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#ad5a9492e13c5e46460e36cf03b5821bc">shaderInstance</a>()<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">if</span> (fInColorPass)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// If color pass</span></div>
<div class="line">            <span class="keywordflow">if</span> (fColorShaderInstance)</div>
<div class="line">                <span class="keywordflow">return</span> fColorShaderInstance;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fInShadowPass)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// If shadow pass</span></div>
<div class="line">            <span class="keywordflow">if</span> (fShadowShaderInstance)</div>
<div class="line">                <span class="keywordflow">return</span> fShadowShaderInstance;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fInPointLightShadowPass)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// If point light shadow pass</span></div>
<div class="line">            <span class="keywordflow">if</span> (fPointLightShadowShaderInstance)</div>
<div class="line">                <span class="keywordflow">return</span> fPointLightShadowShaderInstance;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Example of using an MShaderInstance for draw.</span></div>
<div class="line">    <span class="comment">// We make the activation occur in activateKey() and</span></div>
<div class="line">    <span class="comment">// the termination occur in terminateKey().</span></div>
<div class="line">    <span class="keywordtype">void</span> <a name="a50"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a8d7f721e0a413d81bd9c0b4c4bf451a9">activateKey</a>(<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a>&amp; context, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>&amp; key)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        TRACE_API_CALLS(<span class="stringliteral">&quot;hwPhongShaderOverride::activateKey&quot;</span>);</div>
<div class="line"></div>
<div class="line">        fShaderBound = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (fInColorPass &amp;&amp; fColorShaderInstance)</div>
<div class="line">        {</div>
<div class="line">            fColorShaderInstance-&gt;bind( context );</div>
<div class="line">            fShaderBound = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fInShadowPass &amp;&amp; fShadowShaderInstance)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Update the parameters on the shadow shader</span></div>
<div class="line">            <a name="_a51"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> viewProj = context.<a name="a52"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a5359807d83c248df630615c60f896a51">getMatrix</a>(<a name="a53"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#acc6ad8472c2abfd2f63e100474b977f9a2ad55891ae6c2915699921b3fdea1d4e">MHWRender::MFrameContext::kViewProjMtx</a>);</div>
<div class="line">            fShadowShaderInstance-&gt;setParameter(<span class="stringliteral">&quot;shadowViewProj&quot;</span>, viewProj );</div>
<div class="line">            fShadowShaderInstance-&gt;bind( context );</div>
<div class="line">            fShaderBound = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fInPointLightShadowPass &amp;&amp; fPointLightShadowShaderInstance)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Update the parameters on the point light shadow shader</span></div>
<div class="line">            fPointLightShadowShaderInstance-&gt;bind( context );</div>
<div class="line">            fShaderBound = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Example of using MShaderInstace to draw. Terminate</span></div>
<div class="line">    <span class="comment">// the shader instance here.</span></div>
<div class="line">    <span class="keywordtype">void</span> <a name="a54"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a9d3d971a5a62e06fcbac0537c11d33de">terminateKey</a>(<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a>&amp; context, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>&amp; key)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        TRACE_API_CALLS(<span class="stringliteral">&quot;hwPhongShaderOverride::terminateKey&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (fShaderBound)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (fInColorPass &amp;&amp; fColorShaderInstance)</div>
<div class="line">            {</div>
<div class="line">                fColorShaderInstance-&gt;unbind( context );</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fInShadowPass &amp;&amp; fShadowShaderInstance)</div>
<div class="line">            {</div>
<div class="line">                fShadowShaderInstance-&gt;unbind( context );</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fInPointLightShadowPass &amp;&amp; fPointLightShadowShaderInstance)</div>
<div class="line">            {</div>
<div class="line">                fPointLightShadowShaderInstance-&gt;unbind( context );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        fShaderBound = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Dump out indexing information</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> dumpIndexing(<span class="keyword">const</span> <a name="_a55"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MHWRender::MRenderItem</a>* renderItem)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!renderItem)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">        <a name="_a56"></a><a class="code" href="#!/url=./cpp_ref/class_m_uint_array.html">MUintArray</a> indexRange;</div>
<div class="line">        <span class="keywordflow">if</span> (renderItem-&gt;<a name="a57"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#acfe4fcf09654f6f6799a6966bd6b3e56">isConsolidated</a>())</div>
<div class="line">        {</div>
<div class="line">            <a name="_a58"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry_index_mapping.html">MHWRender::MGeometryIndexMapping</a> geometryIndexMapping;</div>
<div class="line">            renderItem-&gt;<a name="a59"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a9f2f2adf25777c74ddd4210bdd521b17">sourceIndexMapping</a>(geometryIndexMapping);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Debug the ranges if geometry was consolidated</span></div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;geometryIndexMapping.<a name="a60"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry_index_mapping.html#a2b18b4b29133dad42365f8c38846fcff">geometryCount</a>(); i++)</div>
<div class="line">            {</div>
<div class="line">                <a name="_a61"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a> path = geometryIndexMapping.<a name="a62"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry_index_mapping.html#ae74bcf29f3118b1822b598eb585a9609">dagPath</a>(i);</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> comp = geometryIndexMapping.<a name="a63"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry_index_mapping.html#ae663ab17cb370827b8fb17813ea6def8">component</a>(i);</div>
<div class="line">                <span class="keywordtype">int</span> indexStart = geometryIndexMapping.<a name="a64"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry_index_mapping.html#a99601a885ef6a3b000a2653c026e671b">indexStart</a>(i);</div>
<div class="line">                <span class="keywordtype">int</span> indexLength = geometryIndexMapping.<a name="a65"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry_index_mapping.html#a2a1fafdca88610ba9b6b9a2f8b64c4d3">indexLength</a>(i);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Keep track of end of range</span></div>
<div class="line">                <span class="keywordflow">if</span> (indexRange.<a name="a66"></a><a class="code" href="#!/url=./cpp_ref/class_m_uint_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() == 0)</div>
<div class="line">                    indexRange.<a name="a67"></a><a class="code" href="#!/url=./cpp_ref/class_m_uint_array.html#a29ccefc020c96f15e099924ebe83eb07">append</a>(indexStart);</div>
<div class="line">                indexRange.<a class="code" href="#!/url=./cpp_ref/class_m_uint_array.html#a29ccefc020c96f15e099924ebe83eb07">append</a>(indexStart+indexLength);</div>
<div class="line"></div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Have consolidated geometry[%d]. Path=%s, index start=%d, index length=%d\n&quot;</span>,</div>
<div class="line">                    i, path.<a name="a68"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a7cffb69661adc6ae7ac9e03c297caf01">fullPathName</a>().<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(), indexStart, indexLength);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a> sourceDagPath = renderItem-&gt;<a name="a69"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a9452c2cfed46b5c1977568eb5b225930">sourceDagPath</a>();</div>
<div class="line">            <span class="keyword">const</span> <a name="_a70"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html">MHWRender::MGeometry</a>* geometry = renderItem-&gt;<a name="a71"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#aee2e53b30cbf1699eac04ce5659398d3">geometry</a>();</div>
<div class="line">            <span class="keyword">const</span> <a name="_a72"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html">MHWRender::MIndexBuffer</a>* buffer = geometry ? geometry-&gt;<a name="a73"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#aa2f26ad753c6cf66a2d0badd1328ebee">indexBuffer</a>(0) : NULL;</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> indexCount = buffer ? buffer-&gt;<a name="a74"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html#a90ca964ebcc1b02bbcde225edd49e812">size</a>() : 0;</div>
<div class="line">            indexRange.<a class="code" href="#!/url=./cpp_ref/class_m_uint_array.html#a29ccefc020c96f15e099924ebe83eb07">append</a>(0);</div>
<div class="line">            indexRange.<a class="code" href="#!/url=./cpp_ref/class_m_uint_array.html#a29ccefc020c96f15e099924ebe83eb07">append</a>(indexCount);</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Have unconsolidated geometry. Path=%s. index size=%d\n&quot;</span>,</div>
<div class="line">                        sourceDagPath.<a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a7cffb69661adc6ae7ac9e03c297caf01">fullPathName</a>().<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(), indexCount);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Dump out indexing information</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// Note that we can have both</span></div>
<div class="line">        <span class="comment">// 32 or 16-bit indexing. The latter will occur when the indexing</span></div>
<div class="line">        <span class="comment">// references a consolidated batch of geometry.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html">MHWRender::MGeometry</a>* geometry = renderItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#aee2e53b30cbf1699eac04ce5659398d3">geometry</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (!geometry) </div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (sTestIndexing)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html">MHWRender::MIndexBuffer</a>* buffer = geometry-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#aa2f26ad753c6cf66a2d0badd1328ebee">indexBuffer</a>(0);</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> indexBufferCount = 0;</div>
<div class="line">            GLuint *indexBufferId = NULL;</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a08260379b97fd733e30ea92e891ede1e">MHWRender::MGeometry::Primitive</a> indexPrimType = renderItem-&gt;<a name="a75"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#a0005764259795847274dba4c66e3661b">primitive</a>();</div>
<div class="line">            <span class="keywordtype">void</span> *indexHandle = buffer-&gt;<a name="a76"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html#ad7bcab0d1707ef0da22fc72ada62c40e">resourceHandle</a>();</div>
<div class="line">            <span class="keywordflow">if</span> (indexHandle)</div>
<div class="line">            {</div>
<div class="line">                indexBufferId = (GLuint *)(indexHandle);</div>
<div class="line">                indexBufferCount = buffer-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html#a90ca964ebcc1b02bbcde225edd49e812">size</a>();</div>
<div class="line">                {</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;IndexingPrimType(%s), IndexType(%s), IndexCount(%d), Handle(%d)\n&quot;</span>,</div>
<div class="line">                        <a name="a77"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#ae9ba871c853febb72a1bb4586451a92f">MHWRender::MGeometry::primitiveString</a>(indexPrimType).asChar(),</div>
<div class="line">                        <a name="a78"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a2164a45dbdf2ae0f47998f5e5ac854e6">MHWRender::MGeometry::dataTypeString</a>(buffer-&gt;<a name="a79"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html#abc7588a483f61d3d4a1e8204ca14d6f6">dataType</a>()).asChar(),</div>
<div class="line">                        indexBufferCount,</div>
<div class="line">                        *indexBufferId);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html">MHWRender::MIndexBuffer</a>* nonConstIB = <span class="keyword">const_cast&lt;</span><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html">MHWRender::MIndexBuffer</a>*<span class="keyword">&gt;</span>(buffer);</div>
<div class="line">            <span class="keywordflow">if</span> (buffer-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html#abc7588a483f61d3d4a1e8204ca14d6f6">dataType</a>() == <a name="a80"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#ad8ed01ff3ff33333d8e19db4d2818bb6aa93f90f58b3077bdbedeb9506e0143fd">MHWRender::MGeometry::kUnsignedInt32</a>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *ptr = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*)nonConstIB-&gt;<a name="a81"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html#abc9e783c4d7826700a6a6824451f8230">map</a>();</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> r=0; r&lt;indexRange.<a class="code" href="#!/url=./cpp_ref/class_m_uint_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>()-1; r++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">unsigned</span> start = indexRange[r];</div>
<div class="line">                    <span class="keywordtype">unsigned</span> end = indexRange[r+1];</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=start; i&lt;end; i++)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = ptr[i];</div>
<div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;object[%d], triangle[%d], index[%d] = %d\n&quot;</span>, r, (i-start)/3, i, index);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                nonConstIB-&gt;<a name="a82"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html#a1ffeb3b5abb3d61f62b58a391816201c">unmap</a>();</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *ptr = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>*)nonConstIB-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html#abc9e783c4d7826700a6a6824451f8230">map</a>();</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> r=0; r&lt;indexRange.<a class="code" href="#!/url=./cpp_ref/class_m_uint_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>()-1; r++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">unsigned</span> start = indexRange[r];</div>
<div class="line">                    <span class="keywordtype">unsigned</span> end = indexRange[r+1];</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=start; i&lt;end; i++)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> index = ptr[i];</div>
<div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;object[%d], triangle[%d], index[%d] = %d\n&quot;</span>, r, (i-start)/3, i, index);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                nonConstIB-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_index_buffer.html#a1ffeb3b5abb3d61f62b58a391816201c">unmap</a>();</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Dump out extra attribute information for vertex ids, face ids,</span></div>
<div class="line">    <span class="comment">// and local uv coordinates</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> dumpAttributeInformation(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MHWRender::MRenderItem</a>* renderItem)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html">MHWRender::MGeometry</a>* geometry = renderItem-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html#aee2e53b30cbf1699eac04ce5659398d3">geometry</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (!geometry) </div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Dump vertexid and faceid.</span></div>
<div class="line">        <span class="keywordflow">if</span> (sTestVertexIdAndFaceId)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> vbIdx=0; vbIdx&lt;geometry-&gt;<a name="a83"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a2d6ad76bad123c47513c5941e7493914">vertexBufferCount</a>(); vbIdx++)</div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">const</span> <a name="_a84"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html">MHWRender::MVertexBuffer</a>* vb = geometry-&gt;<a name="a85"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a8dbf1ef3c0feaff25da15a60fe968a80">vertexBuffer</a>(vbIdx);</div>
<div class="line">                <span class="keywordflow">if</span> (!vb) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html">MHWRender::MVertexBufferDescriptor</a>&amp; desc = vb-&gt;<a name="a86"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html#a331cfb987f5f4d632a747e7fbbbe4a43">descriptor</a>();</div>
<div class="line">                <span class="keywordflow">if</span> (desc.<a name="a87"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html#ae5acbe47d704ceb866e3717e2ac9422f">dimension</a>() != 1) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> semanticName = desc.<a name="a88"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html#aec39ee3496166457d1ccdf73c8d1a3b2">semanticName</a>();</div>
<div class="line">                <span class="keywordflow">if</span> (semanticName != <span class="stringliteral">&quot;vertexid&quot;</span> &amp;&amp; semanticName != <span class="stringliteral">&quot;faceid&quot;</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Cancel constness to map buffer and dump data.</span></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html">MHWRender::MVertexBuffer</a>* nonConstVB = <span class="keyword">const_cast&lt;</span><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html">MHWRender::MVertexBuffer</a>*<span class="keyword">&gt;</span>(vb);</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">float</span> *ptr = (<span class="keyword">const</span> <span class="keywordtype">float</span>*)nonConstVB-&gt;<a name="a89"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html#abc9e783c4d7826700a6a6824451f8230">map</a>();</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;vb-&gt;<a name="a90"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html#a42db940e8d3c623487a4e2c34024751c">vertexCount</a>(); k++)</div>
<div class="line">                {</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;%s[%d] = %f\n&quot;</span>, semanticName.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(), k, ptr[k] );</div>
<div class="line">                }</div>
<div class="line">                nonConstVB-&gt;<a name="a91"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html#a1ffeb3b5abb3d61f62b58a391816201c">unmap</a>();</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Dump localUVCoord.</span></div>
<div class="line">        <span class="keywordflow">if</span> (sTestLocalUVCoord)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> vbIdx = 0; vbIdx &lt; geometry-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a2d6ad76bad123c47513c5941e7493914">vertexBufferCount</a>(); vbIdx++)</div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html">MHWRender::MVertexBuffer</a>* vb = geometry-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry.html#a8dbf1ef3c0feaff25da15a60fe968a80">vertexBuffer</a>(vbIdx);</div>
<div class="line">                <span class="keywordflow">if</span> (!vb) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html">MHWRender::MVertexBufferDescriptor</a>&amp; desc = vb-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html#a331cfb987f5f4d632a747e7fbbbe4a43">descriptor</a>();</div>
<div class="line">                <span class="keywordflow">if</span> (desc.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html#ae5acbe47d704ceb866e3717e2ac9422f">dimension</a>() != 2) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> semanticName = desc.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer_descriptor.html#aec39ee3496166457d1ccdf73c8d1a3b2">semanticName</a>();</div>
<div class="line">                <span class="keywordflow">if</span> (semanticName != <span class="stringliteral">&quot;localuvcoord&quot;</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Cancel constness to map buffer and dump data.</span></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html">MHWRender::MVertexBuffer</a>* nonConstVB = <span class="keyword">const_cast&lt;</span><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html">MHWRender::MVertexBuffer</a>*<span class="keyword">&gt;</span>(vb);</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">float</span> *ptr = (<span class="keyword">const</span> <span class="keywordtype">float</span>*)nonConstVB-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html#abc9e783c4d7826700a6a6824451f8230">map</a>();</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; vb-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html#a42db940e8d3c623487a4e2c34024751c">vertexCount</a>(); k++)</div>
<div class="line">                {</div>
<div class="line">                    fprintf(stderr, <span class="stringliteral">&quot;%s[%d] = (%g, %g)\n&quot;</span>, semanticName.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(), k, ptr[2*k], ptr[2*k + 1]);</div>
<div class="line">                }</div>
<div class="line">                nonConstVB-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_vertex_buffer.html#a1ffeb3b5abb3d61f62b58a391816201c">unmap</a>();</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a92"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a26fb6e971beb807417cb83a7b2b8268c">draw</a>(</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a>&amp; context,</div>
<div class="line">        <span class="keyword">const</span> <a name="_a93"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item_list.html">MHWRender::MRenderItemList</a>&amp; renderItemList)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        TRACE_API_CALLS(<span class="stringliteral">&quot;hwPhongShaderOverride::draw&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Check if we are drawing consolidate geometry or not</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span> ( fDebugConsolidation || sTestVertexIdAndFaceId || sTestLocalUVCoord || sTestIndexing )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">int</span> numRenderItems = renderItemList.<a name="a94"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item_list.html#a57b988236ee6a3a5e572d126d3fbccc1">length</a>();</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> renderItemIdx=0; renderItemIdx&lt;numRenderItems; renderItemIdx++)</div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item.html">MHWRender::MRenderItem</a>* renderItem = renderItemList.<a name="a95"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_item_list.html#a82ed5d7ae96a2890f5f54f697bb0bab0">itemAt</a>(renderItemIdx);</div>
<div class="line">                <span class="keywordflow">if</span> (!renderItem) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> ( fDebugConsolidation || sTestIndexing )</div>
<div class="line">                {</div>
<div class="line">                    hwPhongShaderOverride::dumpIndexing(renderItem);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (sTestVertexIdAndFaceId || sTestLocalUVCoord || sTestIndexing)</div>
<div class="line">                {</div>
<div class="line">                    hwPhongShaderOverride::dumpAttributeInformation(renderItem);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a name="_a96"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html">MHWRender::MStateManager</a>* stateMgr = context.<a name="a97"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a9eed5300933693e76ad77822b4feb37f">getStateManager</a>();</div>
<div class="line"></div>
<div class="line">        <span class="comment">//initialize hwPhongShader blend state once</span></div>
<div class="line">        <span class="keywordflow">if</span>(sBlendState == NULL)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">//initilize blend state</span></div>
<div class="line">            <a name="_a98"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html">MHWRender::MBlendStateDesc</a> blendStateDesc;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; (blendStateDesc.<a name="a99"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#ab374ca375c42792265e69bb0a4123559">independentBlendEnable</a> ? <a name="a100"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state.html#ab6b4785ac0e20c5947d74921bacc49b8">MHWRender::MBlendState::kMaxTargets</a> : 1); ++i)</div>
<div class="line">            {</div>
<div class="line">                blendStateDesc.<a name="a101"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#ab6054509e76bc88d697a365e82c504c8">targetBlends</a>[i].<a name="a102"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_target_blend_desc.html#af69e3282d64f8cfe88a2759960788417">blendEnable</a> = <span class="keyword">true</span>;</div>
<div class="line">                blendStateDesc.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#ab6054509e76bc88d697a365e82c504c8">targetBlends</a>[i].<a name="a103"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_target_blend_desc.html#a5c49c83334018fa4b2f69ac30b60d003">sourceBlend</a> = <a name="a104"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state.html#acdb056fac09601eaa8b5f1b5df3ee4eaa76de73d01667fca98bcd3754f1f92c00">MHWRender::MBlendState::kSourceAlpha</a>;</div>
<div class="line">                blendStateDesc.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#ab6054509e76bc88d697a365e82c504c8">targetBlends</a>[i].<a name="a105"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_target_blend_desc.html#adadc1ea4b5fca51312ae451f346434e3">destinationBlend</a> = <a name="a106"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state.html#acdb056fac09601eaa8b5f1b5df3ee4eaaa58d506c01416594f41c42e255dec594">MHWRender::MBlendState::kInvSourceAlpha</a>;</div>
<div class="line">                blendStateDesc.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#ab6054509e76bc88d697a365e82c504c8">targetBlends</a>[i].<a name="a107"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_target_blend_desc.html#a919cbb29a19a1fc79843f58e68ccad57">blendOperation</a> = <a name="a108"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state.html#ad3316ff174eff6a45c45f0e90d84eabea8d20f6cca2d49a8732f535cfe28812c8">MHWRender::MBlendState::kAdd</a>;</div>
<div class="line">                blendStateDesc.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#ab6054509e76bc88d697a365e82c504c8">targetBlends</a>[i].<a name="a109"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_target_blend_desc.html#a9fbc968d46ad9a7107696211e34b4e51">alphaSourceBlend</a> = <a name="a110"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state.html#acdb056fac09601eaa8b5f1b5df3ee4eaa567435a26feac1c98cd5213345ec6681">MHWRender::MBlendState::kOne</a>;</div>
<div class="line">                blendStateDesc.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#ab6054509e76bc88d697a365e82c504c8">targetBlends</a>[i].<a name="a111"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_target_blend_desc.html#aa0f38fbd90e3171cc6c092e80ff25c7c">alphaDestinationBlend</a> = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state.html#acdb056fac09601eaa8b5f1b5df3ee4eaaa58d506c01416594f41c42e255dec594">MHWRender::MBlendState::kInvSourceAlpha</a>;</div>
<div class="line">                blendStateDesc.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#ab6054509e76bc88d697a365e82c504c8">targetBlends</a>[i].<a name="a112"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_target_blend_desc.html#a4d3de738732021fb87a82040e77f0aa4">alphaBlendOperation</a> = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state.html#ad3316ff174eff6a45c45f0e90d84eabea8d20f6cca2d49a8732f535cfe28812c8">MHWRender::MBlendState::kAdd</a>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            blendStateDesc.<a name="a113"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#a320c6d5843805b550f81726b07aa7f17">blendFactor</a>[0] = 1.0f;</div>
<div class="line">            blendStateDesc.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#a320c6d5843805b550f81726b07aa7f17">blendFactor</a>[1] = 1.0f;</div>
<div class="line">            blendStateDesc.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#a320c6d5843805b550f81726b07aa7f17">blendFactor</a>[2] = 1.0f;</div>
<div class="line">            blendStateDesc.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#a320c6d5843805b550f81726b07aa7f17">blendFactor</a>[3] = 1.0f;</div>
<div class="line">            sBlendState = stateMgr-&gt;<a name="a114"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#aeb560f7829270f34ab413ad314314c8f">acquireBlendState</a>(blendStateDesc);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">bool</span> debugDrawContext = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordtype">bool</span> exists;</div>
<div class="line">        <span class="keywordtype">int</span> val = <a name="a115"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a7b35236b639518320b2885b4fd673bab">MGlobal::optionVarIntValue</a>(<span class="stringliteral">&quot;hwPhong_debugDrawContext&quot;</span>, &amp;exists);</div>
<div class="line">        <span class="keywordflow">if</span> (exists)</div>
<div class="line">        {</div>
<div class="line">            debugDrawContext = (val &gt; 0);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (debugDrawContext)</div>
<div class="line">            printContextInformation(context);</div>
<div class="line"></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html">MHWRender::MPassContext</a> &amp; passCtx = context.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#ad3f9422688a9ffbe815c374ece46c1ea">getPassContext</a>();</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> &amp; passSem = passCtx.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html#a9737189d5cfffd795336d711a678d627">passSemantics</a>();</div>
<div class="line">        <span class="keywordtype">bool</span> debugPassInformation = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (debugPassInformation)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> &amp; passId = passCtx.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html#ae90d4b4c8175e81800d8eb16ee126e1f">passIdentifier</a>();</div>
<div class="line">            printf(<span class="stringliteral">&quot;hwPhong node drawing in pass[%s], semantic[&quot;</span>, passId.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>());</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;passSem.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); i++)</div>
<div class="line">                printf(<span class="stringliteral">&quot; %s&quot;</span>, passSem[i].asChar());</div>
<div class="line">            printf(<span class="stringliteral">&quot; ]\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// save old render state</span></div>
<div class="line">        <span class="keyword">const</span> <a name="_a116"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state.html">MHWRender::MBlendState</a>* pOldBlendState = stateMgr-&gt;<a name="a117"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a4dbf5ff33e99eba611b73273d868182f">getBlendState</a>();</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Have a MShaderInstance bound then just need to draw the geometry</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span> (fShaderBound)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Draw for color pass</span></div>
<div class="line">            <span class="keywordflow">if</span> (fInColorPass)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">bool</span> needBlending = <span class="keyword">false</span>;</div>
<div class="line">                <span class="keywordflow">if</span> (fTransparency &gt; 0.0f)</div>
<div class="line">                {</div>
<div class="line">                    needBlending = <span class="keyword">true</span>;</div>
<div class="line">                    stateMgr-&gt;<a name="a118"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a27dbc083002d85108ed30ee1131f68c1">setBlendState</a>(sBlendState);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> passCount = fColorShaderInstance-&gt;getPassCount( context );</div>
<div class="line">                <span class="keywordflow">if</span> (passCount)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;passCount; i++)</div>
<div class="line">                    {</div>
<div class="line">                        fColorShaderInstance-&gt;activatePass( context, i );</div>
<div class="line">                        </div>
<div class="line">                        <span class="comment">// Draw the geometry through the internal interface instead</span></div>
<div class="line">                        <span class="comment">// of drawing via the plugin.</span></div>
<div class="line">                        <a name="a119"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a96b26e833c1533131841eb2bcb2288a4">MHWRender::MPxShaderOverride::drawGeometry</a>(context);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (needBlending)</div>
<div class="line">                {</div>
<div class="line">                    stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a27dbc083002d85108ed30ee1131f68c1">setBlendState</a>(pOldBlendState);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Draw for shadow pass</span></div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fInShadowPass)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> passCount = fShadowShaderInstance-&gt;getPassCount( context );</div>
<div class="line">                <span class="keywordflow">if</span> (passCount)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;passCount; i++)</div>
<div class="line">                    {</div>
<div class="line">                        fShadowShaderInstance-&gt;activatePass( context, i );</div>
<div class="line">                        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a96b26e833c1533131841eb2bcb2288a4">MHWRender::MPxShaderOverride::drawGeometry</a>(context);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Draw for point light shadow pass</span></div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fInPointLightShadowPass)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> passCount = fPointLightShadowShaderInstance-&gt;getPassCount( context );</div>
<div class="line">                <span class="keywordflow">if</span> (passCount)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;passCount; i++)</div>
<div class="line">                    {</div>
<div class="line">                        fPointLightShadowShaderInstance-&gt;activatePass( context, i );</div>
<div class="line">                        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a96b26e833c1533131841eb2bcb2288a4">MHWRender::MPxShaderOverride::drawGeometry</a>(context);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    MHWRender::DrawAPI <a name="a120"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a9c43d7192e56c01d8dde77fabd843a0e">supportedDrawAPIs</a>()<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">return</span> (MHWRender::kOpenGL | MHWRender::kDirectX11 | MHWRender::kOpenGLCoreProfile);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a121"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#ab79d6d7859fceb8fc8b0e4ace1869612">isTransparent</a>()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        TRACE_API_CALLS(<span class="stringliteral">&quot;hwPhongShaderOverride::isTransparent&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (fShaderNode)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> (fTransparency &gt; 0.0f);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set a non-texture mode shader which is fixed.</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html">MHWRender::MShaderInstance</a>* <a name="a122"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#addc154cb86dafb4b95301938d97659d8">nonTexturedShaderInstance</a>(<span class="keywordtype">bool</span> &amp;monitor)<span class="keyword"> const override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">if</span> (fNTColorShaderInstance)</div>
<div class="line">        {</div>
<div class="line">            monitor = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">return</span> fNTColorShaderInstance;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a123"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#a1b9341f2236028651e9d3b7b26d52dcb">overridesDrawState</a>()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> debugShaderParameters(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html">MHWRender::MShaderInstance</a> *shaderInstance)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> params;</div>
<div class="line">        shaderInstance-&gt;<a name="a124"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#aec00be694fc8d654f1f7a8ea823a7cea">parameterList</a>(params);</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numParams = params.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>();</div>
<div class="line">        printf(<span class="stringliteral">&quot;DEBUGGING SHADER, BEGIN PARAM LIST OF LENGTH %d\n&quot;</span>, numParams);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;numParams; i++)</div>
<div class="line">        {</div>
<div class="line">            printf(<span class="stringliteral">&quot;ParamName=&#39;%s&#39;, ParamType=&quot;</span>, params[i].asChar());</div>
<div class="line">            <span class="keywordflow">switch</span> (shaderInstance-&gt;<a name="a125"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a53412fe64ba3d9d8434c09e6e07b6011">parameterType</a>(params[i]))</div>
<div class="line">            {</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a126"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0a94dd08feda7b2cf0ff8262312c4fcc09">MHWRender::MShaderInstance::kInvalid</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;Invalid&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a127"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0a8cfc0ab572a96edfc9db7c02f0d025d7">MHWRender::MShaderInstance::kBoolean</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;Boolean&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a128"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0aa1acc5720dd4e85ceea5578a6cf14ae6">MHWRender::MShaderInstance::kInteger</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;Integer&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a129"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0a5686197bafb177bdc82550848416a1ad">MHWRender::MShaderInstance::kFloat</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;Float&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a130"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0a615a014b3454583f793180280757d285">MHWRender::MShaderInstance::kFloat2</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;Float2&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a131"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0a2f329aadf08637405a63cee5369fd28d">MHWRender::MShaderInstance::kFloat3</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;Float3&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a132"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0af21770dc86a3877076e2d58842291ca4">MHWRender::MShaderInstance::kFloat4</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;Float4&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a133"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0a2242133aaee8fd15dbb632825bc4226e">MHWRender::MShaderInstance::kFloat4x4Row</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;Float4x4Row&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a134"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0a706b60512c7f5ba8200df461b672d905">MHWRender::MShaderInstance::kFloat4x4Col</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;Float4x4Col&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a135"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0a0211e7902fa531fb032e5b40a4b31666">MHWRender::MShaderInstance::kTexture1</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;1D Texture&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a136"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0a9f41a2c609a9a7104e4d0c869d8fd2e7">MHWRender::MShaderInstance::kTexture2</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;2D Texture&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a137"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0a96966e9616f0f92c86a62f9ef1cf7640">MHWRender::MShaderInstance::kTexture3</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;3D Texture&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a138"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0ada96c2ae4db83bf803b3e75731d574b3">MHWRender::MShaderInstance::kTextureCube</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;Cube Texture&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a name="a139"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a4d63980e4031b0fc366e623868b27ed0a754585b88bea58243b903b023e1594f0">MHWRender::MShaderInstance::kSampler</a>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;Sampler&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">                printf(<span class="stringliteral">&quot;&#39;Unknown&#39;, &quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            printf(<span class="stringliteral">&quot;IsArrayParameter=&#39;%s&#39;\n&quot;</span>, shaderInstance-&gt;<a name="a140"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#a5986e0e2979770ecb23a3ed60f1d3a3e">isArrayParameter</a>(params[i]) ? <span class="stringliteral">&quot;YES&quot;</span> : <span class="stringliteral">&quot;NO&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        printf(<span class="stringliteral">&quot;END PARAM LIST\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Code to create a cached MShaderInstance</span></div>
<div class="line">    <span class="keywordtype">void</span> createShaderInstance()</div>
<div class="line">    {</div>
<div class="line">        TRACE_API_CALLS(<span class="stringliteral">&quot;hwPhongShaderOverride::createShaderInstance&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html">MHWRender::MRenderer</a> *renderer = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (!renderer)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html">MHWRender::MShaderManager</a>* shaderMgr = renderer-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4603e18a1b89b798a2e4a4f36d9b5125">getShaderManager</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (!shaderMgr)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">bool</span> debugShader = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// If no shadow shader instance created yet acquire one. Use</span></div>
<div class="line">        <span class="comment">// the stock shadow shader provided.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span> (!fShadowShaderInstance)</div>
<div class="line">        {</div>
<div class="line">            fShadowShaderInstance = shaderMgr-&gt;<a name="a141"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a8e4ad27d691969622af2b05d8c6213d9">getStockShader</a>( <a name="a142"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a1f7c5db8a3b5804c6ffce5f305bf51a8afe64911b6b5354f80a8e038cfddacf36">MHWRender::MShaderManager::k3dShadowerShader</a> );</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Some sample debugging code to see what parameters are available.</span></div>
<div class="line">            <span class="keywordflow">if</span> (fShadowShaderInstance)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (debugShader)</div>
<div class="line">                    debugShaderParameters( fShadowShaderInstance );</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Failed to load shadower shader for hwPhong\n&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// If no point light shadow shader instance created yet acquire one. Use</span></div>
<div class="line">        <span class="comment">// the stock shadow shader provided.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span> (!fPointLightShadowShaderInstance)</div>
<div class="line">        {</div>
<div class="line">            fPointLightShadowShaderInstance = shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a8e4ad27d691969622af2b05d8c6213d9">getStockShader</a>( <a name="a143"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a1f7c5db8a3b5804c6ffce5f305bf51a8ad8e1faf47ed035372ca4dfc69d18e270">MHWRender::MShaderManager::k3dPointLightShadowerShader</a> );</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Some sample debugging code to see what parameters are available.</span></div>
<div class="line">            <span class="keywordflow">if</span> (fPointLightShadowShaderInstance)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (debugShader)</div>
<div class="line">                    debugShaderParameters( fPointLightShadowShaderInstance );</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Failed to load point light shadower shader for hwPhong\n&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// If no color shader instance created yet acquire one. For</span></div>
<div class="line">        <span class="comment">// now it&#39;s just using an internal shader for convenience but</span></div>
<div class="line">        <span class="comment">// a custom shader could be written here as well.</span></div>
<div class="line">        <span class="keywordflow">if</span> (!fColorShaderInstance)</div>
<div class="line">        {</div>
<div class="line">            fColorShaderInstance = shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a8e4ad27d691969622af2b05d8c6213d9">getStockShader</a>( <a name="a144"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a1f7c5db8a3b5804c6ffce5f305bf51a8a56de0b4dccd3a1c52e8ddd11aac3e0e2">MHWRender::MShaderManager::k3dBlinnShader</a> );</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Some sample debugging code to see what parameters are available.</span></div>
<div class="line">            <span class="keywordflow">if</span> (fColorShaderInstance &amp;&amp; debugShader)</div>
<div class="line">            {</div>
<div class="line">                debugShaderParameters( fColorShaderInstance );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (!fNTColorShaderInstance)</div>
<div class="line">        {</div>
<div class="line">            fNTColorShaderInstance = shaderMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a8e4ad27d691969622af2b05d8c6213d9">getStockShader</a>( <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_manager.html#a1f7c5db8a3b5804c6ffce5f305bf51a8a56de0b4dccd3a1c52e8ddd11aac3e0e2">MHWRender::MShaderManager::k3dBlinnShader</a> );</div>
<div class="line">            <span class="keywordflow">if</span> (fNTColorShaderInstance)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">float</span> val[4] = { 0.3f, 0.5f, 1.0f, 1.0f };</div>
<div class="line">                fNTColorShaderInstance-&gt;<a name="a145"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html#aa17e2c9a17b86064950103066fa307ef">setParameter</a>(<span class="stringliteral">&quot;diffuseColor&quot;</span>, &amp;val[0]);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Code to update a cached MShaderInstance</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordtype">void</span> updateShaderInstance()</div>
<div class="line">    {</div>
<div class="line">        TRACE_API_CALLS(<span class="stringliteral">&quot;hwPhongShaderOverride::updateShaderInstance&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html">MHWRender::MRenderer</a> *renderer = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (!renderer)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Update the parameters on the color shader</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span> (fColorShaderInstance)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Update shader to mark it as drawing with transparency or not.</span></div>
<div class="line">            fColorShaderInstance-&gt;setIsTransparent( <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_shader_override.html#ab79d6d7859fceb8fc8b0e4ace1869612">isTransparent</a>() );</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (fShaderNode &amp;&amp; fShaderNode-&gt;attributesChangedVP2())</div>
<div class="line">            {</div>
<div class="line">                fColorShaderInstance-&gt;setParameter(<span class="stringliteral">&quot;emissionColor&quot;</span>, &amp;fAmbient[0] );</div>
<div class="line">                fColorShaderInstance-&gt;setParameter(<span class="stringliteral">&quot;diffuseColor&quot;</span>, &amp;fDiffuse[0] );</div>
<div class="line">                fColorShaderInstance-&gt;setParameter(<span class="stringliteral">&quot;specularColor&quot;</span>, &amp;fSpecular[0] );</div>
<div class="line">                <span class="comment">// &quot;specularPower&quot; is set using single-float argument version of setParameter()</span></div>
<div class="line">                <span class="keywordtype">float</span> specPower = fShininess[0];</div>
<div class="line">                fColorShaderInstance-&gt;setParameter(<span class="stringliteral">&quot;specularPower&quot;</span>, specPower );</div>
<div class="line"></div>
<div class="line">                fShaderNode-&gt;markAttributesCleanVP2();</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Utility code to print the current context information</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> printContextInformation( <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a> &amp; context )</div>
<div class="line">    {</div>
<div class="line">        TRACE_API_CALLS(<span class="stringliteral">&quot;hwPhongShaderOverride::printContextInformation&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Sample code to print out the information found in MDrawContext</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <a name="_a146"></a><a class="code" href="#!/url=./cpp_ref/class_m_double_array.html">MDoubleArray</a> dtuple;</div>
<div class="line">        printf(<span class="stringliteral">&quot;Draw Context Diagnostics {\n&quot;</span>);</div>
<div class="line">        {</div>
<div class="line">            dtuple = context.<a name="a147"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a0dfe2293173b7b5a7da2e1f903ee18cb">getTuple</a>( <a name="a148"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#af164f32d9bda6829f1738ef3fb2c6670aba1d4dab9b951b21263efade0a8f6729">MHWRender::MFrameContext::kViewPosition</a> );</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tView position: %f, %f, %f\n&quot;</span>, dtuple[0], dtuple[1], dtuple[2]);</div>
<div class="line">            dtuple = context.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a0dfe2293173b7b5a7da2e1f903ee18cb">getTuple</a>( <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#af164f32d9bda6829f1738ef3fb2c6670aba1d4dab9b951b21263efade0a8f6729">MHWRender::MFrameContext::kViewPosition</a> );</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tView dir : %f, %f, %f\n&quot;</span>, dtuple[0], dtuple[1], dtuple[2]);</div>
<div class="line">            dtuple = context.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a0dfe2293173b7b5a7da2e1f903ee18cb">getTuple</a>( <a name="a149"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#af164f32d9bda6829f1738ef3fb2c6670a46bdbff9d5db6921557766fcf9e4133f">MHWRender::MFrameContext::kViewUp</a> );</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tView up : %f, %f, %f\n&quot;</span>, dtuple[0], dtuple[1], dtuple[2]);</div>
<div class="line">            dtuple = context.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a0dfe2293173b7b5a7da2e1f903ee18cb">getTuple</a>( <a name="a150"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#af164f32d9bda6829f1738ef3fb2c6670ae859394c6853c70c4000dc7a7a766bf1">MHWRender::MFrameContext::kViewRight</a> );</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tView right : %f, %f, %f\n&quot;</span>, dtuple[0], dtuple[1], dtuple[2]);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">            <a name="_a151"></a><a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html">MBoundingBox</a> bbox = context.<a name="a152"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a7b75c194c2b51fa5f31eddef5ebddc41">getSceneBox</a>();</div>
<div class="line">            <a name="_a153"></a><a class="code" href="#!/url=./cpp_ref/class_m_point.html">MPoint</a> bmin = bbox.<a name="a154"></a><a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html#afb3213b98f3a6b4bda9759511e9b79a1">min</a>();</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_point.html">MPoint</a> bmax = bbox.<a name="a155"></a><a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html#a1dfdbea9d5560e4aa09d34bdbd82480c">max</a>();</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tScene bounding box = %g,%g,%g -&gt; %g,%g,%g\n&quot;</span>,</div>
<div class="line">                bmin[0],bmin[1],bmin[2],</div>
<div class="line">                bmax[0],bmax[1],bmax[2]);</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">int</span> originX; <span class="keywordtype">int</span> originY; <span class="keywordtype">int</span> width; <span class="keywordtype">int</span> height;</div>
<div class="line">            context.<a name="a156"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a84f8e099a466341238b4b4e40cde4167">getRenderTargetSize</a>( width, height );</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tRender target size: %d x %d\n&quot;</span>, width, height);</div>
<div class="line">            context.<a name="a157"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a833da0fac707065e2b987ff38b7b7312">getViewportDimensions</a>( originX, originY, width, height);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tViewport dimensions: %d, %d, -&gt; %d, %d\n&quot;</span>, originX, originY, width, height);</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> xStatus;</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tView direction along neg z = %d\n&quot;</span>, context.<a name="a158"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a6913c6eda7d76d313d3ea1a8fab5318d">viewDirectionAlongNegZ</a>( &amp;xStatus ));</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Flag to test getting all scene lights or the subset used for lighting</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="keyword">static</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a45d7b67b2b407db2a3a3927ef09db3e2">MHWRender::MDrawContext::LightFilter</a> considerAllSceneLights = <a name="a159"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a45d7b67b2b407db2a3a3927ef09db3e2ad63bad246d971bae12546a9784c65d31">MHWRender::MDrawContext::kFilteredToLightLimit</a>;</div>
<div class="line">            <span class="keywordflow">if</span> (considerAllSceneLights == <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a45d7b67b2b407db2a3a3927ef09db3e2ad63bad246d971bae12546a9784c65d31">MHWRender::MDrawContext::kFilteredToLightLimit</a>)</div>
<div class="line">                considerAllSceneLights = <a name="a160"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a45d7b67b2b407db2a3a3927ef09db3e2a8d9a85c34398a46f44834be0b4fec0e4">MHWRender::MDrawContext::kFilteredIgnoreLightLimit</a>;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                considerAllSceneLights = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a45d7b67b2b407db2a3a3927ef09db3e2ad63bad246d971bae12546a9784c65d31">MHWRender::MDrawContext::kFilteredToLightLimit</a>;</div>
<div class="line"></div>
<div class="line">            printf(<span class="stringliteral">&quot;\tLight Information for %s\n&quot;</span>,</div>
<div class="line">                considerAllSceneLights == <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a45d7b67b2b407db2a3a3927ef09db3e2ad63bad246d971bae12546a9784c65d31">MHWRender::MDrawContext::kFilteredToLightLimit</a></div>
<div class="line">                ? <span class="stringliteral">&quot;only lights clamped to light limit.&quot;</span> : <span class="stringliteral">&quot;lights not clamped to light limit.&quot;</span>);</div>
<div class="line">                </div>
<div class="line">            <span class="keywordflow">if</span> ( considerAllSceneLights == <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a45d7b67b2b407db2a3a3927ef09db3e2a8d9a85c34398a46f44834be0b4fec0e4">MHWRender::MDrawContext::kFilteredIgnoreLightLimit</a> )</div>
<div class="line">                <a name="a161"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#ad3ef90830d42d36701abb67d53748f08">MHWRender::MRenderer::needEvaluateAllLights</a>();</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lightCount = context.<a name="a162"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a245ec3740263f7f3c076dd9c723141b7">numberOfActiveLights</a>(considerAllSceneLights);</div>
<div class="line">            <a name="_a163"></a><a class="code" href="#!/url=./cpp_ref/class_m_float_point_array.html">MFloatPointArray</a> positions;</div>
<div class="line">            <a name="_a164"></a><a class="code" href="#!/url=./cpp_ref/class_m_float_point.html">MFloatPoint</a> position;</div>
<div class="line">            <a name="_a165"></a><a class="code" href="#!/url=./cpp_ref/class_m_float_vector.html">MFloatVector</a> direction;</div>
<div class="line">            <span class="keywordtype">float</span> intensity = 1.0f;</div>
<div class="line">            <a name="_a166"></a><a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a> color;</div>
<div class="line">            <span class="keywordtype">bool</span> hasDirection = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordtype">bool</span> hasPosition = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">bool</span> visualizeLighting = <span class="keyword">false</span>;</div>
<div class="line">            <span class="comment">// Reuse for each light.</span></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> identity;</div>
<div class="line">            <span class="keywordflow">if</span> (visualizeLighting )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;8; i++)</div>
<div class="line">                {</div>
<div class="line">                    GLenum light = GL_LIGHT0+i;</div>
<div class="line">                    glDisable(light);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (!lightCount)</div>
<div class="line">                    glDisable(GL_LIGHTING);</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                    glEnable(GL_LIGHTING);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;lightCount; i++)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// Shown here are 2 avenues for accessing light data:</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// If only some basic information which is common to all</span></div>
<div class="line">                <span class="comment">// light types is required then the getLightInformation()</span></div>
<div class="line">                <span class="comment">// interface can be used. It is a simpler interface and</span></div>
<div class="line">                <span class="comment">// in general will be faster to execute.</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// The alternative is to access the lights by parameter</span></div>
<div class="line">                <span class="comment">// via the getLightParameterInformation() interface</span></div>
<div class="line">                <span class="comment">// which allows us to inspect all the per light type specific</span></div>
<div class="line">                <span class="comment">// information (e.g. the drop off on spot lights).</span></div>
<div class="line">                <span class="comment">// As shown it is a bit more complex</span></div>
<div class="line">                <span class="comment">// to use but provides more information.</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="keywordtype">bool</span> getCommonParametersOnly = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Look at common information only</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="keywordflow">if</span> (getCommonParametersOnly)</div>
<div class="line">                {</div>
<div class="line">                    context.<a name="a167"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#ad76985f8ee279b7ffd948dc492a748a3">getLightInformation</a>( i,</div>
<div class="line">                                     positions, direction,</div>
<div class="line">                                     intensity, color, hasDirection,</div>
<div class="line">                                     hasPosition,</div>
<div class="line">                                     considerAllSceneLights);</div>
<div class="line">                    printf(<span class="stringliteral">&quot;\tLight %d {\n&quot;</span>, i);</div>
<div class="line">                    printf(<span class="stringliteral">&quot;\t\tDirectional %d, Positional %d\n&quot;</span>, hasDirection, hasPosition);</div>
<div class="line">                    printf(<span class="stringliteral">&quot;\t\tDirection = %g, %g, %g\n&quot;</span>, direction[0],direction[1],direction[2]);</div>
<div class="line">                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> positionCount = positions.<a name="a168"></a><a class="code" href="#!/url=./cpp_ref/class_m_float_point_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>();</div>
<div class="line">                    <span class="keywordflow">if</span> (hasPosition &amp;&amp; positionCount)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p=0; p&lt;positions.<a class="code" href="#!/url=./cpp_ref/class_m_float_point_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); p++)</div>
<div class="line">                        {</div>
<div class="line">                            printf(<span class="stringliteral">&quot;\t\tPosition[%d] = %g, %g, %g\n&quot;</span>, p, positions[p][0], positions[p][1], positions[p][2]);</div>
<div class="line">                            position += positions[p];</div>
<div class="line">                        }</div>
<div class="line">                        position[0] /= (float)positionCount;</div>
<div class="line">                        position[1] /= (float)positionCount;</div>
<div class="line">                        position[2] /= (float)positionCount;</div>
<div class="line">                    }</div>
<div class="line">                    printf(<span class="stringliteral">&quot;\t\tColor = %g, %g, %g\n&quot;</span>, color[0], color[1], color[2]);</div>
<div class="line">                    printf(<span class="stringliteral">&quot;\t\tIntensity = %g\n&quot;</span>, intensity);</div>
<div class="line">                    printf(<span class="stringliteral">&quot;\t}\n&quot;</span>);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Look at all information which may differ per light type</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> positionCount = 0;</div>
<div class="line">                    position[0] = position[1] = position[2] = 0.0f;</div>
<div class="line">                    <a name="_a169"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html">MHWRender::MLightParameterInformation</a> *lightParam =</div>
<div class="line">                        context.<a name="a170"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a05eaca3528290935c1b9ee55ae020c75">getLightParameterInformation</a>( i, considerAllSceneLights );</div>
<div class="line">                    <span class="keywordflow">if</span> (lightParam)</div>
<div class="line">                    {</div>
<div class="line">                        printf(<span class="stringliteral">&quot;\tLight %d {\n&quot;</span>, i);</div>
<div class="line"></div>
<div class="line">                        <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> params;</div>
<div class="line">                        lightParam-&gt;<a name="a171"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#aec00be694fc8d654f1f7a8ea823a7cea">parameterList</a>(params);</div>
<div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p=0; p&lt;params.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); p++)</div>
<div class="line">                        {</div>
<div class="line">                            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> pname = params[p];</div>
<div class="line">                            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4d63980e4031b0fc366e623868b27ed0">MHWRender::MLightParameterInformation::ParameterType</a> ptype = lightParam-&gt;<a name="a172"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a5305e5705305b315f661ae2d13f0f38d">parameterType</a>( pname );</div>
<div class="line">                            <a name="_a173"></a><a class="code" href="#!/url=./cpp_ref/class_m_float_array.html">MFloatArray</a> floatVals;</div>
<div class="line">                            <a name="_a174"></a><a class="code" href="#!/url=./cpp_ref/class_m_int_array.html">MIntArray</a> intVals;</div>
<div class="line">                            <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> matrixVal;</div>
<div class="line">                            <a name="_a175"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sampler_state_desc.html">MHWRender::MSamplerStateDesc</a> samplerDesc;</div>
<div class="line">                            <span class="keywordflow">switch</span> (ptype)</div>
<div class="line">                            {</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a176"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4d63980e4031b0fc366e623868b27ed0a8cfc0ab572a96edfc9db7c02f0d025d7">MHWRender::MLightParameterInformation::kBoolean</a>:</div>
<div class="line">                                lightParam-&gt;<a name="a177"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#aa3237e2138596c256a541816278b402f">getParameter</a>( pname, intVals );</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\tLight parameter %s. Bool[%d]\n&quot;</span>, pname.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),</div>
<div class="line">                                    intVals[0]);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a178"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4d63980e4031b0fc366e623868b27ed0aa1acc5720dd4e85ceea5578a6cf14ae6">MHWRender::MLightParameterInformation::kInteger</a>:</div>
<div class="line">                                lightParam-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#aa3237e2138596c256a541816278b402f">getParameter</a>( pname, intVals );</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\tLight parameter %s. Integer[%d]\n&quot;</span>, pname.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),</div>
<div class="line">                                    intVals[0]);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a179"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4d63980e4031b0fc366e623868b27ed0a5686197bafb177bdc82550848416a1ad">MHWRender::MLightParameterInformation::kFloat</a>:</div>
<div class="line">                                lightParam-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#aa3237e2138596c256a541816278b402f">getParameter</a>( pname, floatVals );</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\tLight parameter %s. Float[%g]\n&quot;</span>, pname.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),</div>
<div class="line">                                    floatVals[0]);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a180"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4d63980e4031b0fc366e623868b27ed0a615a014b3454583f793180280757d285">MHWRender::MLightParameterInformation::kFloat2</a>:</div>
<div class="line">                                lightParam-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#aa3237e2138596c256a541816278b402f">getParameter</a>( pname, floatVals );</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\tLight parameter %s. Float[%g,%g]\n&quot;</span>, pname.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),</div>
<div class="line">                                    floatVals[0], floatVals[1]);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a181"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4d63980e4031b0fc366e623868b27ed0a2f329aadf08637405a63cee5369fd28d">MHWRender::MLightParameterInformation::kFloat3</a>:</div>
<div class="line">                                lightParam-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#aa3237e2138596c256a541816278b402f">getParameter</a>( pname, floatVals );</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\tLight parameter %s. Float3[%g,%g,%g]\n&quot;</span>, pname.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),</div>
<div class="line">                                    floatVals[0], floatVals[1], floatVals[2]);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a182"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4d63980e4031b0fc366e623868b27ed0af21770dc86a3877076e2d58842291ca4">MHWRender::MLightParameterInformation::kFloat4</a>:</div>
<div class="line">                                lightParam-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#aa3237e2138596c256a541816278b402f">getParameter</a>( pname, floatVals );</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\tLight parameter %s. Float4[%g,%g,%g,%g]\n&quot;</span>, pname.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),</div>
<div class="line">                                    floatVals[0], floatVals[1], floatVals[2], floatVals[3]);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a183"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4d63980e4031b0fc366e623868b27ed0a2242133aaee8fd15dbb632825bc4226e">MHWRender::MLightParameterInformation::kFloat4x4Row</a>:</div>
<div class="line">                                lightParam-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#aa3237e2138596c256a541816278b402f">getParameter</a>( pname, matrixVal );</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\tLight parameter %s. Float4x4Row [%g,%g,%g,%g]\n\t\t[%g,%g,%g,%g]\n\t\t[%g,%g,%g,%g]\n\t\t[%g,%g,%g,%g]\n&quot;</span>,</div>
<div class="line">                                    pname.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),</div>
<div class="line">                                    matrixVal[0][0], matrixVal[0][1], matrixVal[0][2], matrixVal[0][3],</div>
<div class="line">                                    matrixVal[1][0], matrixVal[1][1], matrixVal[1][2], matrixVal[1][3],</div>
<div class="line">                                    matrixVal[2][0], matrixVal[2][1], matrixVal[2][2], matrixVal[2][3],</div>
<div class="line">                                    matrixVal[3][0], matrixVal[3][1], matrixVal[3][2], matrixVal[3][3]</div>
<div class="line">                                    );</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a184"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4d63980e4031b0fc366e623868b27ed0a706b60512c7f5ba8200df461b672d905">MHWRender::MLightParameterInformation::kFloat4x4Col</a>:</div>
<div class="line">                                lightParam-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#aa3237e2138596c256a541816278b402f">getParameter</a>( pname, matrixVal );</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\tLight parameter %s. Float4x4Row\n&quot;</span>, pname.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>() );</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a185"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4d63980e4031b0fc366e623868b27ed0a9f41a2c609a9a7104e4d0c869d8fd2e7">MHWRender::MLightParameterInformation::kTexture2</a>:</div>
<div class="line">                            {</div>
<div class="line">                                <span class="keywordtype">void</span> *handle = lightParam-&gt;<a name="a186"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#aabc0d75c8960d98b6f8dbe31c777cf56">getParameterTextureHandle</a>( pname );</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\tLight texture parameter %s. OpenGL texture id = %d\n&quot;</span>, pname.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),</div>
<div class="line">                                    *((<span class="keywordtype">int</span> *)handle));</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a187"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4d63980e4031b0fc366e623868b27ed0a754585b88bea58243b903b023e1594f0">MHWRender::MLightParameterInformation::kSampler</a>:</div>
<div class="line">                                lightParam-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#aa3237e2138596c256a541816278b402f">getParameter</a>( pname, samplerDesc );</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\tLight sampler parameter %s. filter = %d\n&quot;</span>, pname.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>(),</div>
<div class="line">                                    samplerDesc.<a name="a188"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_sampler_state_desc.html#a0280d6ae8821c595d0300d0e65ca5adf">filter</a> );</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">default</span>:</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            }</div>
<div class="line"></div>
<div class="line">                            <span class="comment">// Do some discovery to map stock parameters to usable values</span></div>
<div class="line">                            <span class="comment">// based on the semantic</span></div>
<div class="line">                            <span class="comment">//</span></div>
<div class="line">                            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206">MHWRender::MLightParameterInformation::StockParameterSemantic</a> semantic = lightParam-&gt;<a name="a189"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a37a7621bc6d9453902d95132fbbe2101">parameterSemantic</a>( pname );</div>
<div class="line">                            <span class="keywordflow">switch</span> (semantic)</div>
<div class="line">                            {</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a190"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206a0c0ef3ac9f1f01d67e3b735df26696e8">MHWRender::MLightParameterInformation::kLightEnabled</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : light enabled\n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a191"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206a3305693a0baf5df5ae2efc000aa9c017">MHWRender::MLightParameterInformation::kWorldPosition</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : world position\n&quot;</span>);</div>
<div class="line">                                position += <a class="code" href="#!/url=./cpp_ref/class_m_float_point.html">MFloatPoint</a>( floatVals[0], floatVals[1], floatVals[2] );</div>
<div class="line">                                positionCount++;</div>
<div class="line">                                hasPosition = <span class="keyword">true</span>;</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a192"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206a4006a71da7e8283c7211624c49022eea">MHWRender::MLightParameterInformation::kWorldDirection</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : world direction\n&quot;</span>);</div>
<div class="line">                                direction = <a class="code" href="#!/url=./cpp_ref/class_m_float_vector.html">MFloatVector</a>( floatVals[0], floatVals[1], floatVals[2] );</div>
<div class="line">                                hasDirection = <span class="keyword">true</span>;</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a193"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206ae19f0601680f2872a292474ab3088b4f">MHWRender::MLightParameterInformation::kIntensity</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : intensity\n&quot;</span>);</div>
<div class="line">                                intensity = floatVals[0];</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a194"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206afc0133ebaa6c307b2388ecf5f72f6fdf">MHWRender::MLightParameterInformation::kColor</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : color\n&quot;</span>);</div>
<div class="line">                                color = <a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a>( floatVals[0], floatVals[1], floatVals[2] );</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a195"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206a71980a3324f80d049d0f1bb3deac9592">MHWRender::MLightParameterInformation::kEmitsDiffuse</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : emits-diffuse\n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a196"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206afa56ff2c2d6fc43957c91593e86212af">MHWRender::MLightParameterInformation::kEmitsSpecular</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : emits-specular\n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a197"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206a0be6585329840971e20d964386187935">MHWRender::MLightParameterInformation::kDecayRate</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : decay rate\n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a198"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206ae0f93e71d7dc59ce8212346baa5b1186">MHWRender::MLightParameterInformation::kDropoff</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : drop-off\n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a199"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206a69b7eb958dd9600fc657a046524e2371">MHWRender::MLightParameterInformation::kCosConeAngle</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : cosine cone angle\n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a200"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206a6053be989430b7fbd8b07f51528e8df4">MHWRender::MLightParameterInformation::kShadowMap</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : shadow map\n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a201"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206aa7100ad37872d44900b501f50dc70432">MHWRender::MLightParameterInformation::kShadowSamp</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : shadow map sampler\n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a202"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206ace22882d5498baf50154a878321e7953">MHWRender::MLightParameterInformation::kShadowBias</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : shadow map bias\n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a203"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206a81372e08dd4c84cb91436312913f6e3f">MHWRender::MLightParameterInformation::kShadowMapSize</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : shadow map size\n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a204"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206ae05ca22a699a25e0d2030a7a440ecbbe">MHWRender::MLightParameterInformation::kShadowViewProj</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : shadow map view projection matrix\n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a205"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206ac1cd724f83701837aee2364b308a9ed2">MHWRender::MLightParameterInformation::kShadowColor</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : shadow color\n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a206"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206aca46ea808cc9f011b3f4f014ec9040f3">MHWRender::MLightParameterInformation::kGlobalShadowOn</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : global shadows on \n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">case</span> <a name="a207"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_light_parameter_information.html#a4726f61be6b8b7b5983b153374914206a4852662e5cbf7f64d85133baa57386ab">MHWRender::MLightParameterInformation::kShadowOn</a>:</div>
<div class="line">                                printf(<span class="stringliteral">&quot;\t\t- Parameter semantic : local shadows on\n&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            <span class="keywordflow">default</span>:</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            }</div>
<div class="line"></div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                        <span class="comment">// Compute an average position</span></div>
<div class="line">                        <span class="keywordflow">if</span> (positionCount &gt; 1)</div>
<div class="line">                        {</div>
<div class="line">                            position[0] /= (float)positionCount;</div>
<div class="line">                            position[1] /= (float)positionCount;</div>
<div class="line">                            position[2] /= (float)positionCount;</div>
<div class="line">                            printf(<span class="stringliteral">&quot;\t\tCompute average position [%g,%g,%g]\n&quot;</span>, position[0],</div>
<div class="line">                                position[1], position[2]);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="comment">//delete lightParam;</span></div>
<div class="line">                        printf(<span class="stringliteral">&quot;\t}\n&quot;</span>);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html">MHWRender::MRenderer</a> *theRenderer = <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>();</div>
<div class="line">                <span class="keywordflow">if</span> (theRenderer &amp;&amp; theRenderer-&gt;<a name="a208"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#aac2a5827e6a0ce3333e62ffa7751ba5e">drawAPIIsOpenGL</a>() &amp;&amp; visualizeLighting</div>
<div class="line">                    &amp;&amp; lightCount &lt; 8)</div>
<div class="line">                {</div>
<div class="line">                    GLenum light = GL_LIGHT0+i;</div>
<div class="line"></div>
<div class="line">                    <span class="comment">// Set light parameters</span></div>
<div class="line">                    <span class="keywordtype">float</span> ambient[3] = { 0.0f, 0.0f, 0.0f };</div>
<div class="line">                    <span class="keywordtype">float</span> specular[3] = { 1.0f, 1.0f, 1.0f };</div>
<div class="line">                    glLightfv(light, GL_AMBIENT, &amp;ambient[0]);</div>
<div class="line">                    color[0] *= intensity;</div>
<div class="line">                    color[1] *= intensity;</div>
<div class="line">                    color[2] *= intensity;</div>
<div class="line">                    glLightfv(light, GL_DIFFUSE, &amp;color[0]);</div>
<div class="line">                    glLightfv(light, GL_SPECULAR, &amp;specular[0]);</div>
<div class="line"></div>
<div class="line">                    glLightf(light,  GL_CONSTANT_ATTENUATION, 1.0f);</div>
<div class="line">                    glLightf(light,  GL_LINEAR_ATTENUATION, 0.0f);</div>
<div class="line">                    glLightf(light,  GL_QUADRATIC_ATTENUATION, 0.0f);</div>
<div class="line"></div>
<div class="line">                    glPushMatrix();</div>
<div class="line">                    glLoadMatrixd( identity.<a name="a209"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34">matrix</a>[0] );</div>
<div class="line"></div>
<div class="line">                    <span class="comment">// Set light position</span></div>
<div class="line">                    <span class="keywordflow">if</span> (hasPosition)</div>
<div class="line">                        glLightfv(light, GL_POSITION, &amp;position[0]);</div>
<div class="line">                    <span class="keywordflow">else</span> {</div>
<div class="line">                        position[0] = position[1] = position[2] = 0.0f;</div>
<div class="line">                        glLightfv(light, GL_POSITION, &amp;position[0]);</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    <span class="comment">// Set rest of parameters.</span></div>
<div class="line">                    <span class="keywordflow">if</span> (hasDirection)</div>
<div class="line">                    {</div>
<div class="line">                        glLightf(light,  GL_SPOT_CUTOFF, 90.0f);</div>
<div class="line">                        glLightf(light,  GL_SPOT_EXPONENT, 64.0f);</div>
<div class="line">                        glLightfv(light, GL_SPOT_DIRECTION, &amp;direction[0]);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span></div>
<div class="line">                    {</div>
<div class="line">                        glLightf(light, GL_SPOT_CUTOFF, 180.0f);</div>
<div class="line">                        glLightf(light, GL_SPOT_EXPONENT, 0.0f);</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    glEnable(light);</div>
<div class="line">                    glPopMatrix();</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">        }</div>
<div class="line">        printf(<span class="stringliteral">&quot;}\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    hwPhongShaderOverride(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>&amp; obj)</div>
<div class="line">        : <a class="code" href="#!/url=./cpp_ref/namespace_m_h_w_render.html">MHWRender</a>::MPxShaderOverride(obj)</div>
<div class="line">        , fShaderNode(NULL)</div>
<div class="line">        , fDebugConsolidation(sDebugConsolidation) <span class="comment">// Debug consolidation status during draw</span></div>
<div class="line">        , fHandlesConsolidateGeometry(true) <span class="comment">// Set false to disable geometry consolidation</span></div>
<div class="line">        , fUseCustomData(false) <span class="comment">// Set true to use custom data. Will disable consolidation</span></div>
<div class="line">        , fShaderBound(false)</div>
<div class="line">        , fInColorPass(false)</div>
<div class="line">        , fColorShaderInstance(NULL)</div>
<div class="line">        , fNTColorShaderInstance(NULL)</div>
<div class="line">        , fInShadowPass(false)</div>
<div class="line">        , fInPointLightShadowPass(false)</div>
<div class="line">        , fShadowShaderInstance(NULL)</div>
<div class="line">        , fPointLightShadowShaderInstance(NULL)</div>
<div class="line">        , fTransparency(0.0f)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#if MAYA_API_VERSION &lt; 201650 </span></div>
<div class="line">        <span class="comment">// Option to disable not available in earlier versions</span></div>
<div class="line">        fHandlesConsolidateGeometry = <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Create a shader instance to use for drawing</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        createShaderInstance();</div>
<div class="line"></div>
<div class="line">        fAmbient[0] = fAmbient[1] = fAmbient[2] = 0.0f;</div>
<div class="line">        fDiffuse[0] = fDiffuse[1] = fDiffuse[2] = fDiffuse[3] = 0.0f;</div>
<div class="line">        fSpecular[0] = fSpecular[1] = fSpecular[2] = 0.0f;</div>
<div class="line">        fShininess[0] = fShininess[1] = fShininess[2] = 500.0f;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// override blend state when there is blending</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state.html">MHWRender::MBlendState</a> *sBlendState;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Current hwPhongShader node associated with the shader override.</span></div>
<div class="line">    <span class="comment">// Updated during doDG() time.</span></div>
<div class="line">    hwPhongShader *fShaderNode;</div>
<div class="line">    <span class="comment">// Shader inputs values including transparency</span></div>
<div class="line">    <span class="keywordtype">float</span> fTransparency;</div>
<div class="line">    <span class="keywordtype">float</span> fAmbient[3];</div>
<div class="line">    <span class="keywordtype">float</span> fDiffuse[4];</div>
<div class="line">    <span class="keywordtype">float</span> fSpecular[3];</div>
<div class="line">    <span class="keywordtype">float</span> fShininess[3];</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Pass tracking</span></div>
<div class="line">    <span class="keywordtype">bool</span> fInColorPass;</div>
<div class="line">    <span class="keywordtype">bool</span> fInShadowPass;</div>
<div class="line">    <span class="keywordtype">bool</span> fInPointLightShadowPass;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Debug consolidation status during draw</span></div>
<div class="line">    <span class="keywordtype">bool</span> fDebugConsolidation;</div>
<div class="line">    <span class="comment">// Use custom data. Disables consolidation</span></div>
<div class="line">    <span class="keywordtype">bool</span> fUseCustomData;</div>
<div class="line">    <span class="comment">// Handles consolidated geometry flag</span></div>
<div class="line">    <span class="keywordtype">bool</span> fHandlesConsolidateGeometry;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// VP2 color shader</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html">MHWRender::MShaderInstance</a> *fColorShaderInstance;</div>
<div class="line">    <span class="comment">// VP2 shadow shader</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html">MHWRender::MShaderInstance</a> *fShadowShaderInstance;</div>
<div class="line">    <span class="comment">// VP2 point light shadow shader</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html">MHWRender::MShaderInstance</a> *fPointLightShadowShaderInstance;</div>
<div class="line">    <span class="comment">// VP2 non-textured shader</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_shader_instance.html">MHWRender::MShaderInstance</a> *fNTColorShaderInstance;</div>
<div class="line">    <span class="keyword">mutable</span> <span class="keywordtype">bool</span> fShaderBound;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state.html">MHWRender::MBlendState</a>* hwPhongShaderOverride::sBlendState = NULL;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> initializePlugin( <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> obj )</div>
<div class="line">{</div>
<div class="line">    TRACE_API_CALLS(<span class="stringliteral">&quot;initializePlugin&quot;</span>);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a>   status;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>&amp; swatchName = <a name="a210"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_shader_swatch_generator.html#acf0030e7f24277ad6805a14be529539f">MHWShaderSwatchGenerator::initialize</a>();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> UserClassify( <span class="stringliteral">&quot;shader/surface/utility/:drawdb/shader/surface/hwPhongShader:swatch/&quot;</span>+swatchName );</div>
<div class="line"></div>
<div class="line">    <a name="_a211"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_plugin.html">MFnPlugin</a> plugin( obj, PLUGIN_COMPANY, <span class="stringliteral">&quot;4.5&quot;</span>, <span class="stringliteral">&quot;Any&quot;</span>);</div>
<div class="line">    status = plugin.registerNode( <span class="stringliteral">&quot;hwPhongShader&quot;</span>, hwPhongShader::id,</div>
<div class="line">                                  hwPhongShader::creator, hwPhongShader::initialize,</div>
<div class="line">                                  <a name="a212"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_node.html#a1d1cfd8ffb84e947f82999c682b666a7aee2b86760284068eef3c463f9de9babc">MPxNode::kHwShaderNode</a>, &amp;UserClassify );</div>
<div class="line">    <span class="keywordflow">if</span> (!status) {</div>
<div class="line">        status.<a name="a213"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">&quot;registerNode&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    plugin.registerDragAndDropBehavior(<span class="stringliteral">&quot;hwPhongShaderBehavior&quot;</span>,</div>
<div class="line">                                       hwPhongShaderBehavior::creator);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Register a shader override for this node</span></div>
<div class="line">    <a name="a214"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_registry.html#a7436ee759c9ea5113f5a222085dbfe6e">MHWRender::MDrawRegistry::registerShaderOverrideCreator</a>(</div>
<div class="line">        <span class="stringliteral">&quot;drawdb/shader/surface/hwPhongShader&quot;</span>,</div>
<div class="line">        sHWPhongShaderRegistrantId,</div>
<div class="line">        hwPhongShaderOverride::Creator);</div>
<div class="line">    <span class="keywordflow">if</span> (status != MS::kSuccess) <span class="keywordflow">return</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> uninitializePlugin( <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> obj )</div>
<div class="line">{</div>
<div class="line">    TRACE_API_CALLS(<span class="stringliteral">&quot;uninitializePlugin&quot;</span>);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a>   status;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_fn_plugin.html">MFnPlugin</a> plugin( obj );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Unregister all chamelion shader nodes</span></div>
<div class="line">    plugin.deregisterNode( hwPhongShader::id );</div>
<div class="line">    <span class="keywordflow">if</span> (!status) {</div>
<div class="line">        status.<a class="code" href="#!/url=./cpp_ref/class_m_status.html#a1f01a4748fea4d8bcced082df83f804d">perror</a>(<span class="stringliteral">&quot;deregisterNode&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    plugin.deregisterDragAndDropBehavior(<span class="stringliteral">&quot;hwPhongShaderBehavior&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Deregister the shader override</span></div>
<div class="line">    status = <a name="a215"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_registry.html#a11ddbef3eada4895397b8acb6c77eb2e">MHWRender::MDrawRegistry::deregisterShaderOverrideCreator</a>(</div>
<div class="line">        <span class="stringliteral">&quot;drawdb/shader/surface/hwPhongShader&quot;</span>, sHWPhongShaderRegistrantId);</div>
<div class="line">    <span class="keywordflow">if</span> (status != MS::kSuccess) <span class="keywordflow">return</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> * hwPhongShader::creator()</div>
<div class="line">{</div>
<div class="line">    TRACE_API_CALLS(<span class="stringliteral">&quot;creator&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> hwPhongShader();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> hwPhongShader::initialize()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Make sure that all attributes are cached internal for</span></div>
<div class="line">    <span class="comment">// optimal performance !</span></div>
<div class="line"></div>
<div class="line">    TRACE_API_CALLS(<span class="stringliteral">&quot;initialize&quot;</span>);</div>
<div class="line">    <a name="_a216"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html">MFnNumericAttribute</a> nAttr;</div>
<div class="line">    <a name="_a217"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_compound_attribute.html">MFnCompoundAttribute</a> cAttr;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create input attributes</span></div>
<div class="line">    aColor = nAttr.<a name="a218"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#a3b53a86b42bc4da537c4be835797c4d5">createColor</a>( <span class="stringliteral">&quot;color&quot;</span>, <span class="stringliteral">&quot;c&quot;</span>);</div>
<div class="line">    nAttr.<a name="a219"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709">setStorable</a>(<span class="keyword">true</span>);</div>
<div class="line">    nAttr.<a name="a220"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>(<span class="keyword">true</span>);</div>
<div class="line">    nAttr.<a name="a221"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#aae3f2fbbbce06e006f1838a1fb6fdcdd">setDefault</a>(0.1f, 0.1f, 0.1f);</div>
<div class="line">    nAttr.<a name="a222"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#afa3d56222eae663308e11edc39e8d153">setCached</a>( <span class="keyword">true</span> );</div>
<div class="line">    nAttr.<a name="a223"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#ae27cf2fd28a3c69b880b1096ea9e0103">setInternal</a>( <span class="keyword">true</span> );</div>
<div class="line">    nAttr.<a name="a224"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line">    </div>
<div class="line">    aTransparency = nAttr.<a name="a225"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( <span class="stringliteral">&quot;transparency&quot;</span>, <span class="stringliteral">&quot;tr&quot;</span>, <a name="a226"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a5686197bafb177bdc82550848416a1ad">MFnNumericData::kFloat</a> );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709">setStorable</a>(<span class="keyword">true</span>);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>(<span class="keyword">true</span>);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#aae3f2fbbbce06e006f1838a1fb6fdcdd">setDefault</a>(0.0f);</div>
<div class="line">    nAttr.<a name="a227"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#adab95fd85497b1dad3a4ba7a842ce9d8">setMax</a>(1.0f);</div>
<div class="line">    nAttr.<a name="a228"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#aba21b33176bb831de026b78605c1dcf3">setMin</a>(0.0f);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#afa3d56222eae663308e11edc39e8d153">setCached</a>( <span class="keyword">true</span> );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#ae27cf2fd28a3c69b880b1096ea9e0103">setInternal</a>( <span class="keyword">true</span> );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line"></div>
<div class="line">    aDiffuseColor = nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#a3b53a86b42bc4da537c4be835797c4d5">createColor</a>( <span class="stringliteral">&quot;diffuseColor&quot;</span>, <span class="stringliteral">&quot;dc&quot;</span> );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709">setStorable</a>(<span class="keyword">true</span>);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>(<span class="keyword">true</span>);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#aae3f2fbbbce06e006f1838a1fb6fdcdd">setDefault</a>(1.f, 0.5f, 0.5f);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#afa3d56222eae663308e11edc39e8d153">setCached</a>( <span class="keyword">true</span> );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#ae27cf2fd28a3c69b880b1096ea9e0103">setInternal</a>( <span class="keyword">true</span> );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line"></div>
<div class="line">    aSpecularColor = nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#a3b53a86b42bc4da537c4be835797c4d5">createColor</a>( <span class="stringliteral">&quot;specularColor&quot;</span>, <span class="stringliteral">&quot;sc&quot;</span> );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709">setStorable</a>(<span class="keyword">true</span>);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>(<span class="keyword">true</span>);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#aae3f2fbbbce06e006f1838a1fb6fdcdd">setDefault</a>(0.5f, 0.5f, 0.5f);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#afa3d56222eae663308e11edc39e8d153">setCached</a>( <span class="keyword">true</span> );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#ae27cf2fd28a3c69b880b1096ea9e0103">setInternal</a>( <span class="keyword">true</span> );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>( <span class="keyword">true</span> );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// This is defined as a compound attribute, users can easily enter</span></div>
<div class="line">    <span class="comment">// values beyond 1.</span></div>
<div class="line">    aShininessX = nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( <span class="stringliteral">&quot;shininessX&quot;</span>, <span class="stringliteral">&quot;shx&quot;</span>, <a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a5686197bafb177bdc82550848416a1ad">MFnNumericData::kFloat</a>, 100.0 );</div>
<div class="line">    aShininessY = nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( <span class="stringliteral">&quot;shininessY&quot;</span>, <span class="stringliteral">&quot;shy&quot;</span>, <a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a5686197bafb177bdc82550848416a1ad">MFnNumericData::kFloat</a>, 100.0 );</div>
<div class="line">    aShininessZ = nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( <span class="stringliteral">&quot;shininessZ&quot;</span>, <span class="stringliteral">&quot;shz&quot;</span>, <a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a5686197bafb177bdc82550848416a1ad">MFnNumericData::kFloat</a>, 100.0 );</div>
<div class="line">    aShininess = cAttr.<a name="a229"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_compound_attribute.html#a94a6d5e93a85fb18bc7accc18ee0d9f6">create</a>( <span class="stringliteral">&quot;shininess&quot;</span>, <span class="stringliteral">&quot;sh&quot;</span> );</div>
<div class="line">    cAttr.<a name="a230"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_compound_attribute.html#a45469146fcfb96cdc96ad3a07df5dfa7">addChild</a>(aShininessX);</div>
<div class="line">    cAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_compound_attribute.html#a45469146fcfb96cdc96ad3a07df5dfa7">addChild</a>(aShininessY);</div>
<div class="line">    cAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_compound_attribute.html#a45469146fcfb96cdc96ad3a07df5dfa7">addChild</a>(aShininessZ) ;</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709">setStorable</a>(<span class="keyword">true</span>);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>(<span class="keyword">true</span>);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#afa3d56222eae663308e11edc39e8d153">setCached</a>( <span class="keyword">true</span> );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#ae27cf2fd28a3c69b880b1096ea9e0103">setInternal</a>( <span class="keyword">true</span> );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a0810da59cbaac7ecbd26ba0a43d0ac35">setAffectsAppearance</a>(<span class="keyword">true</span>);   </div>
<div class="line">    cAttr.<a name="a231"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#ab8e48be1f1009a30d0e40dfcaf9e649d">setHidden</a>(<span class="keyword">false</span>);</div>
<div class="line">    </div>
<div class="line">    aGeometryShape = nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( <span class="stringliteral">&quot;geometryShape&quot;</span>, <span class="stringliteral">&quot;gs&quot;</span>, <a name="a232"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a9bb31be73c01d40428195449f62588ac">MFnNumericData::kInt</a> );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709">setStorable</a>(<span class="keyword">true</span>);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>(<span class="keyword">true</span>);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#aae3f2fbbbce06e006f1838a1fb6fdcdd">setDefault</a>(0);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#afa3d56222eae663308e11edc39e8d153">setCached</a>( <span class="keyword">true</span> );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#ae27cf2fd28a3c69b880b1096ea9e0103">setInternal</a>( <span class="keyword">true</span> );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create output attributes here</span></div>
<div class="line">    <span class="comment">// outColor is the only output attribute and it is inherited</span></div>
<div class="line">    <span class="comment">// so we do not need to create or add it.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Add the attributes here</span></div>
<div class="line"></div>
<div class="line">    addAttribute(aColor);</div>
<div class="line">    addAttribute(aTransparency);</div>
<div class="line">    addAttribute(aDiffuseColor);</div>
<div class="line">    addAttribute(aSpecularColor);</div>
<div class="line">    addAttribute(aShininess);</div>
<div class="line">    addAttribute(aGeometryShape);</div>
<div class="line"></div>
<div class="line">    attributeAffects (aColor,           outColor);</div>
<div class="line">    attributeAffects (aTransparency,    outColor);</div>
<div class="line">    attributeAffects (aDiffuseColor,    outColor);</div>
<div class="line">    attributeAffects (aSpecularColor,   outColor);</div>
<div class="line">    attributeAffects (aShininessX,      outColor);</div>
<div class="line">    attributeAffects (aShininessY,      outColor);</div>
<div class="line">    attributeAffects (aShininessZ,      outColor);</div>
<div class="line">    attributeAffects (aShininess,       outColor);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// DESCRIPTION:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> hwPhongShader::compute(</div>
<div class="line"><span class="keyword">const</span> <a name="_a233"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp;      plug,</div>
<div class="line">      <a name="_a234"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block )</div>
<div class="line">{</div>
<div class="line">    TRACE_API_CALLS(<span class="stringliteral">&quot;compute&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((plug != outColor) &amp;&amp; (plug.<a name="a235"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug.html#aa2338038d1c59dc4d35f37f918aabfab">parent</a>() != outColor))</div>
<div class="line">        <span class="keywordflow">return</span> MS::kUnknownParameter;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_float_vector.html">MFloatVector</a> &amp; color  = block.<a name="a236"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_block.html#af4a356799acd4ed070d372ed7cfb4706">inputValue</a>( aDiffuseColor ).<a name="a237"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a5e7d49f6ed0e237f1e9e43b639f06d07">asFloatVector</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// set output color attribute</span></div>
<div class="line">    <a name="_a238"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html">MDataHandle</a> outColorHandle = block.<a name="a239"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_block.html#a5e4082d6ab961bee4ec0281676bb4834">outputValue</a>( outColor );</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_float_vector.html">MFloatVector</a>&amp; outColor = outColorHandle.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a5e7d49f6ed0e237f1e9e43b639f06d07">asFloatVector</a>();</div>
<div class="line">    outColor = color;</div>
<div class="line"></div>
<div class="line">    outColorHandle.<a name="a240"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a7bdd61b8405188bb547fdba3fddace91">setClean</a>();</div>
<div class="line">    <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* virtual */</span></div>
<div class="line"><span class="keywordtype">bool</span> hwPhongShader::setInternalValue( <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> &amp;plug, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html">MDataHandle</a> &amp;handle )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (plug == aColor)</div>
<div class="line">    {</div>
<div class="line">        float3 &amp; val = handle.<a name="a241"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#abda8516acf6a0cbc9387882bc974efac">asFloat3</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (val[0] != mAmbientColor[0] ||</div>
<div class="line">            val[1] != mAmbientColor[1] ||</div>
<div class="line">            val[2] != mAmbientColor[2])</div>
<div class="line">        {</div>
<div class="line">            mAmbientColor[0] = val[0];</div>
<div class="line">            mAmbientColor[1] = val[1];</div>
<div class="line">            mAmbientColor[2] = val[2];</div>
<div class="line">            mAttributesChanged = <span class="keyword">true</span>;</div>
<div class="line">            mAttributesChangedVP2 = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plug == aTransparency)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">float</span> val = handle.<a name="a242"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a43df510424a7de372dd130315d9f223c">asFloat</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (val != mTransparency)</div>
<div class="line">        {</div>
<div class="line">            mTransparency = val;</div>
<div class="line">            mAttributesChanged = <span class="keyword">true</span>;</div>
<div class="line">            mAttributesChangedVP2 = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plug == aDiffuseColor)</div>
<div class="line">    {</div>
<div class="line">        float3 &amp; val = handle.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#abda8516acf6a0cbc9387882bc974efac">asFloat3</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (val[0] != mDiffuseColor[0] ||</div>
<div class="line">            val[1] != mDiffuseColor[1] ||</div>
<div class="line">            val[2] != mDiffuseColor[2])</div>
<div class="line">        {</div>
<div class="line">            mDiffuseColor[0] = val[0];</div>
<div class="line">            mDiffuseColor[1] = val[1];</div>
<div class="line">            mDiffuseColor[2] = val[2];</div>
<div class="line">            mAttributesChanged = <span class="keyword">true</span>;</div>
<div class="line">            mAttributesChangedVP2 = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plug == aSpecularColor)</div>
<div class="line">    {</div>
<div class="line">        float3 &amp; val = handle.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#abda8516acf6a0cbc9387882bc974efac">asFloat3</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (val[0] != mSpecularColor[0] ||</div>
<div class="line">            val[1] != mSpecularColor[1] ||</div>
<div class="line">            val[2] != mSpecularColor[2])</div>
<div class="line">        {</div>
<div class="line">            mSpecularColor[0] = val[0];</div>
<div class="line">            mSpecularColor[1] = val[1];</div>
<div class="line">            mSpecularColor[2] = val[2];</div>
<div class="line">            mAttributesChanged = <span class="keyword">true</span>;</div>
<div class="line">            mAttributesChangedVP2 = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plug == aShininessX)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">float</span> val = handle.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a43df510424a7de372dd130315d9f223c">asFloat</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (val != mShininess[0])</div>
<div class="line">        {</div>
<div class="line">            mShininess[0] = val; </div>
<div class="line">            mAttributesChanged = <span class="keyword">true</span>;</div>
<div class="line">            mAttributesChangedVP2 = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plug == aShininessY)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">float</span> val = handle.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a43df510424a7de372dd130315d9f223c">asFloat</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (val != mShininess[1])</div>
<div class="line">        {</div>
<div class="line">            mShininess[1] = val; </div>
<div class="line">            mAttributesChanged = <span class="keyword">true</span>;</div>
<div class="line">            mAttributesChangedVP2 = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plug == aShininessZ)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">float</span> val = handle.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a43df510424a7de372dd130315d9f223c">asFloat</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (val != mShininess[2])</div>
<div class="line">        {</div>
<div class="line">            mShininess[2] = val; </div>
<div class="line">            mAttributesChanged = <span class="keyword">true</span>;</div>
<div class="line">            mAttributesChangedVP2 = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plug == aGeometryShape)</div>
<div class="line">    {</div>
<div class="line">        mGeometryShape = handle.<a name="a243"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a4c3fb2724eadb8e8a3cca8ff1af10dfd">asInt</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* virtual */</span></div>
<div class="line"><span class="keywordtype">bool</span></div>
<div class="line">hwPhongShader::getInternalValue( <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug, <a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html">MDataHandle</a>&amp; handle )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (plug == aColor)</div>
<div class="line">    {</div>
<div class="line">        handle.<a name="a244"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a2a75482f517f405a641c0eee0bd995ac">set</a>( mAmbientColor[0], mAmbientColor[1], mAmbientColor[2] );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (plug == aTransparency)</div>
<div class="line">    {</div>
<div class="line">        handle.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a2a75482f517f405a641c0eee0bd995ac">set</a>( mTransparency );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plug == aDiffuseColor)</div>
<div class="line">    {</div>
<div class="line">        handle.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a2a75482f517f405a641c0eee0bd995ac">set</a>( mDiffuseColor[0], mDiffuseColor[1], mDiffuseColor[2] );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plug == aSpecularColor)</div>
<div class="line">    {</div>
<div class="line">        handle.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a2a75482f517f405a641c0eee0bd995ac">set</a>( mSpecularColor[0], mSpecularColor[1], mSpecularColor[2] );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plug == aShininessX)</div>
<div class="line">    {</div>
<div class="line">        handle.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a2a75482f517f405a641c0eee0bd995ac">set</a>( mShininess[0] );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plug == aShininessY)</div>
<div class="line">    {</div>
<div class="line">        handle.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a2a75482f517f405a641c0eee0bd995ac">set</a>( mShininess[1] );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plug == aShininessZ)</div>
<div class="line">    {</div>
<div class="line">        handle.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a2a75482f517f405a641c0eee0bd995ac">set</a>( mShininess[2] );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plug == aGeometryShape)</div>
<div class="line">    {</div>
<div class="line">        handle.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a2a75482f517f405a641c0eee0bd995ac">set</a>( (<span class="keywordtype">int</span>) mGeometryShape );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Swatch rendering: </span></div>
<div class="line"><span class="comment">// Does not matter the mode for the viewport VP1 or VP2</span></div>
<div class="line"><span class="comment">// Uses material viewer utility which uses the VP2 render to draw the swatch.</span></div>
<div class="line"><span class="comment"></span><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> hwPhongShader::renderSwatchImage(<a name="_a245"></a><a class="code" href="#!/url=./cpp_ref/class_m_image.html">MImage</a> &amp; outImage)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>())</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Use some sample objects for display</span></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> meshSphere(<span class="stringliteral">&quot;meshTeapot&quot;</span>);</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> meshShaderball(<span class="stringliteral">&quot;meshShaderball&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> targetW, targetH;</div>
<div class="line">        outImage.<a name="a246"></a><a class="code" href="#!/url=./cpp_ref/class_m_image.html#acab1f6acf34fc74e4d717322fa35241a">getSize</a>(targetW, targetH);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> <a name="a247"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_utilities.html#a73c521cb743ed9cc5a595f29d7428e91">MHWRender::MRenderUtilities::renderMaterialViewerGeometry</a>(targetW &gt; 128 ? meshShaderball : meshSphere,</div>
<div class="line">            thisMObject(),</div>
<div class="line">            outImage,</div>
<div class="line">            <a name="a248"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_utilities.html#af9563ae2bd890aa0fb7782f626e35bc7a2cec741abb80798c163d0aea01676163">MHWRender::MRenderUtilities::kPerspectiveCamera</a>,</div>
<div class="line">            <a name="a249"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_render_utilities.html#ad15b3d1fb21d3d61911ada0e2bc9b12bab22f7d3eb3e3131a6e8876dccaf3e934">MHWRender::MRenderUtilities::kSwatchLight</a>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* virtual */</span></div>
<div class="line"><span class="keywordtype">int</span> hwPhongShader::normalsPerVertex()</div>
<div class="line">{</div>
<div class="line">    TRACE_API_CALLS(<span class="stringliteral">&quot;normalsPerVertex&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* virtual */</span></div>
<div class="line"><span class="keywordtype">int</span> hwPhongShader::texCoordsPerVertex()</div>
<div class="line">{</div>
<div class="line">    TRACE_API_CALLS(<span class="stringliteral">&quot;texCoordsPerVertex&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* virtual */</span></div>
<div class="line"><span class="keywordtype">int</span> hwPhongShader::getTexCoordSetNames(<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>&amp; names)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* virtual */</span></div>
<div class="line"><span class="keywordtype">bool</span> hwPhongShader::hasTransparency()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> (mTransparency &gt; 0.0f);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* virtual */</span></div>
<div class="line"><span class="keywordtype">bool</span> hwPhongShader::provideVertexIDs()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> sTestVertexIdAndFaceId || sTestIndexing;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* virtual */</span></div>
<div class="line"><span class="keywordtype">bool</span> hwPhongShader::provideFaceIDs()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> sTestVertexIdAndFaceId || sTestIndexing;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* virtual */</span></div>
<div class="line"><span class="keywordtype">bool</span> hwPhongShader::provideLocalUVCoord()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> sTestLocalUVCoord || sTestIndexing;</div>
<div class="line">}</div>
<div class="line"><span class="comment">// =====================================================================</span></div>
<div class="line"><span class="comment">// Copyright 2018 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This computer source code  and related  instructions and comments are</span></div>
<div class="line"><span class="comment">// the unpublished confidential and proprietary information of Autodesk,</span></div>
<div class="line"><span class="comment">// Inc. and are  protected  under applicable  copyright and trade secret</span></div>
<div class="line"><span class="comment">// law. They may not  be disclosed to, copied or used by any third party</span></div>
<div class="line"><span class="comment">// without the prior written consent of Autodesk, Inc.</span></div>
<div class="line"><span class="comment">// =====================================================================</span></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->

      <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
   </div></body>
</html>
