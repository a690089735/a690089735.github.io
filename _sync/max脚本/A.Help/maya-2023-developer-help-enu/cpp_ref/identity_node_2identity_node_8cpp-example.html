<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
      <title>C++ API Reference: identityNode/identityNode.cpp</title>
      
	  
      
      
      
      
      
      
      
    

</head>
   <body height="100%"><div class="body_content" id="body-content"><link rel="stylesheet" type="text/css" href="cpp_ref/navtree.css"><link rel="stylesheet" type="text/css" href="cpp_ref/doxygen.css"><link rel="stylesheet" type="text/css" href="cpp_ref/tabs.css"><link rel="stylesheet" type="text/css" href="style/adsk.cpm.css"><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('identity_node_2identity_node_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
      <div>
         <div class="head">
            <h1>C++ API Reference: identityNode/identityNode.cpp</h1>
         </div>

<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->

  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="#!/url=./cpp_ref/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="#!/url=./cpp_ref/pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="#!/url=./cpp_ref/modules.html"><span>Modules</span></a></li>
      <li><a href="#!/url=./cpp_ref/namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="#!/url=./cpp_ref/annotated.html"><span>Classes</span></a></li>
      <li><a href="#!/url=./cpp_ref/examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="cpp_ref/search/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="cpp_ref/search/close.png" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>

<div id="doc-content">
<!-- window showing the filter options -->


<!-- iframe showing the search results (closed by default) -->


<div class="header">
  <div class="headertitle">
<div class="title">identityNode/identityNode.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 2015 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk</span></div>
<div class="line"><span class="comment">// license agreement provided at the time of installation or download,</span></div>
<div class="line"><span class="comment">// or which otherwise accompanies this software in either electronic</span></div>
<div class="line"><span class="comment">// or hard copy form.</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  File: identityNode.cpp</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      Empty implementation of a deformer. This node</span></div>
<div class="line"><span class="comment">//      performs no deformation and is basically an empty</span></div>
<div class="line"><span class="comment">//      shell that can be used to create actual deformers.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//      Use this script to create a simple example with the identity node.</span></div>
<div class="line"><span class="comment">//      </span></div>
<div class="line"><span class="comment">//      loadPlugin identityNode;</span></div>
<div class="line"><span class="comment">//      </span></div>
<div class="line"><span class="comment">//      polyTorus -r 1 -sr 0.5 -tw 0 -sx 50 -sy 50 -ax 0 1 0 -cuv 1 -ch 1;</span></div>
<div class="line"><span class="comment">//      deformer -type &quot;identity&quot;;</span></div>
<div class="line"><span class="comment">//      setKeyframe -v 0 -at weightList[0].weights[0] -t 1 identity1;</span></div>
<div class="line"><span class="comment">//      setKeyframe -v 1 -at weightList[0].weights[0] -t 60 identity1;</span></div>
<div class="line"><span class="comment">//      select -cl;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnPlugin.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MTypeId.h&gt;</span> </div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MStringArray.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPxDeformerNode.h&gt;</span> </div>
<div class="line"><span class="preprocessor">#include &lt;maya/MItGeometry.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPoint.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPxGPUDeformer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGPUDeformerRegistry.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MOpenCLInfo.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;clew/clew.h&gt;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>identityNode : <span class="keyword">public</span> <a name="_a0"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_deformer_node.html">MPxDeformerNode</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">static</span>  <span class="keywordtype">void</span>*   creator();</div>
<div class="line">    <span class="keyword">static</span>  <a name="_a1"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> initialize();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Deformation function</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> <a name="a2"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_geometry_filter.html#a30d9732c7497ec1c8c7e431eaa5d61b6">deform</a>(<a name="_a3"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp;    block,</div>
<div class="line">                           <a name="_a4"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html">MItGeometry</a>&amp;   iter,</div>
<div class="line">                           <span class="keyword">const</span> <a name="_a5"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a>&amp; mat,</div>
<div class="line">                           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> multiIndex) <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <a name="_a6"></a><a class="code" href="#!/url=./cpp_ref/class_m_type_id.html">MTypeId</a> id;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// path from where the plugin was loaded</span></div>
<div class="line">    <span class="keyword">static</span> <a name="_a7"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> pluginPath;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_type_id.html">MTypeId</a> identityNode::id( 0x8000d );</div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> identityNode::pluginPath;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span>* identityNode::creator()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> identityNode();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> identityNode::initialize()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <a name="a8"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MStatus::kSuccess</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a></div>
<div class="line">identityNode::deform( <a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block,</div>
<div class="line">                      <a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html">MItGeometry</a>&amp; iter,</div>
<div class="line">                      <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a>&amp; <span class="comment">/*m*/</span>,</div>
<div class="line">                      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> multiIndex)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> returnStatus;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Iterate through each point in the geometry.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">for</span> ( ; !iter.<a name="a9"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html#a8b6dbf6fbab6f4e7bf50a309124cbf4c">isDone</a>(); iter.<a name="a10"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html#a73616f002814b8abe6d921db72d7a496">next</a>()) {</div>
<div class="line">        <a name="_a11"></a><a class="code" href="#!/url=./cpp_ref/class_m_point.html">MPoint</a> pt = iter.<a name="a12"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html#a5880c110ed81dd4da0289ccdca5c1592">position</a>();</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Perform some calculation on pt.</span></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Set the final position.</span></div>
<div class="line">        iter.<a name="a13"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html#aab29469f67fee14833472410a17de18f">setPosition</a>(pt);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> returnStatus;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// The GPU override implementation of the identityNode</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keyword">class </span>identityGPUDeformer : <span class="keyword">public</span> <a name="_a14"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_g_p_u_deformer.html">MPxGPUDeformer</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">static</span> <a name="_a15"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registration_info.html">MGPUDeformerRegistrationInfo</a>* getGPUDeformerInfo();</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> validateNodeInGraph(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a name="_a16"></a><a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp;, <span class="keyword">const</span> <a name="_a17"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug, <a name="_a18"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>* messages);</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> validateNodeValues(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp;, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug, <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>* messages);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Virtual methods from MPxGPUDeformer</span></div>
<div class="line">    identityGPUDeformer();</div>
<div class="line">    ~identityGPUDeformer() <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Implementation of MPxGPUDeformer.</span></div>
<div class="line">    MPxGPUDeformer::DeformerStatus <a name="a19"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_g_p_u_deformer.html#a070259639bc552fd702c9e8e042f0331">evaluate</a>(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; outputPlug, <span class="keyword">const</span> <a name="_a20"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug_array.html">MPlugArray</a>&amp; inputPlugs, <span class="keyword">const</span> <a name="_a21"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_data.html">MGPUDeformerData</a>&amp; inputData, <a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_data.html">MGPUDeformerData</a>&amp; outputData) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a name="a22"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_g_p_u_deformer.html#a74a45d2648335936561898c390281a6a">terminate</a>() <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="comment">// Kernel</span></div>
<div class="line">    <a name="_a23"></a><a class="code" href="#!/url=./cpp_ref/class_m_auto_c_l_kernel.html">MAutoCLKernel</a> fKernel;</div>
<div class="line">    <span class="keywordtype">size_t</span> fLocalWorkSize;</div>
<div class="line">    <span class="keywordtype">size_t</span> fGlobalWorkSize;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// registration information for the identity GPU deformer.</span></div>
<div class="line"><span class="keyword">class </span>identityGPUDeformerInfo : <span class="keyword">public</span> <a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registration_info.html">MGPUDeformerRegistrationInfo</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    identityGPUDeformerInfo(){}</div>
<div class="line">    ~identityGPUDeformerInfo()<span class="keyword"> override</span>{}</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_px_g_p_u_deformer.html">MPxGPUDeformer</a>* <a name="a24"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registration_info.html#a69ee4850048ea760d9e03f2deaf957e4">createGPUDeformer</a>()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">new</span> identityGPUDeformer();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a25"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registration_info.html#af612f89c960cf432dc7be0d3f1be8d93">validateNodeInGraph</a>(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug, <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>* messages)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">return</span> identityGPUDeformer::validateNodeInGraph(block, evaluationNode, plug, messages);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a26"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registration_info.html#a5211d6842c7677f9730a9c76cb258568">validateNodeValues</a>(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug, <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>* messages)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">return</span> identityGPUDeformer::validateNodeValues(block, evaluationNode, plug, messages);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registration_info.html">MGPUDeformerRegistrationInfo</a>* identityGPUDeformer::getGPUDeformerInfo()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> identityGPUDeformerInfo theOne;</div>
<div class="line">    <span class="keywordflow">return</span> &amp;theOne;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">identityGPUDeformer::identityGPUDeformer()</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">identityGPUDeformer::~identityGPUDeformer()</div>
<div class="line">{</div>
<div class="line">    terminate();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> identityGPUDeformer::validateNodeInGraph(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug, <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>* messages)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Support everything.</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> identityGPUDeformer::validateNodeValues(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug, <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>* messages)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Support everything.</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MPxGPUDeformer::DeformerStatus identityGPUDeformer::evaluate(</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug_array.html">MPlugArray</a>&amp; inputPlugs,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_data.html">MGPUDeformerData</a>&amp; inputData,</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_data.html">MGPUDeformerData</a>&amp; outputData</div>
<div class="line">    )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// identityNode only supports a single mesh input plug</span></div>
<div class="line">    <span class="keywordflow">if</span> (inputPlugs.<a name="a27"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() != 1)</div>
<div class="line">        <span class="keywordflow">return</span> MPxGPUDeformer::kDeformerFailure;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; inputPlug = inputPlugs[0];</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a name="_a28"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html">MGPUDeformerBuffer</a> inputPositions = inputData.<a name="a29"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_data.html#a5ce2553c6e11160092fa5f97721f0262">getBuffer</a>(<a name="a30"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_g_p_u_deformer.html#a3355163bdc23aa2119a8b321e8e91fe5">MPxGPUDeformer::sPositionsName</a>(), inputPlug);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html">MGPUDeformerBuffer</a> outputPositions = createOutputBuffer(inputPositions);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!inputPositions.<a name="a31"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html#aac1b70a2ed67ead038c4d3f5ac4d8a81">isValid</a>() || !outputPositions.<a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html#aac1b70a2ed67ead038c4d3f5ac4d8a81">isValid</a>()) <span class="keywordflow">return</span> MPxGPUDeformer::kDeformerFailure;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numElements = inputPositions.<a name="a32"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html#ac9580a2ec3ad9690d0fb0ea0b3179fec">elementCount</a>();</div>
<div class="line">    cl_int err = CL_SUCCESS;    </div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Setup OpenCL kernel.</span></div>
<div class="line">    <span class="keywordflow">if</span> ( !fKernel.get() )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Get and compile the kernel.</span></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> openCLKernelFile = identityNode::pluginPath + <span class="stringliteral">&quot;/identity.cl&quot;</span>;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> openCLKernelName(<span class="stringliteral">&quot;identity&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_auto_c_l_kernel.html">MAutoCLKernel</a> kernel = <a name="a33"></a><a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_info.html#a9b9a0680620c0ecac7dd1b07159ee72f">MOpenCLInfo::getOpenCLKernel</a>( openCLKernelFile, openCLKernelName );</div>
<div class="line">        <span class="keywordflow">if</span> ( kernel.<a name="a34"></a><a class="code" href="#!/url=./cpp_ref/class_m_auto_c_l_kernel.html#ac02f2a4d7312eb91f40980adfd4e31b2">isNull</a>() )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> MPxGPUDeformer::kDeformerFailure;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        fKernel = kernel;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Figure out a good work group size for our kernel.</span></div>
<div class="line">        fLocalWorkSize = 0;</div>
<div class="line">        fGlobalWorkSize = 0;</div>
<div class="line">        <span class="keywordtype">size_t</span> retSize = 0;</div>
<div class="line">        err = clGetKernelWorkGroupInfo(</div>
<div class="line">            fKernel.get(),</div>
<div class="line">            <a name="a35"></a><a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_info.html#a7861622490349f1240dfbe76c21e3e0a">MOpenCLInfo::getOpenCLDeviceId</a>(),</div>
<div class="line">            CL_KERNEL_WORK_GROUP_SIZE,</div>
<div class="line">            <span class="keyword">sizeof</span>(size_t),</div>
<div class="line">            &amp;fLocalWorkSize,</div>
<div class="line">            &amp;retSize</div>
<div class="line">            );</div>
<div class="line">        <a name="a36"></a><a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_info.html#a753d7277906776cd710b3723d74f8b64">MOpenCLInfo::checkCLErrorStatus</a>(err);</div>
<div class="line">        <span class="keywordflow">if</span> ( err != CL_SUCCESS || retSize == 0 || fLocalWorkSize == 0)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> MPxGPUDeformer::kDeformerFailure;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Global work size must be a multiple of local work size.</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">size_t</span> remain = numElements % fLocalWorkSize;</div>
<div class="line">        <span class="keywordflow">if</span> ( remain )</div>
<div class="line">        {</div>
<div class="line">            fGlobalWorkSize = numElements + ( fLocalWorkSize - remain );</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            fGlobalWorkSize = numElements;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set all of our kernel parameters.  Input buffer and output buffer may be changing every frame</span></div>
<div class="line">    <span class="comment">// so always set them.</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> parameterId = 0;</div>
<div class="line">    err = clSetKernelArg(fKernel.get(), parameterId++, <span class="keyword">sizeof</span>(cl_mem), (<span class="keywordtype">void</span>*)outputPositions.buffer().getReadOnlyRef());</div>
<div class="line">    <a name="_a37"></a><a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_info.html">MOpenCLInfo</a>::checkCLErrorStatus(err);</div>
<div class="line">    err = clSetKernelArg(fKernel.get(), parameterId++, sizeof(cl_mem), (<span class="keywordtype">void</span>*)inputPositions.buffer().getReadOnlyRef());</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_info.html">MOpenCLInfo</a>::checkCLErrorStatus(err);</div>
<div class="line">    err = clSetKernelArg(fKernel.get(), parameterId++, sizeof(cl_uint), (<span class="keywordtype">void</span>*)&amp;numElements);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_info.html">MOpenCLInfo</a>::checkCLErrorStatus(err);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set up our input events.  The input event could be NULL, in that case we need to pass</span></div>
<div class="line">    <span class="comment">// slightly different parameters into clEnqueueNDRangeKernel.</span></div>
<div class="line">    cl_event events[ 1 ] = { 0 };</div>
<div class="line">    cl_uint eventCount = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (inputPositions.<a name="a38"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html#ac80e15ff48577dcb6db7ba2db5788427">bufferReadyEvent</a>().<a name="a39"></a><a class="code" href="#!/url=./cpp_ref/class_m_auto_c_l_event.html#a9ae83b577cfbaa81ee19053c78dedccd">get</a>() )</div>
<div class="line">    {</div>
<div class="line">        events[ eventCount++ ] = inputPositions.<a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html#ac80e15ff48577dcb6db7ba2db5788427">bufferReadyEvent</a>().<a class="code" href="#!/url=./cpp_ref/class_m_auto_c_l_event.html#a9ae83b577cfbaa81ee19053c78dedccd">get</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Run the kernel</span></div>
<div class="line">    <a name="_a40"></a><a class="code" href="#!/url=./cpp_ref/class_m_auto_c_l_event.html">MAutoCLEvent</a> kernelFinishedEvent;</div>
<div class="line">    err = clEnqueueNDRangeKernel(</div>
<div class="line">        <a name="a41"></a><a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_info.html#a93e129c1488b06f3347eaaad703ffe34">MOpenCLInfo::getMayaDefaultOpenCLCommandQueue</a>() ,</div>
<div class="line">        fKernel.get() ,</div>
<div class="line">        1 ,</div>
<div class="line">        NULL ,</div>
<div class="line">        &amp;fGlobalWorkSize ,</div>
<div class="line">        &amp;fLocalWorkSize ,</div>
<div class="line">        eventCount ,</div>
<div class="line">        eventCount ? events : NULL ,</div>
<div class="line">        kernelFinishedEvent.<a name="a42"></a><a class="code" href="#!/url=./cpp_ref/class_m_auto_c_l_event.html#a5622645d1b16ac4ab77c233dcea5c5be">getReferenceForAssignment</a>()</div>
<div class="line">        );</div>
<div class="line">    outputPositions.<a name="a43"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html#ac46e36b6959e261802c9603be6137302">setBufferReadyEvent</a>(kernelFinishedEvent);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_info.html#a753d7277906776cd710b3723d74f8b64">MOpenCLInfo::checkCLErrorStatus</a>(err);</div>
<div class="line">    <span class="keywordflow">if</span> ( err != CL_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> MPxGPUDeformer::kDeformerFailure;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    outputData.<a name="a44"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_data.html#a9710db42ff7918d4b588b0045fecdcd0">setBuffer</a>(outputPositions);</div>
<div class="line">    <span class="keywordflow">return</span> MPxGPUDeformer::kDeformerSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> identityGPUDeformer::terminate()</div>
<div class="line">{</div>
<div class="line">    <a name="a45"></a><a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_info.html#a08df219d94dcf2dc03724eff7d5c6483">MOpenCLInfo::releaseOpenCLKernel</a>(fKernel);</div>
<div class="line">    fKernel.reset();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// standard initialization procedures</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> initializePlugin( <a name="_a46"></a><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> obj )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> result;</div>
<div class="line"></div>
<div class="line">    <a name="_a47"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_plugin.html">MFnPlugin</a> plugin( obj, PLUGIN_COMPANY, <span class="stringliteral">&quot;3.0&quot;</span>, <span class="stringliteral">&quot;Any&quot;</span>);</div>
<div class="line">    result = plugin.registerNode(</div>
<div class="line">        <span class="stringliteral">&quot;identity&quot;</span> ,</div>
<div class="line">        identityNode::id ,</div>
<div class="line">        &amp;identityNode::creator ,</div>
<div class="line">        &amp;identityNode::initialize ,</div>
<div class="line">        <a name="a48"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_node.html#a1d1cfd8ffb84e947f82999c682b666a7a397b2fe312ffa55c207f8f9b12f616d3">MPxNode::kDeformerNode</a></div>
<div class="line">        );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> nodeClassName(<span class="stringliteral">&quot;identity&quot;</span>);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> registrantId(<span class="stringliteral">&quot;mayaPluginExample&quot;</span>);</div>
<div class="line">    <a name="a49"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registry.html#adea377dddd00bec03a6cdf70360f567f">MGPUDeformerRegistry::registerGPUDeformerCreator</a>(</div>
<div class="line">        nodeClassName,</div>
<div class="line">        registrantId,</div>
<div class="line">        identityGPUDeformer::getGPUDeformerInfo()</div>
<div class="line">        );</div>
<div class="line"></div>
<div class="line">    identityNode::pluginPath = plugin.loadPath();</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> uninitializePlugin( <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> obj )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> result;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> nodeClassName(<span class="stringliteral">&quot;identity&quot;</span>);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> registrantId(<span class="stringliteral">&quot;mayaPluginExample&quot;</span>);</div>
<div class="line">    <a name="a50"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registry.html#aa290ea8dc9cb67e1056f132b8e441d5f">MGPUDeformerRegistry::deregisterGPUDeformerCreator</a>(</div>
<div class="line">        nodeClassName,</div>
<div class="line">        registrantId</div>
<div class="line">        );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_fn_plugin.html">MFnPlugin</a> plugin( obj );</div>
<div class="line">    result = plugin.deregisterNode( identityNode::id );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->

      <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
   </div></body>
</html>
