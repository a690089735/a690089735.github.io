[地点]
??
[人员]
1
[设备]
电脑整机,鼠标键盘
stablediffusion,要分享的词库小工具,vscode
麦克风,直播软件(屏幕共享)
摄像头(可选,没必要)
[准备]
一组预定义好的自定义词库

[讲解]
给大家分享一个简单朴素的小工具,方便大家定义自己的AI绘画词库.但是这个小工具的使用方向也不仅限于此,只要和组词造句有关的事情,它都能起到帮助作用.而这个工具的灵感,也是来自于自己以前设计的一个训练想象力的小程序,就是那种谁在什么时候干什么,然后发生了什么,最后怎么怎么样了.把主语,谓语,宾语,或者角色,事件,名词,动词,随机事件按一定结构组合起来,形成一段文字描述的小剧情的工具.
现在这个词库小工具主要用作描述词词组的组合,以及自定义词组的重复利用.
这个小工具的核心分为"界面"和"数据"两个部分,他的界面是使用python里面一个叫pyside6的模块写的,主要用于可视化描述词词条数据,以及提供一些简单的功能.目前的两组基础词条数据是从网上爬的,质量可能没有人工维护的好,建议大家还是自己组建专用的词条数据库.
词条数据使用json格式单独储存和修改(json:这森,"这森衣服真好看"的"这森",json衣服真好看,json),json格式是文本文件,用记事本就能打开和修改,大家只要在创建数据的时候遵照一点格式,就能自己维护一套专有的数据库了.这个格式也不难,比如写作文的时候,每个自然段前面要空两个格,还有描述某个人说话需要用冒号标记,再拿引号把这个人说的话括起来.就和这些规则差不多.具体的格式我们后面再简单介绍一下.
[讲解]
首先,我们先把界面和数据这两部分,分别了解一下.
工具界面布局主要分为左右两块,左面一组区域:里面一条条的选项卡,和排列放置的按钮,是用来展示描述词库的,选项卡的标题和按钮上的名称,展示了json文件中的内容,并且提供可以选中的按钮,选中的词会按一定规则传递到右侧的显示框中.
有些自定义的描述词可能会特别特别长,全部显示在按钮上可能不符合普遍需求.我这里把它做了截断处理,短的字符还是正常显示,但是遇到较长的字符组合,一组预定义的描述词,比如"official art,extremely detailed,CG,8k wallpaper"有40多个字符,显示出来可能就是official art,extremely det...这样的.这样的截断效果可能会影响我们查看实际内容的体验,所以这里对所有按钮都加了一个气泡提示,只要鼠标在上面停一下,就能看到完整的描述内容,然后再根据需要进行选择.兼顾了较短的按钮和完整的显示.
这个气泡提示不光显示内容,为了方便组词,还加了一个语法提示.这个语法提示和我们的描述词顺序相关,也和预览页面的文字背景色相关,至于如何定义语法提示内容,我们在下部分创建json数据的部分说明.
[讲解]
现在最新一版对选项卡加了一点优化,之前的版本不方便查看哪些分类有选上的词.每次选择完描述词后,如果切换了选项卡,之前的选择就像被藏起来了一样,再想找到之前点过的词非常困难.新版本添加了一个统计效果,我们能在选项卡上看到每个分类选中了多少描述词,想去掉,过者想找到之前的描述词,可以按这个计数去查找.
[讲解]
右边分为描述词显示框和功能按钮.描述词显示栏用来预览已经选择的描述词,功能按钮上绑定了一些简单的功能.



[讲解]
之前的0.12版本,数据分类是写死的,只能在文本和emoji的json文件的基础上改,修改难度大,而且加的词太多了之后越改越卡,词条的分类细度也不好控制.
现在这个版本把数据完全独立了出来,每次启动的时候,界面程序会读取目录下的json文件,每个json文件都可以作为一个主选项卡添加.[演示-复制一个文件]并且分类细度完全可以自定义,想分的粗点就粗点,想细点就细点.
[讲解]
顶层选项卡可以根据json文件的文件名来进行排序.
[演示]更改文件名称来改变选项卡顺序

[讲解]
不出意外的话,目前的0.16.1版本将是0.1系列的最后一个版本,这一系列主要核心功能,是使用json格式记录数据,再通过用户界面展示和组合数据.
经过实际测试,其实后面打算淘汰json格式的数据,改为excel表格的方式储存和维护数据.
目前认为,大部分用户对于json格式的文件有很高的的维护门槛,而excel表格能很好的提供数据维护相关的功能,极大降低数据的维护和利用成本.让大家更愉快的创建和使用自己的绘画词库.
但起码未来几个月内,仍然还会继续利用json文件储存和维护数据.因为现在的情况下,json文件有比excel更好的储存效果.json格式可以无限套娃,也因此可以直接实现词库的4层分组甚至更多层分组的储存系统.按照现有设计,excel只能直接实现3层数据分组,要是想实现词库需要的4层分组效果,需要用一些方法曲线救国,间接实现4层分组的效果.间接实现4层分组的效果有很多方法,都各有优劣,尤其是当涉及到用户操作的时候,更是不容易取舍和设计.所以中短期内仍然不会提供支持excel格式的新版本词库工具,在新版设计能成为生产力之前,仍然是只能使用json格式来记录和维护数据.

下面我们讲解一下如何制作json格式的数据文件供词库使用.后面只计划了说一下怎么写json文件,对这部分感兴趣的朋友可以继续看,不感兴趣的朋友可以跳过了.
[演示]新建一个json文件
[讲解]
词库使用的json格式文件的基本语法为{"甲":"A"},一个词加冒号,再加另一个词,这样的两个词作为形成对照关系,前面的词叫键,后面的词叫值.最后,把键和值用括号括起来就行.注意,实际的json文件要更强大的多,这里只是介绍词库相关的基本使用方法.
当我们有了{"甲":"A"}这样的一组成对的键值,这种成对的键值,我一般把它们叫做键值对.现在,我们有了一个最简单的词条记录.这里需要了解的是,大括号里可以有很多很多的键值对,只需要用","进行短句即可.比如:
{"甲":"A","乙":"B","丙":"C"}

这些键值对是可以换行的,为了方便阅读,大家一般会像下面这样竖着写:
{
    "甲":"A",
    "乙":"B",
    "丙":"C"
}
换行后,大家普遍都会在键值对的前面空一点点,就像写作文时候的自然段一样,方便阅读.不过还有个要注意的地方,就是不管是横着写,还是竖着写,最后一个键值对都不加逗号的.
被大括号包裹的全部内容,通称"字典"."字典"就是上面被大括号括起来的一组组键值对,键值对主要用来记录对照的关系.
以上这些,是词库中使用的json格式文件的最基本语法.其实和写作文都是很相像的,相信朋友们都可以轻松掌握.
但是想在词库中使用写好的词条,还缺少两项参数,那就是:分类,和属性.要实现分类和属性的记录,我们这里就要利用json的无限套娃功能.
上面讲到"甲":"A"这组键值对中,前面的"甲"是键,后面的"A"是值.我们没讲的是,其实值不只能是"A"这样的词语,也可以用字典作为值!
想让"甲"对应的英文是"A",对应的数字是"0",可以写成多个键值对,然后用大括号包裹,就像下面的样子.
{
    "甲":"A"
}
变为
{
    "甲":{
        "英文":"A",
        "数字":"0"
    }
}
观察一下,不难发现,改变前后的主要区别,在于"甲"的对应值,由原来的"A",变为了一个字典,这个字典里包括"英文"的键和对应值"A",还有叫"数字"的键和对应值"0".这样我们就成功为"甲"记录了两条属性.

要添加分类,其实也和上边的写法差不多.只需要继续套娃即可.比如写成下面这样:
{
    "天干":{
        "甲":{
            "英文":"A",
            "数字":"0"
        },
        "乙":{
            "英文":"B",
            "数字":"1"
        },
        "丙":{
            "英文":"C",
            "数字":"2"
        }
    },
    "地支":{
        "子":{
            "英文":"K",
            "数字":"10"
        },
        "丑":{
            "英文":"L",
            "数字":"11"
        }
    }
}
这样的格式,就基本和我们词库所用的json文件一样了.实际使用的时候,建议大家复制一个模板改一改,要比纯手写简单的多.
词库数据实际写法要多一个分组层,而且词条的属性是text和order,所以应该像下面这样:
{
    "常用": {
        "图像优化": {
            "大师作品": {
                "text": "masterpiece",
                "order": 0
            },
            "最好画质": {
                "text": "best quality",
                "order": 0
            },
            "更高质量": {
                "text": "official art,extremely detailed,CG,8k wallpaper",
                "order": 0
            },
            "高细节": {
                "text": "highly detailed",
                "order": 0
            },
            "超高分辨率": {
                "text": "absurdres",
                "order": 0
            },
            "8k分辨率": {
                "text": "8k resolution",
                "order": 0
            }
        }
    }
}
词条的键,词条的显示内容,text属性,是词条的实际内容,也就是最后要进绘画工具中的内容,order是词条的排列顺序,越小的数字就越靠前,0是最小的数字,比如像大师作品(masterpiece)这样的质量词条,我们把order写成0,他就永远会在其他词条的最前面.
这个数字不仅可以排序,还和hint.set文件中的记录相匹配,决定的词条的提示类型和文字背景色.
hint.set文件中的提示类型和颜色都可以更改,但是数量不能多不能少.

在新版的词库工具中,移除了旧版设计中的预设功能,这个预设功能被现在的自定义数据的功能完全取代,只需要新建一个json文件,就相当于添加了一套预设,并且玩法更多,功能更强大,原来的设计实在没有存在的必要了.
如果想新建一组预设,只需要像创建词库一样操作即可,比如:
[实现准备一个写好的配套词(针对模型)]
[演示]
[讲解]
最后一提,很多朋友不知道emoji的怎么使用,其实每个emoji都能作为一个象形文字作为StableDiffusion的描述词,一些情况下,配合文字描述会有不错的效果.
[演示]利用简单的Emoji作为描述,在SD中文生图.

就像最开始说的那样,json数据的创建部分了解一下就好,因为它实在是不太方便手动维护.
这边后续打算把它改成直接读取excel的方式,这样大家可以直接修改excel表格来维护词库了.


到这里为止,我们提到了词库小工具的用法,通过组织和利用数据,方便收集和复用词条,
还提到了json格式数据的写法,主要关键的是和大括号,冒号,引号有关的书写语法,因为json格式可以无限套娃,所以我们在短期内仍然会坚持使用这种格式来记录和维护数据.在未来,我们打算将维护数据的方法由json换成excel,降低使用门槛.但短期内没有较好的策略能够让excel表格满足词库工具当前的需求.
希望大家都可以借助小工具组织自己的生产力词库,愉快享受AI绘画的乐趣.
