<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
      <title>C++ API Reference: AbcBullet/MayaTransformWriter.cpp</title>
      
	  
      
      
      
      
      
      
      
    

</head>
   <body height="100%"><div class="body_content" id="body-content"><link rel="stylesheet" type="text/css" href="cpp_ref/navtree.css"><link rel="stylesheet" type="text/css" href="cpp_ref/doxygen.css"><link rel="stylesheet" type="text/css" href="cpp_ref/tabs.css"><link rel="stylesheet" type="text/css" href="style/adsk.cpm.css"><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('_abc_bullet_2_maya_transform_writer_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
      <div>
         <div class="head">
            <h1>C++ API Reference: AbcBullet/MayaTransformWriter.cpp</h1>
         </div>

<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->

  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="#!/url=./cpp_ref/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="#!/url=./cpp_ref/pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="#!/url=./cpp_ref/modules.html"><span>Modules</span></a></li>
      <li><a href="#!/url=./cpp_ref/namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="#!/url=./cpp_ref/annotated.html"><span>Classes</span></a></li>
      <li><a href="#!/url=./cpp_ref/examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="cpp_ref/search/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="cpp_ref/search/close.png" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>

<div id="doc-content">
<!-- window showing the filter options -->


<!-- iframe showing the search results (closed by default) -->


<div class="header">
  <div class="headertitle">
<div class="title">AbcBullet/MayaTransformWriter.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-*****************************************************************************</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Copyright (c) 2009-2012,</span></div>
<div class="line"><span class="comment">//  Sony Pictures Imageworks Inc. and</span></div>
<div class="line"><span class="comment">//  Industrial Light &amp; Magic, a division of Lucasfilm Entertainment Company Ltd.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment">// modification, are permitted provided that the following conditions are</span></div>
<div class="line"><span class="comment">// met:</span></div>
<div class="line"><span class="comment">// *       Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment">// notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment">// *       Redistributions in binary form must reproduce the above</span></div>
<div class="line"><span class="comment">// copyright notice, this list of conditions and the following disclaimer</span></div>
<div class="line"><span class="comment">// in the documentation and/or other materials provided with the</span></div>
<div class="line"><span class="comment">// distribution.</span></div>
<div class="line"><span class="comment">// *       Neither the name of Sony Pictures Imageworks, nor</span></div>
<div class="line"><span class="comment">// Industrial Light &amp; Magic, nor the names of their contributors may be used</span></div>
<div class="line"><span class="comment">// to endorse or promote products derived from this software without specific</span></div>
<div class="line"><span class="comment">// prior written permission.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment">// &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment">// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment">// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment">// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment">// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment">// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment">// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment">// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment">// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment">// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//-*****************************************************************************</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;MayaTransformWriter.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;MayaUtility.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> addChannel( </div>
<div class="line">    std::vector &lt; AnimChan &gt; &amp; oAnimChanList,</div>
<div class="line">    Alembic::AbcGeom::XformSample &amp; oSample,</div>
<div class="line">    AnimChan&amp; chan</div>
<div class="line">    )</div>
<div class="line">{</div>
<div class="line">    chan.opNum = oSample.getNumOps();</div>
<div class="line">    oAnimChanList.push_back(chan);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> addTranslate(<span class="keyword">const</span> <a name="_a0"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> &amp; iTrans,</div>
<div class="line">    <a name="_a1"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> parentName, <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> xName, <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> yName, <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> zName,</div>
<div class="line">    Alembic::Util::uint8_t iHint, <span class="keywordtype">bool</span> inverse, <span class="keywordtype">bool</span> forceStatic,</div>
<div class="line">    <span class="keywordtype">bool</span> forceAnimated, Alembic::AbcGeom::XformSample &amp; oSample,</div>
<div class="line">    std::vector &lt; AnimChan &gt; &amp; oAnimChanList)</div>
<div class="line">{</div>
<div class="line">    Alembic::AbcGeom::XformOp op(Alembic::AbcGeom::kTranslateOperation, iHint);</div>
<div class="line"></div>
<div class="line">    <a name="_a2"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> xPlug = iTrans.<a name="a3"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(xName, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">int</span> xSamp = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            xSamp = util::getSampledType(xPlug);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            xSamp = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">double</span> xVal = xPlug.<a name="a4"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> yPlug = iTrans.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(yName, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">int</span> ySamp = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            ySamp = util::getSampledType(yPlug);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            ySamp = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">double</span> yVal = yPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> zPlug = iTrans.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(zName, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">int</span> zSamp = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            zSamp = util::getSampledType(zPlug);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            zSamp = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">double</span> zVal = zPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// this is to handle the case where there is a connection to the parent</span></div>
<div class="line">    <span class="comment">// plug but not to the child plugs, if the connection is there then all</span></div>
<div class="line">    <span class="comment">// of the children are considered animated</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> parentPlug = iTrans.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(parentName, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">int</span> parentSamp = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            parentSamp = util::getSampledType(parentPlug);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            parentSamp = 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (parentSamp != 0)</div>
<div class="line">    {</div>
<div class="line">        xSamp = 1;</div>
<div class="line">        ySamp = 1;</div>
<div class="line">        zSamp = 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// something is sampled or not identity, add it to the stack</span></div>
<div class="line">    <span class="keywordflow">if</span> (xSamp != 0 || ySamp != 0 || zSamp != 0 || xVal != 0.0 || yVal != 0.0 ||</div>
<div class="line">        zVal != 0.0)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (inverse)</div>
<div class="line">        {</div>
<div class="line">            xVal = -xVal;</div>
<div class="line">            yVal = -yVal;</div>
<div class="line">            zVal = -zVal;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        op.setChannelValue(0, xVal);</div>
<div class="line">        op.setChannelValue(1, yVal);</div>
<div class="line">        op.setChannelValue(2, zVal);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (xSamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = xPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line">            <span class="keywordflow">if</span> (inverse)</div>
<div class="line">                chan.scale = -1.0;</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 0;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (ySamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = yPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line">            <span class="keywordflow">if</span> (inverse)</div>
<div class="line">                chan.scale = -1.0;</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 1;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (zSamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = zPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line">            <span class="keywordflow">if</span> (inverse)</div>
<div class="line">                chan.scale = -1.0;</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 2;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        oSample.addOp(op);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// names need to be passed in x,y,z order, iOrder is the order to</span></div>
<div class="line"><span class="comment">// use these indices</span></div>
<div class="line"><span class="keywordtype">void</span> addRotate(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> &amp; iTrans,</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> parentName, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>* iNames, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* iOrder,</div>
<div class="line">    Alembic::Util::uint8_t iHint, <span class="keywordtype">bool</span> forceStatic, <span class="keywordtype">bool</span> forceAnimated,</div>
<div class="line">    Alembic::AbcGeom::XformSample &amp; oSample,</div>
<div class="line">    std::vector &lt; AnimChan &gt; &amp; oAnimChanList,</div>
<div class="line">    <span class="keywordtype">size_t</span> oOpIndex[3])</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// for each possible rotation axis</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> Alembic::AbcGeom::XformOperationType rots[3] = {</div>
<div class="line">         Alembic::AbcGeom::kRotateXOperation,</div>
<div class="line">         Alembic::AbcGeom::kRotateYOperation,</div>
<div class="line">         Alembic::AbcGeom::kRotateZOperation</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="comment">// this is to handle the case where there is a connection to the parent</span></div>
<div class="line">    <span class="comment">// plug but not to the child plugs, if the connection is there then all</span></div>
<div class="line">    <span class="comment">// of the children are considered animated</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> parentPlug = iTrans.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(parentName, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">int</span> parentSamp = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            parentSamp = util::getSampledType(parentPlug);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            parentSamp = 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// whether we are using the XYZ rotation order</span></div>
<div class="line">    <span class="keywordtype">bool</span> isXYZ = ((iOrder[0] == 0) &amp;&amp; (iOrder[1] == 1) &amp;&amp; (iOrder[2] == 2));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// add them in backwards since we are dealing with a stack</span></div>
<div class="line">    <span class="keywordtype">int</span> i = 2;</div>
<div class="line">    <span class="keywordflow">for</span> (; i &gt; -1; i--)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = iOrder[i];</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> plug = iTrans.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(iNames[index], <span class="keyword">true</span>);</div>
<div class="line">        <span class="keywordtype">int</span> samp = 0;</div>
<div class="line">        <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">                samp = util::getSampledType(plug);</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                samp = 1;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (samp == 0)</div>
<div class="line">                samp = parentSamp;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">double</span> plugVal = plug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        Alembic::AbcGeom::XformOp op(rots[index], iHint);</div>
<div class="line">        op.setChannelValue(0, Alembic::AbcGeom::RadiansToDegrees(plugVal));</div>
<div class="line"></div>
<div class="line">        <span class="comment">// the sampled case</span></div>
<div class="line">        <span class="keywordflow">if</span> (samp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = plug;</div>
<div class="line">            chan.scale = Alembic::AbcGeom::RadiansToDegrees(1.0);</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 0;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// non sampled, XYZ axis and the angle is 0, do not add to the stack</span></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isXYZ &amp;&amp; plugVal == 0.0)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">        oOpIndex[index] = oSample.addOp(op);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// the test on whether or not to add it is very similiar to addTranslate</span></div>
<div class="line"><span class="comment">// but the operation it creates is very different</span></div>
<div class="line"><span class="keywordtype">void</span> addShear(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> &amp; iTrans, <span class="keywordtype">bool</span> forceStatic,</div>
<div class="line">    Alembic::AbcGeom::XformSample &amp; oSample,</div>
<div class="line">    std::vector &lt; AnimChan &gt; &amp; oAnimChanList)</div>
<div class="line">{</div>
<div class="line">    Alembic::AbcGeom::XformOp op(Alembic::AbcGeom::kMatrixOperation,</div>
<div class="line">        Alembic::AbcGeom::kMayaShearHint);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> str = <span class="stringliteral">&quot;shearXY&quot;</span>;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> xyPlug = iTrans.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(str, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">int</span> xySamp = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        xySamp = util::getSampledType(xyPlug);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">double</span> xyVal = xyPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line">    str = <span class="stringliteral">&quot;shearXZ&quot;</span>;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> xzPlug = iTrans.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(str, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">int</span> xzSamp = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        xzSamp = util::getSampledType(xzPlug);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">double</span> xzVal = xzPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line">    str = <span class="stringliteral">&quot;shearYZ&quot;</span>;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> yzPlug = iTrans.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(str, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">int</span> yzSamp = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        yzSamp = util::getSampledType(yzPlug);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">double</span> yzVal = yzPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// this is to handle the case where there is a connection to the parent</span></div>
<div class="line">    <span class="comment">// plug but not to the child plugs, if the connection is there then all</span></div>
<div class="line">    <span class="comment">// of the children are considered animated</span></div>
<div class="line">    str = <span class="stringliteral">&quot;shear&quot;</span>;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> parentPlug = iTrans.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(str, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!forceStatic &amp;&amp; util::getSampledType(parentPlug) != 0)</div>
<div class="line">    {</div>
<div class="line">        xySamp = 1;</div>
<div class="line">        xzSamp = 1;</div>
<div class="line">        yzSamp = 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// something is sampled or not identity, add it to the stack</span></div>
<div class="line">    <span class="keywordflow">if</span> (xySamp != 0 || xzSamp != 0 || yzSamp != 0 ||</div>
<div class="line">        xyVal != 0.0 || xzVal != 0.0 || yzVal != 0.0)</div>
<div class="line">    {</div>
<div class="line">        Alembic::Abc::M44d m;</div>
<div class="line">        m.makeIdentity();</div>
<div class="line">        op.setMatrix(m);</div>
<div class="line">        op.setChannelValue(4, xyVal);</div>
<div class="line">        op.setChannelValue(8, xzVal);</div>
<div class="line">        op.setChannelValue(9, yzVal);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (xySamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = xyPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 4;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (xzSamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = xzPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 8;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (yzSamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = yzPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 9;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        oSample.addOp(op);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// this test is very similiar to addTranslate, except that it doesn&#39;t add it</span></div>
<div class="line"><span class="comment">// to the stack if x,y, and z are 1.0</span></div>
<div class="line"><span class="keywordtype">void</span> addScale(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> &amp; iTrans,</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> parentName, <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> xName, <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> yName, <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> zName, <span class="keywordtype">bool</span> inverse,</div>
<div class="line">    <span class="keywordtype">bool</span> forceStatic, <span class="keywordtype">bool</span> forceAnimated, Alembic::AbcGeom::XformSample &amp; oSample,</div>
<div class="line">    std::vector &lt; AnimChan &gt; &amp; oAnimChanList)</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">    Alembic::AbcGeom::XformOp op(Alembic::AbcGeom::kScaleOperation,</div>
<div class="line">        Alembic::AbcGeom::kScaleHint);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> xPlug = iTrans.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(xName, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">int</span> xSamp = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            xSamp = util::getSampledType(xPlug);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            xSamp = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">double</span> xVal = xPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> yPlug = iTrans.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(yName, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">int</span> ySamp = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            ySamp = util::getSampledType(yPlug);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            ySamp = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">double</span> yVal = yPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> zPlug = iTrans.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(zName, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">int</span> zSamp = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            zSamp = util::getSampledType(zPlug);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            zSamp = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">double</span> zVal = zPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a62411b4c90ef50797f86b049bb1f934b">asDouble</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// this is to handle the case where there is a connection to the parent</span></div>
<div class="line">    <span class="comment">// plug but not to the child plugs, if the connection is there then all</span></div>
<div class="line">    <span class="comment">// of the children are considered animated</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> parentPlug = iTrans.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(parentName, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordtype">int</span> parentSamp = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (!forceStatic)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!forceAnimated)</div>
<div class="line">            parentSamp = util::getSampledType(parentPlug);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            parentSamp = 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (parentSamp != 0)</div>
<div class="line">    {</div>
<div class="line">        xSamp = 1;</div>
<div class="line">        ySamp = 1;</div>
<div class="line">        zSamp = 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// something is sampled or not identity, add it to the stack</span></div>
<div class="line">    <span class="keywordflow">if</span> (xSamp != 0 || ySamp != 0 || zSamp != 0 || xVal != 1.0 || yVal != 1.0 ||</div>
<div class="line">        zVal != 1.0)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (inverse)</div>
<div class="line">        {</div>
<div class="line">            xVal = util::inverseScale(xVal);</div>
<div class="line">            yVal = util::inverseScale(yVal);</div>
<div class="line">            zVal = util::inverseScale(zVal);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        op.setChannelValue(0, xVal);</div>
<div class="line">        op.setChannelValue(1, yVal);</div>
<div class="line">        op.setChannelValue(2, zVal);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (xSamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = xPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line">            <span class="keywordflow">if</span> (inverse)</div>
<div class="line">                chan.scale = -std::numeric_limits&lt;double&gt;::infinity();</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 0;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (ySamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = yPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line">            <span class="keywordflow">if</span> (inverse)</div>
<div class="line">                chan.scale = -std::numeric_limits&lt;double&gt;::infinity();</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 1;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (zSamp != 0)</div>
<div class="line">        {</div>
<div class="line">            AnimChan chan;</div>
<div class="line">            chan.plug = zPlug;</div>
<div class="line">            chan.scale = 1.0;</div>
<div class="line">            <span class="keywordflow">if</span> (inverse)</div>
<div class="line">                chan.scale = -std::numeric_limits&lt;double&gt;::infinity();</div>
<div class="line">            chan.opNum = oSample.getNumOps();</div>
<div class="line">            chan.channelNum = 2;</div>
<div class="line">            oAnimChanList.push_back(chan);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        oSample.addOp(op);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> getSampledRotation(<span class="keyword">const</span> Alembic::AbcGeom::XformSample&amp; sample,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> opIndex[3], <span class="keywordtype">double</span>&amp; xx, <span class="keywordtype">double</span>&amp; yy, <span class="keywordtype">double</span>&amp; zz)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> success = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    xx = 0.0;</div>
<div class="line">    <span class="keywordflow">if</span> (opIndex[0] &lt; sample.getNumOps())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">double</span> angleX = sample[opIndex[0]].getChannelValue(0);</div>
<div class="line">        xx = Alembic::AbcGeom::DegreesToRadians(angleX);</div>
<div class="line">        success = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    yy = 0.0;</div>
<div class="line">    <span class="keywordflow">if</span> (opIndex[1] &lt; sample.getNumOps())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">double</span> angleY = sample[opIndex[1]].getChannelValue(0);</div>
<div class="line">        yy = Alembic::AbcGeom::DegreesToRadians(angleY);</div>
<div class="line">        success = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    zz = 0.0;</div>
<div class="line">    <span class="keywordflow">if</span> (opIndex[2] &lt; sample.getNumOps())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">double</span> angleZ = sample[opIndex[2]].getChannelValue(0);</div>
<div class="line">        zz = Alembic::AbcGeom::DegreesToRadians(angleZ);</div>
<div class="line">        success = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> success;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> setSampledRotation(Alembic::AbcGeom::XformSample&amp; sample,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> opIndex[3], <span class="keywordtype">double</span> xx, <span class="keywordtype">double</span> yy, <span class="keywordtype">double</span> zz)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> success = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (opIndex[0] &lt; sample.getNumOps())</div>
<div class="line">    {</div>
<div class="line">        sample[opIndex[0]].setChannelValue(0, Alembic::AbcGeom::RadiansToDegrees(xx));</div>
<div class="line">        success = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (opIndex[1] &lt; sample.getNumOps())</div>
<div class="line">    {</div>
<div class="line">        sample[opIndex[1]].setChannelValue(0, Alembic::AbcGeom::RadiansToDegrees(yy));</div>
<div class="line">        success = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (opIndex[2] &lt; sample.getNumOps())</div>
<div class="line">    {</div>
<div class="line">        sample[opIndex[2]].setChannelValue(0, Alembic::AbcGeom::RadiansToDegrees(zz));</div>
<div class="line">        success = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> success;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MayaTransformWriter::MayaTransformWriter(Alembic::AbcGeom::OObject &amp; iParent,</div>
<div class="line">    <a name="_a5"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a> &amp; iDag, Alembic::Util::uint32_t iTimeIndex, <span class="keyword">const</span> JobArgs &amp; iArgs)</div>
<div class="line">{</div>
<div class="line">    mVerbose = iArgs.verbose;</div>
<div class="line">    mFilterEulerRotations = iArgs.filterEulerRotations;</div>
<div class="line">    mJointOrientOpIndex[0] = mJointOrientOpIndex[1] = mJointOrientOpIndex[2] =</div>
<div class="line">    mRotateOpIndex[0]     = mRotateOpIndex[1]     = mRotateOpIndex[2]     =</div>
<div class="line">    mRotateAxisOpIndex[0]  = mRotateAxisOpIndex[1]  = mRotateAxisOpIndex[2]  = ~size_t(0);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (iDag.<a name="a6"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a5901f0fa543d32fb13756c2d004f37ae">hasFn</a>(<a name="a7"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7ab8b14d1ed753088b316e8ee8c5d38ca9">MFn::kJoint</a>))</div>
<div class="line">    {</div>
<div class="line">        <a name="_a8"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_ik_joint.html">MFnIkJoint</a> joint(iDag);</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> jointName = joint.name();</div>
<div class="line"></div>
<div class="line">        mName = util::stripNamespaces(jointName, iArgs.stripNamespace);</div>
<div class="line"></div>
<div class="line">        Alembic::AbcGeom::OXform obj(iParent, mName.asChar(),</div>
<div class="line">            iTimeIndex);</div>
<div class="line">        mSchema = obj.getSchema();</div>
<div class="line"></div>
<div class="line">        Alembic::Abc::OCompoundProperty cp;</div>
<div class="line">        Alembic::Abc::OCompoundProperty up;</div>
<div class="line">        <span class="keywordflow">if</span> (AttributesWriter::hasAnyAttr(joint, iArgs))</div>
<div class="line">        {</div>
<div class="line">            cp = mSchema.getArbGeomParams();</div>
<div class="line">            up = mSchema.getUserProperties();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        mAttrs = AttributesWriterPtr(<span class="keyword">new</span> AttributesWriter(cp, up, obj, joint,</div>
<div class="line">            iTimeIndex, iArgs));</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!iArgs.worldSpace)</div>
<div class="line">        {</div>
<div class="line">            pushTransformStack(joint, iTimeIndex == 0);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// need to look at inheritsTransform</span></div>
<div class="line">            <a name="_a9"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dag_node.html">MFnDagNode</a> dagNode(iDag);</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> inheritPlug = dagNode.findPlug(<span class="stringliteral">&quot;inheritsTransform&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line">            <span class="keywordflow">if</span> (!inheritPlug.<a name="a10"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug.html#ab7ec149d38b7c29ca55c5aa7b407d8f9">isNull</a>())</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (util::getSampledType(inheritPlug) != 0)</div>
<div class="line">                    mInheritsPlug = inheritPlug;</div>
<div class="line"></div>
<div class="line">                mSample.setInheritsXforms(inheritPlug.<a name="a11"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a69b4092a85b4edf58b7d50f331cc38cf">asBool</a>());</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// everything is default, don&#39;t write anything</span></div>
<div class="line">            <span class="keywordflow">if</span> (mSample.getNumOps() == 0 &amp;&amp; mSample.getInheritsXforms())</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">            mSchema.set(mSample);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <a name="_a12"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_transform.html">MFnTransform</a> trans(iDag);</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> transName = trans.name();</div>
<div class="line"></div>
<div class="line">        mName = util::stripNamespaces(transName, iArgs.stripNamespace);</div>
<div class="line"></div>
<div class="line">        Alembic::AbcGeom::OXform obj(iParent, mName.asChar(),</div>
<div class="line">            iTimeIndex);</div>
<div class="line">        mSchema = obj.getSchema();</div>
<div class="line"></div>
<div class="line">        Alembic::Abc::OCompoundProperty cp;</div>
<div class="line">        Alembic::Abc::OCompoundProperty up;</div>
<div class="line">        <span class="keywordflow">if</span> (AttributesWriter::hasAnyAttr(trans, iArgs))</div>
<div class="line">        {</div>
<div class="line">            cp = mSchema.getArbGeomParams();</div>
<div class="line">            up = mSchema.getUserProperties();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        mAttrs = AttributesWriterPtr(<span class="keyword">new</span> AttributesWriter(cp, up, obj, trans,</div>
<div class="line">            iTimeIndex, iArgs));</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!iArgs.worldSpace)</div>
<div class="line">        {</div>
<div class="line">            pushTransformStack(trans, iTimeIndex == 0);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// need to look at inheritsTransform</span></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_fn_dag_node.html">MFnDagNode</a> dagNode(iDag);</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> inheritPlug = dagNode.findPlug(<span class="stringliteral">&quot;inheritsTransform&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line">            <span class="keywordflow">if</span> (!inheritPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#ab7ec149d38b7c29ca55c5aa7b407d8f9">isNull</a>())</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (util::getSampledType(inheritPlug) != 0)</div>
<div class="line">                    mInheritsPlug = inheritPlug;</div>
<div class="line"></div>
<div class="line">                mSample.setInheritsXforms(inheritPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a69b4092a85b4edf58b7d50f331cc38cf">asBool</a>());</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">            <span class="comment">// everything is default, don&#39;t write anything</span></div>
<div class="line">            <span class="keywordflow">if</span> (mSample.getNumOps() == 0 &amp;&amp; mSample.getInheritsXforms())</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">            mSchema.set(mSample);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// if we didn&#39;t bail early then we need to add all the transform</span></div>
<div class="line">    <span class="comment">// information at the current node and above</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// copy the dag path because we&#39;ll be popping from it</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a> dag(iDag);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    <span class="keywordtype">int</span> numPaths = dag.length();</div>
<div class="line">    std::vector&lt; MDagPath &gt; dagList;</div>
<div class="line">    <span class="keywordflow">for</span> (i = numPaths - 1; i &gt; -1; i--, dag.pop())</div>
<div class="line">    {</div>
<div class="line">        dagList.push_back(dag);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// inheritsTransform exists on both joints and transforms</span></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_fn_dag_node.html">MFnDagNode</a> dagNode(dag);</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> inheritPlug = dagNode.findPlug(<span class="stringliteral">&quot;inheritsTransform&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// if inheritsTransform exists and is set to false, then we</span></div>
<div class="line">        <span class="comment">// don&#39;t need to worry about ancestor nodes above this one</span></div>
<div class="line">        <span class="keywordflow">if</span> (!inheritPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#ab7ec149d38b7c29ca55c5aa7b407d8f9">isNull</a>() &amp;&amp; !inheritPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a69b4092a85b4edf58b7d50f331cc38cf">asBool</a>())</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    std::vector&lt; MDagPath &gt;::iterator iStart = dagList.begin();</div>
<div class="line"></div>
<div class="line">    std::vector&lt; MDagPath &gt;::iterator iCur = dagList.end();</div>
<div class="line">    iCur--;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// now loop backwards over our dagpath list so we push ancestor nodes</span></div>
<div class="line">    <span class="comment">// first, all the way down to the current node</span></div>
<div class="line">    <span class="keywordflow">for</span> (; iCur != iStart; iCur--)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// only add it to the stack don&#39;t write it yet!</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (iCur-&gt;hasFn(<a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7ab8b14d1ed753088b316e8ee8c5d38ca9">MFn::kJoint</a>))</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_fn_ik_joint.html">MFnIkJoint</a> joint(*iCur);</div>
<div class="line">            pushTransformStack(joint, iTimeIndex == 0);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_fn_transform.html">MFnTransform</a> trans(*iCur);</div>
<div class="line">            pushTransformStack(trans, iTimeIndex == 0);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// finally add any transform info on the final node and write it</span></div>
<div class="line">    <span class="keywordflow">if</span> (iCur-&gt;hasFn(<a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7ab8b14d1ed753088b316e8ee8c5d38ca9">MFn::kJoint</a>))</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_fn_ik_joint.html">MFnIkJoint</a> joint(*iCur);</div>
<div class="line">        pushTransformStack(joint, iTimeIndex == 0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_fn_transform.html">MFnTransform</a> trans(*iCur);</div>
<div class="line">        pushTransformStack(trans, iTimeIndex == 0);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// need to look at inheritsTransform</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_fn_dag_node.html">MFnDagNode</a> dagNode(iDag);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> inheritPlug = dagNode.findPlug(<span class="stringliteral">&quot;inheritsTransform&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!inheritPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#ab7ec149d38b7c29ca55c5aa7b407d8f9">isNull</a>())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (util::getSampledType(inheritPlug) != 0)</div>
<div class="line">            mInheritsPlug = inheritPlug;</div>
<div class="line"></div>
<div class="line">        mSample.setInheritsXforms(inheritPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a69b4092a85b4edf58b7d50f331cc38cf">asBool</a>());</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// everything is default, don&#39;t write anything</span></div>
<div class="line">    <span class="keywordflow">if</span> (mSample.getNumOps() == 0 &amp;&amp; mSample.getInheritsXforms())</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    mSchema.set(mSample);</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MayaTransformWriter::MayaTransformWriter(MayaTransformWriter &amp; iParent,</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a> &amp; iDag, Alembic::Util::uint32_t iTimeIndex, <span class="keyword">const</span> JobArgs &amp; iArgs)</div>
<div class="line">{</div>
<div class="line">    mVerbose = iArgs.verbose;</div>
<div class="line">    mFilterEulerRotations = iArgs.filterEulerRotations;</div>
<div class="line">    mJointOrientOpIndex[0] = mJointOrientOpIndex[1] = mJointOrientOpIndex[2] =</div>
<div class="line">    mRotateOpIndex[0]     = mRotateOpIndex[1]     = mRotateOpIndex[2]     =</div>
<div class="line">    mRotateAxisOpIndex[0]  = mRotateAxisOpIndex[1]  = mRotateAxisOpIndex[2]  = ~size_t(0);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (iDag.<a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a5901f0fa543d32fb13756c2d004f37ae">hasFn</a>(<a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7ab8b14d1ed753088b316e8ee8c5d38ca9">MFn::kJoint</a>))</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_fn_ik_joint.html">MFnIkJoint</a> joint(iDag);</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> jointName = joint.name();</div>
<div class="line"></div>
<div class="line">        mName = util::stripNamespaces(jointName, iArgs.stripNamespace);</div>
<div class="line"></div>
<div class="line">        Alembic::AbcGeom::OXform obj(iParent.getObject(), mName.asChar(),</div>
<div class="line">            iTimeIndex);</div>
<div class="line">        mSchema = obj.getSchema();</div>
<div class="line"></div>
<div class="line">        Alembic::Abc::OCompoundProperty cp;</div>
<div class="line">        Alembic::Abc::OCompoundProperty up;</div>
<div class="line">        <span class="keywordflow">if</span> (AttributesWriter::hasAnyAttr(joint, iArgs))</div>
<div class="line">        {</div>
<div class="line">            cp = mSchema.getArbGeomParams();</div>
<div class="line">            up = mSchema.getUserProperties();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        mAttrs = AttributesWriterPtr(<span class="keyword">new</span> AttributesWriter(cp, up, obj, joint,</div>
<div class="line">            iTimeIndex, iArgs));</div>
<div class="line"></div>
<div class="line">        pushTransformStack(joint, iTimeIndex == 0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_fn_transform.html">MFnTransform</a> trans(iDag);</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> transName = trans.name();</div>
<div class="line"></div>
<div class="line">        mName = util::stripNamespaces(transName, iArgs.stripNamespace);</div>
<div class="line"></div>
<div class="line">        Alembic::AbcGeom::OXform obj(iParent.getObject(), mName.asChar(),</div>
<div class="line">            iTimeIndex);</div>
<div class="line">        mSchema = obj.getSchema();</div>
<div class="line"></div>
<div class="line">        Alembic::Abc::OCompoundProperty cp;</div>
<div class="line">        Alembic::Abc::OCompoundProperty up;</div>
<div class="line">        <span class="keywordflow">if</span> (AttributesWriter::hasAnyAttr(trans, iArgs))</div>
<div class="line">        {</div>
<div class="line">            cp = mSchema.getArbGeomParams();</div>
<div class="line">            up = mSchema.getUserProperties();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        mAttrs = AttributesWriterPtr(<span class="keyword">new</span> AttributesWriter(cp, up, obj, trans,</div>
<div class="line">            iTimeIndex, iArgs));</div>
<div class="line"></div>
<div class="line">        pushTransformStack(trans, iTimeIndex == 0);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// need to look at inheritsTransform</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_fn_dag_node.html">MFnDagNode</a> dagNode(iDag);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> inheritPlug = dagNode.findPlug(<span class="stringliteral">&quot;inheritsTransform&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!inheritPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#ab7ec149d38b7c29ca55c5aa7b407d8f9">isNull</a>())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (util::getSampledType(inheritPlug) != 0)</div>
<div class="line">            mInheritsPlug = inheritPlug;</div>
<div class="line"></div>
<div class="line">        mSample.setInheritsXforms(inheritPlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a69b4092a85b4edf58b7d50f331cc38cf">asBool</a>());</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// everything is default, don&#39;t write anything</span></div>
<div class="line">    <span class="keywordflow">if</span> (mSample.getNumOps() == 0 &amp;&amp; mSample.getInheritsXforms())</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    mSchema.set(mSample);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MayaTransformWriter::MayaTransformWriter(Alembic::Abc::OObject &amp; iParent, </div>
<div class="line">    <span class="keyword">const</span> AnimSampler&amp; sampler, </div>
<div class="line">    Alembic::Util::uint32_t iTimeIndex, <span class="keyword">const</span> JobArgs &amp; iArgs)</div>
<div class="line">{</div>
<div class="line">    mVerbose = iArgs.verbose;</div>
<div class="line">    mFilterEulerRotations = iArgs.filterEulerRotations;</div>
<div class="line">    mJointOrientOpIndex[0] = mJointOrientOpIndex[1] = mJointOrientOpIndex[2] =</div>
<div class="line">    mRotateOpIndex[0]     = mRotateOpIndex[1]     = mRotateOpIndex[2]     =</div>
<div class="line">    mRotateAxisOpIndex[0]  = mRotateAxisOpIndex[1]  = mRotateAxisOpIndex[2]  = ~size_t(0);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> name = sampler.name();</div>
<div class="line"></div>
<div class="line">    mName = util::stripNamespaces(name, iArgs.stripNamespace);</div>
<div class="line"></div>
<div class="line">    Alembic::AbcGeom::OXform obj(iParent, mName.asChar(),</div>
<div class="line">        iTimeIndex);</div>
<div class="line">    mSchema = obj.getSchema();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// no custom or user attributes</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// determine channels to write</span></div>
<div class="line">    pushTransformStack(sampler, iTimeIndex == 0);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// everything is default, don&#39;t write anything</span></div>
<div class="line">    <span class="keywordflow">if</span> (mSample.getNumOps() == 0 &amp;&amp; mSample.getInheritsXforms())</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    mSchema.set(mSample);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MayaTransformWriter::~MayaTransformWriter()</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MayaTransformWriter::write()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">size_t</span> numSamples = mAnimChanList.size();</div>
<div class="line">    <span class="keywordflow">if</span> (numSamples &gt; 0)</div>
<div class="line">    {</div>
<div class="line">        std::vector &lt; AnimChan &gt;::iterator it, itEnd;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (it = mAnimChanList.begin(), itEnd = mAnimChanList.end();</div>
<div class="line">            it != itEnd; ++it)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">double</span> val = it-&gt;asDouble();</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (it-&gt;scale == -std::numeric_limits&lt;double&gt;::infinity())</div>
<div class="line">                val = util::inverseScale(val);</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it-&gt;scale != 1.0)</div>
<div class="line">                val *= it-&gt;scale;</div>
<div class="line"></div>
<div class="line">            mSample[it-&gt;opNum].setChannelValue(it-&gt;channelNum, val);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!mInheritsPlug.isNull())</div>
<div class="line">        {</div>
<div class="line">            mSample.setInheritsXforms(mInheritsPlug.asBool());</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (mFilterEulerRotations)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">double</span> xx(0), yy(0), zz(0);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (getSampledRotation(mSample, mJointOrientOpIndex, xx, yy, zz))</div>
<div class="line">            {</div>
<div class="line">                <a name="_a13"></a><a class="code" href="#!/url=./cpp_ref/class_m_euler_rotation.html">MEulerRotation</a> filteredEuler(xx, yy, zz, mPrevJointOrientSolution.order);</div>
<div class="line">                filteredEuler.setToClosestSolution(mPrevJointOrientSolution);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// update sample with new solution</span></div>
<div class="line">                setSampledRotation(mSample, mJointOrientOpIndex, filteredEuler.x, filteredEuler.y, filteredEuler.z);</div>
<div class="line">                mPrevJointOrientSolution = filteredEuler;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (getSampledRotation(mSample, mRotateOpIndex, xx, yy, zz))</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_euler_rotation.html">MEulerRotation</a> filteredEuler(xx, yy, zz, mPrevRotateSolution.order);</div>
<div class="line">                filteredEuler.setToClosestSolution(mPrevRotateSolution);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line">                <span class="keywordflow">if</span> (mVerbose)</div>
<div class="line">                {</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> str;</div>
<div class="line">                    <a name="_a14"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> args(7,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"></div>
<div class="line">                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;</div>
<div class="line"></div>
<div class="line">                    i=0;</div>
<div class="line">                    args[i++] = mName;</div>
<div class="line">                    args[i++].set(mPrevRotateSolution[0]);</div>
<div class="line">                    args[i++].set(mPrevRotateSolution[1]);</div>
<div class="line">                    args[i++].set(mPrevRotateSolution[2]);</div>
<div class="line"></div>
<div class="line">                    args[i++].set(Alembic::AbcGeom::RadiansToDegrees(mPrevRotateSolution[0]));</div>
<div class="line">                    args[i++].set(Alembic::AbcGeom::RadiansToDegrees(mPrevRotateSolution[1]));</div>
<div class="line">                    args[i++].set(Alembic::AbcGeom::RadiansToDegrees(mPrevRotateSolution[2]));</div>
<div class="line"></div>
<div class="line">                    str.<a name="a15"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#a07ae464181c795f43fa1bcc288acff91">format</a>(<span class="stringliteral">&quot;^1s: previous rotation radians(^2s, ^3s, ^4s) degrees(^5s, ^6s, ^7s)&quot;</span>,args);</div>
<div class="line">                    <a name="a16"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a3d14e9f9ed022a80f664eac0136c2f7a">MGlobal::displayInfo</a>( str );</div>
<div class="line"></div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_euler_rotation.html">MEulerRotation</a> currentEuler(xx, yy, zz, mPrevRotateSolution.order);</div>
<div class="line"></div>
<div class="line">                    i=0;</div>
<div class="line">                    args[i++] = mName;</div>
<div class="line">                    args[i++].set(currentEuler[0]);</div>
<div class="line">                    args[i++].set(currentEuler[1]);</div>
<div class="line">                    args[i++].set(currentEuler[2]);</div>
<div class="line"></div>
<div class="line">                    args[i++].set(Alembic::AbcGeom::RadiansToDegrees(currentEuler[0]));</div>
<div class="line">                    args[i++].set(Alembic::AbcGeom::RadiansToDegrees(currentEuler[1]));</div>
<div class="line">                    args[i++].set(Alembic::AbcGeom::RadiansToDegrees(currentEuler[2]));</div>
<div class="line"></div>
<div class="line">                    str.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a07ae464181c795f43fa1bcc288acff91">format</a>(<span class="stringliteral">&quot;^1s: current rotation radians(^2s, ^3s, ^4s) degrees(^5s, ^6s, ^7s)&quot;</span>,args);</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a3d14e9f9ed022a80f664eac0136c2f7a">MGlobal::displayInfo</a>( str );</div>
<div class="line"></div>
<div class="line">                    i=0;</div>
<div class="line">                    args[i++] = mName;</div>
<div class="line">                    args[i++].set(filteredEuler[0]);</div>
<div class="line">                    args[i++].set(filteredEuler[1]);</div>
<div class="line">                    args[i++].set(filteredEuler[2]);</div>
<div class="line"></div>
<div class="line">                    args[i++].set(Alembic::AbcGeom::RadiansToDegrees(filteredEuler[0]));</div>
<div class="line">                    args[i++].set(Alembic::AbcGeom::RadiansToDegrees(filteredEuler[1]));</div>
<div class="line">                    args[i++].set(Alembic::AbcGeom::RadiansToDegrees(filteredEuler[2]));</div>
<div class="line"></div>
<div class="line">                    str.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a07ae464181c795f43fa1bcc288acff91">format</a>(<span class="stringliteral">&quot;^1s: filtered rotation radians(^2s, ^3s, ^4s) degrees(^5s, ^6s, ^7s)&quot;</span>,args);</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a3d14e9f9ed022a80f664eac0136c2f7a">MGlobal::displayInfo</a>( str );</div>
<div class="line"></div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">                <span class="comment">// update sample with new solution</span></div>
<div class="line">                setSampledRotation(mSample, mRotateOpIndex, filteredEuler.x, filteredEuler.y, filteredEuler.z);</div>
<div class="line">                mPrevRotateSolution = filteredEuler;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (getSampledRotation(mSample, mRotateAxisOpIndex, xx, yy, zz))</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_euler_rotation.html">MEulerRotation</a> filteredEuler(xx, yy, zz, mPrevRotateAxisSolution.order);</div>
<div class="line">                filteredEuler.setToClosestSolution(mPrevRotateAxisSolution);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// update sample with new solution</span></div>
<div class="line">                setSampledRotation(mSample, mRotateAxisOpIndex, filteredEuler.x, filteredEuler.y, filteredEuler.z);</div>
<div class="line">                mPrevRotateAxisSolution = filteredEuler;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        mSchema.set(mSample);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> MayaTransformWriter::isAnimated()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="keywordflow">return</span> mAnimChanList.size() &gt; 0 || !mInheritsPlug.isNull();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MayaTransformWriter::pushTransformStack(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_fn_transform.html">MFnTransform</a> &amp; iTrans,</div>
<div class="line">    <span class="keywordtype">bool</span> iForceStatic)</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">    <span class="comment">// inspect the translate</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">&quot;translate&quot;</span>, <span class="stringliteral">&quot;translateX&quot;</span>, <span class="stringliteral">&quot;translateY&quot;</span>, <span class="stringliteral">&quot;translateZ&quot;</span>,</div>
<div class="line">        Alembic::AbcGeom::kTranslateHint, <span class="keyword">false</span>, iForceStatic, <span class="keyword">false</span>, mSample,</div>
<div class="line">        mAnimChanList);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// inspect the rotate pivot translate</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">&quot;rotatePivotTranslate&quot;</span>, <span class="stringliteral">&quot;rotatePivotTranslateX&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;rotatePivotTranslateY&quot;</span>, <span class="stringliteral">&quot;rotatePivotTranslateZ&quot;</span>,</div>
<div class="line">        Alembic::AbcGeom::kRotatePivotTranslationHint, <span class="keyword">false</span>,</div>
<div class="line">            iForceStatic, <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// inspect the rotate pivot</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">&quot;rotatePivot&quot;</span>, <span class="stringliteral">&quot;rotatePivotX&quot;</span>, <span class="stringliteral">&quot;rotatePivotY&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;rotatePivotZ&quot;</span>,  Alembic::AbcGeom::kRotatePivotPointHint,</div>
<div class="line">        <span class="keyword">false</span>, iForceStatic, <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// inspect rotate names</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> rotateNames[3];</div>
<div class="line">    rotateNames[0] = <span class="stringliteral">&quot;rotateX&quot;</span>;</div>
<div class="line">    rotateNames[1] = <span class="stringliteral">&quot;rotateY&quot;</span>;</div>
<div class="line">    rotateNames[2] = <span class="stringliteral">&quot;rotateZ&quot;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rotOrder[3];</div>
<div class="line"></div>
<div class="line">    <span class="comment">// if this returns false then the rotation order was kInvalid or kLast</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_transformation_matrix.html#af3d74c777e523f2725cdf87c15a4b5bc">MTransformationMatrix::RotationOrder</a> eRotOrder(iTrans.<a name="a17"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_transform.html#a4279a68f07bfa316935e61610786e6aa">rotationOrder</a>());</div>
<div class="line">    <span class="keywordflow">if</span> (util::getRotOrder(eRotOrder, rotOrder[0], rotOrder[1],</div>
<div class="line">        rotOrder[2]))</div>
<div class="line">    {</div>
<div class="line">        addRotate(iTrans, <span class="stringliteral">&quot;rotate&quot;</span>, rotateNames, rotOrder,</div>
<div class="line">            Alembic::AbcGeom::kRotateHint, iForceStatic, <span class="keyword">false</span>,</div>
<div class="line">            mSample, mAnimChanList, mRotateOpIndex);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// now look at the rotation orientation, aka rotate axis</span></div>
<div class="line">    rotateNames[0] = <span class="stringliteral">&quot;rotateAxisX&quot;</span>;</div>
<div class="line">    rotateNames[1] = <span class="stringliteral">&quot;rotateAxisY&quot;</span>;</div>
<div class="line">    rotateNames[2] = <span class="stringliteral">&quot;rotateAxisZ&quot;</span>;</div>
<div class="line">    rotOrder[0] = 0;</div>
<div class="line">    rotOrder[1] = 1;</div>
<div class="line">    rotOrder[2] = 2;</div>
<div class="line">    addRotate(iTrans, <span class="stringliteral">&quot;rotateAxis&quot;</span>, rotateNames, rotOrder,</div>
<div class="line">        Alembic::AbcGeom::kRotateOrientationHint, iForceStatic, <span class="keyword">false</span>,</div>
<div class="line">        mSample, mAnimChanList, mRotateAxisOpIndex);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// invert the rotate pivot if necessary</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">&quot;rotatePivot&quot;</span>, <span class="stringliteral">&quot;rotatePivotX&quot;</span>, <span class="stringliteral">&quot;rotatePivotY&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;rotatePivotZ&quot;</span>, Alembic::AbcGeom::kRotatePivotPointHint,</div>
<div class="line">        <span class="keyword">true</span>, iForceStatic, <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// inspect the scale pivot translation</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">&quot;scalePivotTranslate&quot;</span>, <span class="stringliteral">&quot;scalePivotTranslateX&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;scalePivotTranslateY&quot;</span>, <span class="stringliteral">&quot;scalePivotTranslateZ&quot;</span>,</div>
<div class="line">        Alembic::AbcGeom::kScalePivotTranslationHint, <span class="keyword">false</span>, iForceStatic,</div>
<div class="line">        <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// inspect the scale pivot point</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">&quot;scalePivot&quot;</span>, <span class="stringliteral">&quot;scalePivotX&quot;</span>, <span class="stringliteral">&quot;scalePivotY&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;scalePivotZ&quot;</span>, Alembic::AbcGeom::kScalePivotPointHint, <span class="keyword">false</span>,</div>
<div class="line">        iForceStatic, <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// inspect the shear</span></div>
<div class="line">    addShear(iTrans, iForceStatic, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// add the scale</span></div>
<div class="line">    addScale(iTrans, <span class="stringliteral">&quot;scale&quot;</span>, <span class="stringliteral">&quot;scaleX&quot;</span>, <span class="stringliteral">&quot;scaleY&quot;</span>, <span class="stringliteral">&quot;scaleZ&quot;</span>, <span class="keyword">false</span>,</div>
<div class="line">        iForceStatic, <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// inverse the scale pivot point if necessary</span></div>
<div class="line">    addTranslate(iTrans, <span class="stringliteral">&quot;scalePivot&quot;</span>, <span class="stringliteral">&quot;scalePivotX&quot;</span>, <span class="stringliteral">&quot;scalePivotY&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;scalePivotZ&quot;</span>, Alembic::AbcGeom::kScalePivotPointHint, <span class="keyword">true</span>,</div>
<div class="line">        iForceStatic, <span class="keyword">false</span>, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// remember current rotation</span></div>
<div class="line">    <span class="keywordflow">if</span> (mFilterEulerRotations)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">double</span> xx(0), yy(0), zz(0);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// there are 2 rotation order enum definitions:</span></div>
<div class="line">        <span class="comment">//   MEulerRotation::RotationOrder = MTransformationMatrix::RotationOrder-1</span></div>
<div class="line">        <span class="keywordflow">if</span> (getSampledRotation( mSample, mRotateOpIndex, xx, yy, zz ))</div>
<div class="line">        {</div>
<div class="line">            mPrevRotateSolution.setValue(xx, yy, zz, (<a class="code" href="#!/url=./cpp_ref/class_m_euler_rotation.html#af3d74c777e523f2725cdf87c15a4b5bc">MEulerRotation::RotationOrder</a>)(eRotOrder-1));</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (getSampledRotation( mSample, mRotateAxisOpIndex, xx, yy, zz ))</div>
<div class="line">        {</div>
<div class="line">            mPrevRotateAxisSolution.setValue(xx, yy, zz, <a name="a18"></a><a class="code" href="#!/url=./cpp_ref/class_m_euler_rotation.html#af3d74c777e523f2725cdf87c15a4b5bcacfa82ee0eaf4075f3cda4152dd020d99">MEulerRotation::kXYZ</a>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MayaTransformWriter::pushTransformStack(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_fn_ik_joint.html">MFnIkJoint</a> &amp; iJoint,</div>
<div class="line">    <span class="keywordtype">bool</span> iForceStatic)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// check joints that are driven by Maya FBIK</span></div>
<div class="line">    <span class="comment">// Maya FBIK has no connection to joints&#39; TRS plugs</span></div>
<div class="line">    <span class="comment">// but TRS of joints are driven by FBIK, they are not static</span></div>
<div class="line">    <span class="comment">// Maya 2012&#39;s new HumanIK has connections to joints.</span></div>
<div class="line">    <span class="comment">// FBIK is a special case.</span></div>
<div class="line">    <span class="keywordtype">bool</span> forceAnimated = <span class="keyword">false</span>;</div>
<div class="line">    <a name="_a19"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status = MS::kSuccess;</div>
<div class="line">    <span class="keywordflow">if</span> (iJoint.<a name="a20"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_ik_joint.html#a10915465bf61324638e009e022882976">hikJointName</a>(&amp;status).<a name="a21"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e">length</a>() &gt; 0 &amp;&amp; status) {</div>
<div class="line">        forceAnimated = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// inspect the translate</span></div>
<div class="line">    addTranslate(iJoint, <span class="stringliteral">&quot;translate&quot;</span>, <span class="stringliteral">&quot;translateX&quot;</span>, <span class="stringliteral">&quot;translateY&quot;</span>, <span class="stringliteral">&quot;translateZ&quot;</span>,</div>
<div class="line">        Alembic::AbcGeom::kTranslateHint, <span class="keyword">false</span>, iForceStatic, forceAnimated,</div>
<div class="line">        mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// inspect the inverseParent scale</span></div>
<div class="line">    <span class="comment">// [IS] is ignored when Segment Scale Compensate is false</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> scaleCompensatePlug = iJoint.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>(<span class="stringliteral">&quot;segmentScaleCompensate&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (scaleCompensatePlug.<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#a69b4092a85b4edf58b7d50f331cc38cf">asBool</a>())</div>
<div class="line">    {</div>
<div class="line">        addScale(iJoint, <span class="stringliteral">&quot;inverseScale&quot;</span>, <span class="stringliteral">&quot;inverseScaleX&quot;</span>, <span class="stringliteral">&quot;inverseScaleY&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;inverseScaleZ&quot;</span>, <span class="keyword">true</span>, iForceStatic, forceAnimated, mSample, mAnimChanList);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_transformation_matrix.html#af3d74c777e523f2725cdf87c15a4b5bc">MTransformationMatrix::RotationOrder</a> eJointOrientOrder, eRotOrder, eRotateAxisOrder;</div>
<div class="line">    <span class="keywordtype">double</span> vals[3];</div>
<div class="line"></div>
<div class="line">    <span class="comment">// for reordering rotate names</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> rotateNames[3];</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rotOrder[3];</div>
<div class="line"></div>
<div class="line">    <span class="comment">// now look at the joint orientation</span></div>
<div class="line">    rotateNames[0] = <span class="stringliteral">&quot;jointOrientX&quot;</span>;</div>
<div class="line">    rotateNames[1] = <span class="stringliteral">&quot;jointOrientY&quot;</span>;</div>
<div class="line">    rotateNames[2] = <span class="stringliteral">&quot;jointOrientZ&quot;</span>;</div>
<div class="line"></div>
<div class="line">    iJoint.<a name="a22"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_ik_joint.html#a0f41ef4fb484400b2472a6d9c1c5afcb">getOrientation</a>(vals, eJointOrientOrder);</div>
<div class="line">    <span class="keywordflow">if</span> (util::getRotOrder(eJointOrientOrder, rotOrder[0], rotOrder[1], rotOrder[2]))</div>
<div class="line">    {</div>
<div class="line">        addRotate(iJoint, <span class="stringliteral">&quot;jointOrient&quot;</span>, rotateNames, rotOrder,</div>
<div class="line">            Alembic::AbcGeom::kRotateHint, iForceStatic, <span class="keyword">true</span>,</div>
<div class="line">            mSample, mAnimChanList, mJointOrientOpIndex);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    rotateNames[0] = <span class="stringliteral">&quot;rotateX&quot;</span>;</div>
<div class="line">    rotateNames[1] = <span class="stringliteral">&quot;rotateY&quot;</span>;</div>
<div class="line">    rotateNames[2] = <span class="stringliteral">&quot;rotateZ&quot;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// if this returns false then the rotation order was kInvalid or kLast</span></div>
<div class="line">    eRotOrder = iJoint.<a class="code" href="#!/url=./cpp_ref/class_m_fn_transform.html#a4279a68f07bfa316935e61610786e6aa">rotationOrder</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (util::getRotOrder(eRotOrder, rotOrder[0], rotOrder[1],</div>
<div class="line">        rotOrder[2]))</div>
<div class="line">    {</div>
<div class="line">        addRotate(iJoint, <span class="stringliteral">&quot;rotate&quot;</span>, rotateNames, rotOrder,</div>
<div class="line">            Alembic::AbcGeom::kRotateHint, iForceStatic, <span class="keyword">true</span>,</div>
<div class="line">            mSample, mAnimChanList, mRotateOpIndex);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// now look at the rotation orientation, aka rotate axis</span></div>
<div class="line">    rotateNames[0] = <span class="stringliteral">&quot;rotateAxisX&quot;</span>;</div>
<div class="line">    rotateNames[1] = <span class="stringliteral">&quot;rotateAxisY&quot;</span>;</div>
<div class="line">    rotateNames[2] = <span class="stringliteral">&quot;rotateAxisZ&quot;</span>;</div>
<div class="line"></div>
<div class="line">    iJoint.<a name="a23"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_ik_joint.html#a77418f351887f797ea214317a0c6e1bd">getScaleOrientation</a>(vals, eRotateAxisOrder);</div>
<div class="line">    <span class="keywordflow">if</span> (util::getRotOrder(eRotateAxisOrder, rotOrder[0], rotOrder[1], rotOrder[2]))</div>
<div class="line">    {</div>
<div class="line">        addRotate(iJoint, <span class="stringliteral">&quot;rotateAxis&quot;</span>, rotateNames, rotOrder,</div>
<div class="line">            Alembic::AbcGeom::kRotateOrientationHint, iForceStatic, <span class="keyword">true</span>,</div>
<div class="line">            mSample, mAnimChanList, mRotateAxisOpIndex);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// inspect the scale</span></div>
<div class="line">    addScale(iJoint, <span class="stringliteral">&quot;scale&quot;</span>, <span class="stringliteral">&quot;scaleX&quot;</span>, <span class="stringliteral">&quot;scaleY&quot;</span>, <span class="stringliteral">&quot;scaleZ&quot;</span>, <span class="keyword">false</span>,</div>
<div class="line">        iForceStatic, forceAnimated, mSample, mAnimChanList);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// remember current rotation</span></div>
<div class="line">    <span class="keywordflow">if</span> (mFilterEulerRotations)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">double</span> xx(0), yy(0), zz(0);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// there are 2 rotation order enum definitions:</span></div>
<div class="line">        <span class="comment">//   MEulerRotation::RotationOrder = MTransformationMatrix::RotationOrder-1</span></div>
<div class="line">        <span class="keywordflow">if</span> (getSampledRotation( mSample, mJointOrientOpIndex, xx, yy, zz ))</div>
<div class="line">        {</div>
<div class="line">            mPrevJointOrientSolution.setValue(xx, yy, zz, (<a class="code" href="#!/url=./cpp_ref/class_m_euler_rotation.html#af3d74c777e523f2725cdf87c15a4b5bc">MEulerRotation::RotationOrder</a>)(eJointOrientOrder-1));</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (getSampledRotation( mSample, mRotateOpIndex, xx, yy, zz ))</div>
<div class="line">        {</div>
<div class="line">            mPrevRotateSolution.setValue(xx, yy, zz, (<a class="code" href="#!/url=./cpp_ref/class_m_euler_rotation.html#af3d74c777e523f2725cdf87c15a4b5bc">MEulerRotation::RotationOrder</a>)(eRotOrder-1));</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (getSampledRotation( mSample, mRotateAxisOpIndex, xx, yy, zz ))</div>
<div class="line">        {</div>
<div class="line">            mPrevRotateAxisSolution.setValue(xx, yy, zz, (<a class="code" href="#!/url=./cpp_ref/class_m_euler_rotation.html#af3d74c777e523f2725cdf87c15a4b5bc">MEulerRotation::RotationOrder</a>)(eRotateAxisOrder-1));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> MayaTransformWriter::pushTransformStack(<span class="keyword">const</span> AnimSampler &amp; sampler,</div>
<div class="line">    <span class="keywordtype">bool</span> iForceStatic)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// inspect the translate</span></div>
<div class="line">    {</div>
<div class="line">        Alembic::Util::uint8_t iHint = Alembic::AbcGeom::kTranslateHint;</div>
<div class="line"></div>
<div class="line">        Alembic::AbcGeom::XformOp op(Alembic::AbcGeom::kTranslateOperation, iHint);</div>
<div class="line"></div>
<div class="line">        AnimChan xChan = sampler.animChan(Alembic::AbcGeom::kTranslateOperation,kChannel0);</div>
<div class="line">        AnimChan yChan = sampler.animChan(Alembic::AbcGeom::kTranslateOperation,kChannel1);</div>
<div class="line">        AnimChan zChan = sampler.animChan(Alembic::AbcGeom::kTranslateOperation,kChannel2);</div>
<div class="line"></div>
<div class="line">        op.setChannelValue(kChannel0, xChan.asDouble());</div>
<div class="line">        op.setChannelValue(kChannel1, yChan.asDouble());</div>
<div class="line">        op.setChannelValue(kChannel2, zChan.asDouble());</div>
<div class="line"></div>
<div class="line">        addChannel( mAnimChanList, mSample, xChan );</div>
<div class="line">        addChannel( mAnimChanList, mSample, yChan );</div>
<div class="line">        addChannel( mAnimChanList, mSample, zChan );</div>
<div class="line"></div>
<div class="line">        mSample.addOp(op);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: inspect the rotate pivot translate</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: inspect the rotate pivot</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: inspect rotate names</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_transformation_matrix.html#af3d74c777e523f2725cdf87c15a4b5bc">MTransformationMatrix::RotationOrder</a> eRotOrder = <a name="a24"></a><a class="code" href="#!/url=./cpp_ref/class_m_transformation_matrix.html#af3d74c777e523f2725cdf87c15a4b5bcacfa82ee0eaf4075f3cda4152dd020d99">MTransformationMatrix::kXYZ</a>;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rotOrder[3];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (util::getRotOrder(eRotOrder, rotOrder[0], rotOrder[1], rotOrder[2]))</div>
<div class="line">    {</div>
<div class="line">        Alembic::Util::uint8_t iHint = Alembic::AbcGeom::kRotateHint;</div>
<div class="line"></div>
<div class="line">        Alembic::AbcGeom::XformOp opZ(Alembic::AbcGeom::kRotateZOperation, iHint);</div>
<div class="line">        Alembic::AbcGeom::XformOp opY(Alembic::AbcGeom::kRotateYOperation, iHint);</div>
<div class="line">        Alembic::AbcGeom::XformOp opX(Alembic::AbcGeom::kRotateXOperation, iHint);</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">double</span> scale = Alembic::AbcGeom::RadiansToDegrees(1.0);</div>
<div class="line"></div>
<div class="line">        AnimChan zChan = sampler.animChan(Alembic::AbcGeom::kRotateZOperation, kChannel0, scale);</div>
<div class="line">        AnimChan yChan = sampler.animChan(Alembic::AbcGeom::kRotateYOperation, kChannel0, scale);</div>
<div class="line">        AnimChan xChan = sampler.animChan(Alembic::AbcGeom::kRotateXOperation, kChannel0, scale);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// assume we&#39;re getting radians</span></div>
<div class="line">        <span class="keywordtype">double</span> valZ = zChan.asDouble();</div>
<div class="line">        <span class="keywordtype">double</span> valY = yChan.asDouble();</div>
<div class="line">        <span class="keywordtype">double</span> valX = xChan.asDouble();</div>
<div class="line"></div>
<div class="line">        opZ.setChannelValue(kChannel0, valZ);</div>
<div class="line">        opY.setChannelValue(kChannel0, valY);</div>
<div class="line">        opX.setChannelValue(kChannel0, valX);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// we are using the XYZ rotation order</span></div>
<div class="line">        addChannel( mAnimChanList, mSample, zChan );</div>
<div class="line">        mRotateOpIndex[rotOrder[2]] = mSample.addOp(opZ);</div>
<div class="line"></div>
<div class="line">        addChannel( mAnimChanList, mSample, yChan );</div>
<div class="line">        mRotateOpIndex[rotOrder[1]] = mSample.addOp(opY);</div>
<div class="line"></div>
<div class="line">        addChannel( mAnimChanList, mSample, xChan );</div>
<div class="line">        mRotateOpIndex[rotOrder[0]] = mSample.addOp(opX);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: now look at the rotation orientation, aka rotate axis</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: invert the rotate pivot if necessary</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: inspect the scale pivot translation</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: inspect the scale pivot point</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: inspect the shear</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: add the scale</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// TODO: inverse the scale pivot point if necessary</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// remember current rotation</span></div>
<div class="line">    <span class="keywordflow">if</span> (mFilterEulerRotations)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">double</span> xx(0), yy(0), zz(0);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// there are 2 rotation order enum definitions:</span></div>
<div class="line">        <span class="comment">//   MEulerRotation::RotationOrder = MTransformationMatrix::RotationOrder-1</span></div>
<div class="line">        <span class="keywordflow">if</span> (getSampledRotation( mSample, mRotateOpIndex, xx, yy, zz ))</div>
<div class="line">        {</div>
<div class="line">            mPrevRotateSolution.setValue(xx, yy, zz, (<a class="code" href="#!/url=./cpp_ref/class_m_euler_rotation.html#af3d74c777e523f2725cdf87c15a4b5bc">MEulerRotation::RotationOrder</a>)(eRotOrder-1));</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (getSampledRotation( mSample, mRotateAxisOpIndex, xx, yy, zz ))</div>
<div class="line">        {</div>
<div class="line">            mPrevRotateAxisSolution.setValue(xx, yy, zz, <a class="code" href="#!/url=./cpp_ref/class_m_euler_rotation.html#af3d74c777e523f2725cdf87c15a4b5bcacfa82ee0eaf4075f3cda4152dd020d99">MEulerRotation::kXYZ</a>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->

      <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
   </div></body>
</html>
