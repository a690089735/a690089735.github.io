<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
      <title>C++ API Reference: onbShader/onbShaderOverride.cpp</title>
      
	  
      
      
      
      
      
      
      
    

</head>
   <body height="100%"><div class="body_content" id="body-content"><link rel="stylesheet" type="text/css" href="cpp_ref/navtree.css"><link rel="stylesheet" type="text/css" href="cpp_ref/doxygen.css"><link rel="stylesheet" type="text/css" href="cpp_ref/tabs.css"><link rel="stylesheet" type="text/css" href="style/adsk.cpm.css"><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('onb_shader_2onb_shader_override_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
      <div>
         <div class="head">
            <h1>C++ API Reference: onbShader/onbShaderOverride.cpp</h1>
         </div>

<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->

  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="#!/url=./cpp_ref/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="#!/url=./cpp_ref/pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="#!/url=./cpp_ref/modules.html"><span>Modules</span></a></li>
      <li><a href="#!/url=./cpp_ref/namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="#!/url=./cpp_ref/annotated.html"><span>Classes</span></a></li>
      <li><a href="#!/url=./cpp_ref/examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="cpp_ref/search/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="cpp_ref/search/close.png" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>

<div id="doc-content">
<!-- window showing the filter options -->


<!-- iframe showing the search results (closed by default) -->


<div class="header">
  <div class="headertitle">
<div class="title">onbShader/onbShaderOverride.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">// ===========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 2015 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk license</span></div>
<div class="line"><span class="comment">// agreement provided at the time of installation or download, or which</span></div>
<div class="line"><span class="comment">// otherwise accompanies this software in either electronic or hard copy form.</span></div>
<div class="line"><span class="comment">// ===========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;onbShaderOverride.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MViewport2Renderer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFragmentManager.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This is the implementation of MPxSurfaceShadingNodeOverride that tells Maya</span></div>
<div class="line"><span class="comment">// how to build and manage a VP2 shading fragment for the onbShader node in the</span></div>
<div class="line"><span class="comment">// DG. Note that the implementation is trivial for the most part. The reason for</span></div>
<div class="line"><span class="comment">// this is because we have made the final fragment graph parameters match in</span></div>
<div class="line"><span class="comment">// name and type to the attributes on the shading node. If that was not the</span></div>
<div class="line"><span class="comment">// case, or if there were paramters without a one-to-one mapping from</span></div>
<div class="line"><span class="comment">// attributes on the node then this class would be more complicated, perhaps</span></div>
<div class="line"><span class="comment">// requiring the implementation of several of the other virtual methods from</span></div>
<div class="line"><span class="comment">// MPxShadingNodeOverride (the base class to MPxSurfaceShadingNodeOverride).</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Here we simply provide the final fragment graph name in fragmentName(),</span></div>
<div class="line"><span class="comment">// and also provide parameter names for certain material properties (color,</span></div>
<div class="line"><span class="comment">// transparency and bump).</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// A static method handles the definition and registration of the actual</span></div>
<div class="line"><span class="comment">// shading fragments and the final fragment graph. Please see the comments in</span></div>
<div class="line"><span class="comment">// registerFragments() for more details.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <a name="_a0"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> onbShaderOverride::sFinalFragmentGraphName(<span class="stringliteral">&quot;onbShaderSurface&quot;</span>);</div>
<div class="line"></div>
<div class="line"><a name="_a1"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_surface_shading_node_override.html">MHWRender::MPxSurfaceShadingNodeOverride</a>* onbShaderOverride::creator(</div>
<div class="line">    <span class="keyword">const</span> <a name="_a2"></a><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>&amp; obj)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> onbShaderOverride(obj);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">onbShaderOverride::onbShaderOverride(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>&amp; obj)</div>
<div class="line">: MPxSurfaceShadingNodeOverride(obj)</div>
<div class="line">, fObject(obj)</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">onbShaderOverride::~onbShaderOverride()</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MHWRender::DrawAPI onbShaderOverride::supportedDrawAPIs()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// Support all available draw APIs (all fragments have an implementation for</span></div>
<div class="line">    <span class="comment">// each).</span></div>
<div class="line">    <span class="keywordflow">return</span></div>
<div class="line">        MHWRender::kOpenGL |</div>
<div class="line">        MHWRender::kDirectX11 |</div>
<div class="line">        MHWRender::kOpenGLCoreProfile;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> onbShaderOverride::fragmentName()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// Return the name of the full fragment graph</span></div>
<div class="line">    <span class="keywordflow">return</span> sFinalFragmentGraphName;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> onbShaderOverride::primaryColorParameter()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// Use the color parameter from the our fragment graph as the primary color</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;color&quot;</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> onbShaderOverride::transparencyParameter()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// Use the transparency parameter from our fragment graph for transparency</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;transparency&quot;</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> onbShaderOverride::bumpAttribute()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// Use the normalCamera attribute to recognize bump connections</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;normalCamera&quot;</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Static fragment registration/deregistration methods called from plugin</span></div>
<div class="line"><span class="comment">// init/unint functions. Only need to be called once.</span></div>
<div class="line"><a name="_a3"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> onbShaderOverride::registerFragments()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Get fragment manager for registration</span></div>
<div class="line">    <a name="_a4"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html">MHWRender::MFragmentManager</a>* fragmentMgr =</div>
<div class="line">        <a name="a5"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>()</div>
<div class="line">            ? <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>()-&gt;<a name="a6"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a0f42783e8eee6f472d6bbb2acb6b2f2d">getFragmentManager</a>()</div>
<div class="line">            : NULL;</div>
<div class="line">    <span class="comment">// No fragment manager, fail</span></div>
<div class="line">    <span class="keywordflow">if</span> (!fragmentMgr) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line">    <span class="comment">// Fragments are already registered, return success</span></div>
<div class="line">    <span class="keywordflow">if</span> (fragmentMgr-&gt;<a name="a7"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#af82d71b3a71c8752d51d0a9cb6081877">hasFragment</a>(sFinalFragmentGraphName)) <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> fragmentName;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* fragmentBody = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Pass-through fragment for float3 type, used to provide clarity and as to</span></div>
<div class="line">    <span class="comment">// where duplicated parameters come from (in this case it is used three</span></div>
<div class="line">    <span class="comment">// times, once each for Nw, Vw and Lw, which are all used on both</span></div>
<div class="line">    <span class="comment">// onbShaderGeom and onbDiffuse.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    fragmentName = <span class="stringliteral">&quot;onbFloat3PassThrough&quot;</span>;</div>
<div class="line">    fragmentBody =</div>
<div class="line">        <span class="stringliteral">&quot;&lt;fragment uiName=\&quot;onbFloat3PassThrough\&quot; name=\&quot;onbFloat3PassThrough\&quot; type=\&quot;plumbing\&quot; class=\&quot;ShadeFragment\&quot; version=\&quot;1.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;description&gt;&lt;![CDATA[Pass-through fragment for float3 type.]]&gt;&lt;/description&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;input\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;output\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;Cg\&quot; lang_version=\&quot;2.1\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbFloat3PassThrough\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;float3 onbFloat3PassThrough(float3 value) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return value; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;HLSL\&quot; lang_version=\&quot;11.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbFloat3PassThrough\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;float3 onbFloat3PassThrough(float3 value) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return value; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;GLSL\&quot; lang_version=\&quot;3.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbFloat3PassThrough\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;vec3 onbFloat3PassThrough(vec3 value) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return value; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;&lt;/fragment&gt; \r\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (fragmentName != fragmentMgr-&gt;<a name="a8"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a221c1b902178b12d827dcae51fdca4c8">addShadeFragmentFromBuffer</a>(fragmentBody, <span class="keyword">false</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Fragment to pre-compute some dot products needed by diffuse and specular</span></div>
<div class="line">    <span class="comment">// computations. Results are packed into a float4.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    fragmentName = <span class="stringliteral">&quot;onbShaderGeom&quot;</span>;</div>
<div class="line">    fragmentBody =</div>
<div class="line">        <span class="stringliteral">&quot;&lt;fragment uiName=\&quot;onbShaderGeom\&quot; name=\&quot;onbShaderGeom\&quot; type=\&quot;plumbing\&quot; class=\&quot;ShadeFragment\&quot; version=\&quot;1.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;description&gt;&lt;![CDATA[Computes shader geometric components (dot products)]]&gt;&lt;/description&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;Nw\&quot; flags=\&quot;varyingInputParam\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;Lw\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;HLw\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;Vw\&quot; flags=\&quot;varyingInputParam\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;Lw\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;HLw\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float4 name=\&quot;onbShaderGeom\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;Cg\&quot; lang_version=\&quot;2.1\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbShaderGeom\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;float4 onbShaderGeom( \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Nw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Lw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 HLw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Vw) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Hw = normalize(HLw + Vw); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NL = saturate(dot(Nw, Lw)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NV = saturate(dot(Nw, Vw)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NH = saturate(dot(Nw, Hw)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float VH = dot(Vw, Hw); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return float4(NL, NV, NH, VH); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;HLSL\&quot; lang_version=\&quot;11.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbShaderGeom\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;float4 onbShaderGeom( \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Nw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Lw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 HLw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Vw) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Hw = normalize(HLw + Vw); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NL = saturate(dot(Nw, Lw)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NV = saturate(dot(Nw, Vw)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NH = saturate(dot(Nw, Hw)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float VH = dot(Vw, Hw); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return float4(NL, NV, NH, VH); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;GLSL\&quot; lang_version=\&quot;3.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbShaderGeom\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;vec4 onbShaderGeom( \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 Nw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 Lw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 HLw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 Vw) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 Hw = normalize(HLw + Vw); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NL = saturate(dot(Nw, Lw)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NV = saturate(dot(Nw, Vw)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NH = saturate(dot(Nw, Hw)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float VH = dot(Vw, Hw); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return vec4(NL, NV, NH, VH); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;&lt;/fragment&gt; \r\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (fragmentName != fragmentMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a221c1b902178b12d827dcae51fdca4c8">addShadeFragmentFromBuffer</a>(fragmentBody, <span class="keyword">false</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Fragment to compute the diffuse contribution for shading for a single</span></div>
<div class="line">    <span class="comment">// light source. Implements the simplified Oren-Nayar computation  based on</span></div>
<div class="line">    <span class="comment">//   Engel, Wolfgang et al. Programming Vertex, Geometry, and Pixel Shaders</span></div>
<div class="line">    <span class="comment">//   http://content.gpwiki.org/index.php/D3DBook:(Lighting)_Oren-Nayar</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    fragmentName = <span class="stringliteral">&quot;onbDiffuse&quot;</span>;</div>
<div class="line">    fragmentBody =</div>
<div class="line">        <span class="stringliteral">&quot;&lt;fragment uiName=\&quot;onbDiffuse\&quot; name=\&quot;onbDiffuse\&quot; type=\&quot;plumbing\&quot; class=\&quot;ShadeFragment\&quot; version=\&quot;1.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;description&gt;&lt;![CDATA[Computes Oren-Nayar diffuse component]]&gt;&lt;/description&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float4 name=\&quot;shaderGeomInput\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;Nw\&quot; flags=\&quot;varyingInputParam\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;Lw\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;Vw\&quot; flags=\&quot;varyingInputParam\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;diffuseI\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float name=\&quot;roughness\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float4 name=\&quot;shaderGeomInput\&quot; value=\&quot;0.0,0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;Lw\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;diffuseI\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float name=\&quot;roughness\&quot; value=\&quot;0.3\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;onbDiffuse\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;Cg\&quot; lang_version=\&quot;2.1\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbDiffuse\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;float3 onbDiffuse( \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float4 NL_NV_NH_VH, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Nw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Lw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Vw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 diffuseI, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float roughness) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   // GPU implementation of Oren-Nayar computation from: \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   //  Engel, Wolfgang et al.: Programming Vertex, Geometry, and Pixel Shaders \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   //  http://content.gpwiki.org/index.php/D3DBook:(Lighting)_Oren-Nayar \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float acosNV = acos(NL_NV_NH_VH.y); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float acosNL = acos(NL_NV_NH_VH.x); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float alpha = max(acosNV, acosNL); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float beta = min(acosNV, acosNL); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float gamma = dot(Vw - Nw*NL_NV_NH_VH.y, Lw - Nw*NL_NV_NH_VH.x); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float roughnessSq = roughness*roughness; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float A = 1.0f - 0.5f*(roughnessSq/(roughnessSq + 0.57f)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float B = 0.45f*(roughnessSq/(roughnessSq + 0.09f)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float C = sin(alpha)*tan(beta); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float factor = max(0.0f, NL_NV_NH_VH.x)*(A + B*max(0.0f, gamma)*C); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return factor*diffuseI; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;HLSL\&quot; lang_version=\&quot;11.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbDiffuse\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;float3 onbDiffuse( \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float4 NL_NV_NH_VH, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Nw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Lw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 Vw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 diffuseI, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float roughness) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   // GPU implementation of Oren-Nayar computation from: \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   //  Engel, Wolfgang et al.: Programming Vertex, Geometry, and Pixel Shaders \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   //  http://content.gpwiki.org/index.php/D3DBook:(Lighting)_Oren-Nayar \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float acosNV = acos(NL_NV_NH_VH.y); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float acosNL = acos(NL_NV_NH_VH.x); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float alpha = max(acosNV, acosNL); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float beta = min(acosNV, acosNL); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float gamma = dot(Vw - Nw*NL_NV_NH_VH.y, Lw - Nw*NL_NV_NH_VH.x); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float roughnessSq = roughness*roughness; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float A = 1.0f - 0.5f*(roughnessSq/(roughnessSq + 0.57f)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float B = 0.45f*(roughnessSq/(roughnessSq + 0.09f)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float C = sin(alpha)*tan(beta); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float factor = max(0.0f, NL_NV_NH_VH.x)*(A + B*max(0.0f, gamma)*C); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return factor*diffuseI; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;GLSL\&quot; lang_version=\&quot;3.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbDiffuse\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;vec3 onbDiffuse( \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec4 NL_NV_NH_VH, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 Nw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 Lw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 Vw, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 diffuseI, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float roughness) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   // GPU implementation of Oren-Nayar computation from: \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   //  Engel, Wolfgang et al.: Programming Vertex, Geometry, and Pixel Shaders \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   //  http://content.gpwiki.org/index.php/D3DBook:(Lighting)_Oren-Nayar \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float acosNV = acos(NL_NV_NH_VH.y); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float acosNL = acos(NL_NV_NH_VH.x); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float alpha = max(acosNV, acosNL); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float beta = min(acosNV, acosNL); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float gamma = dot(Vw - Nw*NL_NV_NH_VH.y, Lw - Nw*NL_NV_NH_VH.x); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float roughnessSq = roughness*roughness; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float A = 1.0f - 0.5f*(roughnessSq/(roughnessSq + 0.57f)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float B = 0.45f*(roughnessSq/(roughnessSq + 0.09f)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float C = sin(alpha)*tan(beta); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float factor = max(0.0f, NL_NV_NH_VH.x)*(A + B*max(0.0f, gamma)*C); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return factor*diffuseI; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;&lt;/fragment&gt; \r\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (fragmentName != fragmentMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a221c1b902178b12d827dcae51fdca4c8">addShadeFragmentFromBuffer</a>(fragmentBody, <span class="keyword">false</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Fragment to compute the specular contribution for shading for a single</span></div>
<div class="line">    <span class="comment">// light source. Implements blinn specular computation.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    fragmentName = <span class="stringliteral">&quot;onbSpecular&quot;</span>;</div>
<div class="line">    fragmentBody =</div>
<div class="line">        <span class="stringliteral">&quot;&lt;fragment uiName=\&quot;onbSpecular\&quot; name=\&quot;onbSpecular\&quot; type=\&quot;plumbing\&quot; class=\&quot;ShadeFragment\&quot; version=\&quot;1.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;description&gt;&lt;![CDATA[Computes blinn specular component]]&gt;&lt;/description&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;specularI\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float4 name=\&quot;shaderGeomInput\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;specularColor\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float name=\&quot;eccentricity\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float name=\&quot;specularRollOff\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;specularI\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float4 name=\&quot;shaderGeomInput\&quot; value=\&quot;0.0,0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;specularColor\&quot; value=\&quot;1.0,1.0,1.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float name=\&quot;eccentricity\&quot; value=\&quot;0.1\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float name=\&quot;specularRollOff\&quot; value=\&quot;0.7\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;onbSpecular\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;Cg\&quot; lang_version=\&quot;2.1\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbSpecular\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;float3 onbSpecular( \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 specularI, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float4 NL_NV_NH_VH, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 specularColor, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float ecc, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float rolloff) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   const float eps = 0.00001f; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float ecc2 = ecc * ecc - 1.0f; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NH = NL_NV_NH_VH.z; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float d = (ecc2 + 1.0f) / (1.0f + ecc2 * NH * NH); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   d *= 2.0f * d * d; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NL = NL_NV_NH_VH.x; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NV = NL_NV_NH_VH.y; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float VH = NL_NV_NH_VH.w + eps; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   NH *= 0.5f; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float g = saturate(min(NH*NV/VH, NH*NL/VH)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float k = max((1.0f - NV), (1.0f - NL)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   k = k * k * k; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float f = k + (1.0f - k) * rolloff; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return specularI * saturate(d * f * g) * specularColor; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;HLSL\&quot; lang_version=\&quot;11.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbSpecular\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;float3 onbSpecular( \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 specularI, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float4 NL_NV_NH_VH, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 specularColor, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float ecc, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float rolloff) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   const float eps = 0.00001f; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float ecc2 = ecc * ecc - 1.0f; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NH = NL_NV_NH_VH.z; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float d = (ecc2 + 1.0f) / (1.0f + ecc2 * NH * NH); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   d *= 2.0f * d * d; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NL = NL_NV_NH_VH.x; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NV = NL_NV_NH_VH.y; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float VH = NL_NV_NH_VH.w + eps; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   NH *= 0.5f; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float g = saturate(min(NH*NV/VH, NH*NL/VH)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float k = max((1.0f - NV), (1.0f - NL)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   k = k * k * k; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float f = k + (1.0f - k) * rolloff; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return specularI * saturate(d * f * g) * specularColor; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;GLSL\&quot; lang_version=\&quot;3.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbSpecular\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;vec3 onbSpecular( \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 specularI, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec4 NL_NV_NH_VH, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 specularColor, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float ecc, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float rolloff) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   const float eps = 0.00001f; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float ecc2 = ecc * ecc - 1.0f; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NH = NL_NV_NH_VH.z; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float d = (ecc2 + 1.0f) / (1.0f + ecc2 * NH * NH); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   d *= 2.0f * d * d; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NL = NL_NV_NH_VH.x; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float NV = NL_NV_NH_VH.y; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float VH = NL_NV_NH_VH.w + eps; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   NH *= 0.5f; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float g = saturate(min(NH*NV/VH, NH*NL/VH)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float k = max((1.0f - NV), (1.0f - NL)); \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   k = k * k * k; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float f = k + (1.0f - k) * rolloff; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return specularI * saturate(d * f * g) * specularColor; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;&lt;/fragment&gt; \r\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (fragmentName != fragmentMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a221c1b902178b12d827dcae51fdca4c8">addShadeFragmentFromBuffer</a>(fragmentBody, <span class="keyword">false</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Light accumulator fragment. Special fragment type that instructs the</span></div>
<div class="line">    <span class="comment">// underlying fragment system to generate a light loop based on input from</span></div>
<div class="line">    <span class="comment">// the auto-generated &quot;selector&quot; fragment. The value &quot;mayaLightSelector16&quot;</span></div>
<div class="line">    <span class="comment">// gives the name of the selector fragment. This fragment is created by</span></div>
<div class="line">    <span class="comment">// Maya and connected at the appropriate time. The selector fragment</span></div>
<div class="line">    <span class="comment">// supports up to 16 lights. This accumulator fragment causes the</span></div>
<div class="line">    <span class="comment">// generation of code that computes the diffuse and specular shading for</span></div>
<div class="line">    <span class="comment">// each light and then gathers the scaled sum of the results.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    fragmentName = <span class="stringliteral">&quot;onb16LightAccum&quot;</span>;</div>
<div class="line">    fragmentBody =</div>
<div class="line">        <span class="stringliteral">&quot;&lt;fragment uiName=\&quot;onb16LightAccum\&quot; name=\&quot;onb16LightAccum\&quot; type=\&quot;accum\&quot; class=\&quot;ShadeFragment\&quot; version=\&quot;1.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;description&gt;&lt;![CDATA[Accumulates specular &amp; diffuse irradiance for 16 lights]]&gt;&lt;/description&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;scaledDiffuse\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;scaledSpecular\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;string name=\&quot;selector\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;string name=\&quot;selector\&quot; value=\&quot;mayaLightSelector16\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;alias name=\&quot;scaledDiffuse\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;alias name=\&quot;scaledSpecular\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;&lt;/fragment&gt; \r\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (fragmentName != fragmentMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a221c1b902178b12d827dcae51fdca4c8">addShadeFragmentFromBuffer</a>(fragmentBody, <span class="keyword">false</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Struct declaration fragment. This fragment provides the declaration of</span></div>
<div class="line">    <span class="comment">// the output structure of the onb fragment graph giving support for</span></div>
<div class="line">    <span class="comment">// multiple outputs. The struct fragment must be a part of the final</span></div>
<div class="line">    <span class="comment">// fragment graph in order to ensure that the fragment system includes</span></div>
<div class="line">    <span class="comment">// the declaration of the struct in the final effect.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    fragmentName = <span class="stringliteral">&quot;onbShaderOutput&quot;</span>;</div>
<div class="line">    fragmentBody =</div>
<div class="line">        <span class="stringliteral">&quot;&lt;fragment uiName=\&quot;onbShaderOutput\&quot; name=\&quot;onbShaderOutput\&quot; type=\&quot;structure\&quot; class=\&quot;ShadeFragment\&quot; version=\&quot;1.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;description&gt;&lt;![CDATA[Struct output for onb shader]]&gt;&lt;/description&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;struct name=\&quot;onbShaderOutput\&quot; struct_name=\&quot;onbShaderOutput\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;alias name=\&quot;onbShaderOutput\&quot; struct_name=\&quot;onbShaderOutput\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;outColor\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;outTransparency\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float4 name=\&quot;outSurfaceFinal\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;Cg\&quot; lang_version=\&quot;2.1\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;declaration name=\&quot;onbShaderOutput\&quot;&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;struct onbShaderOutput \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 outColor; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 outTransparency; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float4 outSurfaceFinal; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;}; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/declaration&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;HLSL\&quot; lang_version=\&quot;11.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;declaration name=\&quot;onbShaderOutput\&quot;&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;struct onbShaderOutput \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 outColor; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 outTransparency; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float4 outSurfaceFinal; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;}; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/declaration&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;GLSL\&quot; lang_version=\&quot;3.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;declaration name=\&quot;onbShaderOutput\&quot;&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;struct onbShaderOutput \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 outColor; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 outTransparency; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec4 outSurfaceFinal; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;}; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/declaration&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;&lt;/fragment&gt; \r\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (fragmentName != fragmentMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a221c1b902178b12d827dcae51fdca4c8">addShadeFragmentFromBuffer</a>(fragmentBody, <span class="keyword">false</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Combiner fragment. Takes in the computed diffuse and specular results</span></div>
<div class="line">    <span class="comment">// and combines them with the other shader parameters to produce the final</span></div>
<div class="line">    <span class="comment">// color, transparency and surface (color with alpha) values. The ambientIn</span></div>
<div class="line">    <span class="comment">// parameter is populated by Maya with level of global ambient light based</span></div>
<div class="line">    <span class="comment">// on ambient lights in the scene.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    fragmentName = <span class="stringliteral">&quot;onbCombiner&quot;</span>;</div>
<div class="line">    fragmentBody =</div>
<div class="line">        <span class="stringliteral">&quot;&lt;fragment uiName=\&quot;onbCombiner\&quot; name=\&quot;onbCombiner\&quot; type=\&quot;plumbing\&quot; class=\&quot;ShadeFragment\&quot; version=\&quot;1.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;description&gt;&lt;![CDATA[Combines ambient, diffuse, specular components additively]]&gt;&lt;/description&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;diffuseIrradIn\&quot; flags=\&quot;constantParam\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;specularIrradIn\&quot; flags=\&quot;constantParam\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;color\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;transparency\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;ambientColor\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;ambientIn\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;incandescence\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;diffuseIrradIn\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;specularIrradIn\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;color\&quot; value=\&quot;0.5,0.5,0.5\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;transparency\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;ambientColor\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;ambientIn\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;incandescence\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;struct name=\&quot;onbCombiner\&quot; struct_name=\&quot;onbShaderOutput\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;Cg\&quot; lang_version=\&quot;2.1\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbCombiner\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;onbShaderOutput onbCombiner( \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 diffuseIrradIn, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 specularIrradIn, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 color, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 transparency, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 ambientColor, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 ambientIn, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 incandescence) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   onbShaderOutput result; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor = (ambientColor+ambientIn)*color; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor += diffuseIrradIn*color; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 opacity = saturate(1.0f - transparency);  \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor *= opacity; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor += specularIrradIn; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor += incandescence; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outTransparency = transparency; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   const float3 intenseVec = float3(1.0f / 3.0f, 1.0f / 3.0f, 1.0f / 3.0f);  \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outSurfaceFinal = float4(result.outColor, dot(opacity, intenseVec));  \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return result; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;HLSL\&quot; lang_version=\&quot;11.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbCombiner\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;onbShaderOutput onbCombiner( \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 diffuseIrradIn, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 specularIrradIn, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 color, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 transparency, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 ambientColor, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 ambientIn, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 incandescence) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   onbShaderOutput result; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor = (ambientColor+ambientIn)*color; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor += diffuseIrradIn*color; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   float3 opacity = saturate(1.0f - transparency);  \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor *= opacity; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor += specularIrradIn; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor += incandescence; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outTransparency = transparency; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   const float3 intenseVec = float3(1.0f / 3.0f, 1.0f / 3.0f, 1.0f / 3.0f);  \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outSurfaceFinal = float4(result.outColor, dot(opacity, intenseVec));  \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return result; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;implementation render=\&quot;OGSRenderer\&quot; language=\&quot;GLSL\&quot; lang_version=\&quot;3.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;function_name val=\&quot;onbCombiner\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;source&gt;&lt;![CDATA[ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;onbShaderOutput onbCombiner( \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 diffuseIrradIn, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 specularIrradIn, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 color, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 transparency, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 ambientColor, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 ambientIn, \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 incandescence) \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;{ \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   onbShaderOutput result; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor = (ambientColor+ambientIn)*color; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor += diffuseIrradIn*color; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   vec3 opacity = saturate(1.0f - transparency);  \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor *= opacity; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor += specularIrradIn; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outColor += incandescence; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outTransparency = transparency; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   const vec3 intenseVec = vec3(0.3333, 0.3333, 0.3333);  \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   result.outSurfaceFinal = vec4(result.outColor, dot(opacity, intenseVec));  \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   return result; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;} \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       ]]&gt;&lt;/source&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/implementation&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;&lt;/fragment&gt; \r\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (fragmentName != fragmentMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a221c1b902178b12d827dcae51fdca4c8">addShadeFragmentFromBuffer</a>(fragmentBody, <span class="keyword">false</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Full, final graph made up of previously registered fragments. A picture</span></div>
<div class="line">    <span class="comment">// which flows from top to bottom.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">//      onbFloat3PassThrough(Nw)--------------------\</span></div>
<div class="line"><span class="comment">    //            |                                     |</span></div>
<div class="line">    <span class="comment">//            |  nbFloat3PassThrough(Vw)---------\  |</span></div>
<div class="line">    <span class="comment">//            |   |                              |  |</span></div>
<div class="line">    <span class="comment">//            |   |    nbFloat3PassThrough(Lw)   |  |</span></div>
<div class="line">    <span class="comment">//            |   |     |       |                |  |</span></div>
<div class="line">    <span class="comment">//            |   |     |       |                |  |</span></div>
<div class="line">    <span class="comment">//            onbShaderGeom     \-------------\  |  |</span></div>
<div class="line">    <span class="comment">//                |    |                      |  |  |</span></div>
<div class="line">    <span class="comment">//                |    \-------------------\  |  |  |</span></div>
<div class="line">    <span class="comment">//                |                        |  |  |  |</span></div>
<div class="line">    <span class="comment">//                |                        |  |  |  |</span></div>
<div class="line">    <span class="comment">//          onbSpecular                    onbDiffuse</span></div>
<div class="line">    <span class="comment">//                     \                  /</span></div>
<div class="line">    <span class="comment">//                      \                /</span></div>
<div class="line">    <span class="comment">//                       onb16LightAccum</span></div>
<div class="line">    <span class="comment">//                              |</span></div>
<div class="line">    <span class="comment">//                         onbCombiner</span></div>
<div class="line">    <span class="comment">//                              |</span></div>
<div class="line">    <span class="comment">//                        onbShaderOutput</span></div>
<div class="line">    <span class="comment">//                              |</span></div>
<div class="line">    <span class="comment">//                        &lt;FINAL RESULT&gt;</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Maya&#39;s shader translation system will take this graph and connect light</span></div>
<div class="line">    <span class="comment">// information where appropriate, allowing this to be inserted in the body</span></div>
<div class="line">    <span class="comment">// of the light loop.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// From Maya&#39;s point of view, this graph is fully representative of the</span></div>
<div class="line">    <span class="comment">// associated shading node in the DG. All inputs and outputs on this graph</span></div>
<div class="line">    <span class="comment">// are matched to inputs and outputs on the DG node. Connections to other</span></div>
<div class="line">    <span class="comment">// nodes (input or output) will be mirrored by connections to other</span></div>
<div class="line">    <span class="comment">// fragments using the matching parameters.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// The parameters Lw and HLw are automatically hooked up to the appropriate</span></div>
<div class="line">    <span class="comment">// light fragments by Maya. Nw and Vw are varying parameters that are</span></div>
<div class="line">    <span class="comment">// automatically generated by the vertex shader.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    fragmentName = sFinalFragmentGraphName;</div>
<div class="line">    fragmentBody =</div>
<div class="line">        <span class="stringliteral">&quot;&lt;fragment_graph name=\&quot;onbShaderSurface\&quot; ref=\&quot;onbShaderSurface\&quot; class=\&quot;FragmentGraph\&quot; version=\&quot;1.0\&quot;&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;fragments&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;fragment_ref name=\&quot;nwPassThrough\&quot; ref=\&quot;onbFloat3PassThrough\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;fragment_ref name=\&quot;vwPassThrough\&quot; ref=\&quot;onbFloat3PassThrough\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;fragment_ref name=\&quot;lwPassThrough\&quot; ref=\&quot;onbFloat3PassThrough\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;fragment_ref name=\&quot;onbShaderGeom\&quot; ref=\&quot;onbShaderGeom\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;fragment_ref name=\&quot;onbDiffuse\&quot; ref=\&quot;onbDiffuse\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;fragment_ref name=\&quot;onbSpecular\&quot; ref=\&quot;onbSpecular\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;fragment_ref name=\&quot;onb16LightAccum\&quot; ref=\&quot;onb16LightAccum\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;fragment_ref name=\&quot;onbCombiner\&quot; ref=\&quot;onbCombiner\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;fragment_ref name=\&quot;onbShaderOutput\&quot; ref=\&quot;onbShaderOutput\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/fragments&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;connections&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;connect from=\&quot;nwPassThrough.output\&quot; to=\&quot;onbDiffuse.Nw\&quot; name=\&quot;Nw\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;connect from=\&quot;vwPassThrough.output\&quot; to=\&quot;onbDiffuse.Vw\&quot; name=\&quot;Vw\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;connect from=\&quot;lwPassThrough.output\&quot; to=\&quot;onbDiffuse.Lw\&quot; name=\&quot;Lw\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;connect from=\&quot;nwPassThrough.output\&quot; to=\&quot;onbShaderGeom.Nw\&quot; name=\&quot;Nw\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;connect from=\&quot;vwPassThrough.output\&quot; to=\&quot;onbShaderGeom.Vw\&quot; name=\&quot;Vw\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;connect from=\&quot;lwPassThrough.output\&quot; to=\&quot;onbShaderGeom.Lw\&quot; name=\&quot;Lw\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;connect from=\&quot;onbShaderGeom.onbShaderGeom\&quot; to=\&quot;onbDiffuse.shaderGeomInput\&quot; name=\&quot;shaderGeomInput\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;connect from=\&quot;onbShaderGeom.onbShaderGeom\&quot; to=\&quot;onbSpecular.shaderGeomInput\&quot; name=\&quot;shaderGeomInput\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;connect from=\&quot;onbDiffuse.onbDiffuse\&quot; to=\&quot;onb16LightAccum.scaledDiffuse\&quot; name=\&quot;scaledDiffuse\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;connect from=\&quot;onbSpecular.onbSpecular\&quot; to=\&quot;onb16LightAccum.scaledSpecular\&quot; name=\&quot;scaledSpecular\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;connect from=\&quot;onb16LightAccum.scaledDiffuse\&quot; to=\&quot;onbCombiner.diffuseIrradIn\&quot; name=\&quot;diffuseIrradIn\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;connect from=\&quot;onb16LightAccum.scaledSpecular\&quot; to=\&quot;onbCombiner.specularIrradIn\&quot; name=\&quot;specularIrradIn\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;connect from=\&quot;onbCombiner.onbCombiner\&quot; to=\&quot;onbShaderOutput.onbShaderOutput\&quot; name=\&quot;onbShaderOutput\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/connections&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;Nw\&quot; ref=\&quot;nwPassThrough.input\&quot; semantic=\&quot;Nw\&quot; flags=\&quot;varyingInputParam\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;Vw\&quot; ref=\&quot;vwPassThrough.input\&quot; semantic=\&quot;Vw\&quot; flags=\&quot;varyingInputParam\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;Lw\&quot; ref=\&quot;lwPassThrough.input\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;HLw\&quot; ref=\&quot;onbShaderGeom.HLw\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;diffuseI\&quot; ref=\&quot;onbDiffuse.diffuseI\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float name=\&quot;roughness\&quot; ref=\&quot;onbDiffuse.roughness\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;specularI\&quot; ref=\&quot;onbSpecular.specularI\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;specularColor\&quot; ref=\&quot;onbSpecular.specularColor\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float name=\&quot;eccentricity\&quot; ref=\&quot;onbSpecular.eccentricity\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float name=\&quot;specularRollOff\&quot; ref=\&quot;onbSpecular.specularRollOff\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;string name=\&quot;selector\&quot; ref=\&quot;onb16LightAccum.selector\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;color\&quot; ref=\&quot;onbCombiner.color\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;transparency\&quot; ref=\&quot;onbCombiner.transparency\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;ambientColor\&quot; ref=\&quot;onbCombiner.ambientColor\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;ambientIn\&quot; ref=\&quot;onbCombiner.ambientIn\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;incandescence\&quot; ref=\&quot;onbCombiner.incandescence\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/properties&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;Lw\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;HLw\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;diffuseI\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float name=\&quot;roughness\&quot; value=\&quot;0.3\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;specularI\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;specularColor\&quot; value=\&quot;1.0,1.0,1.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float name=\&quot;eccentricity\&quot; value=\&quot;0.1\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float name=\&quot;specularRollOff\&quot; value=\&quot;0.7\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;string name=\&quot;selector\&quot; value=\&quot;mayaLightSelector16\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;color\&quot; value=\&quot;0.5,0.5,0.5\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;transparency\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;ambientColor\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;ambientIn\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;float3 name=\&quot;incandescence\&quot; value=\&quot;0.0,0.0,0.0\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/values&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       &lt;struct name=\&quot;onbShaderOutput\&quot; ref=\&quot;onbShaderOutput.onbShaderOutput\&quot; /&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;   &lt;/outputs&gt; \r\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;&lt;/fragment_graph&gt; \r\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (fragmentName != fragmentMgr-&gt;<a name="a9"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a2264caab6f1d9736fe2e7ccc195e8340">addFragmentGraphFromBuffer</a>(fragmentBody)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> onbShaderOverride::deregisterFragments()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Get fragment manager for deregistration</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html">MHWRender::MFragmentManager</a>* fragmentMgr =</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>()</div>
<div class="line">            ? <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>()-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a0f42783e8eee6f472d6bbb2acb6b2f2d">getFragmentManager</a>()</div>
<div class="line">            : NULL;</div>
<div class="line">    <span class="comment">// No fragment manager, fail</span></div>
<div class="line">    <span class="keywordflow">if</span> (!fragmentMgr) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Remove fragments from library on plugin unload</span></div>
<div class="line">    <span class="keywordflow">if</span> (!fragmentMgr-&gt;<a name="a10"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a0986b6896f4fad94fc61ff750583187f">removeFragment</a>(<span class="stringliteral">&quot;onbFloat3PassThrough&quot;</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line">    <span class="keywordflow">if</span> (!fragmentMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a0986b6896f4fad94fc61ff750583187f">removeFragment</a>(<span class="stringliteral">&quot;onbShaderGeom&quot;</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line">    <span class="keywordflow">if</span> (!fragmentMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a0986b6896f4fad94fc61ff750583187f">removeFragment</a>(<span class="stringliteral">&quot;onbDiffuse&quot;</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line">    <span class="keywordflow">if</span> (!fragmentMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a0986b6896f4fad94fc61ff750583187f">removeFragment</a>(<span class="stringliteral">&quot;onbSpecular&quot;</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line">    <span class="keywordflow">if</span> (!fragmentMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a0986b6896f4fad94fc61ff750583187f">removeFragment</a>(<span class="stringliteral">&quot;onb16LightAccum&quot;</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line">    <span class="keywordflow">if</span> (!fragmentMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a0986b6896f4fad94fc61ff750583187f">removeFragment</a>(<span class="stringliteral">&quot;onbShaderOutput&quot;</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line">    <span class="keywordflow">if</span> (!fragmentMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a0986b6896f4fad94fc61ff750583187f">removeFragment</a>(<span class="stringliteral">&quot;onbCombiner&quot;</span>)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line">    <span class="keywordflow">if</span> (!fragmentMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_fragment_manager.html#a0986b6896f4fad94fc61ff750583187f">removeFragment</a>(sFinalFragmentGraphName)) <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->

      <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
   </div></body>
</html>
