<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
      <title>C++ API Reference: cgFx/cgfxShaderCmd.cpp</title>
      
	  
      
      
      
      
      
      
      
    

</head>
   <body height="100%"><div class="body_content" id="body-content"><link rel="stylesheet" type="text/css" href="cpp_ref/navtree.css"><link rel="stylesheet" type="text/css" href="cpp_ref/doxygen.css"><link rel="stylesheet" type="text/css" href="cpp_ref/tabs.css"><link rel="stylesheet" type="text/css" href="style/adsk.cpm.css"><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('cg_fx_2cgfx_shader_cmd_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
      <div>
         <div class="head">
            <h1>C++ API Reference: cgFx/cgfxShaderCmd.cpp</h1>
         </div>

<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->

  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="#!/url=./cpp_ref/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="#!/url=./cpp_ref/pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="#!/url=./cpp_ref/modules.html"><span>Modules</span></a></li>
      <li><a href="#!/url=./cpp_ref/namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="#!/url=./cpp_ref/annotated.html"><span>Classes</span></a></li>
      <li><a href="#!/url=./cpp_ref/examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="cpp_ref/search/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="cpp_ref/search/close.png" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>

<div id="doc-content">
<!-- window showing the filter options -->


<!-- iframe showing the search results (closed by default) -->


<div class="header">
  <div class="headertitle">
<div class="title">cgFx/cgfxShaderCmd.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Copyright (C) 2002-2004 NVIDIA </span></div>
<div class="line"><span class="comment">// </span></div>
<div class="line"><span class="comment">// File: cgfxShaderCmd.cpp</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// MEL Command: cgfxShader</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Author: Jim Atkinson</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Changes:</span></div>
<div class="line"><span class="comment">//  10/2003  Kurt Harriman - www.octopusgraphics.com +1-415-893-1023</span></div>
<div class="line"><span class="comment">//           - Multiple UV sets; user-specified texcoord assignment;</span></div>
<div class="line"><span class="comment">//             error handling.</span></div>
<div class="line"><span class="comment">//           - &quot;-pp/pluginPath&quot; flag of cgfxShader command returns the</span></div>
<div class="line"><span class="comment">//             full path of the &quot;cgfxShader&quot; subdirectory beneath the</span></div>
<div class="line"><span class="comment">//             directory from which the plug-in binary was loaded.</span></div>
<div class="line"><span class="comment">//           - &quot;-mtc/maxTexCoords&quot; flag of cgfxShader command returns an</span></div>
<div class="line"><span class="comment">//             upper bound on the number of texcoord inputs per vertex</span></div>
<div class="line"><span class="comment">//             (GL_MAX_TEXTURE_UNITS) that can be passed from Maya thru</span></div>
<div class="line"><span class="comment">//             OpenGL to vertex shaders on the current workstation.</span></div>
<div class="line"><span class="comment">//           - &quot;-tcs/texCoordSource&quot; flag of cgfxShader command returns</span></div>
<div class="line"><span class="comment">//             cgfxShader node&#39;s &quot;tcs/texCoordSource&quot; attribute value.  </span></div>
<div class="line"><span class="comment">//           - &quot;-euv/emptyUV&quot; and &quot;-eus/emptyUVShapes&quot; flags added as</span></div>
<div class="line"><span class="comment">//             part of a temporary workaround for a bug discovered in</span></div>
<div class="line"><span class="comment">//             Maya 5.0.  May be removed after Maya is fixed, so don&#39;t</span></div>
<div class="line"><span class="comment">//             rely on them in user code.  </span></div>
<div class="line"><span class="comment">//  12/2003  Kurt Harriman - www.octopusgraphics.com +1-415-893-1023</span></div>
<div class="line"><span class="comment">//           - To load or reload an effect, use the cgfxShader command</span></div>
<div class="line"><span class="comment">//             &quot;-fx/fxFile &lt;filename&gt;&quot; flag.  Setting the cgfxShader</span></div>
<div class="line"><span class="comment">//             node&#39;s &quot;s/shader&quot; attribute no longer loads the effect.</span></div>
<div class="line"><span class="comment">//           - Shader parameter descriptions can be queried via the</span></div>
<div class="line"><span class="comment">//             &quot;-des/description&quot; flag of cgfxShader command, together</span></div>
<div class="line"><span class="comment">//             with &quot;-lp/listParameters&quot; or &quot;-p/parameter &lt;name&gt;&quot;</span></div>
<div class="line"><span class="comment">//           - &quot;-ci/caseInsensitive&quot; option for &quot;-p/parameter &lt;name&gt;&quot;</span></div>
<div class="line"><span class="comment">//           - The techniques defined by the current effect can be</span></div>
<div class="line"><span class="comment">//             queried via the &quot;-lt/listTechniques&quot; flag.</span></div>
<div class="line"><span class="comment">//           - To choose a technique, set the &quot;t/technique&quot;</span></div>
<div class="line"><span class="comment">//             attribute of the cgfxShader node.  The effect is not </span></div>
<div class="line"><span class="comment">//             reloaded.  There is no longer a message box requiring</span></div>
<div class="line"><span class="comment">//             the user to choose a technique when loading an effect.</span></div>
<div class="line"><span class="comment">//           - Fixed some undo/redo bugs that caused crashes and</span></div>
<div class="line"><span class="comment">//             incorrect rendering.  Fixed some memory leaks.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 2015 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk</span></div>
<div class="line"><span class="comment">// license agreement provided at the time of installation or download,</span></div>
<div class="line"><span class="comment">// or which otherwise accompanies this software in either electronic</span></div>
<div class="line"><span class="comment">// or hard copy form.</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"><span class="preprocessor">#include &quot;cgfxShaderCommon.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;cgfxShaderCmd.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;cgfxShaderNode.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;cgfxProfile.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;cgfxFindImage.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MArgDatabase.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MCommandResult.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDagPath.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFeedbackLine.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnDagNode.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGlobal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/M3dView.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// These options are global to the plug-in and don&#39;t require a</span></div>
<div class="line"><span class="comment">// node to be selected or specified...</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kMaxTexCoordsFlag           &quot;-mtc&quot;</span></div>
<div class="line"><span class="preprocessor">#define kMaxTexCoordsFlagLong       &quot;-maxTexCoords&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kPluginPathFlag             &quot;-pp&quot;</span></div>
<div class="line"><span class="preprocessor">#define kPluginPathFlagLong         &quot;-pluginPath&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// These options pertain to the specified or selected cgfxShader node...</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kFxFlag                     &quot;-fx&quot;</span></div>
<div class="line"><span class="preprocessor">#define kFxFlagLong                 &quot;-fxFile&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kFxPathFlag                 &quot;-fxp&quot;</span></div>
<div class="line"><span class="preprocessor">#define kFxPathFlagLong             &quot;-fxPath&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kFxTechniqueFlag            &quot;-t&quot;</span></div>
<div class="line"><span class="preprocessor">#define kFxTechniqueFlagLong        &quot;-technique&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kFxProfileFlag              &quot;-pr&quot;</span></div>
<div class="line"><span class="preprocessor">#define kFxProfileFlagLong          &quot;-profile&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kNameFlag                   &quot;-n&quot;</span></div>
<div class="line"><span class="preprocessor">#define kNameFlagLong               &quot;-name&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kListTechniquesFlag         &quot;-lt&quot;</span></div>
<div class="line"><span class="preprocessor">#define kListTechniquesFlagLong     &quot;-listTechniques&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kListProfilesFlag           &quot;-lpr&quot;</span></div>
<div class="line"><span class="preprocessor">#define kListProfilesFlagLong       &quot;-listProfiles&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kListParametersFlag         &quot;-lp&quot;</span></div>
<div class="line"><span class="preprocessor">#define kListParametersFlagLong     &quot;-listParameters&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kParameterFlag              &quot;-p&quot;</span></div>
<div class="line"><span class="preprocessor">#define kParameterFlagLong          &quot;-parameter&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kTexCoordSourceFlag         &quot;-tcs&quot;</span></div>
<div class="line"><span class="preprocessor">#define kTexCoordSourceFlagLong     &quot;-texCoordSource&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if MAYA_API_VERSION &gt;= 700</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #define kColorSourceFlag         &quot;-cs&quot;</span></div>
<div class="line"><span class="preprocessor">    #define kColorSourceFlagLong     &quot;-colorSource&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kEmptyUVFlag                &quot;-euv&quot;</span></div>
<div class="line"><span class="preprocessor">#define kEmptyUVFlagLong            &quot;-emptyUV&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kEmptyUVShapesFlag          &quot;-eus&quot;</span></div>
<div class="line"><span class="preprocessor">#define kEmptyUVShapesFlagLong      &quot;-emptyUVShapes&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Flags that modify the behavior of -lp ...</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kCaseInsensitiveFlag        &quot;-ci&quot;</span></div>
<div class="line"><span class="preprocessor">#define kCaseInsensitiveFlagLong    &quot;-caseInsensitive&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Flags that modify the behavior of -lp and -p ...</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define kDescriptionFlag            &quot;-des&quot;</span></div>
<div class="line"><span class="preprocessor">#define kDescriptionFlagLong        &quot;-description&quot;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Static data members</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><a name="_a0"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> cgfxShaderCmd::sPluginPath;    <span class="comment">// directory path for scripts etc.</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a name="_a1"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a></div>
<div class="line">cgfxShaderCmd::doIt( <span class="keyword">const</span> <a name="_a2"></a><a class="code" href="#!/url=./cpp_ref/class_m_arg_list.html">MArgList</a>&amp; args )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> stat;</div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">        stat = doCmd( args );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( cgfxShaderCommon::InternalError* e )   </div>
<div class="line">    {</div>
<div class="line">        reportInternalError( __FILE__, (<span class="keywordtype">size_t</span>)e );</div>
<div class="line">        stat = MS::kFailure;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( ... )</div>
<div class="line">    {</div>
<div class="line">        reportInternalError( __FILE__, __LINE__ );</div>
<div class="line">        stat = MS::kFailure;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> stat;</div>
<div class="line">}                                      <span class="comment">// MStatus cgfxShaderCmd::doIt</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a></div>
<div class="line">cgfxShaderCmd::redoIt()</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#ifdef MAYA_PRINT_DEBUG_INFO</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> ss = <span class="stringliteral">&quot;  .. Redo &quot;</span>;</div>
<div class="line">    ss += fArgString;</div>
<div class="line">    ss += <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    ::OutputDebugString( ss.<a name="a3"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>() );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> stat;</div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Get the node object from the selection list.</span></div>
<div class="line">        <a name="_a4"></a><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> oNode;</div>
<div class="line">        stat = fNodeSelection.getDependNode( 0, oNode );</div>
<div class="line">        M_CHECK( stat );</div>
<div class="line"></div>
<div class="line">        <a name="_a5"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> fnNode( oNode, &amp;stat );</div>
<div class="line">        M_CHECK( stat &amp;&amp; fnNode.typeId() == cgfxShaderNode::sId );</div>
<div class="line"></div>
<div class="line">        cgfxShaderNode* pNode = (cgfxShaderNode*)fnNode.userNode();</div>
<div class="line">        M_CHECK( pNode );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Re-create or re-edit the node.</span></div>
<div class="line">        stat = redoCmd( oNode, fnNode, pNode );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( cgfxShaderCommon::InternalError* e )   </div>
<div class="line">    {</div>
<div class="line">        reportInternalError( __FILE__, (<span class="keywordtype">size_t</span>)e );</div>
<div class="line">        stat = MS::kFailure;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( ... )</div>
<div class="line">    {</div>
<div class="line">        reportInternalError( __FILE__, __LINE__ );</div>
<div class="line">        stat = MS::kFailure;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#ifdef MAYA_PRINT_DEBUG_INFO</span></div>
<div class="line">    ss = <span class="stringliteral">&quot;  .. redone\n&quot;</span>;</div>
<div class="line">    ::OutputDebugString( ss.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>() );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordflow">return</span> stat;</div>
<div class="line">}                                      <span class="comment">// MStatus cgfxShaderCmd::redoIt</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a></div>
<div class="line">cgfxShaderCmd::undoIt()</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#ifdef MAYA_PRINT_DEBUG_INFO</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> ss = <span class="stringliteral">&quot;  .. Undo &quot;</span>;</div>
<div class="line">    ss += fArgString;</div>
<div class="line">    ss += <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    ::OutputDebugString( ss.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>() );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> stat;</div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">        stat = undoCmd();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( cgfxShaderCommon::InternalError* e )   </div>
<div class="line">    {</div>
<div class="line">        reportInternalError( __FILE__, (<span class="keywordtype">size_t</span>)e );</div>
<div class="line">        stat = MS::kFailure;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( ... )</div>
<div class="line">    {</div>
<div class="line">        reportInternalError( __FILE__, __LINE__ );</div>
<div class="line">        stat = MS::kFailure;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#ifdef MAYA_PRINT_DEBUG_INFO</span></div>
<div class="line">    ss = <span class="stringliteral">&quot;  .. undone\n&quot;</span>;</div>
<div class="line">    ::OutputDebugString( ss.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>() );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordflow">return</span> stat;</div>
<div class="line">}                                      <span class="comment">// MStatus cgfxShaderCmd::undoIt</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a></div>
<div class="line">cgfxShaderCmd::doCmd(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_arg_list.html">MArgList</a>&amp; args)</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      implements the MEL cgfxShader command.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Arguments:</span></div>
<div class="line"><span class="comment">//      -fx/fxFile  The CgFX file to load.</span></div>
<div class="line"><span class="comment">//      -e/edit     Edit an existing cgfxShader rather than creating</span></div>
<div class="line"><span class="comment">//                  a new one.</span></div>
<div class="line"><span class="comment">//      -q/query    Get specified info</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Return Value:</span></div>
<div class="line"><span class="comment">//      MS::kSuccess - command succeeded</span></div>
<div class="line"><span class="comment">//      MS::kFailure - command failed (returning this value will cause the </span></div>
<div class="line"><span class="comment">//                     MEL script that is being run to terminate unless the</span></div>
<div class="line"><span class="comment">//                     error is caught using a &quot;catch&quot; statement.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if defined(_WIN32) &amp;&amp; defined(CGFX_DEBUG_MEMORY)</span></div>
<div class="line">    <span class="comment">// Get the current state of the flag</span></div>
<div class="line">    <span class="comment">// and store it in a temporary variable</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> tmpFlag = -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (tmpFlag == -1)</div>
<div class="line">    {</div>
<div class="line">        tmpFlag = _CrtSetDbgFlag( _CRTDBG_REPORT_FLAG );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Turn On (OR) - call _CrtCheckMemory at every</span></div>
<div class="line">        <span class="comment">// allocation request</span></div>
<div class="line">        tmpFlag |= _CRTDBG_CHECK_ALWAYS_DF;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Turn on (OR) - check for memory leaks at end</span></div>
<div class="line">        <span class="comment">// of program.</span></div>
<div class="line">        tmpFlag |= _CRTDBG_LEAK_CHECK_DF;</div>
<div class="line"></div>
<div class="line">        _CrtSetDbgFlag( tmpFlag );</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* _WIN32 &amp;&amp; CGFX_DEBUG_MEMORY */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a>        status;</div>
<div class="line">    <a name="_a6"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html">MSelectionList</a> selList;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>        oNode;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>        sResult;</div>
<div class="line">    <a name="_a7"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>   saResult;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>        sFeedback;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>        sTemp;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>        sWho = <span class="stringliteral">&quot;cgfxShader : &quot;</span>;</div>
<div class="line"></div>
<div class="line">    status = parseArgs(args, selList);</div>
<div class="line">    <span class="keywordflow">if</span> (!status)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// -pp / -pluginPath </span></div>
<div class="line">    <span class="comment">//     Returns the directory path where this plug-in&#39;s auxiliary</span></div>
<div class="line">    <span class="comment">//     files, such as MEL scripts, are expected to be found.</span></div>
<div class="line">    <span class="comment">//     The path name is in Maya format (&#39;/&#39; delimited) with no</span></div>
<div class="line">    <span class="comment">//     trailing slash.  Result type is string.  (Query only)</span></div>
<div class="line">    <span class="keywordflow">if</span> ( fPluginPath )</div>
<div class="line">    {</div>
<div class="line">        setResult( sPluginPath );</div>
<div class="line">        <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// -lp / -listProfiles</span></div>
<div class="line">    <span class="comment">//  </span></div>
<div class="line">    <span class="comment">//     Return the names of the profiles supported on the current</span></div>
<div class="line">    <span class="comment">//     platform.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">//     Each item in the result array has the form</span></div>
<div class="line">    <span class="comment">//         &quot;VertexProfileName&lt;,GeometryProfileName,FragmentProfileName&quot;</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">//     Result type is string[].  (Query only; set internally)</span></div>
<div class="line">    <span class="keywordflow">if</span> ( fListProfiles )</div>
<div class="line">    {</div>
<div class="line">        setResult( cgfxProfile::getProfileList() );</div>
<div class="line">        <span class="keywordflow">return</span> status;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// -mtc / -maxTexCoords</span></div>
<div class="line">    <span class="comment">//     Returns the maximum number of texcoord inputs that can be</span></div>
<div class="line">    <span class="comment">//     passed to vertex shaders under the currently installed</span></div>
<div class="line">    <span class="comment">//     OpenGL implementation.  Returns 0 if the information is</span></div>
<div class="line">    <span class="comment">//     not available.  Result type is integer.  (Query only)</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Don&#39;t use GL_MAX_TEXTURE_UNITS as this does not provide a proper</span></div>
<div class="line">    <span class="comment">// count when the # of image or texcoord inputs differs</span></div>
<div class="line">    <span class="comment">// from the conventional (older) notion of texture unit. </span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Instead take the minimum of GL_MAX_TEXTURE_COORDS_ARB and</span></div>
<div class="line">    <span class="comment">// GL_MAX_TEXUTRE_IMAGE_UNITS_ARB according to the </span></div>
<div class="line">    <span class="comment">// ARB_FRAGMENT_PROGRAM specification.</span></div>
<div class="line">    <span class="keywordflow">if</span> ( fMaxTexCoords )    </div>
<div class="line">    {</div>
<div class="line">        GLint     mtc = 0;</div>
<div class="line">        <a name="_a8"></a><a class="code" href="#!/url=./cpp_ref/class_m3d_view.html">M3dView</a> vw = <a name="a9"></a><a class="code" href="#!/url=./cpp_ref/class_m3d_view.html#a3cda809eff914b04ff47de958c365f09">M3dView::active3dView</a>( &amp;status );</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Deprecated Methods : vw.beginGL(), vw.endGL()</span></div>
<div class="line">        _OPENMAYA_DEPRECATION_PUSH_AND_DISABLE_WARNING</div>
<div class="line">        <span class="keywordflow">if</span> ( status &amp;&amp; vw.<a name="a10"></a><a class="code" href="#!/url=./cpp_ref/class_m3d_view.html#a0e318e5634c7aaf31c4eb7232d2013d4">beginGL</a>() )</div>
<div class="line">        {</div>
<div class="line">            glGetIntegerv( GL_MAX_TEXTURE_COORDS_ARB, &amp;mtc );</div>
<div class="line">            GLint mic = 0;</div>
<div class="line">            glGetIntegerv( GL_MAX_TEXTURE_IMAGE_UNITS_ARB, &amp;mic );</div>
<div class="line">            <span class="keywordflow">if</span> (mic &lt; mtc)</div>
<div class="line">                mtc = mic;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ( mtc &lt; 1 )</div>
<div class="line">                mtc = 1;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( mtc &gt; CGFXSHADERNODE_GL_TEXTURE_MAX )</div>
<div class="line">                mtc = CGFXSHADERNODE_GL_TEXTURE_MAX;</div>
<div class="line">            </div>
<div class="line">            </div>
<div class="line">            vw.<a name="a11"></a><a class="code" href="#!/url=./cpp_ref/class_m3d_view.html#ab810c5a46d728df70ff5f44b604559f4">endGL</a>();</div>
<div class="line">        }</div>
<div class="line">        _OPENMAYA_POP_WARNING</div>
<div class="line"></div>
<div class="line">        setResult( (<span class="keywordtype">int</span>)mtc );</div>
<div class="line">        <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If edit or query, find the specified cgfxShaderNode.</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> fnNode;</div>
<div class="line">    cgfxShaderNode*   pNode = NULL;</div>
<div class="line">    <span class="keywordflow">if</span> ( fIsEdit || fIsQuery )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// We are editing an existing node which must have been</span></div>
<div class="line">        <span class="comment">// provided in the args (or the current selection list).</span></div>
<div class="line">        <span class="comment">// Get the correct node name into fNodeName;</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span> (selList.<a name="a12"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html#a99dd6a54b909ede1d11702fe58977e2a">length</a>() != 1)</div>
<div class="line">        {</div>
<div class="line">            status = MS::kNotFound;</div>
<div class="line">            <span class="keywordflow">return</span> status;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Get the name of the node into fNodeName so that it can</span></div>
<div class="line">        <span class="comment">// be saved for undo/redo</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> tmpList;</div>
<div class="line">        selList.<a name="a13"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html#aaf17bbe390ab271a23cf4eca69e3f81e">getSelectionStrings</a>(tmpList);</div>
<div class="line">        fNodeName = tmpList[0];</div>
<div class="line">        <span class="keywordflow">if</span> ( fNodeName.length() ) </div>
<div class="line">        {</div>
<div class="line">            sWho += <span class="stringliteral">&quot; \&quot;&quot;</span>;</div>
<div class="line">            sWho += fNodeName;</div>
<div class="line">            sWho += <span class="stringliteral">&quot;\&quot;&quot;</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        status = selList.<a name="a14"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html#a72d8cd9c78fd234dcf68cd2fb70bc432">getDependNode</a>(0, oNode);</div>
<div class="line">        <span class="keywordflow">if</span> (!status)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> status;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        status = fnNode.<a name="a15"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>( oNode );</div>
<div class="line">        <span class="keywordflow">if</span> (!status)</div>
<div class="line">        {</div>
<div class="line">            sFeedback = sWho;</div>
<div class="line">            sFeedback += <span class="stringliteral">&quot; is not a cgfxShader node.&quot;</span>;</div>
<div class="line">            <a name="a16"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0">MGlobal::displayError</a>( sFeedback );</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span> status;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (fnNode.<a name="a17"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#a1d0bbd4d50dae591f8e003c0aedc8135">typeId</a>() != cgfxShaderNode::sId)</div>
<div class="line">        {</div>
<div class="line">            status = MS::kInvalidParameter;</div>
<div class="line">            sFeedback = sWho;</div>
<div class="line">            sFeedback += <span class="stringliteral">&quot; is not a cgfxShader node.&quot;</span>;</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0">MGlobal::displayError</a>( sFeedback );</div>
<div class="line">            <span class="keywordflow">return</span> status;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        pNode = (cgfxShaderNode*)fnNode.<a name="a18"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#a4f2c53c9d1dcf25a6462c70fb25aead1">userNode</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (!pNode)</div>
<div class="line">        {</div>
<div class="line">            status = MS::kInvalidParameter;</div>
<div class="line">            sFeedback = sWho;</div>
<div class="line">            sFeedback += <span class="stringliteral">&quot; is not cgfxShader node.&quot;</span>;</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0">MGlobal::displayError</a>( sFeedback );</div>
<div class="line">            <span class="keywordflow">return</span> status;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( fIsQuery ) {</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// -fx / -fxFile</span></div>
<div class="line">        <span class="comment">//     Returns the shader file name. </span></div>
<div class="line">        <span class="keywordflow">if</span> ( fFxFile )</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> path = pNode-&gt;shaderFxFile();</div>
<div class="line">            setResult( path );</div>
<div class="line">            <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// -fxp / -fxPath </span></div>
<div class="line">        <span class="comment">//     Returns the path of the fx file.  The path name is in Maya</span></div>
<div class="line">        <span class="comment">//     format (&#39;/&#39; delimited).  Result type is string.</span></div>
<div class="line">        <span class="comment">//     (Query only)</span></div>
<div class="line">        <span class="keywordflow">if</span> ( fFxPath )</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> path = cgfxFindFile(pNode-&gt;shaderFxFile());</div>
<div class="line">            setResult( path );</div>
<div class="line">            <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// -t / -technique</span></div>
<div class="line">        <span class="comment">//     Returns the currently active technique</span></div>
<div class="line">        <span class="keywordflow">if</span> ( fTechnique )</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> path = pNode-&gt;getTechnique();</div>
<div class="line">            setResult( path );</div>
<div class="line">            <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// -p / -profile</span></div>
<div class="line">        <span class="comment">//     Returns the current profile</span></div>
<div class="line">        <span class="keywordflow">if</span> ( fProfile )</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> path = pNode-&gt;getProfile();</div>
<div class="line">            setResult( path );</div>
<div class="line">            <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// -lt / -listTechniques</span></div>
<div class="line">        <span class="comment">//     Return the technique names defined by the current effect.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">//     Each item in the result array has the form</span></div>
<div class="line">        <span class="comment">//         &quot;techniqueName&lt;TAB&gt;numPasses&quot;</span></div>
<div class="line">        <span class="comment">//     where </span></div>
<div class="line">        <span class="comment">//         numPasses is the number of passes defined by the </span></div>
<div class="line">        <span class="comment">//             technique, or 0 if the technique is not valid.   </span></div>
<div class="line">        <span class="comment">//     (Future versions of the cgfxShader plug-in may append</span></div>
<div class="line">        <span class="comment">//      additional tab-separated fields.)</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">//     Result type is string[].  (Query only; set internally)</span></div>
<div class="line">        <span class="keywordflow">if</span> ( fListTechniques )</div>
<div class="line">        {</div>
<div class="line">            setResult( pNode-&gt;getTechniqueList() );</div>
<div class="line">            <span class="keywordflow">return</span> status;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// -lp / -listParameters</span></div>
<div class="line">        <span class="comment">//     Return the attribute names corresponding to the</span></div>
<div class="line">        <span class="comment">//     shader&#39;s tweakable uniform parameters.</span></div>
<div class="line">        <span class="comment">//     Result type is string[].  (Query only; set internally)</span></div>
<div class="line">        <span class="comment">// -des / -description</span></div>
<div class="line">        <span class="comment">//     If specified, each item in the result array has the form</span></div>
<div class="line">        <span class="comment">//          &quot;attrName&lt;TAB&gt;type&lt;TAB&gt;semantic&lt;TAB&gt;description&lt;TAB&gt;extraAttrSuffix&quot;</span></div>
<div class="line">        <span class="comment">//     (Future versions of the cgfxShader plug-in may provide</span></div>
<div class="line">        <span class="comment">//       additional tab-separated fields after the semantic.)</span></div>
<div class="line">        <span class="comment">//     A missing field is indicated by a single space (&quot; &quot;) </span></div>
<div class="line">        <span class="comment">//       so the string can be parsed more easily using the MEL</span></div>
<div class="line">        <span class="comment">//       &quot;tokenize&quot; function, which treats a group of consecutive</span></div>
<div class="line">        <span class="comment">//       delimiters the same as a single delimiter.</span></div>
<div class="line">        <span class="keywordflow">if</span> ( fListParameters )</div>
<div class="line">        {</div>
<div class="line">            cgfxRCPtr&lt;cgfxAttrDefList&gt; list = cgfxAttrDef::attrsFromNode( oNode );</div>
<div class="line">            <span class="keywordflow">for</span> ( cgfxAttrDefList::iterator it = list; it; ++it )</div>
<div class="line">            {</div>
<div class="line">                cgfxAttrDef* aDef = *it;</div>
<div class="line">                <span class="keywordflow">if</span> ( fDescription )</div>
<div class="line">                {</div>
<div class="line">                    sResult = aDef-&gt;fName.<a name="a19"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ? aDef-&gt;fName : <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">                    sResult += <span class="stringliteral">&quot;\t&quot;</span>;</div>
<div class="line">                    sTemp = aDef-&gt;typeName();</div>
<div class="line">                    sResult += sTemp.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ? sTemp : <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">                    sResult += <span class="stringliteral">&quot;\t&quot;</span>;               </div>
<div class="line">                    sResult += aDef-&gt;fSemantic.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ? aDef-&gt;fSemantic : <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">                    sResult += <span class="stringliteral">&quot;\t&quot;</span>;</div>
<div class="line">                    sResult += aDef-&gt;fDescription.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ? aDef-&gt;fDescription : <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">                    sResult += <span class="stringliteral">&quot;\t&quot;</span>;               </div>
<div class="line">                    <span class="keyword">const</span> <span class="keywordtype">char</span>* suffix = aDef-&gt;getExtraAttrSuffix();</div>
<div class="line">                    sResult += suffix ? suffix : <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                    sResult = aDef-&gt;fName;</div>
<div class="line">                saResult.<a name="a20"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>( sResult );</div>
<div class="line">            }</div>
<div class="line">            setResult( saResult );</div>
<div class="line">            <span class="keywordflow">return</span> status;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// -p  / -parameter &lt;name&gt;</span></div>
<div class="line">        <span class="comment">//     Return a string describing the data type and usage of </span></div>
<div class="line">        <span class="comment">//     the attribute whose name is specified.  </span></div>
<div class="line">        <span class="comment">//     Result type is string (with no -description flag), or</span></div>
<div class="line">        <span class="comment">//     string array (if you specify -description).  </span></div>
<div class="line">        <span class="comment">//     (Query only; set internally)</span></div>
<div class="line">        <span class="comment">// -ci / -caseInsensitive</span></div>
<div class="line">        <span class="comment">//     If specified, returns information for the first </span></div>
<div class="line">        <span class="comment">//     attribute that matches the specified name assuming</span></div>
<div class="line">        <span class="comment">//     no distinction between upper and lower case letters.</span></div>
<div class="line">        <span class="comment">// -des / -description</span></div>
<div class="line">        <span class="comment">//     If specified, the result is a string array containing:</span></div>
<div class="line">        <span class="comment">//          [0] = attribute name</span></div>
<div class="line">        <span class="comment">//          [1] = type</span></div>
<div class="line">        <span class="comment">//          [2] = semantic </span></div>
<div class="line">        <span class="comment">//          [3] = description from &quot;desc&quot; or &quot;uiname&quot; annotation</span></div>
<div class="line">        <span class="comment">//          [4] = extra attribute suffix for Vector4 (&quot;W&quot;) / Color4 (&quot;Alpha&quot;)</span></div>
<div class="line">        <span class="comment">//          (Future versions of the cgfxShader plug-in may provide</span></div>
<div class="line">        <span class="comment">//          additional tab-separated fields after the semantic.)</span></div>
<div class="line">        <span class="comment">//     If omitted, only the type is returned (a string).</span></div>
<div class="line">        <span class="keywordflow">if</span> ( fParameterName.length() &gt; 0 )</div>
<div class="line">        {</div>
<div class="line">            cgfxRCPtr&lt;cgfxAttrDefList&gt; list = cgfxAttrDef::attrsFromNode( oNode );</div>
<div class="line">            cgfxAttrDefList::iterator it; </div>
<div class="line">            <span class="keywordflow">if</span> ( fCaseInsensitive )</div>
<div class="line">                it = list-&gt;findInsensitive( fParameterName );</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                it = list-&gt;find( fParameterName );</div>
<div class="line">            <span class="keywordflow">if</span> ( fDescription )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> ( it )</div>
<div class="line">                {</div>
<div class="line">                    cgfxAttrDef* aDef = *it;</div>
<div class="line">                    saResult.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>( aDef-&gt;fName );</div>
<div class="line">                    saResult.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>( aDef-&gt;typeName() );</div>
<div class="line">                    saResult.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>( aDef-&gt;fSemantic );</div>
<div class="line">                    saResult.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>( aDef-&gt;fDescription );</div>
<div class="line">                    <span class="keyword">const</span> <span class="keywordtype">char</span>* suffix = aDef-&gt;getExtraAttrSuffix();</div>
<div class="line">                    saResult.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>( suffix ? suffix : <span class="stringliteral">&quot;&quot;</span> );</div>
<div class="line">                }</div>
<div class="line">                setResult( saResult );</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> ( it )</div>
<div class="line">                    sResult = (*it)-&gt;typeName();</div>
<div class="line">                setResult( sResult );</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> status;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// -euv / -emptyUV</span></div>
<div class="line">        <span class="comment">//     Returns the names of UV sets on a blocked list.  These UV sets</span></div>
<div class="line">        <span class="comment">//     are disabled from being passed to the shader because there</span></div>
<div class="line">        <span class="comment">//     is at least one mesh where the UV set name is defined but </span></div>
<div class="line">        <span class="comment">//     has no faces mapped.  Due to a bug in Maya (in 5.0 and</span></div>
<div class="line">        <span class="comment">//     possibly some other releases), Maya crashes if an empty</span></div>
<div class="line">        <span class="comment">//     UV set is accessed by a hardware shader.  The blocked list is</span></div>
<div class="line">        <span class="comment">//     intended to protect the user against accidentally hitting</span></div>
<div class="line">        <span class="comment">//     the bug and crashing Maya.  After the Maya fix has been</span></div>
<div class="line">        <span class="comment">//     verified, this option can continue to be accepted for awhile</span></div>
<div class="line">        <span class="comment">//     for compatibility, returning an empty result array.</span></div>
<div class="line">        <span class="comment">//     Result type is string[].  (Query only; set internally)</span></div>
<div class="line">        <span class="keywordflow">if</span> ( fEmptyUV )</div>
<div class="line">        {</div>
<div class="line">            setResult( pNode-&gt;getEmptyUVSets() );</div>
<div class="line">            <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// -eus / -emptyUVShapes</span></div>
<div class="line">        <span class="comment">//     Returns the names of shape nodes that have empty UV sets </span></div>
<div class="line">        <span class="comment">//     which are causing the UV set names to be added to a blocked list.</span></div>
<div class="line">        <span class="comment">//     After the Maya bug fix has been verified, this option</span></div>
<div class="line">        <span class="comment">//     can remain for awhile for compatibility, returning an</span></div>
<div class="line">        <span class="comment">//     empty result array.</span></div>
<div class="line">        <span class="comment">//     Result type is string[].  (Query only; set internally)</span></div>
<div class="line">        <span class="keywordflow">if</span> ( fEmptyUVShapes )</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <a name="_a21"></a><a class="code" href="#!/url=./cpp_ref/class_m_object_array.html">MObjectArray</a>&amp; oaShapes = pNode-&gt;getEmptyUVSetShapes();</div>
<div class="line">            <a name="_a22"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dag_node.html">MFnDagNode</a>          fnDagNode;</div>
<div class="line">            <a name="_a23"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>            dpShape;</div>
<div class="line">            <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> iShape = 0; iShape &lt; oaShapes.<a name="a24"></a><a class="code" href="#!/url=./cpp_ref/class_m_object_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); ++iShape )</div>
<div class="line">            {</div>
<div class="line">                fnDagNode.<a name="a25"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dag_node.html#a6b2301b53683a8e8f56dd0b9cb088b0f">setObject</a>( oaShapes[ iShape ] );</div>
<div class="line">                fnDagNode.<a name="a26"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dag_node.html#adfb40b1f56af23ad94c4ca77c9a147b5">getPath</a>( dpShape );</div>
<div class="line">                saResult.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>( dpShape.<a name="a27"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a9aa2e126e83787f285f843fb528d82c6">partialPathName</a>() );</div>
<div class="line">            }</div>
<div class="line">            setResult( saResult );</div>
<div class="line">            <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// -tcs / -texCoordSource</span></div>
<div class="line">        <span class="comment">//     Returns the value of the texCoordSource attribute, because</span></div>
<div class="line">        <span class="comment">//     the MEL &quot;getAttr&quot; command doesn&#39;t work with string arrays.</span></div>
<div class="line">        <span class="comment">//     Result type is string[].  (Query only; set via &quot;setAttr&quot;)</span></div>
<div class="line">        <span class="keywordflow">if</span> ( fTexCoordSource )</div>
<div class="line">        {</div>
<div class="line">            setResult( pNode-&gt;getTexCoordSource() );</div>
<div class="line">            <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if MAYA_API_VERSION &gt;= 700</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// -cs / -colorSource</span></div>
<div class="line">        <span class="comment">//     Returns the value of the colorSource attribute, because</span></div>
<div class="line">        <span class="comment">//     the MEL &quot;getAttr&quot; command doesn&#39;t work with string arrays.</span></div>
<div class="line">        <span class="comment">//     Result type is string[].  (Query only; set via &quot;setAttr&quot;)</span></div>
<div class="line">        <span class="keywordflow">if</span> ( fColorSource )</div>
<div class="line">        {</div>
<div class="line">            setResult( pNode-&gt;getColorSource() );</div>
<div class="line">            <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Error if -q with no other query flags.</span></div>
<div class="line">        <span class="keywordflow">return</span> MS::kInvalidParameter;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If user didn&#39;t specify shader fx file, default to current</span></div>
<div class="line">    <span class="comment">// value of our cgfxShader node&#39;s &quot;shader&quot; attribute.</span></div>
<div class="line">    <span class="keywordflow">if</span> (!fFxFile &amp;&amp; pNode)</div>
<div class="line">        fNewFxFile = pNode-&gt;shaderFxFile();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If user didn&#39;t specify technique name, default to current</span></div>
<div class="line">    <span class="comment">// value of our cgfxShader node&#39;s &quot;technique&quot; attribute.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// If a new fx file has been specified without a technique, we</span></div>
<div class="line">    <span class="comment">// leave the technique name empty so that the first technique of</span></div>
<div class="line">    <span class="comment">// the effect will be selected.</span></div>
<div class="line">    <span class="keywordflow">if</span> (!fTechnique &amp;&amp; pNode)</div>
<div class="line">        fNewTechnique = pNode-&gt;getTechnique();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If user didn&#39;t specify profile name, default to current</span></div>
<div class="line">    <span class="comment">// value of our cgfxShader node&#39;s &quot;profile&quot; attribute.</span></div>
<div class="line">    <span class="keywordflow">if</span> (!fProfile &amp;&amp; pNode)</div>
<div class="line">        fNewProfile = pNode-&gt;getProfile();</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Load the effect from the .fx file.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">if</span> (fFxFile)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Attempt to read the new fEffect from the file</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> file = cgfxFindFile(fNewFxFile);</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> projectFile = cgfxFindFile(fNewFxFile, <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Compile and create the effect.</span></div>
<div class="line">        fNewEffect = cgfxEffect::loadEffect(file, cgfxProfile::getProfile(fNewProfile));</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (fNewEffect-&gt;isValid())</div>
<div class="line">        {           </div>
<div class="line">            <span class="comment">// There is no current view in batch mode, just return</span></div>
<div class="line">            <span class="comment">// success then</span></div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_global.html#afb0008b4212928b7913ba9cfc64fe88b">MGlobal::MMayaState</a> mayaState = <a name="a28"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#ac7296da94b1d0b659833fc653a6af10e">MGlobal::mayaState</a>(&amp;status);</div>
<div class="line">            <span class="keywordflow">if</span> ( !status ) <span class="keywordflow">return</span> status;</div>
<div class="line">            <span class="keywordflow">if</span> ( mayaState == <a name="a29"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#afb0008b4212928b7913ba9cfc64fe88ba347100316aff63bf166232d8145a44f6">MGlobal::kBatch</a> ) <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line"></div>
<div class="line">            fNewFxFile = projectFile;</div>
<div class="line"></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m3d_view.html">M3dView</a> view = <a class="code" href="#!/url=./cpp_ref/class_m3d_view.html#a3cda809eff914b04ff47de958c365f09">M3dView::active3dView</a>();</div>
<div class="line"></div>
<div class="line">            <span class="comment">// The M3dView class doesn&#39;t return the correct status if</span></div>
<div class="line">            <span class="comment">// there isn&#39;t an active 3D view, so we rely on the</span></div>
<div class="line">            <span class="comment">// success of beginGL() which will make the context</span></div>
<div class="line">            <span class="comment">// current.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            _OPENMAYA_DEPRECATION_PUSH_AND_DISABLE_WARNING</div>
<div class="line">            <span class="keywordflow">if</span> (!view.<a class="code" href="#!/url=./cpp_ref/class_m3d_view.html#a0e318e5634c7aaf31c4eb7232d2013d4">beginGL</a>()) </div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> es = <span class="stringliteral">&quot;There is no active view to bind &quot;</span> + sWho + <span class="stringliteral">&quot; to.&quot;</span>;</div>
<div class="line">                <a name="a30"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#acb043e7fc4eb7fc0f39833d31364b8a4">MGlobal::displayWarning</a>( es );</div>
<div class="line">                <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            view.<a class="code" href="#!/url=./cpp_ref/class_m3d_view.html#ab810c5a46d728df70ff5f44b604559f4">endGL</a>();</div>
<div class="line">            _OPENMAYA_POP_WARNING</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Tell user if successful.</span></div>
<div class="line">        <span class="keywordflow">if</span> (fNewEffect-&gt;isValid())</div>
<div class="line">        {</div>
<div class="line">            sFeedback = sWho;</div>
<div class="line">            sFeedback += <span class="stringliteral">&quot; loaded effect \&quot;&quot;</span>;</div>
<div class="line">            sFeedback += file;</div>
<div class="line">            sFeedback += <span class="stringliteral">&quot;\&quot;&quot;</span>;</div>
<div class="line">            <a name="a31"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a3d14e9f9ed022a80f664eac0136c2f7a">MGlobal::displayInfo</a>( sFeedback );</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            sFeedback = sWho;</div>
<div class="line">            sFeedback += <span class="stringliteral">&quot; unable to load effect \&quot;&quot;</span>;</div>
<div class="line">            sFeedback += file.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ? file : fNewFxFile;</div>
<div class="line">            sFeedback += <span class="stringliteral">&quot;\&quot;&quot;</span>;</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0">MGlobal::displayError</a>( sFeedback );</div>
<div class="line">            <span class="keywordflow">return</span> MS::kFailure;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create an MDGModifier to hold an agenda of operations to be</span></div>
<div class="line">    <span class="comment">//   performed to update the DG.  We build the agenda here;</span></div>
<div class="line">    <span class="comment">//   then invoke it to do/redo/undo the updates.</span></div>
<div class="line">    fDagMod = <span class="keyword">new</span> <a name="_a32"></a><a class="code" href="#!/url=./cpp_ref/class_m_d_g_modifier.html">MDGModifier</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create new cgfxShader node if requested.  </span></div>
<div class="line">    <span class="keywordflow">if</span> ( !fIsEdit )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Create node.</span></div>
<div class="line">        oNode = fDagMod-&gt;createNode(cgfxShaderNode::sId, &amp;status);</div>
<div class="line">        M_CHECK( status );</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ( fNodeName.length() &gt; 0 )</div>
<div class="line">        {</div>
<div class="line">            status = fDagMod-&gt;renameNode(oNode, fNodeName);</div>
<div class="line">            M_CHECK( status );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        status = fnNode.<a class="code" href="#!/url=./cpp_ref/class_m_fn_base.html#ad09f5acece0f9926b3e0e55cff78c3be">setObject</a>( oNode );</div>
<div class="line">        M_CHECK( status &amp;&amp; fnNode.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#a1d0bbd4d50dae591f8e003c0aedc8135">typeId</a>() == cgfxShaderNode::sId );</div>
<div class="line"></div>
<div class="line">        pNode = (cgfxShaderNode*)fnNode.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#a4f2c53c9d1dcf25a6462c70fb25aead1">userNode</a>();</div>
<div class="line">        M_CHECK( pNode );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// On successful completion, redoCmd() will select the new node.</span></div>
<div class="line">        <span class="comment">// Save old selection for undo.</span></div>
<div class="line">        status = <a name="a33"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a6d81d38246555884897fb153c93aaf42">MGlobal::getActiveSelectionList</a>( fOldSelection );</div>
<div class="line">        M_CHECK( status );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (fFxFile) {</div>
<div class="line">        <span class="comment">// Save the current state of the node for undo purposes</span></div>
<div class="line">        fOldFxFile    = pNode-&gt;shaderFxFile();</div>
<div class="line">        fOldEffect = pNode-&gt;effect();   <span class="comment">// save old CGeffect</span></div>
<div class="line"></div>
<div class="line">        cgfxShaderNode::NodeList nodes;</div>
<div class="line">        <span class="comment">// getNodesToUpdate will return the list of nodes that will need to be updated :</span></div>
<div class="line">        <span class="comment">// if the new fx file is the same as the old fx file, the action is considered a reload,</span></div>
<div class="line">        <span class="comment">//     we&#39;ll gather all the nodes that are using the old effect and reload them all.</span></div>
<div class="line">        <span class="comment">// else the effect file is different and only the current node will be updated.</span></div>
<div class="line">        getNodesToUpdate(fOldEffect, pNode, nodes);</div>
<div class="line"></div>
<div class="line">        cgfxShaderNode::NodeList::const_iterator it = nodes.begin();</div>
<div class="line">        cgfxShaderNode::NodeList::const_iterator itEnd = nodes.end();</div>
<div class="line">        <span class="keywordflow">for</span>(; it != itEnd; ++it)</div>
<div class="line">        {</div>
<div class="line">            cgfxShaderNode* node = *it;</div>
<div class="line"></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> &amp;oldAttributeList = fOldAttributeList[node];</div>
<div class="line">            cgfxRCPtr&lt;cgfxAttrDefList&gt; &amp;oldAttrDefList = fOldAttrDefList[node];</div>
<div class="line"></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> &amp;newAttributeList = fNewAttributeList[node];</div>
<div class="line">            cgfxRCPtr&lt;cgfxAttrDefList&gt; &amp;newAttrDefList = fNewAttrDefList[node];</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">            node-&gt;getAttributeList( oldAttributeList );</div>
<div class="line"></div>
<div class="line">            oldAttrDefList = node-&gt;attrDefList(); <span class="comment">// save old cgfxAttrDefList ptr</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">// Now figure out what to do with the node.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// updateNode does a fair amount of work.  First, it gets the</span></div>
<div class="line">            <span class="comment">// cgfxAttrDefList from the effect.  Then it gets the equivalent</span></div>
<div class="line">            <span class="comment">// list from the node itself.  It determines which attributes need</span></div>
<div class="line">            <span class="comment">// to be added and which need to be deleted and fills in all the</span></div>
<div class="line">            <span class="comment">// changes in the MDagModifier fDagMod.  Then it builds a new value</span></div>
<div class="line">            <span class="comment">// for the attributeList attribute.  Finally, it builds a new</span></div>
<div class="line">            <span class="comment">// value for the attrDefList internal value.  All these values are</span></div>
<div class="line">            <span class="comment">// returned here where we can set them into the node.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            cgfxAttrDef::updateNode( fNewEffect,             <span class="comment">// IN</span></div>
<div class="line">                                     node,                   <span class="comment">// IN</span></div>
<div class="line">                                     fDagMod,                <span class="comment">// UPD</span></div>
<div class="line">                                     newAttrDefList,         <span class="comment">// OUT</span></div>
<div class="line">                                     newAttributeList );     <span class="comment">// OUT</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Save a reference to the node in a selection list for undo/redo.</span></div>
<div class="line">    status = fNodeSelection.add( oNode );</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Save the current state of the node for undo purposes</span></div>
<div class="line">    fOldTechnique = pNode-&gt;getTechnique();</div>
<div class="line">    fOldProfile   = pNode-&gt;getProfile();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I think we have all the information to redoIt().</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Typically, the doIt() method only collects the infomation required</span></div>
<div class="line">    <span class="comment">// to do/undo the action and then stores it in class members.  The </span></div>
<div class="line">    <span class="comment">// redo method is then called to do the actuall work.  This prevents</span></div>
<div class="line">    <span class="comment">// code duplication.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">return</span> redoCmd( oNode, fnNode, pNode );</div>
<div class="line">}                                      <span class="comment">// cgfxShaderCmd::doCmd</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      implements redo for the MEL cgfxShader command. </span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//      This method is called when the user has undone a command of this type</span></div>
<div class="line"><span class="comment">//      and then redoes it.  No arguments are passed in as all of the necessary</span></div>
<div class="line"><span class="comment">//      information is cached by the doIt method.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Return Value:</span></div>
<div class="line"><span class="comment">//      MS::kSuccess - command succeeded</span></div>
<div class="line"><span class="comment">//      MS::kFailure - redoIt failed.  this is a serious problem that will</span></div>
<div class="line"><span class="comment">//                     likely cause the undo queue to be purged</span></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a></div>
<div class="line">cgfxShaderCmd::redoCmd( <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>&amp;           oNode,</div>
<div class="line">                        <a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a>&amp; fnNode,</div>
<div class="line">                        cgfxShaderNode*    pNode )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!fOldAttrDefList.empty()) {</div>
<div class="line">        <span class="comment">// Release the textures from the innactive attribute list to</span></div>
<div class="line">        <span class="comment">// save memory.</span></div>
<div class="line">        NodeAttrDefList::iterator it = fOldAttrDefList.begin();</div>
<div class="line">        NodeAttrDefList::iterator itEnd = fOldAttrDefList.end();</div>
<div class="line">        <span class="keywordflow">for</span>(; it != itEnd; ++it)</div>
<div class="line">        {</div>
<div class="line">            cgfxRCPtr&lt;cgfxAttrDefList&gt; &amp;attrDefList = it-&gt;second;</div>
<div class="line">            <span class="keywordflow">if</span>(!attrDefList.isNull())</div>
<div class="line">                attrDefList-&gt;releaseTextures();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (fFxFile) {</div>
<div class="line">        <span class="comment">// cgfxAttrDef list may contain MObject references to dynamic attrs</span></div>
<div class="line">        <span class="comment">//   that are about to disappear.  Clean up those references before </span></div>
<div class="line">        <span class="comment">//   they become invalid, so they don&#39;t cause an exception later.</span></div>
<div class="line">        pNode-&gt;setAttrDefList( cgfxRCPtr&lt;cgfxAttrDefList&gt;() );</div>
<div class="line">        cgfxRCPtr&lt;cgfxAttrDefList&gt; currNodeAttrDefList;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Actually update the node.</span></div>
<div class="line">        status = fDagMod-&gt;doIt();</div>
<div class="line">        M_CHECK( status );</div>
<div class="line"></div>
<div class="line">        cgfxShaderNode::NodeList nodes;</div>
<div class="line">        <span class="comment">// getNodesToUpdate will return the list of nodes that will need to be updated :</span></div>
<div class="line">        <span class="comment">// if the new fx file is the same as the old fx file, the action is considered a reload,</span></div>
<div class="line">        <span class="comment">//     we&#39;ll gather all the nodes that are using the old effect and reload them all.</span></div>
<div class="line">        <span class="comment">// else the effect file is different and only the current node will be updated.</span></div>
<div class="line">        getNodesToUpdate(fOldEffect, pNode, nodes);</div>
<div class="line"></div>
<div class="line">        cgfxShaderNode::NodeList::const_iterator it = nodes.begin();</div>
<div class="line">        cgfxShaderNode::NodeList::const_iterator itEnd = nodes.end();</div>
<div class="line">        <span class="keywordflow">for</span>(; it != itEnd; ++it)</div>
<div class="line">        {</div>
<div class="line">            cgfxShaderNode* node = *it;</div>
<div class="line"></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> &amp;attributeList = fNewAttributeList[node];</div>
<div class="line">            cgfxRCPtr&lt;cgfxAttrDefList&gt; &amp;attrDefList = fNewAttrDefList[node];</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>(node == pNode)</div>
<div class="line">                currNodeAttrDefList = attrDefList;</div>
<div class="line"></div>
<div class="line">            node-&gt;setAttributeList(attributeList);</div>
<div class="line">            node-&gt;setAttrDefList(attrDefList);</div>
<div class="line">            <span class="comment">// Notice: Must setShaderFxFileChanged before setEffect</span></div>
<div class="line">            node-&gt;setShaderFxFileChanged(<span class="keyword">true</span>);</div>
<div class="line">            node-&gt;setEffect(fNewEffect);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        cgfxAttrDef::initializeAttributes( oNode, currNodeAttrDefList, <span class="keyword">false</span>, fDagMod);</div>
<div class="line">        fnNode.<a name="a34"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>( cgfxShaderNode::sShader , <span class="keyword">true</span>).<a name="a35"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug.html#aec7c3792a53d27a61ece4f7b81cc123b">setValue</a>( fNewFxFile );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// Actually update the node.</span></div>
<div class="line">        status = fDagMod-&gt;doIt();</div>
<div class="line">        M_CHECK( status );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (fTechnique) {</div>
<div class="line">        fnNode.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>( cgfxShaderNode::sTechnique , <span class="keyword">true</span> ).<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#aec7c3792a53d27a61ece4f7b81cc123b">setValue</a>( fNewTechnique );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (fProfile) {</div>
<div class="line">        fnNode.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>( cgfxShaderNode::sProfile , <span class="keyword">true</span> ).<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#aec7c3792a53d27a61ece4f7b81cc123b">setValue</a>( fNewProfile );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( !fIsEdit ) </div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Save the actual node name (in case user did not specify a</span></div>
<div class="line">        <span class="comment">//   name, or in case Maya altered the name to make it unique.)</span></div>
<div class="line">        fNodeName = fnNode.<a name="a36"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#a049384adbea0396ea2f03d1ad4d69df1">name</a>();</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Finally, if we created a new node, select it.  I don&#39;t do</span></div>
<div class="line">        <span class="comment">// status checking here because I don&#39;t want the command to fail</span></div>
<div class="line">        <span class="comment">// merely because the selection might fail.  In other words, I&#39;m</span></div>
<div class="line">        <span class="comment">// not checking because I don&#39;t care.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html">MSelectionList</a> selList;</div>
<div class="line">        selList.<a name="a37"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html#a23929aeafb29672f2652128eac9c4dec">add</a>(oNode);</div>
<div class="line">        <a name="a38"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a33e6a7c8fa1c06fd64063bd08d4e4aef">MGlobal::setActiveSelectionList</a>(selList);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}                                      <span class="comment">// cgfxShaderCmd::redoCmd</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a></div>
<div class="line">cgfxShaderCmd::undoCmd()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      implements undo for the MEL cgfxShader command.  </span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//      This method is called to undo a previous command of this type.  The </span></div>
<div class="line"><span class="comment">//      system should be returned to the exact state that it was it previous </span></div>
<div class="line"><span class="comment">//      to this command being executed.  That includes the selection state.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Return Value:</span></div>
<div class="line"><span class="comment">//      MS::kSuccess - command succeeded</span></div>
<div class="line"><span class="comment">//      MS::kFailure - undo failed.  this is a serious problem that will</span></div>
<div class="line"><span class="comment">//                     likely cause the undo queue to be purged</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Find the node</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> oNode;</div>
<div class="line"></div>
<div class="line">    status = fNodeSelection.getDependNode(0, oNode);</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> fnNode( oNode, &amp;status );</div>
<div class="line">    M_CHECK( status &amp;&amp; fnNode.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#a1d0bbd4d50dae591f8e003c0aedc8135">typeId</a>() == cgfxShaderNode::sId );</div>
<div class="line"></div>
<div class="line">    cgfxShaderNode* pNode = (cgfxShaderNode*)fnNode.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#a4f2c53c9d1dcf25a6462c70fb25aead1">userNode</a>();</div>
<div class="line">    M_CHECK( pNode );</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!fNewAttrDefList.empty()) {</div>
<div class="line">        <span class="comment">// Release the textures from the innactive attribute list to</span></div>
<div class="line">        <span class="comment">// save memory.</span></div>
<div class="line">        NodeAttrDefList::iterator it = fNewAttrDefList.begin();</div>
<div class="line">        NodeAttrDefList::iterator itEnd = fNewAttrDefList.end();</div>
<div class="line">        <span class="keywordflow">for</span>(; it != itEnd; ++it)</div>
<div class="line">        {</div>
<div class="line">            cgfxRCPtr&lt;cgfxAttrDefList&gt; &amp;attrDefList = it-&gt;second;</div>
<div class="line">            <span class="keywordflow">if</span>(!attrDefList.isNull())</div>
<div class="line">                attrDefList-&gt;releaseTextures();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (fFxFile) {</div>
<div class="line">        <span class="comment">// cgfxAttrDef list may contain MObject references to dynamic attrs</span></div>
<div class="line">        <span class="comment">//   that are about to disappear.  Clean up those references before </span></div>
<div class="line">        <span class="comment">//   they become invalid, so they don&#39;t cause an exception later.</span></div>
<div class="line">        pNode-&gt;setAttrDefList( cgfxRCPtr&lt;cgfxAttrDefList&gt;() );</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Now put the node back the way it used to be.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    status = fDagMod-&gt;undoIt();</div>
<div class="line">    M_CHECK( status );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( fIsEdit )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (fFxFile) {</div>
<div class="line">            cgfxRCPtr&lt;cgfxAttrDefList&gt; currNodeAttrDefList;</div>
<div class="line"></div>
<div class="line">            cgfxShaderNode::NodeList nodes;</div>
<div class="line">            <span class="comment">// getNodesToUpdate will return the list of nodes that will need to be updated :</span></div>
<div class="line">            <span class="comment">// if the new fx file is the same as the old fx file, the action is considered a reload,</span></div>
<div class="line">            <span class="comment">//     we&#39;ll gather all the nodes that are using the nex effect (it&#39;s an undo) and reload them all.</span></div>
<div class="line">            <span class="comment">// else the effect file is different and only the current node will be updated.</span></div>
<div class="line">            getNodesToUpdate(fNewEffect, pNode, nodes);</div>
<div class="line"></div>
<div class="line">            cgfxShaderNode::NodeList::const_iterator it = nodes.begin();</div>
<div class="line">            cgfxShaderNode::NodeList::const_iterator itEnd = nodes.end();</div>
<div class="line">            <span class="keywordflow">for</span>(; it != itEnd; ++it)</div>
<div class="line">            {</div>
<div class="line">                cgfxShaderNode* node = *it;</div>
<div class="line"></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> &amp;attributeList = fOldAttributeList[node];</div>
<div class="line">                cgfxRCPtr&lt;cgfxAttrDefList&gt; &amp;attrDefList = fOldAttrDefList[node];</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(node == pNode)</div>
<div class="line">                    currNodeAttrDefList = attrDefList;</div>
<div class="line"></div>
<div class="line">                node-&gt;setAttributeList(attributeList);</div>
<div class="line">                node-&gt;setAttrDefList(attrDefList);</div>
<div class="line">                <span class="comment">// Notice: Must setShaderFxFileChanged before setEffect</span></div>
<div class="line">                node-&gt;setShaderFxFileChanged(<span class="keyword">true</span>);</div>
<div class="line">                node-&gt;setEffect(fOldEffect);</div>
<div class="line"></div>
<div class="line">            }</div>
<div class="line">            cgfxAttrDef::initializeAttributes( oNode, currNodeAttrDefList, <span class="keyword">true</span>, fDagMod);</div>
<div class="line">            fnNode.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>( cgfxShaderNode::sShader , <span class="keyword">true</span> ).<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#aec7c3792a53d27a61ece4f7b81cc123b">setValue</a>( fOldFxFile );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (fTechnique) {</div>
<div class="line">            fnNode.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>( cgfxShaderNode::sTechnique , <span class="keyword">true</span> ).<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#aec7c3792a53d27a61ece4f7b81cc123b">setValue</a>( fOldTechnique );</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (fProfile) {</div>
<div class="line">            fnNode.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#aac29b4a3b51c9d236175e955638f7153">findPlug</a>( cgfxShaderNode::sProfile , <span class="keyword">true</span> ).<a class="code" href="#!/url=./cpp_ref/class_m_plug.html#aec7c3792a53d27a61ece4f7b81cc123b">setValue</a>( fOldProfile );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> </div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a33e6a7c8fa1c06fd64063bd08d4e4aef">MGlobal::setActiveSelectionList</a>( fOldSelection );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> MS::kSuccess;</div>
<div class="line">}                                      <span class="comment">// cgfxShaderCmd::undoCmd</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">/* static */</span></div>
<div class="line"><a name="_a39"></a><a class="code" href="#!/url=./cpp_ref/class_m_syntax.html">MSyntax</a> cgfxShaderCmd::newSyntax()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_syntax.html">MSyntax</a> syntax;</div>
<div class="line"></div>
<div class="line">    syntax.<a name="a40"></a><a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#a2a329cd0b0d89bc1b9721c522d6d0006">enableEdit</a>();</div>
<div class="line">    syntax.<a name="a41"></a><a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#a414088ac458bc323845634fcf7663e69">enableQuery</a>();</div>
<div class="line">    syntax.<a name="a42"></a><a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>( kPluginPathFlag, kPluginPathFlagLong );</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>( kMaxTexCoordsFlag, kMaxTexCoordsFlagLong );</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>(kFxFlag, kFxFlagLong, <a name="a43"></a><a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#ae6f2057f0d0419845a48c1eb6813f2adafab53ea4a643325262b9c140af093279">MSyntax::kString</a>);</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>(kFxPathFlag, kFxPathFlagLong, <a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#ae6f2057f0d0419845a48c1eb6813f2adafab53ea4a643325262b9c140af093279">MSyntax::kString</a>);</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>(kFxTechniqueFlag, kFxTechniqueFlagLong, <a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#ae6f2057f0d0419845a48c1eb6813f2adafab53ea4a643325262b9c140af093279">MSyntax::kString</a>);</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>( kListTechniquesFlag, kListTechniquesFlagLong );</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>(kFxProfileFlag, kFxProfileFlagLong, <a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#ae6f2057f0d0419845a48c1eb6813f2adafab53ea4a643325262b9c140af093279">MSyntax::kString</a>);</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>( kListProfilesFlag, kListProfilesFlagLong );</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>(kNameFlag, kNameFlagLong, <a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#ae6f2057f0d0419845a48c1eb6813f2adafab53ea4a643325262b9c140af093279">MSyntax::kString</a>);</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>(kListParametersFlag, kListParametersFlagLong);</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>(kParameterFlag, kParameterFlagLong, <a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#ae6f2057f0d0419845a48c1eb6813f2adafab53ea4a643325262b9c140af093279">MSyntax::kString</a>);</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>( kEmptyUVFlag, kEmptyUVFlagLong );</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>( kEmptyUVShapesFlag, kEmptyUVShapesFlagLong );</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>( kTexCoordSourceFlag, kTexCoordSourceFlagLong );</div>
<div class="line"><span class="preprocessor">#if MAYA_API_VERSION &gt;= 700</span></div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>( kColorSourceFlag, kColorSourceFlagLong );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>( kCaseInsensitiveFlag, kCaseInsensitiveFlagLong );</div>
<div class="line">    syntax.<a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#aeaeaac3794bb4de8004afb1ac1829488">addFlag</a>( kDescriptionFlag, kDescriptionFlagLong );</div>
<div class="line"></div>
<div class="line">    syntax.<a name="a44"></a><a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#a299f2c91c864387f1b4208e99a72631d">setObjectType</a>(<a name="a45"></a><a class="code" href="#!/url=./cpp_ref/class_m_syntax.html#a72b517c34c0de9b91ce4b5342675186baf19c7ad857ee046737f2d9c08e7bb70d">MSyntax::kSelectionList</a>, 0, 1);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Removed useSelectionAsDefault because in Maya 5.0 it causes an</span></div>
<div class="line">    <span class="comment">// unwanted error message to the Script Editor window from the</span></div>
<div class="line">    <span class="comment">// MArgDatabase constructor when no object is specified and the</span></div>
<div class="line">    <span class="comment">// current selection is empty.                      - kh 11/2003</span></div>
<div class="line">    <span class="comment">//      syntax.useSelectionAsDefault(true);</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> syntax;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span>* cgfxShaderCmd::creator()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      this method exists to give Maya a way to create new objects</span></div>
<div class="line"><span class="comment">//      of this type. </span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Return Value:</span></div>
<div class="line"><span class="comment">//      a new object of this type</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> cgfxShaderCmd();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">cgfxShaderCmd::cgfxShaderCmd()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      cgfxShaderCmd constructor</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">:   fIsEdit( false )</div>
<div class="line">,   fIsQuery( false )</div>
<div class="line">,   fMaxTexCoords( false )</div>
<div class="line">,   fFxFile( false )</div>
<div class="line">,   fFxPath( false )</div>
<div class="line">,   fTechnique( false )</div>
<div class="line">,   fProfile( false )</div>
<div class="line">,   fPluginPath( false )</div>
<div class="line">,   fEmptyUV( false )</div>
<div class="line">,   fEmptyUVShapes( false )</div>
<div class="line">,   fListParameters(false)</div>
<div class="line">,   fListTechniques( false )</div>
<div class="line">,   fListProfiles( false )</div>
<div class="line">,   fTexCoordSource( false )</div>
<div class="line">#if MAYA_API_VERSION &gt;= 700</div>
<div class="line">,   fColorSource( false )</div>
<div class="line">#endif</div>
<div class="line">,   fCaseInsensitive( false )</div>
<div class="line">,   fDescription( false )</div>
<div class="line">,   fOldEffect(0)</div>
<div class="line">,   fNewEffect(0)</div>
<div class="line">,   fDagMod(0)</div>
<div class="line">{ <span class="comment">/* Nothing left */</span> }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">cgfxShaderCmd::~cgfxShaderCmd()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      cgfxShaderCmd destructor</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#ifdef MAYA_PRINT_DEBUG_INFO</span></div>
<div class="line">        <span class="keywordflow">if</span> ( !fIsQuery )</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> ss = <span class="stringliteral">&quot;  .. ~cmd &quot;</span>;</div>
<div class="line">            ss += fArgString;</div>
<div class="line">            ss += <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">            ::OutputDebugString( ss.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>() );</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        fOldAttrDefList.<a name="a46"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#ac8bb3912a3ce86b15842e79d0b421204">clear</a>();</div>
<div class="line">        fNewAttrDefList.clear();</div>
<div class="line"></div>
<div class="line">        <span class="keyword">delete</span> fDagMod;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( cgfxShaderCommon::InternalError* e )   </div>
<div class="line">    {</div>
<div class="line">        reportInternalError( __FILE__, (<span class="keywordtype">size_t</span>)e );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( ... )</div>
<div class="line">    {</div>
<div class="line">        reportInternalError( __FILE__, __LINE__ );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> cgfxShaderCmd::isUndoable() const</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      this method tells Maya this command is undoable.  It is added to the </span></div>
<div class="line"><span class="comment">//      undo queue if it is.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Return Value:</span></div>
<div class="line"><span class="comment">//      true if this command is undoable.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> !fIsQuery;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">/* private */</span></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> cgfxShaderCmd::parseArgs(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_arg_list.html">MArgList</a>&amp; args, <a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html">MSelectionList</a>&amp; selList)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a>         status;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>         sMsg;</div>
<div class="line"></div>
<div class="line">    selList.<a name="a47"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html#ad5522f028dde0080b753279426415a4a">clear</a>();</div>
<div class="line">    fArgString.<a name="a48"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html#ac8bb3912a3ce86b15842e79d0b421204">clear</a>();</div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> iArg = 0; iArg &lt; args.<a name="a49"></a><a class="code" href="#!/url=./cpp_ref/class_m_arg_list.html#a99dd6a54b909ede1d11702fe58977e2a">length</a>(); ++iArg )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> ( iArg &gt; 0 )</div>
<div class="line">            fArgString += <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">        fArgString += args.<a name="a50"></a><a class="code" href="#!/url=./cpp_ref/class_m_arg_list.html#ad24ff3826e4df513b55e1a0ecb0a665b">asString</a>( iArg );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef MAYA_PRINT_DEBUG_INFO</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> ss = <span class="stringliteral">&quot;  .. Cmd  &quot;</span>;</div>
<div class="line">    ss += fArgString;</div>
<div class="line">    ss += <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    ::OutputDebugString( ss.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>() );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    <a name="_a51"></a><a class="code" href="#!/url=./cpp_ref/class_m_arg_database.html">MArgDatabase</a> argData( syntax(), args, &amp;status );</div>
<div class="line">    <span class="keywordflow">if</span> ( !status )</div>
<div class="line">        <span class="keywordflow">return</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> bCgfxShaderNodeRequired = <span class="keyword">true</span>;</div>
<div class="line">    fIsEdit = argData.isEdit();</div>
<div class="line">    fIsQuery = argData.isQuery();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( argData.isFlagSet( kMaxTexCoordsFlag ) )       </div>
<div class="line">    {</div>
<div class="line">        bCgfxShaderNodeRequired = <span class="keyword">false</span>;</div>
<div class="line">        fMaxTexCoords = <span class="keyword">true</span>;    </div>
<div class="line">        fIsQuery = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( argData.isFlagSet( kPluginPathFlag ) )       </div>
<div class="line">    {</div>
<div class="line">        bCgfxShaderNodeRequired = <span class="keyword">false</span>;</div>
<div class="line">        fPluginPath = <span class="keyword">true</span>;    </div>
<div class="line">        fIsQuery = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( argData.isFlagSet( kEmptyUVFlag ) )       </div>
<div class="line">    {</div>
<div class="line">        fEmptyUV = <span class="keyword">true</span>;    </div>
<div class="line">        fIsQuery = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( argData.isFlagSet( kEmptyUVShapesFlag ) )       </div>
<div class="line">    {</div>
<div class="line">        fEmptyUVShapes = <span class="keyword">true</span>;    </div>
<div class="line">        fIsQuery = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( argData.isFlagSet( kTexCoordSourceFlag ) )       </div>
<div class="line">    {</div>
<div class="line">        fTexCoordSource = <span class="keyword">true</span>;    </div>
<div class="line">        fIsQuery = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if MAYA_API_VERSION &gt;= 700</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( argData.isFlagSet( kColorSourceFlag ) )       </div>
<div class="line">    {</div>
<div class="line">        fColorSource = <span class="keyword">true</span>;    </div>
<div class="line">        fIsQuery = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (argData.isFlagSet(kFxFlag))</div>
<div class="line">    {</div>
<div class="line">        fFxFile = <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (!fIsQuery) {</div>
<div class="line">            argData.getFlagArgument(kFxFlag, 0, fNewFxFile);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (argData.isFlagSet(kFxPathFlag))</div>
<div class="line">    {</div>
<div class="line">        fFxPath = <span class="keyword">true</span>;</div>
<div class="line">        fIsQuery = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (argData.isFlagSet(kFxTechniqueFlag))</div>
<div class="line">    {</div>
<div class="line">        fTechnique = <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (!fIsQuery) {</div>
<div class="line">            argData.getFlagArgument( kFxTechniqueFlag, 0, fNewTechnique );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (argData.isFlagSet(kFxProfileFlag))</div>
<div class="line">    {</div>
<div class="line">        fProfile = <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (!fIsQuery) {</div>
<div class="line">            argData.getFlagArgument( kFxProfileFlag, 0, fNewProfile );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (argData.isFlagSet(kNameFlag))</div>
<div class="line">    {</div>
<div class="line">        argData.getFlagArgument(kNameFlag, 0, fNodeName);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (argData.isFlagSet(kListParametersFlag))</div>
<div class="line">    {</div>
<div class="line">        fListParameters = <span class="keyword">true</span>;</div>
<div class="line">        fIsQuery = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( argData.isFlagSet( kListTechniquesFlag ) )</div>
<div class="line">    {</div>
<div class="line">        fListTechniques = <span class="keyword">true</span>;</div>
<div class="line">        fIsQuery = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( argData.isFlagSet( kListProfilesFlag ) )</div>
<div class="line">    {</div>
<div class="line">        bCgfxShaderNodeRequired = <span class="keyword">false</span>;</div>
<div class="line">        fListProfiles = <span class="keyword">true</span>;</div>
<div class="line">        fIsQuery = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (argData.isFlagSet(kParameterFlag))</div>
<div class="line">    {</div>
<div class="line">        argData.getFlagArgument(kParameterFlag, 0, fParameterName);</div>
<div class="line">        fIsQuery = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( argData.isFlagSet( kCaseInsensitiveFlag ) )       </div>
<div class="line">    {</div>
<div class="line">        fCaseInsensitive = <span class="keyword">true</span>;    </div>
<div class="line">        fIsQuery = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( argData.isFlagSet( kDescriptionFlag ) )       </div>
<div class="line">    {</div>
<div class="line">        fDescription = <span class="keyword">true</span>;    </div>
<div class="line">        fIsQuery = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check for mutually exclusive flags.</span></div>
<div class="line">    <span class="keywordflow">if</span> ( fIsQuery &amp;&amp;</div>
<div class="line">        fIsEdit )</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> es = <span class="stringliteral">&quot;cgfxShader: invalid use of -e/-edit flag&quot;</span>;</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0">MGlobal::displayError</a>( es );</div>
<div class="line">        <span class="keywordflow">return</span> MS::kInvalidParameter;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Get the objects on which to operate.</span></div>
<div class="line">    <span class="keywordflow">if</span> ( bCgfxShaderNodeRequired )</div>
<div class="line">    {</div>
<div class="line">        argData.getObjects(selList);</div>
<div class="line">        <span class="keywordflow">if</span> ( selList.<a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html#a99dd6a54b909ede1d11702fe58977e2a">length</a>() == 0 )</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a6d81d38246555884897fb153c93aaf42">MGlobal::getActiveSelectionList</a>( selList );</div>
<div class="line">        <span class="keywordflow">if</span> ( selList.<a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html#a99dd6a54b909ede1d11702fe58977e2a">length</a>() != 1 )</div>
<div class="line">        {</div>
<div class="line">            sMsg = <span class="stringliteral">&quot;Exactly one node must be specified or selected for command:  cgfxShader &quot;</span>;</div>
<div class="line">            sMsg += fArgString;</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0">MGlobal::displayError</a>( sMsg );</div>
<div class="line">            status = MS::kInvalidParameter;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> cgfxShaderCmd::getNodesToUpdate(<span class="keyword">const</span> cgfxRCPtr&lt;const cgfxEffect&gt;&amp; effect, cgfxShaderNode* currNode, cgfxShaderNode::NodeList&amp; nodes)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// Consider as a reload if the new and old fx file names are the same</span></div>
<div class="line">    <span class="keywordtype">bool</span> isReload = (fNewFxFile == fOldFxFile);</div>
<div class="line">    <span class="keywordflow">if</span>(isReload)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Get all the shaders that use the old effect</span></div>
<div class="line">        cgfxShaderNode::getNodesUsingEffect(effect, nodes);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Simply update the current node</span></div>
<div class="line">        nodes.insert(currNode);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Error reporting</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">cgfxShaderCmd::reportInternalError( <span class="keyword">const</span> <span class="keywordtype">char</span>* sFile, <span class="keywordtype">size_t</span> errcode )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> es = <span class="stringliteral">&quot;cgfxShader internal error &quot;</span>;</div>
<div class="line">    es += (int)errcode;</div>
<div class="line">    <span class="keywordflow">if</span> (fArgString.length() &gt; 0)</div>
<div class="line">    {</div>
<div class="line">        es += <span class="stringliteral">&quot; with args: &quot;</span>;</div>
<div class="line">        es += fArgString;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#ifdef _WINDOWS</span></div>
<div class="line">    ::OutputDebugString( es.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>() );</div>
<div class="line">    ::OutputDebugString( <span class="stringliteral">&quot;\n&quot;</span> );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a4ddbe97e58a90e1ab05d45a62c006cf0">MGlobal::displayError</a>( es );</div>
<div class="line">}                                      <span class="comment">// cgfxShaderCmd::reportInternalError</span></div>
<div class="line"></div>
<div class="line"></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->

      <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
   </div></body>
</html>
