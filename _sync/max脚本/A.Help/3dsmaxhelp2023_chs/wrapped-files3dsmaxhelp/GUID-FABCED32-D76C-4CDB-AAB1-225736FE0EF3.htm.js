var topic = "<!DOCTYPE html><html>\n   <head>\n      <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n      <meta name=\"product\" content=\"3DSMAX\">\n      <meta name=\"release\" content=\"2023\">\n      <meta name=\"book\" content=\"GeneralUser\">\n      <meta name=\"created\" content=\"2022-03-27\">\n      <meta name=\"topicid\" content=\"GUID-FABCED32-D76C-4CDB-AAB1-225736FE0EF3\">\n      <meta name=\"description\" content=\"HI 解算器的基本要求是，该解决方案属于历史独立型，即只能基于当前状态下的目标和其他附带参数。\">\n      <meta name=\"indexterm\" content=\"白皮书, 旋转角度和 HI IK 解算器\">\n      <meta name=\"indexterm\" content=\"旋转角度\">\n      <meta name=\"indexterm\" content=\"HI IK 解算器\">\n      <meta name=\"topic-type\" content=\"concept\">\n      <title>白皮书：HI IK 解算器的旋转角度</title><script language=\"javascript\">var index = \'index3dsmaxhelp.html\';</script></head>\n   <body height=\"100%\">\n      <div class=\"body_content\" id=\"body-content\" dir=\"ltr\"><a name=\"GUID-FABCED32-D76C-4CDB-AAB1-225736FE0EF3\"></a><div class=\"head\">\n            <h1>白皮书：HI IK 解算器的旋转角度</h1>\n         </div>\n         <p class=\"blurb\">HI 解算器的基本要求是，该解决方案属于历史独立型，即只能基于当前状态下的目标和其他附带参数。 </p>\n         <div class=\"section\"><a name=\"WS1A9193826455F5FFBA679E112A6A190044D4D\"></a> \n            <h2><a name=\"GUID-04682915-C0A4-445D-BC21-E3A2219C4FC9\"></a>自由旋转角度\n            </h2> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E2A\"></a>为单个链提供位置目标后，将保持明显的自由度：绕末端效应器轴（EE 轴）旋转。使用旋转角度，可以定量地说明这种自由度。 \n            </p> <a name=\"WS1A9193826455F5FFBA679E112A6A190044D4E\"></a><div class=\"figure-anchor\"><img src=\"../images/GUID-70A1A90C-C7A3-4387-9189-DF4CE0B16172-low.png\"></div>  \n            <p><a name=\"GUID-F1B3F453-B856-4B36-99CE-CAE67BDAC640\"></a> <em class=\"strong\">1. 起始关节</em> \n            </p> \n            <p><a name=\"GUID-7748AB2C-EECF-40E5-B159-EC68C3A623ED\"></a> <em class=\"strong\">2. 末端效应器</em> \n            </p> \n            <p><a name=\"GUID-6B148ECF-06D2-460C-A85E-CF577D5077C2\"></a> <em class=\"strong\">3. EE 轴</em> \n            </p> \n         </div>\n         <div class=\"section\"><a name=\"WS1A9193826455F5FFBA679E112A6A190044D4F\"></a> \n            <h2><a name=\"GUID-32D75D16-CD3E-4384-83A4-9C35DDCC97F9\"></a>解算器平面\n            </h2> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E29\"></a>我们称通过所有关节的平面为“解算器平面”。如果关节不位于平面上，该平面的定义如下：(A) 通过“起始关节”和“结束关节”；(B) 在某种意义上，距离其余关节最近。 \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E28\"></a>“旋转角度”说明了“解算器平面”的自由度。它只包含“起始关节”。 \n            </p> \n         </div>\n         <div class=\"section\"><a name=\"WS1A9193826455F5FFBA679E112A6A190044D50\"></a> \n            <h2><a name=\"GUID-6D6B1AB9-56B8-4DDF-ACA4-2F6892A0816B\"></a>零平面贴图\n            </h2> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E27\"></a>为了定量说明解算器平面，必须就 0 的含义达成一致。末端效应器的位置给定时，“零（解算器）平面”的位置如何？“零平面贴图”用作参数 EE 轴，因此可以为零平面生成法线。 \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E26\"></a>使用 IK 系统，各个解算器插件都能定义自己的“零平面贴图”。如果未定义，IK 系统将会提供默认值。 \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E25\"></a>“零平面贴图”的参数是一个提供 EE 轴方向的单位向量。同样，EE 沿着 EE 轴滑动时，应该固定解算器平面。因此，“零平面贴图”可以定义向量场或球体。如果提供球体上的点，将会生成切向单位向量，以其作为零平面的法线进行插补。 \n            </p> <a name=\"WS1A9193826455F5FFBA679E112A6A190044D51\"></a><div class=\"figure-anchor\"><img src=\"../images/GUID-69019042-2C7C-444F-93B4-F70446D8A90B-low.png\"><p class=\"figure-title\">1. 零平面的法线</p>\n            </div>  \n         </div>\n         <div class=\"section\"><a name=\"WS1A9193826455F5FFBA679E112A6A190044D52\"></a> \n            <h2><a name=\"GUID-D5C94313-296F-46A9-BECD-94223501ACC2\"></a>翻转解算器平面\n            </h2> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E24\"></a>球体上不存在连续的向量场属于数学事实。无论做何努力，邻近向量会大幅更改的球体上始终存在着一点。这是末端效应器轴向其靠近时解算器平面要发生翻转的位置。 \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E23\"></a>一方面，这是因为，根据历史独立型要求，我们必须向单点分配固定向量。另外一方面，无论分配什么向量，该向量将会与分配给邻近点的某些向量明显不同。 \n            </p> \n         </div>\n         <div class=\"section\"><a name=\"WS1A9193826455F5FFBA679E112A6A190044D53\"></a> \n            <h2><a name=\"GUID-189E4A6F-5D9A-4018-BBE3-AF65E0E5611D\"></a>球体的固有参考帧\n            </h2> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E22\"></a>为了定义“零平面贴图”，必须定义球体的参考帧。该参考帧是关节链本身所固有的。 \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E21\"></a>球体可以通过中心、水平面和子午线（零纬度）来定义。该中心分配给起始关节。 \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E20\"></a>如果所有的关节角度都假定为首选角度，则姿势尤其重要。我们称之为首选姿势。 \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E1F\"></a>我们将处于首选姿势的解算器平面用作水平面。因为使用旋转角度可以控制起始关节，所以，起始关节处的首选角度并非是固有的。另外，使用解算器平面定义水平面是合理的。其中，通过向起始关节分配零平面，而向其他关节分配首选角度，可以生成该解算器平面。 \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E1E\"></a>EE 轴可以定义子午线。此时，球体的定义如下图所述： \n            </p> <a name=\"WS1A9193826455F5FFBA679E112A6A190044D54\"></a><div class=\"figure-anchor\"><img src=\"../images/GUID-05A3B219-8C39-4CA3-82D4-F2AB83E2819B-low.png\"><p class=\"figure-title\">1. EE 轴</p>\n            </div>  \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E1D\"></a>所有关节都假定了首选角度。“零平面贴图”将在该球体上加以定义。 \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E1C\"></a>事实上，定义其自身的“零平面贴图”时所用的插件解算器 API 可以向处于首选姿势的解算器平面分配 EE 轴和法线： \n            </p> \n            <div class=\"codeBlock\"><pre>virtual const IKSys::ZeroPlaneMap*\n\n GetZeroPlaneMap(const Point3&amp; a0,\n const Point3&amp; n0) const</pre></div> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E1B\"></a>其中，<em class=\"mild\">a0</em> 和 <em class=\"mild\">n0</em> 分别是 EE 轴和处于首选姿势的解算器平面。ZeroPlaneMap 的对象是一个向球体上每点分配平面法线的函数。 \n            </p> \n         </div>\n         <div class=\"section\"><a name=\"WS1A9193826455F5FFBA679E112A6A190044D55\"></a> \n            <h2><a name=\"GUID-BFBA80A1-6FBA-4223-959A-677C2DB8DA21\"></a>默认零平面贴图\n            </h2> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E1A\"></a>如果未由插件解算器提供，（IK 解算器本身作为插件解算器实施）IK 系统将会提供默认值。该贴图是通过下列规则定义的： \n            </p> <a name=\"WS1A9193826455F5FFBA679E112A6A190044D56\"></a><ul>\n               <li> <em class=\"strong\">A：</em>对于水平面与球体相交得到的赤道上的每个点，法线向量是作为垂直向量定义的。该向量所指的方向与处于首选姿势的解算器平面的法线方向相同。 \n               </li>\n               <li> <em class=\"strong\">B：</em>对于球体而不是两极上的任何点，存在一个通过该点和南北两极的大圆。该圆与赤道相交于两点。一点比较靠近指定点。按着大圆方向将赤道上更近的点处的法线沿着切线方向移动到该点，即可定义指定点处的法线向量。 <a name=\"WS1A9193826455F5FFBA679E112A6A190044D57\"></a><div class=\"figure-anchor\"><img src=\"../images/GUID-DD6B52C2-F688-409C-AA5B-2FC4D46BBD7C-low.png\"><p></p>\n                     <p class=\"figure-title\">生成零平面的默认法线</p>\n                  </div>  \n               </li>\n            </ul> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E19\"></a>无疑，这种方法不会延伸到南北极。南北极是单点。EE 轴穿越两极时，法线将会突然改变方向，即通过用户视口进行翻转。 \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E18\"></a>通常，首选姿势是首次分配解算器时的姿势。因此，放置点的平面与此处的水平面相对应。规则 A 可以确保，如果在平面上移动目标，该链将一直处于该平面中。 \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E17\"></a>规则 B 表明，沿着与赤道垂直的大圆移动到赤道时，该链一直处于垂直位置，穿过两极（该贴图的单点）时除外。 \n            </p> \n         </div>\n         <div class=\"section\"><a name=\"WS1A9193826455F5FFBA679E112A6A190044D58\"></a> \n            <h2><a name=\"GUID-4395C4AD-FBF1-412E-A452-F93B8428FDBB\"></a>父空间\n            </h2> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E16\"></a>到目前为止，我们已经介绍了很多内容，就好像整个世界只包含 IK 元素一样。事实上，IK 链和目标位于各个变换层次的点上。最终，我们必须绘制末端效应器的位置。在世界中，该位置是指球体上的某个点。根据球体相对于末端效应器位置的安装方式，经度和纬度的显示不尽相同。要在其中放置该球体的父变换空间称“旋转角度父空间”或“父空间”（如果环境明确的话）。\n               \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E15\"></a>对于 IK 参数，父空间必须是恒定不变的。刚才，我们已经提供了两种选择方案： \n            </p> <a name=\"WS1A9193826455F5FFBA679E112A6A190044D59\"></a><ul>\n               <li> <em class=\"strong\">起始关节</em>“旋转角度父空间”与“起始关节”的父空间相同。 \n               </li>\n               <li> <em class=\"strong\">IK 目标</em>“旋转角度父空间”是 IK 目标的父级。 \n               </li>\n            </ul> \n         </div>\n         <div class=\"section\"><a name=\"WS1A9193826455F5FFBA679E112A6A190044D5A\"></a> \n            <h2><a name=\"GUID-56667347-CAE0-4693-81FC-1806BE5A71B8\"></a>示例 1\n            </h2> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E14\"></a>如果起始关节和目标直接位于世界中，选择“父空间”不会有任何区别。在下例中，起始关节是对象 A 的父级。 \n            </p> <a name=\"WS1A9193826455F5FFBA679E112A6A190044D5B\"></a><div class=\"figure-anchor\"><img src=\"../images/GUID-9BC76CF9-DC9E-4A42-A94C-F54B16FBAE37-low.png\"><p class=\"figure-title\">此时，可以（通过起始关节）将 IK 链设置为对象 A 的父级。</p>\n            </div>  \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E13\"></a>假定这是分配 IK 解算器时的姿势。因此，这是首选姿势。展开关节的平面是球体的水平面（“零平面贴图”）。 \n            </p> <a name=\"WS1A9193826455F5FFBA679E112A6A190044D5C\"></a><ul>\n               <li> <em class=\"strong\">A：</em>“父空间”是“起始关节”。在这种情况下，将该球体设置为 A 的父级。如果 A 绕着绘制的轴旋转，该球体将会与其一同旋转。目标位于各个变换层次中。该目标将会保持原位。末端效应器因 IK 解决方案而与其相连。因为（平面）法线对球体是固定的，所以，它也会与\n                  A 一起旋转。为此，整个链似乎与父对象一起旋转。 \n               </li>\n               <li> <em class=\"strong\">B：</em>“父空间”是“IK 目标”。假定该目标是世界的父级。在这种情况下，由于球体已设置为世界的父级，因此保持不变。因此法线对球体是固定的，所以，旋转 A 时，该链将保持静止。 \n               </li>\n            </ul> \n         </div>\n         <div class=\"section\"><a name=\"WS1A9193826455F5FFBA679E112A6A190044D5D\"></a> \n            <h2><a name=\"GUID-5055B049-BB5D-4272-AE5A-7661E8461EDC\"></a>示例 2\n            </h2> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E12\"></a>在下例中，我们将要了解一下分配 IK 解算器后父空间存在的旋转情况。 \n            </p> <a name=\"WS1A9193826455F5FFBA679E112A6A190044D5E\"></a><div class=\"figure-anchor\"><img src=\"../images/GUID-5948D744-4AB9-453F-8DFA-ECEF440A2045-low.png\"><p class=\"figure-title\">分配 IK 解算器后，IK 链的父空间将会包含一个旋转。</p>\n            </div>  \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E11\"></a>父 A 包含 90 度的旋转。如果用户没有使用 IK 解算器创建四个骨骼，并在稍后分配一个 IK 解算器（从 <em class=\"mild\">Bone2</em> 到 <em class=\"mild\">Bone4</em>），就属于抽象概念。如果直接将链设置为世界的父级，它将会显示在右图中：解算器平面变成水平状态。 \n            </p> <a name=\"WS1A9193826455F5FFBA679E112A6A190044D5F\"></a><ul>\n               <li> <em class=\"strong\">A：</em>“父空间”是“起始关节”。旋转 A 后，将会安装球体。因此，“水平面”与视口中所示的链平面相符。单点相对于该平面与“起始关节”垂直。在平面上移动目标/末端效应器时，它决不会与单点交叉，也不会进行翻转。 \n               </li>\n               <li> <em class=\"strong\">B：</em>“父空间”是“IK 目标”。另外，我们假定目标的父空间是世界。此时，该球体的“水平面”将变成水平状态，如右图所示。单点和两极都位于展开关节的平面上。因此，用户左右移动目标/末端效应器时，末端效应器将会通过单点，还会进行翻转。 \n               </li>\n            </ul> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E10\"></a>B 的问题在于，决不会向用户显示右图。因此，必须对其进行设想，以便了解翻转。 \n            </p> \n         </div>\n         <div class=\"section\"><a name=\"WS1A9193826455F5FFBA679E112A6A190044D60\"></a> \n            <h2><a name=\"GUID-86B99856-AFC7-4ACE-9042-E3293C239A30\"></a>示例 3\n            </h2> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E0F\"></a>本例介绍了重新分配“起始关节”时生成的结果。假定我们有一个包含四个骨骼节点的 IK 链。 \n            </p> <a name=\"WS1A9193826455F5FFBA679E112A6A190044D61\"></a><div class=\"figure-anchor\"><img src=\"../images/GUID-BB77E9AE-2899-46CF-A69D-F6FB5F7BD86B-low.png\"></div>  \n            <p><a name=\"GUID-868CA235-60DC-4C25-BF74-93BC422871A1\"></a> <em class=\"strong\">1. Bone01</em> \n            </p> \n            <p><a name=\"GUID-34085D39-FF6F-42E7-A1F3-DDCC971349EB\"></a> <em class=\"strong\">2. Bone02</em> \n            </p> \n            <p><a name=\"GUID-CAB15AE9-9428-48D9-B385-9F0627FC67E4\"></a> <em class=\"strong\">3. Bone03</em> \n            </p> \n            <p><a name=\"GUID-32ED99DD-1438-44D9-B896-C07138636A23\"></a> <em class=\"strong\">4. Bone04</em> \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E0E\"></a>“起始关节”和“结束关节”分别是 <em class=\"mild\">Bone01</em> 和 <em class=\"mild\">Bone04</em>。假定图中所示的姿势是首选姿势，且 <em class=\"mild\">Bone01</em> 包含一个旋转。如果直接将 <em class=\"mild\">Bone02</em> 设置为世界的父级，右图中将会显示 <em class=\"mild\">Bone02</em> 的层次。 \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E0D\"></a>向 <em class=\"mild\">Bone02</em> 重新分配“起始关节”时，“零平面贴图”球体将会基于右侧的配置。 \n            </p> <a name=\"WS1A9193826455F5FFBA679E112A6A190044D62\"></a><ul>\n               <li> <em class=\"strong\">A：</em>“父空间”是“起始关节”。在这种情况下，固定进行正确配置的球体将被设置为 <em class=\"mild\">Bone01</em> 的父级。它将会与基于 <em class=\"mild\">Bone01</em> 到 <em class=\"mild\">Bone04</em> 的球体相同。因此，可以获得相同的法线，而链将会保持不变。 \n               </li>\n               <li> <em class=\"strong\">B：</em>“父空间”是“IK 目标”。在这种情况下，球体处于世界中，而 <em class=\"mild\">Bone02</em> 被设置为 <em class=\"mild\">Bone01</em> 的父级。如果 <em class=\"mild\">Bone04</em> 因 <em class=\"mild\">Bone01</em> 变换而移动到左侧，对球体（对世界固定）固定的观察者将会发现，<em class=\"mild\">Bone04</em> 正在远离首选姿势定义的中性位置。此后，将会对“零平面贴图”应用算法，以便在替换位置处找到法线。通常，它不会与视口垂直。因此，使用新的“起始关节”时，只会翻转一次。 \n               </li>\n            </ul> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E0C\"></a>如果删除解算器/目标，并已分配新对象（从 <em class=\"mild\">Bone02</em> 到 <em class=\"mild\">Bone04</em>），您将会发现，该链不会翻转。为什么？分配“起始关节”和创建新的 IK 链/目标是不同的。“起始关节”是很多 IK 参数之一。重新分配“起始关节”与修改任何参数完全相同。其余参数将保持完好。尤其是，执行重新分配操作后，不会更改“旋转角度”。 \n            </p> \n            <p><a name=\"WS1A9193826455F5FF103859C11318F51BDD-3E0B\"></a>创建新的 IK 链/目标会有所不同。试图确保关节链处于固定状态，方法是对参数进行相应的调整。尤其是，“旋转角度”将会设置为某个值，使解算器平面可以在视口中保持固定。 \n            </p> \n         </div>\n         <div class=\"footer-block\"><a href=\"..\" class=\"comments-anchor\" target=\"_blank\"><span class=\"comments-link\">请将您关于此页内容的评论发送给我们</span></a></div><br><p class=\"footer-license-block\"><a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc-sa/3.0/\" target=\"_blank\"><img alt=\"Creative Commons License\" style=\"border-width: 0;\" src=\"../images/ccLink.png\"></a>&nbsp;<em>除非另有说明，否则此作品受到 <a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc-sa/3.0/\" target=\"_blank\"> Creative Commons 署名-非商业性使用-相同方式共享 3.0 未本地化版本许可证</a>的制约。请参见 <a href=\"http://autodesk.com/creativecommons\" target=\"_blank\">Autodesk Creative Commons 常见问题</a>(英文)以获取更多信息。</em></p><br></div>\n   </body>\n</html>";