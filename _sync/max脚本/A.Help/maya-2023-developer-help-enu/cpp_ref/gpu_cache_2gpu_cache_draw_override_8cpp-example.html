<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
      <title>C++ API Reference: gpuCache/gpuCacheDrawOverride.cpp</title>
      
	  
      
      
      
      
      
      
      
    

</head>
   <body height="100%"><div class="body_content" id="body-content"><link rel="stylesheet" type="text/css" href="cpp_ref/navtree.css"><link rel="stylesheet" type="text/css" href="cpp_ref/doxygen.css"><link rel="stylesheet" type="text/css" href="cpp_ref/tabs.css"><link rel="stylesheet" type="text/css" href="style/adsk.cpm.css"><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('gpu_cache_2gpu_cache_draw_override_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
      <div>
         <div class="head">
            <h1>C++ API Reference: gpuCache/gpuCacheDrawOverride.cpp</h1>
         </div>

<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->

  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="#!/url=./cpp_ref/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="#!/url=./cpp_ref/pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="#!/url=./cpp_ref/modules.html"><span>Modules</span></a></li>
      <li><a href="#!/url=./cpp_ref/namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="#!/url=./cpp_ref/annotated.html"><span>Classes</span></a></li>
      <li><a href="#!/url=./cpp_ref/examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="cpp_ref/search/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="cpp_ref/search/close.png" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>

<div id="doc-content">
<!-- window showing the filter options -->


<!-- iframe showing the search results (closed by default) -->


<div class="header">
  <div class="headertitle">
<div class="title">gpuCache/gpuCacheDrawOverride.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">//**************************************************************************/</span></div>
<div class="line"><span class="comment">// Copyright 2020 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk</span></div>
<div class="line"><span class="comment">// license agreement provided at the time of installation or download,</span></div>
<div class="line"><span class="comment">// or which otherwise accompanies this software in either electronic</span></div>
<div class="line"><span class="comment">// or hard copy form.</span></div>
<div class="line"><span class="comment">//**************************************************************************/</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;gpuCacheDrawOverride.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;gpuCacheConfig.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;gpuCacheShapeNode.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;gpuCacheDrawTraversal.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;gpuCacheFrustum.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;gpuCacheGLFT.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MAnimControl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDrawContext.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnDependencyNode.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGlobal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MHWGeometryUtilities.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MStateManager.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MUserData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGL.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnCamera.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MSelectionList.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPointArray.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>{</div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>GPUCache;</div>
<div class="line"></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"><span class="comment">// LOCAL TYPES</span></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">enum</span> DepthOffsetType {</div>
<div class="line">    kNoDepthOffset,</div>
<div class="line">    kApplyDepthOffset,</div>
<div class="line">    kNbDepthOffsetType</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">enum</span> ColorType {</div>
<div class="line">    kSubNodeColor,</div>
<div class="line">    kDefaultColor,</div>
<div class="line">    kBlackColor,</div>
<div class="line">    kXrayColor,</div>
<div class="line">    kXrayBlackColor,</div>
<div class="line">    kNbColorType</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">enum</span> NormalsType {</div>
<div class="line">    kFrontNormals,</div>
<div class="line">    kBackNormals,</div>
<div class="line">    kNbNormalsType</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">enum</span> FrontFaceType {</div>
<div class="line">    kFrontClockwise,</div>
<div class="line">    kFrontCounterClockwise,</div>
<div class="line">    kNbFrontFaceType</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">enum</span> TwoSidedLightingType {</div>
<div class="line">    kTwoSidedLighting,</div>
<div class="line">    kOneSidedLighting,</div>
<div class="line">    kNbTwoSidedLightingType</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"><span class="comment">// LOCAL FUNCTIONS</span></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> setShadedBlendState(<a name="_a0"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html">MHWRender::MStateManager</a>* stateMgr)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="#!/url=./cpp_ref/namespace_m_h_w_render.html">MHWRender</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <a name="_a1"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state.html">MBlendState</a>* blendState = NULL;</div>
<div class="line">    <span class="keywordflow">if</span> (!blendState) {</div>
<div class="line">        <a name="_a2"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html">MBlendStateDesc</a> desc;</div>
<div class="line"></div>
<div class="line">        desc.<a name="a3"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#ab6054509e76bc88d697a365e82c504c8">targetBlends</a>[0].<a name="a4"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_target_blend_desc.html#af69e3282d64f8cfe88a2759960788417">blendEnable</a> = <span class="keyword">true</span>;</div>
<div class="line">        desc.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#ab6054509e76bc88d697a365e82c504c8">targetBlends</a>[0].<a name="a5"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_target_blend_desc.html#adadc1ea4b5fca51312ae451f346434e3">destinationBlend</a> = MBlendState::kInvSourceAlpha;</div>
<div class="line">        desc.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html#ab6054509e76bc88d697a365e82c504c8">targetBlends</a>[0].<a name="a6"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_target_blend_desc.html#aa0f38fbd90e3171cc6c092e80ff25c7c">alphaDestinationBlend</a> = MBlendState::kInvSourceAlpha;</div>
<div class="line"></div>
<div class="line">        blendState = stateMgr-&gt;<a name="a7"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#aeb560f7829270f34ab413ad314314c8f">acquireBlendState</a>(desc);</div>
<div class="line">    }</div>
<div class="line">    stateMgr-&gt;<a name="a8"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a27dbc083002d85108ed30ee1131f68c1">setBlendState</a>(blendState);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keyword">const</span> <a name="_a9"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html">MHWRender::MRasterizerState</a>* createShadedRasterState(</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html">MHWRender::MStateManager</a>* stateMgr,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html#a9602dcbc7b9991767e322a6f55541e8a">MHWRender::MRasterizerState::CullMode</a> cullMode,</div>
<div class="line">    <span class="keyword">const</span> DepthOffsetType                       depthOffsetType)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="#!/url=./cpp_ref/namespace_m_h_w_render.html">MHWRender</a>;</div>
<div class="line"></div>
<div class="line">    <a name="_a10"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state_desc.html">MRasterizerStateDesc</a> desc;</div>
<div class="line">    desc.<a name="a11"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state_desc.html#a5a9f0fe3d49830803b7a25440b2d19a6">cullMode</a> = cullMode;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (depthOffsetType == kApplyDepthOffset) {</div>
<div class="line">        desc.<a name="a12"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state_desc.html#a0c22bd503abc493c0b54ba8a7593a6d8">depthBiasIsFloat</a>       = true ;</div>
<div class="line">        desc.<a name="a13"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state_desc.html#a2894fe1122185e1e681e79ab7cfeb8d6">depthBias</a>              = 0.0000002384f;</div>
<div class="line">        desc.<a name="a14"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state_desc.html#a7d6c8cc49b0374cb87605d24acacd4e2">slopeScaledDepthBias</a>   = 0.95f;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> stateMgr-&gt;<a name="a15"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a1f43e6ab99a6e2e5817df7bb1a0c69e6">acquireRasterizerState</a>(desc);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> setShadedRasterState(</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html">MHWRender::MStateManager</a>* stateMgr,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html#a9602dcbc7b9991767e322a6f55541e8a">MHWRender::MRasterizerState::CullMode</a> cullMode,</div>
<div class="line">    <span class="keyword">const</span> DepthOffsetType                       depthOffsetType,</div>
<div class="line">    <span class="keyword">const</span> FrontFaceType                         frontFaceType)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="#!/url=./cpp_ref/namespace_m_h_w_render.html">MHWRender</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html">MRasterizerState</a>* cullNoneRasterizerState[kNbDepthOffsetType]  =</div>
<div class="line">        {NULL, NULL};</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html">MRasterizerState</a>* cullFrontRasterizerState[kNbDepthOffsetType] =</div>
<div class="line">        {NULL, NULL};</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html">MRasterizerState</a>* cullBackRasterizerState[kNbDepthOffsetType]  =</div>
<div class="line">        {NULL, NULL};</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!cullNoneRasterizerState[kNoDepthOffset]) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dot = 0; dot &lt; kNbDepthOffsetType; ++dot) {</div>
<div class="line">            cullNoneRasterizerState[dot] = createShadedRasterState(</div>
<div class="line">                stateMgr, MRasterizerState::kCullNone, DepthOffsetType(dot));</div>
<div class="line">            cullFrontRasterizerState[dot] = createShadedRasterState(</div>
<div class="line">                stateMgr, MRasterizerState::kCullFront, DepthOffsetType(dot));</div>
<div class="line">            cullBackRasterizerState[dot] = createShadedRasterState(</div>
<div class="line">                stateMgr, MRasterizerState::kCullBack, DepthOffsetType(dot));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> (cullMode) {</div>
<div class="line">        <span class="keywordflow">case</span> MRasterizerState::kCullNone:</div>
<div class="line">            stateMgr-&gt;<a name="a16"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a7dfb1c4f28575ed6581aa40a7b64f22a">setRasterizerState</a>(</div>
<div class="line">                cullNoneRasterizerState[depthOffsetType]);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> MRasterizerState::kCullFront:</div>
<div class="line">            stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a7dfb1c4f28575ed6581aa40a7b64f22a">setRasterizerState</a>(</div>
<div class="line">                cullFrontRasterizerState[depthOffsetType]);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> MRasterizerState::kCullBack:</div>
<div class="line">            stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a7dfb1c4f28575ed6581aa40a7b64f22a">setRasterizerState</a>(</div>
<div class="line">                cullBackRasterizerState[depthOffsetType]);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">default</span>: assert(0);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Must use OpenGL directly here since the MStateManager does not</span></div>
<div class="line">    <span class="comment">// allow us to control this OpenGL state. The</span></div>
<div class="line">    <span class="comment">// MRasterizerState::frontCounterClockwise parameter only controls</span></div>
<div class="line">    <span class="comment">// the winding order used for culling purposes, not for lighting</span></div>
<div class="line">    <span class="comment">// purposes.</span></div>
<div class="line">    gGLFT-&gt;glFrontFace(frontFaceType == kFrontClockwise ? MGL_CW : MGL_CCW);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> setShadedSolidDepthState(</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html">MHWRender::MStateManager</a>* stateMgr)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="#!/url=./cpp_ref/namespace_m_h_w_render.html">MHWRender</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <a name="_a17"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_depth_stencil_state.html">MDepthStencilState</a>* depthState = NULL;</div>
<div class="line">    <span class="keywordflow">if</span> (!depthState) {</div>
<div class="line">        <a name="_a18"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_depth_stencil_state_desc.html">MDepthStencilStateDesc</a> desc;</div>
<div class="line">        depthState = stateMgr-&gt;<a name="a19"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a4fae5c76bc6698abb77b9ffec01bc21a">acquireDepthStencilState</a>(desc);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    stateMgr-&gt;<a name="a20"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a5a6b8e76300df4a0c9f6a38b236118f7">setDepthStencilState</a>(depthState);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> setShadedTwoSidedLightingState(</div>
<div class="line">    <span class="keyword">const</span> TwoSidedLightingType twoSidedLightingType)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// MStateManager does not allow us to set two-sided lighting state.</span></div>
<div class="line">    gGLFT-&gt;glLightModeli(MGL_LIGHT_MODEL_TWO_SIDE,</div>
<div class="line">        twoSidedLightingType == kTwoSidedLighting ? 1 : 0);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> setShadedAlphaDepthState(</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html">MHWRender::MStateManager</a>* stateMgr)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="#!/url=./cpp_ref/namespace_m_h_w_render.html">MHWRender</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_depth_stencil_state.html">MDepthStencilState</a>* depthState = NULL;</div>
<div class="line">    <span class="keywordflow">if</span> (!depthState) {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_depth_stencil_state_desc.html">MDepthStencilStateDesc</a> desc;</div>
<div class="line">        desc.<a name="a21"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_depth_stencil_state_desc.html#a1944b0918378af218375dd45c1f191d1">depthWriteEnable</a> = <span class="keyword">false</span>;</div>
<div class="line">        depthState = stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a4fae5c76bc6698abb77b9ffec01bc21a">acquireDepthStencilState</a>(desc);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a5a6b8e76300df4a0c9f6a38b236118f7">setDepthStencilState</a>(depthState);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> setWireframeState(</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html">MHWRender::MStateManager</a>* stateMgr)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="#!/url=./cpp_ref/namespace_m_h_w_render.html">MHWRender</a>;</div>
<div class="line"></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state.html">MBlendState</a>* blendState = NULL;</div>
<div class="line">        <span class="keywordflow">if</span> (!blendState) {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state_desc.html">MBlendStateDesc</a> desc;</div>
<div class="line">            blendState = stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#aeb560f7829270f34ab413ad314314c8f">acquireBlendState</a>(desc);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a27dbc083002d85108ed30ee1131f68c1">setBlendState</a>(blendState);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html">MRasterizerState</a>* rasterizerState = NULL;</div>
<div class="line">        <span class="keywordflow">if</span> (!rasterizerState) {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state_desc.html">MRasterizerStateDesc</a> desc;</div>
<div class="line">            rasterizerState = stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a1f43e6ab99a6e2e5817df7bb1a0c69e6">acquireRasterizerState</a>(desc);</div>
<div class="line">        }</div>
<div class="line">        stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a7dfb1c4f28575ed6581aa40a7b64f22a">setRasterizerState</a>(rasterizerState);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_depth_stencil_state.html">MDepthStencilState</a>* depthState = NULL;</div>
<div class="line">        <span class="keywordflow">if</span> (!depthState) {</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_depth_stencil_state_desc.html">MDepthStencilStateDesc</a> desc;</div>
<div class="line">            depthState = stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a4fae5c76bc6698abb77b9ffec01bc21a">acquireDepthStencilState</a>(desc);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a5a6b8e76300df4a0c9f6a38b236118f7">setDepthStencilState</a>(depthState);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"><span class="comment">// LOCAL CLASSES</span></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"><span class="comment">// CLASS TopLevelCullVisitor</span></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>TopLevelCullVisitor : <span class="keyword">public</span> SubNodeVisitor</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">    TopLevelCullVisitor(<span class="keyword">const</span> Frustum&amp; frustrum, <span class="keywordtype">double</span> seconds)</div>
<div class="line">        : fFrustum(frustrum),</div>
<div class="line">          fSeconds(seconds),</div>
<div class="line">          fIsCulled(<span class="keyword">true</span>)</div>
<div class="line">    {}</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> isCulled()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> fIsCulled; }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> visit(<span class="keyword">const</span> XformData&amp;   xform,</div>
<div class="line">                       <span class="keyword">const</span> SubNode&amp;     subNode)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keyword">const</span> std::shared_ptr&lt;const XformSample&gt;&amp; sample =</div>
<div class="line">            xform.getSample(fSeconds);</div>
<div class="line">        <span class="keywordflow">if</span> (!sample) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">        fIsCulled =</div>
<div class="line">            fFrustum.test(sample-&gt;boundingBox()) == Frustum::kOutside;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> visit(<span class="keyword">const</span> ShapeData&amp;   shape,</div>
<div class="line">                       <span class="keyword">const</span> SubNode&amp;     subNode)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keyword">const</span> std::shared_ptr&lt;const ShapeSample&gt;&amp; sample =</div>
<div class="line">            shape.getSample(fSeconds);</div>
<div class="line">        <span class="keywordflow">if</span> (!sample) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">        fIsCulled =</div>
<div class="line">            fFrustum.test(sample-&gt;boundingBox()) == Frustum::kOutside;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> Frustum&amp;  fFrustum;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>    fSeconds;</div>
<div class="line">    <span class="keywordtype">bool</span>            fIsCulled;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"><span class="comment">// CLASS DrawShadedTraversal</span></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>DrawShadedState : <span class="keyword">public</span> DrawTraversalState</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    DrawShadedState(</div>
<div class="line">        <span class="keyword">const</span> Frustum&amp;                          frustrum,</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>                            seconds,</div>
<div class="line">        <span class="keyword">const</span> TransparentPruneType              transparentPrune,</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html">MHWRender::MStateManager</a>*               stateMgr,</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html#a9602dcbc7b9991767e322a6f55541e8a">MHWRender::MRasterizerState::CullMode</a>   cullMode,</div>
<div class="line">        <span class="keyword">const</span> DepthOffsetType                   depthOffsetType,</div>
<div class="line">        <span class="keyword">const</span> ColorType                         colorType,</div>
<div class="line">        <span class="keyword">const</span> <a name="_a22"></a><a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a>&amp;                           defaultDiffuseColor,</div>
<div class="line">        <span class="keyword">const</span> NormalsType                       normalsType)</div>
<div class="line">        : DrawTraversalState(frustrum, seconds, transparentPrune),</div>
<div class="line">          fStateMgr(stateMgr),</div>
<div class="line">          fCullMode(cullMode),</div>
<div class="line">          fDepthOffsetType(depthOffsetType),</div>
<div class="line">          fColorType(colorType),</div>
<div class="line">          fDefaultDiffuseColor(defaultDiffuseColor),</div>
<div class="line">          fNormalsType(normalsType)</div>
<div class="line">    {}</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html">MHWRender::MStateManager</a>* stateManager()<span class="keyword"> const         </span>{ <span class="keywordflow">return</span> fStateMgr; }</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html#a9602dcbc7b9991767e322a6f55541e8a">MHWRender::MRasterizerState::CullMode</a> cullMode()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> fCullMode; }</div>
<div class="line"></div>
<div class="line">    DepthOffsetType depthOffsetType()<span class="keyword"> const     </span>{ <span class="keywordflow">return</span> fDepthOffsetType; }</div>
<div class="line">    ColorType       colorType()<span class="keyword"> const           </span>{ <span class="keywordflow">return</span> fColorType; }</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a>&amp;   defaultDiffuseColor()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> fDefaultDiffuseColor; }</div>
<div class="line">    NormalsType     normalsType()<span class="keyword"> const         </span>{ <span class="keywordflow">return</span> fNormalsType; }</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html">MHWRender::MStateManager</a>* <span class="keyword">const</span>         fStateMgr;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html#a9602dcbc7b9991767e322a6f55541e8a">MHWRender::MRasterizerState::CullMode</a>   fCullMode;</div>
<div class="line">    <span class="keyword">const</span> DepthOffsetType                   fDepthOffsetType;</div>
<div class="line">    <span class="keyword">const</span> ColorType                         fColorType;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a>                            fDefaultDiffuseColor;</div>
<div class="line">    <span class="keyword">const</span> NormalsType                       fNormalsType;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>DrawShadedTraversal</div>
<div class="line">    : <span class="keyword">public</span> DrawTraversal&lt;DrawShadedTraversal, DrawShadedState&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">    <span class="keyword">typedef</span> DrawTraversal&lt;DrawShadedTraversal, DrawShadedState&gt; BaseClass;</div>
<div class="line"></div>
<div class="line">    DrawShadedTraversal(</div>
<div class="line">        DrawShadedState&amp;        state,</div>
<div class="line">        <span class="keyword">const</span> <a name="_a23"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a>&amp;          xform,</div>
<div class="line">        <span class="keywordtype">bool</span>                    isReflection,</div>
<div class="line">        Frustum::ClippingResult parentClippingResult)</div>
<div class="line">        : BaseClass(state, xform, isReflection, parentClippingResult)</div>
<div class="line">    {}</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> draw(<span class="keyword">const</span> std::shared_ptr&lt;const ShapeSample&gt;&amp; sample)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!sample-&gt;visibility()) <span class="keywordflow">return</span>;</div>
<div class="line">        gGLFT-&gt;glLoadMatrixd(xform().matrix[0]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (sample-&gt;isBoundingBoxPlaceHolder()) {</div>
<div class="line">            state().vboProxy().drawBoundingBox(sample, <span class="keyword">true</span>);</div>
<div class="line">            GlobalReaderCache::theCache().hintShapeReadOrder(subNode());</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        assert(sample-&gt;positions());</div>
<div class="line">        assert(sample-&gt;normals());</div>
<div class="line"></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a> diffuseColor;</div>
<div class="line">        <span class="keywordflow">switch</span> (state().colorType()) {</div>
<div class="line">        <span class="keywordflow">case</span> kSubNodeColor:</div>
<div class="line">            diffuseColor = sample-&gt;diffuseColor();</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> kDefaultColor:</div>
<div class="line">            <span class="comment">// Use default material</span></div>
<div class="line">            diffuseColor = state().defaultDiffuseColor();</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> kBlackColor:</div>
<div class="line">            <span class="comment">// No light -&gt; draw black!</span></div>
<div class="line">            diffuseColor = <a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a>(0.0f, 0.0f, 0.0f, sample-&gt;diffuseColor()[3]);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> kXrayColor:</div>
<div class="line">            <span class="comment">// X-Ray mode -&gt; alpha *= 0.3f (extraOpacity)</span></div>
<div class="line">            diffuseColor = <a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a>(sample-&gt;diffuseColor()[0],</div>
<div class="line">                                  sample-&gt;diffuseColor()[1],</div>
<div class="line">                                  sample-&gt;diffuseColor()[2],</div>
<div class="line">                                  sample-&gt;diffuseColor()[3] * 0.3f);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> kXrayBlackColor:</div>
<div class="line">            <span class="comment">// X-ray mode + No light</span></div>
<div class="line">            diffuseColor = <a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a>(0.0f, 0.0f, 0.0f, sample-&gt;diffuseColor()[3] * 0.3f);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            assert(0);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (diffuseColor[3] &lt;= 0.0 ||</div>
<div class="line">            (diffuseColor[3] &gt;= 1.0 &amp;&amp;</div>
<div class="line">                state().transparentPrune() == DrawShadedState::kPruneOpaque) ||</div>
<div class="line">            (diffuseColor[3] &lt;  1.0 &amp;&amp;</div>
<div class="line">                state().transparentPrune() == DrawShadedState::kPruneTransparent)) {</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// set colour</span></div>
<div class="line">        gGLFT-&gt;glColor4f(diffuseColor[0]*diffuseColor[3],</div>
<div class="line">                         diffuseColor[1]*diffuseColor[3],</div>
<div class="line">                         diffuseColor[2]*diffuseColor[3],</div>
<div class="line">                         diffuseColor[3]);</div>
<div class="line"></div>
<div class="line">        setShadedRasterState(state().stateManager(),</div>
<div class="line">                             state().cullMode(),</div>
<div class="line">                             state().depthOffsetType(),</div>
<div class="line">                             isReflection() ?</div>
<div class="line">                             kFrontClockwise : kFrontCounterClockwise);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Draw the triangle mesh for all components.</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> groupId = 0; groupId &lt; sample-&gt;numIndexGroups(); ++groupId ) {</div>
<div class="line">            state().vboProxy().drawTriangles(</div>
<div class="line">                sample, groupId,</div>
<div class="line">                state().normalsType() == kFrontNormals ?</div>
<div class="line">                VBOProxy::kFrontNormals : VBOProxy::kBackNormals,</div>
<div class="line">                VBOProxy::kNoUVs);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"><span class="comment">// CLASS DrawWireframeTraversal</span></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>DrawWireframeState : <span class="keyword">public</span> DrawTraversalState</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    DrawWireframeState(</div>
<div class="line">        <span class="keyword">const</span> Frustum&amp;  frustrum,</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span>    seconds)</div>
<div class="line">        : DrawTraversalState(frustrum, seconds, kPruneNone)</div>
<div class="line">    {}</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>DrawWireframeTraversal</div>
<div class="line">    : <span class="keyword">public</span> DrawTraversal&lt;DrawWireframeTraversal, DrawWireframeState&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">    <span class="keyword">typedef</span> DrawTraversal&lt;DrawWireframeTraversal, DrawWireframeState&gt; BaseClass;</div>
<div class="line"></div>
<div class="line">    DrawWireframeTraversal(</div>
<div class="line">        DrawWireframeState&amp;     state,</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a>&amp;          xform,</div>
<div class="line">        <span class="keywordtype">bool</span>                    isReflection,</div>
<div class="line">        Frustum::ClippingResult parentClippingResult)</div>
<div class="line">        : BaseClass(state, xform, isReflection, parentClippingResult)</div>
<div class="line">    {}</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> draw(<span class="keyword">const</span> std::shared_ptr&lt;const ShapeSample&gt;&amp; sample)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (!sample-&gt;visibility()) <span class="keywordflow">return</span>;</div>
<div class="line">        gGLFT-&gt;glLoadMatrixd(xform().matrix[0]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (sample-&gt;isBoundingBoxPlaceHolder()) {</div>
<div class="line">            state().vboProxy().drawBoundingBox(sample);</div>
<div class="line">            GlobalReaderCache::theCache().hintShapeReadOrder(subNode());</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        assert(sample-&gt;positions());</div>
<div class="line">        assert(sample-&gt;normals());</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        state().vboProxy().drawWireframe(sample);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>GPUCache {</div>
<div class="line"></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"><span class="comment">// CLASS DrawOverride::UserData</span></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>DrawOverride::UserData : <span class="keyword">public</span> <a name="_a24"></a><a class="code" href="#!/url=./cpp_ref/class_m_user_data.html">MUserData</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">/*----- member functions -----*/</span></div>
<div class="line">    UserData(<span class="keyword">const</span> ShapeNode* node)</div>
<div class="line">        : fShapeNode(node)</div>
<div class="line">    {}</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> set(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; seconds,</div>
<div class="line">             <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a>&amp; wireframeColor,</div>
<div class="line">             <span class="keywordtype">bool</span>          isSelected)</div>
<div class="line">    {</div>
<div class="line">        fSeconds = seconds;</div>
<div class="line"></div>
<div class="line">        fWireframeColor[0] = wireframeColor[0];</div>
<div class="line">        fWireframeColor[1] = wireframeColor[1];</div>
<div class="line">        fWireframeColor[2] = wireframeColor[2];</div>
<div class="line"></div>
<div class="line">        fIsSelected = isSelected;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// This is used for both rendering and selection. When it&#39;s called for rendering, selectInfo </span></div>
<div class="line">    <span class="comment">// is expected to be nullptr. When it&#39;s called for selection, selectionInfo must be a valid pointer.</span></div>
<div class="line">    <span class="keywordtype">void</span> draw(<span class="keyword">const</span> <a name="_a25"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a>&amp; context, <span class="keyword">const</span> <a name="_a26"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_selection_info.html">MHWRender::MSelectionInfo</a>* selectInfo) <span class="keyword">const</span>;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*----- member functions -----*/</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> drawShadedSampleGL(</div>
<div class="line">        <span class="keyword">const</span> Frustum&amp;                              frustum,</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html">MHWRender::MStateManager</a>*                   stateMgr,</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html#a9602dcbc7b9991767e322a6f55541e8a">MHWRender::MRasterizerState::CullMode</a>       cullMode,</div>
<div class="line">        <span class="keyword">const</span> DepthOffsetType                       depthOffsetType,</div>
<div class="line">        <span class="keyword">const</span> ColorType                             colorType,</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a>&amp;                               defaultDiffuseColor,</div>
<div class="line">        <span class="keyword">const</span> NormalsType                           normalsType,</div>
<div class="line">        <span class="keyword">const</span> DrawShadedState::TransparentPruneType transparentPrune,</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a>&amp;                              xform,</div>
<div class="line">        <span class="keyword">const</span> SubNode::Ptr&amp;                         rootNode) <span class="keyword">const</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> drawWireframeSampleGL(<span class="keyword">const</span> Frustum&amp;  frustum,</div>
<div class="line">                               <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a>&amp;  xform,</div>
<div class="line">                               <span class="keyword">const</span> SubNode::Ptr&amp; rootNode) <span class="keyword">const</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> drawBoundingBoxSampleGL(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a>&amp;      xform,</div>
<div class="line">                                 <span class="keyword">const</span> SubNode::Ptr&amp; rootNode) <span class="keyword">const</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Returns true if any lights exists and false otherwise.</span></div>
<div class="line">    <span class="keywordtype">bool</span> setupLightingGL(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a>&amp; context) <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">void</span> unsetLightingGL(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a>&amp; context) <span class="keyword">const</span>;</div>
<div class="line"></div>
<div class="line">    ~UserData()<span class="keyword"> override    </span>{}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">/*----- data members -----*/</span></div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> ShapeNode* fShapeNode = <span class="keyword">nullptr</span>;</div>
<div class="line">    <span class="keywordtype">double</span>           fSeconds{0.0};</div>
<div class="line">    GLfloat          fWireframeColor[3] = {1.f, 1.f, 1.f};</div>
<div class="line">    <span class="keywordtype">bool</span>             fIsSelected{<span class="keyword">false</span>};</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> DrawOverride::UserData::drawShadedSampleGL(</div>
<div class="line">    <span class="keyword">const</span> Frustum&amp;                              frustum,</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html">MHWRender::MStateManager</a>*                   stateMgr,</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html#a9602dcbc7b9991767e322a6f55541e8a">MHWRender::MRasterizerState::CullMode</a>       cullMode,</div>
<div class="line">    <span class="keyword">const</span> DepthOffsetType                       depthOffsetType,</div>
<div class="line">    <span class="keyword">const</span> ColorType                             colorType,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a>&amp;                               defaultDiffuseColor,</div>
<div class="line">    <span class="keyword">const</span> NormalsType                           normalsType,</div>
<div class="line">    <span class="keyword">const</span> DrawShadedState::TransparentPruneType transparentPrune,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a>&amp;                              xform,</div>
<div class="line">    <span class="keyword">const</span> SubNode::Ptr&amp;                         rootNode)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    DrawShadedState state(</div>
<div class="line">        frustum, fSeconds, transparentPrune, stateMgr,</div>
<div class="line">        cullMode, depthOffsetType, colorType,</div>
<div class="line">        defaultDiffuseColor, normalsType);</div>
<div class="line"></div>
<div class="line">    DrawShadedTraversal visitor(</div>
<div class="line">        state, xform, xform.<a name="a27"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix.html#adcbd22bb9bbae2691f231c12c4c8cca1">det3x3</a>() &lt; 0.0, Frustum::kUnknown);</div>
<div class="line"></div>
<div class="line">    rootNode-&gt;accept(visitor);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> DrawOverride::UserData::drawWireframeSampleGL(</div>
<div class="line">    <span class="keyword">const</span> Frustum&amp;  frustum,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a>&amp;  xform,</div>
<div class="line">    <span class="keyword">const</span> SubNode::Ptr&amp; rootNode)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    DrawWireframeState state(frustum, fSeconds);</div>
<div class="line">    DrawWireframeTraversal visitor(state, xform, <span class="keyword">false</span>, Frustum::kUnknown);</div>
<div class="line">    rootNode-&gt;accept(visitor);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> DrawOverride::UserData::drawBoundingBoxSampleGL(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a>&amp;      xform,</div>
<div class="line">    <span class="keyword">const</span> SubNode::Ptr&amp; rootNode)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// Get the bounding box.</span></div>
<div class="line">    <a name="_a28"></a><a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html">MBoundingBox</a> boundingBox;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> SubNodeData::Ptr subNodeData = rootNode-&gt;getData();</div>
<div class="line">    <span class="keywordflow">if</span> (!subNodeData) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> XformData::Ptr xformData =</div>
<div class="line">        std::dynamic_pointer_cast&lt;<span class="keyword">const</span> XformData&gt;(subNodeData);</div>
<div class="line">    <span class="keywordflow">if</span> (xformData) {</div>
<div class="line">        <span class="keyword">const</span> std::shared_ptr&lt;const XformSample&gt;&amp; sample =</div>
<div class="line">            xformData-&gt;getSample(fSeconds);</div>
<div class="line">        <span class="keywordflow">if</span> (!sample || !sample-&gt;visibility()) <span class="keywordflow">return</span>;</div>
<div class="line">        boundingBox = sample-&gt;boundingBox();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keyword">const</span> ShapeData::Ptr shapeData =</div>
<div class="line">            std::dynamic_pointer_cast&lt;<span class="keyword">const</span> ShapeData&gt;(subNodeData);</div>
<div class="line">        <span class="keywordflow">if</span> (shapeData) {</div>
<div class="line">            <span class="keyword">const</span> std::shared_ptr&lt;const ShapeSample&gt;&amp; sample =</div>
<div class="line">                shapeData-&gt;getSample(fSeconds);</div>
<div class="line">            <span class="keywordflow">if</span> (!sample || !sample-&gt;visibility()) <span class="keywordflow">return</span>;</div>
<div class="line">            boundingBox = sample-&gt;boundingBox();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Draw the bounding box.</span></div>
<div class="line">    gGLFT-&gt;glLoadMatrixd(xform.<a name="a29"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34">matrix</a>[0]);</div>
<div class="line"></div>
<div class="line">    VBOProxy vboProxy;</div>
<div class="line">    vboProxy.drawBoundingBox(boundingBox);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">bool</span> DrawOverride::UserData::setupLightingGL(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a>&amp; context)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <a name="_a30"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Take into account only the 8 lights supported by the basic</span></div>
<div class="line">    <span class="comment">// OpenGL profile.</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nbLights =</div>
<div class="line">        std::min(context.<a name="a31"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a245ec3740263f7f3c076dd9c723141b7">numberOfActiveLights</a>(MDrawContext::LightFilter::kFilteredToLightLimit, &amp;status), 8u);</div>
<div class="line">    <span class="keywordflow">if</span> (status != <a name="a32"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MStatus::kSuccess</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (nbLights &gt; 0) {</div>
<div class="line">        <span class="comment">// Lights are specified in world space and needs to be</span></div>
<div class="line">        <span class="comment">// converted to view space.</span></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> worldToView =</div>
<div class="line">            context.<a name="a33"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a5359807d83c248df630615c60f896a51">getMatrix</a>(<a name="a34"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#acc6ad8472c2abfd2f63e100474b977f9a1628397f32d381a2b05a9902af452c8a">MHWRender::MFrameContext::kViewMtx</a>, &amp;status);</div>
<div class="line">        <span class="keywordflow">if</span> (status != <a class="code" href="#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MStatus::kSuccess</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        gGLFT-&gt;glLoadMatrixd(worldToView.<a class="code" href="#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34">matrix</a>[0]);</div>
<div class="line"></div>
<div class="line">        gGLFT-&gt;glEnable(MGL_LIGHTING);</div>
<div class="line">        gGLFT-&gt;glColorMaterial(MGL_FRONT_AND_BACK, MGL_AMBIENT_AND_DIFFUSE);</div>
<div class="line">        gGLFT-&gt;glEnable(MGL_COLOR_MATERIAL) ;</div>
<div class="line">        gGLFT-&gt;glEnable(MGL_NORMALIZE) ;</div>
<div class="line"></div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> MGLfloat ambient[4]  = { 0.0f, 0.0f, 0.0f, 1.0f };</div>
<div class="line">            <span class="keyword">const</span> MGLfloat specular[4] = { 0.0f, 0.0f, 0.0f, 1.0f };</div>
<div class="line"></div>
<div class="line">            gGLFT-&gt;glMaterialfv(MGL_FRONT_AND_BACK, MGL_AMBIENT,  ambient);</div>
<div class="line">            gGLFT-&gt;glMaterialfv(MGL_FRONT_AND_BACK, MGL_SPECULAR, specular);</div>
<div class="line"></div>
<div class="line">            gGLFT-&gt;glLightModelfv(MGL_LIGHT_MODEL_AMBIENT, ambient);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Two sided-lighting seems is always enabled in VP2.0.</span></div>
<div class="line">            <span class="keywordflow">if</span> (Config::emulateTwoSidedLighting()) {</div>
<div class="line">                gGLFT-&gt;glLightModeli(MGL_LIGHT_MODEL_TWO_SIDE, 0);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> {</div>
<div class="line">                gGLFT-&gt;glLightModeli(MGL_LIGHT_MODEL_TWO_SIDE, 1);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nbLights; ++i) {</div>
<div class="line">            <a name="_a35"></a><a class="code" href="#!/url=./cpp_ref/class_m_float_point_array.html">MFloatPointArray</a> positions;</div>
<div class="line">            <a name="_a36"></a><a class="code" href="#!/url=./cpp_ref/class_m_float_vector.html">MFloatVector</a> direction;</div>
<div class="line">            <span class="keywordtype">float</span> intensity;</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a> color;</div>
<div class="line">            <span class="keywordtype">bool</span> hasDirection;</div>
<div class="line">            <span class="keywordtype">bool</span> hasPosition;</div>
<div class="line">            status = context.<a name="a37"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#ad76985f8ee279b7ffd948dc492a748a3">getLightInformation</a>(</div>
<div class="line">                i, positions, direction, intensity, color,</div>
<div class="line">                hasDirection, hasPosition);</div>
<div class="line">            <span class="keywordflow">if</span> (status != <a class="code" href="#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MStatus::kSuccess</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// if (hasPosition)</span></div>
<div class="line">            <span class="comment">//     fprintf(stderr, &quot;   -&gt; Light%d position  = (%lf, %lf, %lf, %lf)\n&quot;,</span></div>
<div class="line">            <span class="comment">//             i, position[0], position[1], position[2], position[3]);</span></div>
<div class="line">            <span class="comment">// if (hasDirection)</span></div>
<div class="line">            <span class="comment">//     fprintf(stderr, &quot;   -&gt; Light%d direction = (%lf, %lf, %lf) - %lf\n&quot;,</span></div>
<div class="line">            <span class="comment">//             i, direction[0], direction[1], direction[2], direction.length());</span></div>
<div class="line">            <span class="comment">// fprintf(stderr, &quot;   -&gt; Light%d color = %lf x (%lf, %lf, %lf, %lf)\n&quot;,</span></div>
<div class="line">            <span class="comment">//         i, intensity, color[0], color[1], color[2], color[3]);</span></div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (hasDirection) {</div>
<div class="line">                <span class="keywordflow">if</span> (hasPosition) {</div>
<div class="line">                    <span class="comment">// Assumes a Maya Spot Light!</span></div>
<div class="line">                    <a name="_a38"></a><a class="code" href="#!/url=./cpp_ref/class_m_float_point.html">MFloatPoint</a> position;</div>
<div class="line">                    position[0] = positions[0][0];</div>
<div class="line">                    position[1] = positions[0][1];</div>
<div class="line">                    position[2] = positions[0][2];</div>
<div class="line">                    <span class="keyword">const</span> MGLfloat ambient[4] = { 0.0f, 0.0f, 0.0f, 1.0f };</div>
<div class="line">                    <span class="keyword">const</span> MGLfloat diffuse[4] = { intensity * color[0],</div>
<div class="line">                                                  intensity * color[1],</div>
<div class="line">                                                  intensity * color[2],</div>
<div class="line">                                                  1.0f };</div>
<div class="line">                    <span class="keyword">const</span> MGLfloat pos[4] = { position[0],</div>
<div class="line">                                              position[1],</div>
<div class="line">                                              position[2],</div>
<div class="line">                                              1.0f };</div>
<div class="line">                    <span class="keyword">const</span> MGLfloat dir[3] = { direction[0],</div>
<div class="line">                                              direction[1],</div>
<div class="line">                                              direction[2]};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">                    gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_AMBIENT,  ambient);</div>
<div class="line">                    gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_DIFFUSE,  diffuse);</div>
<div class="line">                    gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_POSITION, pos);</div>
<div class="line">                    gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_SPOT_DIRECTION, dir);</div>
<div class="line"></div>
<div class="line">                    <span class="comment">// Maya&#39;s default value&#39;s for spot lights.</span></div>
<div class="line">                    gGLFT-&gt;glLightf(MGL_LIGHT0+i,  MGL_SPOT_EXPONENT, 0.0);</div>
<div class="line">                    gGLFT-&gt;glLightf(MGL_LIGHT0+i,  MGL_SPOT_CUTOFF,  20.0);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">// Assumes a Maya Directional Light!</span></div>
<div class="line">                    <span class="keyword">const</span> MGLfloat ambient[4] = { 0.0f, 0.0f, 0.0f, 1.0f };</div>
<div class="line">                    <span class="keyword">const</span> MGLfloat diffuse[4] = { intensity * color[0],</div>
<div class="line">                                                  intensity * color[1],</div>
<div class="line">                                                  intensity * color[2],</div>
<div class="line">                                                  1.0f };</div>
<div class="line">                    <span class="keyword">const</span> MGLfloat pos[4] = { -direction[0],</div>
<div class="line">                                              -direction[1],</div>
<div class="line">                                              -direction[2],</div>
<div class="line">                                              0.0f };</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">                    gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_AMBIENT,  ambient);</div>
<div class="line">                    gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_DIFFUSE,  diffuse);</div>
<div class="line">                    gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_POSITION, pos);</div>
<div class="line">                    gGLFT-&gt;glLightf(MGL_LIGHT0+i, MGL_SPOT_CUTOFF, 180.0);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hasPosition) {</div>
<div class="line">                <span class="comment">// Assumes a Maya Point Light!</span></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_float_point.html">MFloatPoint</a> position;</div>
<div class="line">                position[0] = positions[0][0];</div>
<div class="line">                position[1] = positions[0][1];</div>
<div class="line">                position[2] = positions[0][2];</div>
<div class="line">                <span class="keyword">const</span> MGLfloat ambient[4] = { 0.0f, 0.0f, 0.0f, 1.0f };</div>
<div class="line">                <span class="keyword">const</span> MGLfloat diffuse[4] = { intensity * color[0],</div>
<div class="line">                                              intensity * color[1],</div>
<div class="line">                                              intensity * color[2],</div>
<div class="line">                                              1.0f };</div>
<div class="line">                <span class="keyword">const</span> MGLfloat pos[4] = { position[0],</div>
<div class="line">                                          position[1],</div>
<div class="line">                                          position[2],</div>
<div class="line">                                          1.0f };</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">                gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_AMBIENT,  ambient);</div>
<div class="line">                gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_DIFFUSE,  diffuse);</div>
<div class="line">                gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_POSITION, pos);</div>
<div class="line">                gGLFT-&gt;glLightf(MGL_LIGHT0+i, MGL_SPOT_CUTOFF, 180.0);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="comment">// Assumes a Maya Ambient Light!</span></div>
<div class="line">                <span class="keyword">const</span> MGLfloat ambient[4] = { intensity * color[0],</div>
<div class="line">                                              intensity * color[1],</div>
<div class="line">                                              intensity * color[2],</div>
<div class="line">                                              1.0f };</div>
<div class="line">                <span class="keyword">const</span> MGLfloat diffuse[4] = { 0.0f, 0.0f, 0.0f, 1.0f };</div>
<div class="line">                <span class="keyword">const</span> MGLfloat pos[4] = { 0.0f, 0.0f, 0.0f, 1.0f };</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">                gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_AMBIENT,  ambient);</div>
<div class="line">                gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_DIFFUSE,  diffuse);</div>
<div class="line">                gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_POSITION, pos);</div>
<div class="line">                gGLFT-&gt;glLightf(MGL_LIGHT0+i, MGL_SPOT_CUTOFF, 180.0);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            gGLFT-&gt;glEnable(MGL_LIGHT0+i);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> nbLights &gt; 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> DrawOverride::UserData::unsetLightingGL(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a>&amp; context)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Take into account only the 8 lights supported by the basic</span></div>
<div class="line">    <span class="comment">// OpenGL profile.</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nbLights =</div>
<div class="line">        std::min(context.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a245ec3740263f7f3c076dd9c723141b7">numberOfActiveLights</a>(MDrawContext::LightFilter::kFilteredToLightLimit, &amp;status), 8u);</div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MStatus::kSuccess</a>) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Restore OpenGL default values for anything that we have</span></div>
<div class="line">    <span class="comment">// modified.</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (nbLights &gt; 0) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nbLights; ++i) {</div>
<div class="line">            gGLFT-&gt;glDisable(MGL_LIGHT0+i);</div>
<div class="line"></div>
<div class="line">            <span class="keyword">const</span> MGLfloat ambient[4] = { 0.0f, 0.0f, 0.0f, 1.0f };</div>
<div class="line">            gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_AMBIENT,  ambient);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (i==0) {</div>
<div class="line">                <span class="keyword">const</span> MGLfloat diffuse[4] = { 1.0f, 1.0f, 1.0f, 1.0f };</div>
<div class="line">                gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_DIFFUSE,  diffuse);</div>
<div class="line"></div>
<div class="line">                <span class="keyword">const</span> MGLfloat spec[4]    = { 1.0f, 1.0f, 1.0f, 1.0f };</div>
<div class="line">                gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_SPECULAR, spec);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keyword">const</span> MGLfloat diffuse[4] = { 0.0f, 0.0f, 0.0f, 1.0f };</div>
<div class="line">                gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_DIFFUSE,  diffuse);</div>
<div class="line"></div>
<div class="line">                <span class="keyword">const</span> MGLfloat spec[4]    = { 0.0f, 0.0f, 0.0f, 1.0f };</div>
<div class="line">                gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_SPECULAR, spec);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keyword">const</span> MGLfloat pos[4]     = { 0.0f, 0.0f, 1.0f, 0.0f };</div>
<div class="line">            gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_POSITION, pos);</div>
<div class="line"></div>
<div class="line">            <span class="keyword">const</span> MGLfloat dir[3]     = { 0.0f, 0.0f, -1.0f };</div>
<div class="line">            gGLFT-&gt;glLightfv(MGL_LIGHT0+i, MGL_SPOT_DIRECTION, dir);</div>
<div class="line"></div>
<div class="line">            gGLFT-&gt;glLightf(MGL_LIGHT0+i,  MGL_SPOT_EXPONENT,  0.0);</div>
<div class="line">            gGLFT-&gt;glLightf(MGL_LIGHT0+i,  MGL_SPOT_CUTOFF,  180.0);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        gGLFT-&gt;glDisable(MGL_LIGHTING);</div>
<div class="line">        gGLFT-&gt;glDisable(MGL_COLOR_MATERIAL) ;</div>
<div class="line">        gGLFT-&gt;glDisable(MGL_NORMALIZE) ;</div>
<div class="line"></div>
<div class="line">        <span class="keyword">const</span> MGLfloat ambient[4]  = { 0.2f, 0.2f, 0.2f, 1.0f };</div>
<div class="line">        <span class="keyword">const</span> MGLfloat specular[4] = { 0.8f, 0.8f, 0.8f, 1.0f };</div>
<div class="line"></div>
<div class="line">        gGLFT-&gt;glMaterialfv(MGL_FRONT_AND_BACK, MGL_AMBIENT,  ambient);</div>
<div class="line">        gGLFT-&gt;glMaterialfv(MGL_FRONT_AND_BACK, MGL_SPECULAR, specular);</div>
<div class="line"></div>
<div class="line">        gGLFT-&gt;glLightModelfv(MGL_LIGHT_MODEL_AMBIENT, ambient);</div>
<div class="line">        gGLFT-&gt;glLightModeli(MGL_LIGHT_MODEL_TWO_SIDE, 0);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> DrawOverride::UserData::draw(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a>&amp; context,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_selection_info.html">MHWRender::MSelectionInfo</a>* selectInfo)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="#!/url=./cpp_ref/namespace_m_h_w_render.html">MHWRender</a>;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Extract the cached geometry.</span></div>
<div class="line">    <span class="keyword">const</span> SubNode::Ptr&amp; rootNode =</div>
<div class="line">        fShapeNode-&gt;getCachedGeometry();</div>
<div class="line">    <span class="keywordflow">if</span> (!rootNode) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// get renderer</span></div>
<div class="line">    <a name="_a39"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html">MRenderer</a>* theRenderer = MRenderer::theRenderer();</div>
<div class="line">    <span class="keywordflow">if</span> (!theRenderer) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html">MStateManager</a>* stateMgr = context.<a name="a40"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a9eed5300933693e76ad77822b4feb37f">getStateManager</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (!stateMgr) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> displayStyle = context.<a name="a41"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#acd5ce60bbd3d03181b1ad681023ff44d">getDisplayStyle</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (displayStyle == 0) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Sample code to debug pass information</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> debugPassInformation = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (debugPassInformation)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a name="_a42"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html">MHWRender::MPassContext</a> &amp; passCtx = context.<a name="a43"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#ad3f9422688a9ffbe815c374ece46c1ea">getPassContext</a>();</div>
<div class="line">        <span class="keyword">const</span> <a name="_a44"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> &amp; passId = passCtx.<a name="a45"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html#ae90d4b4c8175e81800d8eb16ee126e1f">passIdentifier</a>();</div>
<div class="line">        <span class="keyword">const</span> <a name="_a46"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> &amp; passSem = passCtx.<a name="a47"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_pass_context.html#a9737189d5cfffd795336d711a678d627">passSemantics</a>();</div>
<div class="line">        printf(<span class="stringliteral">&quot;gpuCache override in pass[%s], semantic[&quot;</span>, passId.<a name="a48"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a>());</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;passSem.<a name="a49"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); i++)</div>
<div class="line">            printf(<span class="stringliteral">&quot; %s&quot;</span>, passSem[i].asChar());</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (displayStyle &amp; MFrameContext::kXray) {</div>
<div class="line">        <span class="comment">// Viewport 2.0 will call draw() twice when drawing transparent objects</span></div>
<div class="line">        <span class="comment">// (X-Ray mode). We skip the first draw() call.</span></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html">MRasterizerState</a>* rasterState = stateMgr-&gt;<a name="a50"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a381d58fef9908f00a0e04bcf38b67838">getRasterizerState</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (rasterState &amp;&amp; rasterState-&gt;<a name="a51"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html#a40659f03655c48c6f0060634b295067d">desc</a>().<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state_desc.html#a5a9f0fe3d49830803b7a25440b2d19a6">cullMode</a> == MRasterizerState::kCullFront) {</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// View frustum culling.</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> worldViewProjInvMatrix =</div>
<div class="line">        context.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a5359807d83c248df630615c60f896a51">getMatrix</a>(MFrameContext::kWorldViewProjInverseMtx, &amp;status);</div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MStatus::kSuccess</a>) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    Frustum frustum( worldViewProjInvMatrix);</div>
<div class="line">    {</div>
<div class="line">        TopLevelCullVisitor visitor(frustum, fSeconds);</div>
<div class="line">        rootNode-&gt;accept(visitor);</div>
<div class="line">        <span class="keywordflow">if</span> (visitor.isCulled()) <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// get state data</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> xform =</div>
<div class="line">        context.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a5359807d83c248df630615c60f896a51">getMatrix</a>(MFrameContext::kWorldViewMtx, &amp;status);</div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MStatus::kSuccess</a>) <span class="keywordflow">return</span>;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> projection =</div>
<div class="line">        context.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a5359807d83c248df630615c60f896a51">getMatrix</a>(MFrameContext::kProjectionMtx, &amp;status);</div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MStatus::kSuccess</a>) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Compute a pick matrix that, when it is post-multiplied with the</span></div>
<div class="line">    <span class="comment">// projection matrix, will cause the picking region to fill the entire</span></div>
<div class="line">    <span class="comment">// viewport for OpenGL selection mode.</span></div>
<div class="line">    <span class="keywordflow">if</span> (selectInfo)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> view_x, view_y, view_w, view_h;</div>
<div class="line">        context.<a name="a52"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html#a833da0fac707065e2b987ff38b7b7312">getViewportDimensions</a>(view_x, view_y, view_w, view_h);</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sel_x, sel_y, sel_w, sel_h;</div>
<div class="line">        selectInfo-&gt;<a name="a53"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_selection_info.html#a2e00d4919c72b22e16478dfd986684b2">selectRect</a>(sel_x, sel_y, sel_w, sel_h);</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">double</span> center_x = sel_x + sel_w * 0.5;</div>
<div class="line">        <span class="keywordtype">double</span> center_y = sel_y + sel_h * 0.5;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> pickMatrix;</div>
<div class="line">        pickMatrix[0][0] = view_w / double(sel_w);</div>
<div class="line">        pickMatrix[1][1] = view_h / double(sel_h);</div>
<div class="line">        pickMatrix[3][0] = (view_w - 2.0 * (center_x - view_x)) / double(sel_w);</div>
<div class="line">        pickMatrix[3][1] = (view_h - 2.0 * (center_y - view_y)) / double(sel_h);</div>
<div class="line"></div>
<div class="line">        projection *= pickMatrix;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Save the current gfx state so that we can restore it later on!</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_blend_state.html">MBlendState</a>* savedBlendState           = stateMgr-&gt;<a name="a54"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a4dbf5ff33e99eba611b73273d868182f">getBlendState</a>();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_rasterizer_state.html">MRasterizerState</a>* savedRasterizerState = stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a381d58fef9908f00a0e04bcf38b67838">getRasterizerState</a>();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_depth_stencil_state.html">MDepthStencilState</a>* savedDepthState    = stateMgr-&gt;<a name="a55"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a401853f47989ca1cd4df01ca1976feb4">getDepthStencilState</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// GL Draw</span></div>
<div class="line">    <span class="keywordflow">if</span> (theRenderer-&gt;<a name="a56"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#aac2a5827e6a0ce3333e62ffa7751ba5e">drawAPIIsOpenGL</a>())</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// set projection matrix</span></div>
<div class="line">        gGLFT-&gt;glMatrixMode(MGL_PROJECTION);</div>
<div class="line">        gGLFT-&gt;glPushMatrix();</div>
<div class="line">        gGLFT-&gt;glLoadMatrixd(projection.<a class="code" href="#!/url=./cpp_ref/class_m_matrix.html#a527b102f4eb0951cf4f391f828d3ca34">matrix</a>[0]);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// set world matrix</span></div>
<div class="line">        gGLFT-&gt;glMatrixMode(MGL_MODELVIEW);</div>
<div class="line">        gGLFT-&gt;glPushMatrix();</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Bounding Box</span></div>
<div class="line">        <span class="keywordflow">if</span> (displayStyle &amp; MFrameContext::kBoundingBox)</div>
<div class="line">        {</div>
<div class="line">            setWireframeState(stateMgr);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// set colour</span></div>
<div class="line">            gGLFT-&gt;glColor3fv(fWireframeColor);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// set style</span></div>
<div class="line">            gGLFT-&gt;glEnable(MGL_LINE_STIPPLE);</div>
<div class="line">            gGLFT-&gt;glLineStipple(1, Config::kLineStippleShortDashed);</div>
<div class="line"></div>
<div class="line">            drawBoundingBoxSampleGL(xform, rootNode);</div>
<div class="line"></div>
<div class="line">            gGLFT-&gt;glDisable(MGL_LINE_STIPPLE);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">bool</span> needWireframe =</div>
<div class="line">            !(displayStyle &amp; MFrameContext::kBoundingBox) &amp;&amp;</div>
<div class="line">            (displayStyle &amp; MFrameContext::kWireFrame || fIsSelected);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">bool</span> wireframeOnShaded = needWireframe &amp;&amp;</div>
<div class="line">            (displayStyle &amp; MFrameContext::kGouraudShaded);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">bool</span> disableWireframeOnShaded = wireframeOnShaded &amp;&amp;</div>
<div class="line">            (DisplayPref::wireframeOnShadedMode() == DisplayPref::kWireframeOnShadedNone);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Wireframe can be considerered as being opaque and therefore</span></div>
<div class="line">        <span class="comment">// must be drawn before any transparent object.</span></div>
<div class="line">        <span class="keywordflow">if</span> (needWireframe &amp;&amp; !disableWireframeOnShaded)</div>
<div class="line">        {</div>
<div class="line">            setWireframeState(stateMgr);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// set colour</span></div>
<div class="line">            gGLFT-&gt;glColor3fv(fWireframeColor);</div>
<div class="line"></div>
<div class="line">            gGLFT-&gt;glEnable(MGL_LINE_STIPPLE);</div>
<div class="line">            <span class="keywordflow">if</span> (wireframeOnShaded) {</div>
<div class="line">                <span class="comment">// Wireframe on shaded is affected by wireframe on shaded mode</span></div>
<div class="line">                DisplayPref::WireframeOnShadedMode wireframeOnShadedMode =</div>
<div class="line">                    DisplayPref::wireframeOnShadedMode();</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (wireframeOnShadedMode == DisplayPref::kWireframeOnShadedReduced) {</div>
<div class="line">                    gGLFT-&gt;glLineStipple(1, Config::kLineStippleDotted);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> {</div>
<div class="line">                    assert(wireframeOnShadedMode != DisplayPref::kWireframeOnShadedNone);</div>
<div class="line">                    gGLFT-&gt;glLineStipple(1, Config::kLineStippleShortDashed);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> {</div>
<div class="line">                gGLFT-&gt;glLineStipple(1, Config::kLineStippleShortDashed);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            drawWireframeSampleGL(frustum, xform, rootNode);</div>
<div class="line"></div>
<div class="line">            gGLFT-&gt;glDisable( MGL_LINE_STIPPLE );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (displayStyle &amp; MFrameContext::kGouraudShaded)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// When we need to draw both the shaded geometry and the</span></div>
<div class="line">            <span class="comment">// wireframe mesh, we need to offset the shaded geometry</span></div>
<div class="line">            <span class="comment">// in depth to avoid Z-fighting against the wireframe</span></div>
<div class="line">            <span class="comment">// mesh.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// On the hand, we don&#39;t want to use depth offset when</span></div>
<div class="line">            <span class="comment">// drawing only the shaded geometry because it leads to</span></div>
<div class="line">            <span class="comment">// some drawing artifacts. The reason is a litle bit</span></div>
<div class="line">            <span class="comment">// subtle. At silouhette edges, both front-facing and</span></div>
<div class="line">            <span class="comment">// back-facing faces are meeting. These faces can have a</span></div>
<div class="line">            <span class="comment">// different slope in Z and this can lead to a different</span></div>
<div class="line">            <span class="comment">// Z-offset being applied. When unlucky, the back-facing</span></div>
<div class="line">            <span class="comment">// face can be drawn in front of the front-facing face. If</span></div>
<div class="line">            <span class="comment">// two-sided lighting is enabled, the back-facing fragment</span></div>
<div class="line">            <span class="comment">// can have a different resultant color. This can lead to</span></div>
<div class="line">            <span class="comment">// a rim of either dark or bright pixels around silouhette</span></div>
<div class="line">            <span class="comment">// edges.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// When the wireframe mesh is drawn on top (even a dotted</span></div>
<div class="line">            <span class="comment">// one), it masks this effect sufficiently that it is no</span></div>
<div class="line">            <span class="comment">// longer distracting for the user, so it is OK to use</span></div>
<div class="line">            <span class="comment">// depth offset when the wireframe mesh is drawn on top.</span></div>
<div class="line">            <span class="keyword">const</span> DepthOffsetType depthOffsetType = needWireframe ?</div>
<div class="line">                kApplyDepthOffset : kNoDepthOffset;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Set up OpenGL lights</span></div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">bool</span> anyLights = setupLightingGL(context);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Determine the diffuse color</span></div>
<div class="line">            ColorType colorType = kSubNodeColor;</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a>    defaultDiffuseColor;</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">bool</span> needOpaquePass      =</div>
<div class="line">                rootNode-&gt;transparentType() != SubNode::kTransparent;</div>
<div class="line">            <span class="keywordtype">bool</span> needTransparentPass =</div>
<div class="line">                rootNode-&gt;transparentType() != SubNode::kOpaque;</div>
<div class="line"></div>
<div class="line">            DrawShadedState::TransparentPruneType opaquePassPrune =</div>
<div class="line">                DrawShadedState::kPruneTransparent;</div>
<div class="line">            DrawShadedState::TransparentPruneType transparentPassPrune =</div>
<div class="line">                DrawShadedState::kPruneOpaque;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (displayStyle &amp; MFrameContext::kDefaultMaterial) {</div>
<div class="line">                <span class="comment">// Force drawing as opaque gray if use default material</span></div>
<div class="line">                colorType           = kDefaultColor;</div>
<div class="line">                needOpaquePass      = <span class="keyword">true</span>;</div>
<div class="line">                needTransparentPass = <span class="keyword">false</span>;</div>
<div class="line">                opaquePassPrune     = DrawShadedState::kPruneNone;</div>
<div class="line">                <span class="keywordflow">if</span> (anyLights) {</div>
<div class="line">                    defaultDiffuseColor = Config::kDefaultGrayColor;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (displayStyle &amp; MFrameContext::kXray) {</div>
<div class="line">                <span class="comment">// Force drawing as transparent in X-Ray mode</span></div>
<div class="line">                needOpaquePass       = <span class="keyword">false</span>;</div>
<div class="line">                needTransparentPass  = <span class="keyword">true</span>;</div>
<div class="line">                transparentPassPrune = DrawShadedState::kPruneNone;</div>
<div class="line">                colorType = anyLights ? kXrayColor : kXrayBlackColor;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            <span class="keywordflow">if</span> (!anyLights) {</div>
<div class="line">                <span class="comment">// Force drawing as black if no light exists in the scene.</span></div>
<div class="line">                colorType = kBlackColor;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            setShadedBlendState(stateMgr);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Opaque pass</span></div>
<div class="line">            <span class="keywordflow">if</span> (needOpaquePass) {</div>
<div class="line">                setShadedSolidDepthState(stateMgr);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (displayStyle &amp; MFrameContext::kTwoSidedLighting) {</div>
<div class="line">                    <span class="comment">// Two-sided lighting</span></div>
<div class="line">                    <span class="keywordflow">if</span> (Config::emulateTwoSidedLighting()) {</div>
<div class="line">                        setShadedTwoSidedLightingState(kOneSidedLighting);</div>
<div class="line"></div>
<div class="line">                        drawShadedSampleGL(</div>
<div class="line">                            frustum, stateMgr, MRasterizerState::kCullFront,</div>
<div class="line">                            depthOffsetType, colorType, defaultDiffuseColor,</div>
<div class="line">                            kBackNormals, opaquePassPrune, xform, rootNode);</div>
<div class="line"></div>
<div class="line">                        drawShadedSampleGL(</div>
<div class="line">                            frustum, stateMgr, MRasterizerState::kCullBack,</div>
<div class="line">                            depthOffsetType, colorType, defaultDiffuseColor,</div>
<div class="line">                            kFrontNormals, opaquePassPrune, xform, rootNode);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> {</div>
<div class="line">                        setShadedTwoSidedLightingState(kTwoSidedLighting);</div>
<div class="line"></div>
<div class="line">                        drawShadedSampleGL(</div>
<div class="line">                            frustum, stateMgr, MRasterizerState::kCullNone,</div>
<div class="line">                            depthOffsetType, colorType, defaultDiffuseColor,</div>
<div class="line">                            kFrontNormals, opaquePassPrune, xform, rootNode);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">// One-sided lighting</span></div>
<div class="line">                    setShadedTwoSidedLightingState(kOneSidedLighting);</div>
<div class="line"></div>
<div class="line">                    drawShadedSampleGL(</div>
<div class="line">                        frustum, stateMgr, MRasterizerState::kCullNone,</div>
<div class="line">                        depthOffsetType, colorType, defaultDiffuseColor,</div>
<div class="line">                        kFrontNormals, opaquePassPrune, xform, rootNode);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Transparent pass</span></div>
<div class="line">            <span class="keywordflow">if</span> (needTransparentPass) {</div>
<div class="line">                setShadedAlphaDepthState(stateMgr);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (displayStyle &amp; MFrameContext::kTwoSidedLighting) {</div>
<div class="line">                    <span class="comment">// Two-sided lighting</span></div>
<div class="line">                    setShadedTwoSidedLightingState(</div>
<div class="line">                           Config::emulateTwoSidedLighting() ?</div>
<div class="line">                           kOneSidedLighting : kTwoSidedLighting );</div>
<div class="line"></div>
<div class="line">                    drawShadedSampleGL(</div>
<div class="line">                        frustum, stateMgr, MRasterizerState::kCullFront,</div>
<div class="line">                        depthOffsetType, colorType, defaultDiffuseColor,</div>
<div class="line">                        Config::emulateTwoSidedLighting() ? kBackNormals : kFrontNormals,</div>
<div class="line">                        transparentPassPrune, xform, rootNode);</div>
<div class="line">                    drawShadedSampleGL(</div>
<div class="line">                        frustum, stateMgr, MRasterizerState::kCullBack,</div>
<div class="line">                        depthOffsetType, colorType, defaultDiffuseColor,</div>
<div class="line">                        kFrontNormals,  transparentPassPrune, xform, rootNode);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">// One-sided lighting</span></div>
<div class="line">                    setShadedTwoSidedLightingState(kOneSidedLighting);</div>
<div class="line"></div>
<div class="line">                    drawShadedSampleGL(</div>
<div class="line">                        frustum, stateMgr, MRasterizerState::kCullFront,</div>
<div class="line">                        depthOffsetType, colorType, defaultDiffuseColor,</div>
<div class="line">                        kFrontNormals, transparentPassPrune, xform, rootNode);</div>
<div class="line">                    drawShadedSampleGL(</div>
<div class="line">                        frustum, stateMgr, MRasterizerState::kCullBack,</div>
<div class="line">                        depthOffsetType, colorType, defaultDiffuseColor,</div>
<div class="line">                        kFrontNormals, transparentPassPrune, xform, rootNode);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            unsetLightingGL(context);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Bring the OpenGL state back to the VP2.0 expected default.</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Restore the default color.</span></div>
<div class="line">        gGLFT-&gt;glColor4f(1.0f, 1.0f, 1.0f, 1.0f);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Restore OGS default value</span></div>
<div class="line">        gGLFT-&gt;glFrontFace(GL_CCW);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Restore OGS default two-sided lighting state.</span></div>
<div class="line">        gGLFT-&gt;glLightModeli(MGL_LIGHT_MODEL_TWO_SIDE, 1);</div>
<div class="line"></div>
<div class="line">        gGLFT-&gt;glMatrixMode(MGL_PROJECTION);</div>
<div class="line">        gGLFT-&gt;glPopMatrix();</div>
<div class="line">        gGLFT-&gt;glMatrixMode(MGL_MODELVIEW);</div>
<div class="line">        gGLFT-&gt;glPopMatrix();</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// TODO: To be implemented!</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a27dbc083002d85108ed30ee1131f68c1">setBlendState</a>(savedBlendState);</div>
<div class="line">    stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a7dfb1c4f28575ed6581aa40a7b64f22a">setRasterizerState</a>(savedRasterizerState);</div>
<div class="line">    stateMgr-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a5a6b8e76300df4a0c9f6a38b236118f7">setDepthStencilState</a>(savedDepthState);</div>
<div class="line"></div>
<div class="line">    stateMgr-&gt;<a name="a57"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a544e5c653741b90e7c65d2b34e8ebe60">releaseBlendState</a>(savedBlendState);</div>
<div class="line">    stateMgr-&gt;<a name="a58"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a5c1115e1c741c78d1c19909c7b4d8db9">releaseRasterizerState</a>(savedRasterizerState);</div>
<div class="line">    stateMgr-&gt;<a name="a59"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_state_manager.html#a1ab255028fb2b2440bb6b7300713c15f">releaseDepthStencilState</a>(savedDepthState);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"><span class="comment">// CLASS DrawOverride</span></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> DrawOverride::drawCb(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a>&amp; context,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_user_data.html">MUserData</a>* userData)</div>
<div class="line">{</div>
<div class="line">    draw(context, <span class="keyword">nullptr</span>, userData);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> DrawOverride::draw(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a>&amp; context,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_selection_info.html">MHWRender::MSelectionInfo</a>* selectInfo,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_user_data.html">MUserData</a>* userData)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Make sure that the post render callbacks have been properly</span></div>
<div class="line">    <span class="comment">// initialized. We have to verify at each refresh because there is</span></div>
<div class="line">    <span class="comment">// no easy way to recieve a callback when a new modelEditor is</span></div>
<div class="line">    <span class="comment">// created.</span></div>
<div class="line">    ShapeNode::init3dViewPostRenderCallbacks();</div>
<div class="line"></div>
<div class="line">    InitializeGLFT();</div>
<div class="line">    <span class="keyword">const</span> UserData* data = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UserData*<span class="keyword">&gt;</span>(userData);</div>
<div class="line">    <span class="keywordflow">if</span> (data) data-&gt;draw(context, selectInfo);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><a name="_a60"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_draw_override.html">MHWRender::MPxDrawOverride</a>*</div>
<div class="line">DrawOverride::creator(<span class="keyword">const</span> <a name="_a61"></a><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>&amp; obj)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> DrawOverride(obj);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">DrawOverride::DrawOverride(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>&amp; obj)</div>
<div class="line">    : <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_px_draw_override.html">MPxDrawOverride</a>(obj, &amp;drawCb)</div>
<div class="line">{}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">DrawOverride::~DrawOverride()</div>
<div class="line">{}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">MHWRender::DrawAPI DrawOverride::supportedDrawAPIs()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// This draw override supports only OpenGL for now.</span></div>
<div class="line">    <span class="keywordflow">return</span> MHWRender::kOpenGL;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">bool</span> DrawOverride::isBounded(<span class="keyword">const</span> <a name="_a62"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; <span class="comment">/*objPath*/</span>,</div>
<div class="line">                             <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; <span class="comment">/*cameraPath*/</span>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html">MBoundingBox</a> DrawOverride::boundingBox(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; objPath,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; cameraPath)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// Extract the cached geometry.</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line">    <a name="_a63"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> node(objPath.<a name="a64"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#ae024049dad815f2f186e6a4fead8be51">node</a>(), &amp;status);</div>
<div class="line">    <span class="keywordflow">if</span> (!status) <span class="keywordflow">return</span> <a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html">MBoundingBox</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> ShapeNode* shapeNode = <span class="keyword">dynamic_cast&lt;</span>ShapeNode*<span class="keyword">&gt;</span>(node.userNode());</div>
<div class="line">    <span class="keywordflow">if</span> (!shapeNode) <span class="keywordflow">return</span> <a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html">MBoundingBox</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> SubNode::Ptr subNode = shapeNode-&gt;getCachedGeometry();</div>
<div class="line">    <span class="keywordflow">if</span> (!subNode) <span class="keywordflow">return</span> <a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html">MBoundingBox</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> SubNodeData::Ptr subNodeData = subNode-&gt;getData();</div>
<div class="line">    <span class="keywordflow">if</span> (!subNodeData) <span class="keywordflow">return</span> <a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html">MBoundingBox</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> seconds = <a name="a65"></a><a class="code" href="#!/url=./cpp_ref/class_m_anim_control.html#a8cb1e013d828c1d012fee789b14e0060">MAnimControl::currentTime</a>().<a name="a66"></a><a class="code" href="#!/url=./cpp_ref/class_m_time.html#a105d41236561f4d4be6383ced757a429">as</a>(<a name="a67"></a><a class="code" href="#!/url=./cpp_ref/class_m_time.html#abceb2331ad056e3c5ad27894199a49eda3091d1a096c28d4993507f167253ebc7">MTime::kSeconds</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Handle transforms.</span></div>
<div class="line">    <span class="keyword">const</span> XformData::Ptr xform =</div>
<div class="line">        std::dynamic_pointer_cast&lt;<span class="keyword">const</span> XformData&gt;(subNodeData);</div>
<div class="line">    <span class="keywordflow">if</span> (xform) {</div>
<div class="line">        <span class="keyword">const</span> std::shared_ptr&lt;const XformSample&gt;&amp; sample =</div>
<div class="line">            xform-&gt;getSample(seconds);</div>
<div class="line">        <span class="keywordflow">return</span> sample-&gt;boundingBox();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Handle shapes.</span></div>
<div class="line">    <span class="keyword">const</span> ShapeData::Ptr shape =</div>
<div class="line">        std::dynamic_pointer_cast&lt;<span class="keyword">const</span> ShapeData&gt;(subNodeData);</div>
<div class="line">    <span class="keywordflow">if</span> (shape) {</div>
<div class="line">        <span class="keyword">const</span> std::shared_ptr&lt;const ShapeSample&gt;&amp; sample =</div>
<div class="line">            shape-&gt;getSample(seconds);</div>
<div class="line">        <span class="keywordflow">return</span> sample-&gt;boundingBox();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="#!/url=./cpp_ref/class_m_bounding_box.html">MBoundingBox</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">bool</span> DrawOverride::disableInternalBoundingBoxDraw()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// Always return true since we will perform custom bounding box</span></div>
<div class="line">    <span class="comment">// drawing</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_user_data.html">MUserData</a>* DrawOverride::prepareForDraw(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; objPath,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; cameraPath,</div>
<div class="line">    <span class="keyword">const</span> <a name="_a68"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html">MHWRender::MFrameContext</a>&amp; frameContext,</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_user_data.html">MUserData</a>* oldData)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="#!/url=./cpp_ref/namespace_m_h_w_render.html">MHWRender</a>;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> <span class="keywordtype">object</span>    = objPath.<a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#ae024049dad815f2f186e6a4fead8be51">node</a>();</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> transform = objPath.<a name="a69"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a13f88add2c589379a22d5aaaa4a39fb4">transform</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Retrieve data cache (create if does not exist)</span></div>
<div class="line">    UserData* data = <span class="keyword">dynamic_cast&lt;</span>UserData*<span class="keyword">&gt;</span>(oldData);</div>
<div class="line">    <span class="keywordflow">if</span> (!data)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// get the real ShapeNode from the MObject</span></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> node(<span class="keywordtype">object</span>, &amp;status);</div>
<div class="line">        <span class="keywordflow">if</span> (status)</div>
<div class="line">        {</div>
<div class="line">            data = <span class="keyword">new</span> UserData(</div>
<div class="line">                dynamic_cast&lt;ShapeNode*&gt;(node.userNode()));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (data) {</div>
<div class="line">        <span class="comment">// compute data and cache it</span></div>
<div class="line"></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_color.html">MColor</a> wireframeColor =</div>
<div class="line">            <a name="a70"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry_utilities.html#a6221bc7407b14246b14f79a751496276">MGeometryUtilities::wireframeColor</a>(objPath);</div>
<div class="line"></div>
<div class="line">        <span class="keyword">const</span> DisplayStatus displayStatus =</div>
<div class="line">            <a name="a71"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_geometry_utilities.html#aa2838b92c9f7db4a810690a986199134">MGeometryUtilities::displayStatus</a>(objPath);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">bool</span> isSelected =</div>
<div class="line">            (displayStatus == kActive) ||</div>
<div class="line">            (displayStatus == kLead)   ||</div>
<div class="line">            (displayStatus == kHilite);</div>
<div class="line"></div>
<div class="line">        data-&gt;set(</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_anim_control.html#a8cb1e013d828c1d012fee789b14e0060">MAnimControl::currentTime</a>().as(<a class="code" href="#!/url=./cpp_ref/class_m_time.html#abceb2331ad056e3c5ad27894199a49eda3091d1a096c28d4993507f167253ebc7">MTime::kSeconds</a>),</div>
<div class="line">            wireframeColor,</div>
<div class="line">            isSelected);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> data;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> DrawOverride::wantUserSelection()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">// Support user selection using glRenderMode(GL_SELECT)</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html">MHWRender::MRenderer</a>* theRenderer = <a name="a72"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#a4678a72ac6959ed21d422d27928d0343">MHWRender::MRenderer::theRenderer</a>();</div>
<div class="line">    <span class="keywordflow">return</span> theRenderer &amp;&amp; (theRenderer-&gt;<a name="a73"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#ae2d5ce57991bca16f525728e8d9d399e">drawAPI</a>() == MHWRender::kOpenGL || theRenderer-&gt;<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_renderer.html#ae2d5ce57991bca16f525728e8d9d399e">drawAPI</a>() == MHWRender::kOpenGLCoreProfile);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// The current limitation has the selection volume bounded by [-2500..2500) in</span></div>
<div class="line"><span class="comment">// any axis, which has been logged as MAYA-104047. If this becomes an issue, </span></div>
<div class="line"><span class="comment">// either of the these workarounds can be an option to get around the problem.</span></div>
<div class="line"><span class="comment">// 1. Toggle on Automatic camera-based selection or Camera-based selection </span></div>
<div class="line"><span class="comment">//    in Selection Preferences. </span></div>
<div class="line"><span class="comment">// 2. Set the environment variable MAYA_VP2_LOCALE_GRID_SIZE (default to 5000)</span></div>
<div class="line"><span class="comment">//    to a larger value, i.e. twice of the scene bounding box.</span></div>
<div class="line"><span class="keywordtype">bool</span> DrawOverride::userSelect(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_selection_info.html">MHWRender::MSelectionInfo</a>&amp; selectInfo,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_draw_context.html">MHWRender::MDrawContext</a>&amp; context,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a>&amp; objPath,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_user_data.html">MUserData</a>* data,</div>
<div class="line">    <a name="_a74"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html">MSelectionList</a>&amp; selectionList,</div>
<div class="line">    <a name="_a75"></a><a class="code" href="#!/url=./cpp_ref/class_m_point_array.html">MPointArray</a>&amp; worldSpaceHitPts)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// This is the user selection function that will be invoked only if</span></div>
<div class="line">    <span class="comment">// wantUserSelection() returns true. </span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set up selection buffer</span></div>
<div class="line">    <span class="keyword">const</span> GLsizei BUF_SIZE = 10;</div>
<div class="line">    GLuint selectBuf[BUF_SIZE];</div>
<div class="line">    glSelectBuffer(BUF_SIZE, selectBuf);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Enter OpenGL selection mode</span></div>
<div class="line">    glRenderMode(GL_SELECT);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Call into draw code with a name pushed onto the name stack and the</span></div>
<div class="line">    <span class="comment">// select info passed into the method for adjusting projection matrix.</span></div>
<div class="line">    glInitNames();</div>
<div class="line">    glPushName(0);</div>
<div class="line">    draw(context, &amp;selectInfo, data);</div>
<div class="line">    glPopName();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Exit OpenGL selection mode.</span></div>
<div class="line">    GLint hits = glRenderMode(GL_RENDER);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Return false if nothing is hit.</span></div>
<div class="line">    <span class="keywordflow">if</span> (hits &lt;= 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Otherwise, calculate the hit point in world space. The depth is the</span></div>
<div class="line">    <span class="comment">// average of minimum and maximum, so it isn&#39;t the accurate depth at</span></div>
<div class="line">    <span class="comment">// the cursor position.</span></div>
<div class="line">    GLuint minZ = selectBuf[1];</div>
<div class="line">    GLuint maxZ = selectBuf[2];</div>
<div class="line">    <span class="keywordtype">double</span> depth = (minZ*0.5 + maxZ*0.5) / 0xFFFFFFFF;</div>
<div class="line"></div>
<div class="line">    <a name="_a76"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_camera.html">MFnCamera</a> camera(context.<a name="a77"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#a7785aa5262ffc0200653a692b16fa608">getCurrentCameraPath</a>());</div>
<div class="line">    <span class="keywordflow">if</span> (!camera.isOrtho())</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> Zn = camera.<a name="a78"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_camera.html#a7189bcaad0276cd50d0d67b69e572ddd">nearClippingPlane</a>();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> Zf = camera.farClippingPlane();</div>
<div class="line">        depth *= Zn / (Zf - depth * (Zf - Zn));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, y, w, h;</div>
<div class="line">    selectInfo.<a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_selection_info.html#a2e00d4919c72b22e16478dfd986684b2">selectRect</a>(x, y, w, h);</div>
<div class="line"></div>
<div class="line">    <a name="_a79"></a><a class="code" href="#!/url=./cpp_ref/class_m_point.html">MPoint</a> nearPw, farPw;</div>
<div class="line">    context.<a name="a80"></a><a class="code" href="#!/url=./cpp_ref/class_m_h_w_render_1_1_m_frame_context.html#a0f5a55195c724b06707730d7d52d915c">viewportToWorld</a>(x + w*0.5, y + h*0.5, nearPw, farPw);</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_point.html">MPoint</a> hitPoint = nearPw + depth * (farPw - nearPw);</div>
<div class="line"></div>
<div class="line">    selectionList.<a name="a81"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html#a23929aeafb29672f2652128eac9c4dec">add</a>(objPath);</div>
<div class="line">    worldSpaceHitPts.<a name="a82"></a><a class="code" href="#!/url=./cpp_ref/class_m_point_array.html#abe5a9fe36b4651af38a4a26c85f46e1a">append</a>(hitPoint);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->

      <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
   </div></body>
</html>
