<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
      <title>C++ API Reference: autoLoader/moduleLogic.cpp</title>
      
	  
      
      
      
      
      
      
      
    

</head>
   <body height="100%"><div class="body_content" id="body-content"><link rel="stylesheet" type="text/css" href="cpp_ref/navtree.css"><link rel="stylesheet" type="text/css" href="cpp_ref/doxygen.css"><link rel="stylesheet" type="text/css" href="cpp_ref/tabs.css"><link rel="stylesheet" type="text/css" href="style/adsk.cpm.css"><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('auto_loader_2module_logic_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
      <div>
         <div class="head">
            <h1>C++ API Reference: autoLoader/moduleLogic.cpp</h1>
         </div>

<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->

  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="#!/url=./cpp_ref/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="#!/url=./cpp_ref/pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="#!/url=./cpp_ref/modules.html"><span>Modules</span></a></li>
      <li><a href="#!/url=./cpp_ref/namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="#!/url=./cpp_ref/annotated.html"><span>Classes</span></a></li>
      <li><a href="#!/url=./cpp_ref/examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="cpp_ref/search/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="cpp_ref/search/close.png" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>

<div id="doc-content">
<!-- window showing the filter options -->


<!-- iframe showing the search results (closed by default) -->


<div class="header">
  <div class="headertitle">
<div class="title">autoLoader/moduleLogic.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Copyright 2015 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Use of this software is subject to the terms of the Autodesk license </span></div>
<div class="line"><span class="comment">//  agreement provided at the time of installation or download, or which </span></div>
<div class="line"><span class="comment">//  otherwise accompanies this software in either electronic or hard copy form.   </span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;moduleLogic.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;moduleLogicCmd.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGlobal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFileObject.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef MAC_PLUGIN</span></div>
<div class="line"><span class="preprocessor">#define MAXPATHLEN 1024</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#define LINE (MAXPATHLEN * 3)</span></div>
<div class="line"><span class="preprocessor">#define KEYWORD_MAYAVERSION _T(&quot;MAYAVERSION&quot;)</span></div>
<div class="line"><span class="preprocessor">#define KEYWORD_PLATFORM _T(&quot;PLATFORM&quot;)</span></div>
<div class="line"><span class="preprocessor">#define KEYWORD_LOCALE _T(&quot;LOCALE&quot;)</span></div>
<div class="line"><span class="preprocessor">#define KEYWORD_SEPARATOR _T(&quot;:&quot;)</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><span class="keywordtype">void</span> MModuleLogic::ModuleDetectionLogicInit (threadData *data) {</div>
<div class="line">    </div>
<div class="line">    <span class="comment">//First lets make sure that the the autoLoad plugin doesn&#39;t flood the command window</span></div>
<div class="line">    <span class="comment">//with commands when &#39;echo all commands&#39; is set</span></div>
<div class="line">    <a name="a0"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a09e405631e7cf680f8ac9d934ad73434">MGlobal::executeCommand</a> (_T(<span class="stringliteral">&quot;commandEcho -addFilter {\&quot;loadModule\&quot;, \&quot;moduleDetectionLogic\&quot;};&quot;</span>)) ;</div>
<div class="line"></div>
<div class="line">    data-&gt;szPlatform = <a name="a1"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#aaba986b09bb353d06155a21266e06b00">MGlobal::mayaName</a>();</div>
<div class="line">    data-&gt;szOS =<a name="a2"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a8dd71fbf4d71dacf626180777ba91a62">MGlobal::executeCommandStringResult</a> (_T(<span class="stringliteral">&quot;about -os;&quot;</span>)) ; <span class="comment">// return &#39;win64&#39; on Windows x64</span></div>
<div class="line">    data-&gt;szVersion =<a name="a3"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a5e267b7212f8651514c21ca82566e412">MGlobal::mayaVersion</a> () ; <span class="comment">// return &#39;2013 x64&#39; on Maya 2013 / 2013.5 x64</span></div>
<div class="line">    data-&gt;szVersion =data-&gt;szVersion.substringW (0, 3) ; <span class="comment">// remove &#39;.5&#39; and &#39; x64&#39; if present</span></div>
<div class="line">    data-&gt;szLocale =<a class="code" href="#!/url=./cpp_ref/class_m_global.html#a8dd71fbf4d71dacf626180777ba91a62">MGlobal::executeCommandStringResult</a> (_T(<span class="stringliteral">&quot;about -uil;&quot;</span>)) ; <span class="comment">// return &#39;en_US&#39; on Maya English version</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//- Now initialize the modules</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a09e405631e7cf680f8ac9d934ad73434">MGlobal::executeCommand</a> (_T(<span class="stringliteral">&quot;moduleInfo -lm;&quot;</span>), data-&gt;szModules, <span class="keyword">false</span>, <span class="keyword">false</span>) ;</div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i =0 ; i &lt; data-&gt;szModules.length () ; i++ ) {</div>
<div class="line">        <a name="_a4"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> cmd, modName =data-&gt;szModules [i] ;</div>
<div class="line">        cmd.<a name="a5"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#a07ae464181c795f43fa1bcc288acff91">format</a> (_T(<span class="stringliteral">&quot;moduleInfo -d -mn \&quot;^1s\&quot;;&quot;</span>), modName) ;</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> modFile =<a class="code" href="#!/url=./cpp_ref/class_m_global.html#a8dd71fbf4d71dacf626180777ba91a62">MGlobal::executeCommandStringResult</a> (cmd, <span class="keyword">false</span>, <span class="keyword">false</span>) ;</div>
<div class="line">        <span class="comment">// Old module system (.mod or .txt file in modules folder), nothing additional things to process</span></div>
<div class="line">        <span class="comment">// .mod file do not support anything more than setting variables, so we are ok</span></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> ext =modFile.<a name="a6"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#a41ba57372bc1082383b4f1929a8030fa">substring</a> (modFile.<a name="a7"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#a2f0c58e22c8c209d0ea924de9913993a">rindex</a> (_T(<span class="charliteral">&#39;.&#39;</span>)) + 1, modFile.<a name="a8"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e">length</a> () - 1).toLowerCase () ;</div>
<div class="line">        <span class="keywordflow">if</span> ( ext != _T(<span class="stringliteral">&quot;xml&quot;</span>) )</div>
<div class="line">            <span class="keywordflow">continue</span> ;</div>
<div class="line">        MModuleLogic::InitNewModules (data, modName, modFile) ;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MModuleLogic::InitNewModules (threadData *data, <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> &amp;modName, <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> &amp;packageFile) {</div>
<div class="line">    MModuleLogic::executePackageContents (data, packageFile) ;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><span class="keywordtype">void</span> MModuleLogic::ModuleDetectionLogicCmdExecute (threadData *data) {</div>
<div class="line">    <span class="keywordflow">if</span> ( threadData::bWaitingForCommand == <span class="keyword">false</span> ) {</div>
<div class="line">        threadData::bWaitingForCommand =true ;</div>
<div class="line">        <a name="a9"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a2c877a6e116f8fd3a6e76387403c023a">MGlobal::executeCommandOnIdle</a> (kmoduleLogicCmdName, <span class="keyword">false</span>) ;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MModuleLogic::ModuleDetectionLogic (threadData *data, <span class="keywordtype">bool</span> bInitNow <span class="comment">/*=true*/</span>) {</div>
<div class="line">    <span class="comment">//MGlobal::executeCommand (_T(&quot;loadModule -all;&quot;), false, false) ;</span></div>
<div class="line">    <span class="comment">//data-&gt;szModules.clear () ;</span></div>
<div class="line">    <span class="comment">//MGlobal::executeCommand (_T(&quot;moduleInfo -lm;&quot;), data-&gt;szModules, false, false) ;</span></div>
<div class="line">    </div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> cmd ;</div>
<div class="line">    <a name="_a10"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> newModules, newModulesName ;</div>
<div class="line">    <a name="_a11"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> ms =<a class="code" href="#!/url=./cpp_ref/class_m_global.html#a09e405631e7cf680f8ac9d934ad73434">MGlobal::executeCommand</a> (_T(<span class="stringliteral">&quot;loadModule -scan;&quot;</span>), newModules, <span class="keyword">false</span>, <span class="keyword">false</span>) ;</div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i =0 ; i &lt; newModules.<a name="a12"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a580388f31f60c46fac867ca48a48da1e">length</a> () ; i++ ) {</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> modFile =newModules [i] ;</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> ext =modFile.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a41ba57372bc1082383b4f1929a8030fa">substring</a> (modFile.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a2f0c58e22c8c209d0ea924de9913993a">rindex</a> (_T(<span class="charliteral">&#39;.&#39;</span>)) + 1, modFile.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a580388f31f60c46fac867ca48a48da1e">length</a> () - 1).toLowerCase () ;</div>
<div class="line">        <span class="comment">// Old module system does not describe its package content, so we assume all files are on disk</span></div>
<div class="line">        <span class="comment">// For the new module system, the package can list all Vital files, so we need to check they are </span></div>
<div class="line">        <span class="comment">// all present before initializing the module. Otherwise, we will wait a bit longer and try again</span></div>
<div class="line">        <span class="keywordflow">if</span> ( ext == _T(<span class="stringliteral">&quot;xml&quot;</span>) &amp;&amp; !MModuleLogic::isPackageReady (data, modFile) )</div>
<div class="line">            <span class="keywordflow">continue</span> ;</div>
<div class="line">        cmd.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a07ae464181c795f43fa1bcc288acff91">format</a> (_T(<span class="stringliteral">&quot;loadModule -load \&quot;^1s\&quot;;&quot;</span>), modFile) ;</div>
<div class="line">        ms =<a class="code" href="#!/url=./cpp_ref/class_m_global.html#a09e405631e7cf680f8ac9d934ad73434">MGlobal::executeCommand</a> (cmd, newModulesName, <span class="keyword">false</span>, <span class="keyword">false</span>) ;</div>
<div class="line">        data-&gt;szModules.append (newModulesName [0]) ;</div>
<div class="line">        <span class="comment">// Old module system (.mod or .txt file in modules folder), nothing additional things to process</span></div>
<div class="line">        <span class="comment">// .mod file do not support anything more than setting variables, so we are ok</span></div>
<div class="line">        <span class="keywordflow">if</span> ( ext != _T(<span class="stringliteral">&quot;xml&quot;</span>) )</div>
<div class="line">            continue ;</div>
<div class="line">        <span class="comment">// Update the plug-in manager to show new plug-ins if any</span></div>
<div class="line">        <span class="comment">// (do it now before it appears in Plug-in Manager Misc section)</span></div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a09e405631e7cf680f8ac9d934ad73434">MGlobal::executeCommand</a> (_T(<span class="stringliteral">&quot;if ( `exists updatePluginModule` ) updatePluginModule();&quot;</span>), <span class="keyword">false</span>, <span class="keyword">false</span>) ;</div>
<div class="line">        MModuleLogic::InitNewModules (data, newModulesName [0], modFile) ;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//newModulesName.clear () ;</span></div>
<div class="line">    <span class="comment">//ms =MGlobal::executeCommand (_T(&quot;moduleInfo -lm;&quot;), newModulesName, false, false) ;</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Make sure the thread can call us again</span></div>
<div class="line">    threadData::bWaitingForCommand =false ;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><span class="keywordtype">bool</span> MModuleLogic::isPackageReady (threadData *data, <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> &amp;modFile) {</div>
<div class="line">    xmlDocPtr doc =xmlParseFile (modFile.<a name="a13"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a> ()) ;</div>
<div class="line">    <span class="keywordflow">if</span> ( doc == NULL )</div>
<div class="line">        <span class="keywordflow">return</span> (<span class="keyword">false</span>) ;</div>
<div class="line">    xmlXPathContextPtr context =xmlXPathNewContext (doc) ;</div>
<div class="line"></div>
<div class="line">    <a name="_a14"></a><a class="code" href="#!/url=./cpp_ref/class_m_file_object.html">MFileObject</a> fmod ;</div>
<div class="line">    fmod.<a name="a15"></a><a class="code" href="#!/url=./cpp_ref/class_m_file_object.html#ac14aefbfe38c2711256eb8c14a3194ee">setRawFullName</a> (modFile) ;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> modPath =fmod.<a name="a16"></a><a class="code" href="#!/url=./cpp_ref/class_m_file_object.html#a7a4d2fada6eb436c6e74f1e62212c218">resolvedPath</a> () ;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> mxpath ;</div>
<div class="line">    mxpath.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a07ae464181c795f43fa1bcc288acff91">format</a> (_T(<span class="stringliteral">&quot;//Components/RuntimeRequirements[(not(@OS) or contains(@OS, &#39;^1s&#39;)) and (not(@Platform) or contains(@Platform, &#39;^2s&#39;))]&quot;</span>), data-&gt;szOS, data-&gt;szPlatform) ;</div>
<div class="line">    xmlChar *xpath =(xmlChar *)mxpath.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a> () ;</div>
<div class="line">    xmlXPathObjectPtr result =xmlXPathEvalExpression (xpath, context) ;</div>
<div class="line">    <span class="keywordtype">bool</span> bOk =true ;</div>
<div class="line">    <span class="keywordflow">if</span> ( result != NULL &amp;&amp; !xmlXPathNodeSetIsEmpty (result-&gt;nodesetval) ) {</div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j =0 ; j &lt; result-&gt;nodesetval-&gt;nodeNr &amp;&amp; bOk ; j++ ) {</div>
<div class="line">            xmlNodePtr reqNode =result-&gt;nodesetval-&gt;nodeTab [j] ;</div>
<div class="line">            context-&gt;node =reqNode-&gt;parent ;</div>
<div class="line">            <span class="comment">//- We ignore ./MayaEnv XML nodes since Maya already processed them</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">//- Search for ./ComponentEntry XML nodes</span></div>
<div class="line">            xmlChar *xpathComp =(xmlChar *)<span class="stringliteral">&quot;./ComponentEntry&quot;</span> ;</div>
<div class="line">            xmlXPathObjectPtr resultEntries =xmlXPathEvalExpression (xpathComp, context) ;</div>
<div class="line">            <span class="keywordflow">if</span> ( resultEntries != NULL &amp;&amp; !xmlXPathNodeSetIsEmpty (resultEntries-&gt;nodesetval) ) {</div>
<div class="line">                <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> k =0 ; k &lt; resultEntries-&gt;nodesetval-&gt;nodeNr &amp;&amp; bOk ; k++ ) {</div>
<div class="line">                    xmlNodePtr compNode =resultEntries-&gt;nodesetval-&gt;nodeTab [k] ;</div>
<div class="line">                    xmlChar *compName =xmlGetProp (compNode, (xmlChar *)<span class="stringliteral">&quot;ModuleName&quot;</span>) ;</div>
<div class="line"></div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_file_object.html">MFileObject</a> fobj ;</div>
<div class="line">                    fobj.<a name="a17"></a><a class="code" href="#!/url=./cpp_ref/class_m_file_object.html#a0dd985505aff794eef8b6b3e7d895d78">setRawPath</a> (modPath) ;</div>
<div class="line">                    fobj.<a name="a18"></a><a class="code" href="#!/url=./cpp_ref/class_m_file_object.html#ae998c69c8f2bf4f7436663676a735654">setRawName</a> (<a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> ((<span class="keywordtype">char</span> *)compName)) ;</div>
<div class="line">                    <span class="keywordflow">if</span> ( !fobj.<a name="a19"></a><a class="code" href="#!/url=./cpp_ref/class_m_file_object.html#aa9100e4c626877b706ca9fc67a35c562">exists</a> () )</div>
<div class="line">                        bOk =<span class="keyword">false</span> ;</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">if</span> ( compName != NULL )</div>
<div class="line">                    {</div>
<div class="line">                        xmlFree (compName) ;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> ( resultEntries != NULL )</div>
<div class="line">            {</div>
<div class="line">                xmlXPathFreeObject (resultEntries) ;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> ( result != NULL )</div>
<div class="line">    {</div>
<div class="line">        xmlXPathFreeObject (result) ;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( context != NULL )</div>
<div class="line">    {</div>
<div class="line">        xmlXPathFreeContext (context) ;</div>
<div class="line">    }</div>
<div class="line">    xmlFreeDoc (doc) ; <span class="comment">// Pointer already tested above</span></div>
<div class="line">    <span class="keywordflow">return</span> (bOk) ;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><span class="keywordtype">bool</span> MModuleLogic::executePackageContents (threadData *data, <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> &amp;modFile) {</div>
<div class="line">    xmlDocPtr doc =xmlParseFile (modFile.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a> ()) ;</div>
<div class="line">    <span class="keywordflow">if</span> ( doc == NULL )</div>
<div class="line">        <span class="keywordflow">return</span> (<span class="keyword">false</span>) ;</div>
<div class="line">    xmlXPathContextPtr context =xmlXPathNewContext (doc) ;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> mxpath ;</div>
<div class="line">    mxpath.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a07ae464181c795f43fa1bcc288acff91">format</a> (_T(<span class="stringliteral">&quot;//Components/RuntimeRequirements[(not(@OS) or contains(@OS, &#39;^1s&#39;)) and (not(@Platform) or contains(@Platform, &#39;^2s&#39;))]&quot;</span>), data-&gt;szOS, data-&gt;szPlatform) ;</div>
<div class="line">    xmlChar *xpath =(xmlChar *)mxpath.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#aa9ab612f356c53479afc4c648c9ef94d">asChar</a> () ;</div>
<div class="line">    xmlXPathObjectPtr result =xmlXPathEvalExpression (xpath, context) ;</div>
<div class="line">    <span class="keywordflow">if</span> ( result != NULL &amp;&amp; !xmlXPathNodeSetIsEmpty (result-&gt;nodesetval) ) {</div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j =0 ; j &lt; result-&gt;nodesetval-&gt;nodeNr ; j++ ) {</div>
<div class="line">            xmlNodePtr reqNode =result-&gt;nodesetval-&gt;nodeTab [j] ;</div>
<div class="line">            context-&gt;node =reqNode-&gt;parent ;</div>
<div class="line">            <span class="comment">//- We ignore ./MayaEnv XML nodes since Maya already processed them</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">//- Search for ./ComponentEntry XML nodes</span></div>
<div class="line">            MModuleLogic::executeComponentEntry (data, context) ;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> ( result != NULL )</div>
<div class="line">    {</div>
<div class="line">        xmlXPathFreeObject (result) ;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( context != NULL )</div>
<div class="line">    {</div>
<div class="line">        xmlXPathFreeContext (context) ;</div>
<div class="line">    }</div>
<div class="line">    xmlFreeDoc (doc) ; <span class="comment">// Pointer already tested above</span></div>
<div class="line">    <span class="keywordflow">return</span> (<span class="keyword">true</span>) ;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> MModuleLogic::executeComponentEntry (threadData *data, xmlXPathContextPtr &amp;context) {</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> cmd ;</div>
<div class="line">    xmlChar *xpath =(xmlChar *)<span class="stringliteral">&quot;./ComponentEntry&quot;</span> ;</div>
<div class="line">    xmlXPathObjectPtr result =xmlXPathEvalExpression (xpath, context) ;</div>
<div class="line">    <span class="keywordflow">if</span> ( result != NULL &amp;&amp; !xmlXPathNodeSetIsEmpty (result-&gt;nodesetval) ) {</div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j =0 ; j &lt; result-&gt;nodesetval-&gt;nodeNr ; j++ ) {</div>
<div class="line">            xmlNodePtr compNode =result-&gt;nodesetval-&gt;nodeTab [j] ;</div>
<div class="line">            xmlChar *compName =xmlGetProp (compNode, (xmlChar *)<span class="stringliteral">&quot;ModuleName&quot;</span>) ;</div>
<div class="line">            xmlChar *autoload =xmlGetProp (compNode, (xmlChar *)<span class="stringliteral">&quot;AutoLoad&quot;</span>) ;</div>
<div class="line">            xmlChar *autoloadOnce = xmlGetProp (compNode, (xmlChar *)<span class="stringliteral">&quot;AutoLoadOnce&quot;</span>) ;</div>
<div class="line">            xmlChar *cmdInvoke =xmlGetProp (compNode, (xmlChar *)<span class="stringliteral">&quot;LoadOnCommandInvocation&quot;</span>) ;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ( autoload != NULL &amp;&amp; xmlStrcasecmp (autoload, (xmlChar *)<span class="stringliteral">&quot;true&quot;</span>) == 0 ) {</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_file_object.html">MFileObject</a> fobj ;</div>
<div class="line">                fobj.<a class="code" href="#!/url=./cpp_ref/class_m_file_object.html#ae998c69c8f2bf4f7436663676a735654">setRawName</a> (<a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> ((<span class="keywordtype">char</span> *)compName)) ;</div>
<div class="line">                <span class="comment">// For AutoLoad, plug-ins must be in the MAYA_PLUG_IN_PATH</span></div>
<div class="line">                cmd.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a07ae464181c795f43fa1bcc288acff91">format</a> (_T(<span class="stringliteral">&quot;if ( !`pluginInfo -query -loaded \&quot;^1s\&quot;` ) loadPlugin -quiet \&quot;^1s\&quot;;&quot;</span>), fobj.<a name="a20"></a><a class="code" href="#!/url=./cpp_ref/class_m_file_object.html#a614484d9028d9d09418b5e337c39b7a0">resolvedName</a> ()) ;</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a09e405631e7cf680f8ac9d934ad73434">MGlobal::executeCommand</a> (cmd, <span class="keyword">false</span>,  <span class="keyword">false</span>) ;</div>
<div class="line">                cmd.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a07ae464181c795f43fa1bcc288acff91">format</a> (_T(<span class="stringliteral">&quot;pluginInfo -q -path \&quot;^1s\&quot;;&quot;</span>), fobj.<a class="code" href="#!/url=./cpp_ref/class_m_file_object.html#a614484d9028d9d09418b5e337c39b7a0">resolvedName</a> ()) ;</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> st =<a class="code" href="#!/url=./cpp_ref/class_m_global.html#a8dd71fbf4d71dacf626180777ba91a62">MGlobal::executeCommandStringResult</a> (cmd, <span class="keyword">false</span>,  <span class="keyword">false</span>) ;</div>
<div class="line">                cmd.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a07ae464181c795f43fa1bcc288acff91">format</a> (_T(<span class="stringliteral">&quot;pluginInfo -edit -autoload true \&quot;^1s\&quot;;&quot;</span>), st) ;</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a09e405631e7cf680f8ac9d934ad73434">MGlobal::executeCommand</a> (cmd, <span class="keyword">false</span>,  <span class="keyword">false</span>) ;</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( autoloadOnce != NULL &amp;&amp; xmlStrcasecmp (autoloadOnce, (xmlChar *)<span class="stringliteral">&quot;true&quot;</span>) == 0 ) {</div>
<div class="line">                <span class="comment">// Same as for AutoLoad but check if we have OptionVar of already initialized</span></div>
<div class="line">                <span class="comment">// generate the oneTimeAutoLoad_pluginName</span></div>
<div class="line">                                <a class="code" href="#!/url=./cpp_ref/class_m_file_object.html">MFileObject</a> fobj ;</div>
<div class="line">                                fobj.<a class="code" href="#!/url=./cpp_ref/class_m_file_object.html#ae998c69c8f2bf4f7436663676a735654">setRawName</a> (<a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> ((<span class="keywordtype">char</span> *)compName)) ;</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> oneTimeAutoLoadPlugin = <span class="stringliteral">&quot;oneTimeAutoLoadPlugin&quot;</span> + fobj.<a class="code" href="#!/url=./cpp_ref/class_m_file_object.html#a614484d9028d9d09418b5e337c39b7a0">resolvedName</a>();</div>
<div class="line">                <span class="keywordflow">if</span> ( ! <a name="a21"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a75f7749b37a9015a347ab3ceaad6cb07">MGlobal::optionVarExists</a>(oneTimeAutoLoadPlugin) ){</div>
<div class="line">                    <a name="a22"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#ac4846b16993246fd74b83d1d5b9b6a9f">MGlobal::setOptionVarValue</a>(oneTimeAutoLoadPlugin, 1);</div>
<div class="line">                    <span class="comment">// For AutoLoadOnce, plug-ins must be in the MAYA_PLUG_IN_PATH</span></div>
<div class="line">                    cmd.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a07ae464181c795f43fa1bcc288acff91">format</a> (_T(<span class="stringliteral">&quot;if ( !`pluginInfo -query -loaded \&quot;^1s\&quot;` ) loadPlugin -quiet \&quot;^1s\&quot;;&quot;</span>), fobj.<a class="code" href="#!/url=./cpp_ref/class_m_file_object.html#a614484d9028d9d09418b5e337c39b7a0">resolvedName</a> ()) ;</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a09e405631e7cf680f8ac9d934ad73434">MGlobal::executeCommand</a> (cmd, <span class="keyword">false</span>,  <span class="keyword">false</span>) ;</div>
<div class="line">                    cmd.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a07ae464181c795f43fa1bcc288acff91">format</a> (_T(<span class="stringliteral">&quot;pluginInfo -q -path \&quot;^1s\&quot;;&quot;</span>), fobj.<a class="code" href="#!/url=./cpp_ref/class_m_file_object.html#a614484d9028d9d09418b5e337c39b7a0">resolvedName</a> ()) ;</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> st =<a class="code" href="#!/url=./cpp_ref/class_m_global.html#a8dd71fbf4d71dacf626180777ba91a62">MGlobal::executeCommandStringResult</a> (cmd, <span class="keyword">false</span>,  <span class="keyword">false</span>) ;</div>
<div class="line">                    cmd.<a class="code" href="#!/url=./cpp_ref/class_m_string.html#a07ae464181c795f43fa1bcc288acff91">format</a> (_T(<span class="stringliteral">&quot;pluginInfo -edit -autoload true \&quot;^1s\&quot;;&quot;</span>), st) ;</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a09e405631e7cf680f8ac9d934ad73434">MGlobal::executeCommand</a> (cmd, <span class="keyword">false</span>,  <span class="keyword">false</span>) ;</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( cmdInvoke != NULL &amp;&amp; xmlStrcasecmp (cmdInvoke, (xmlChar *)<span class="stringliteral">&quot;true&quot;</span>) == 0 ) {</div>
<div class="line">                <span class="comment">// Not supported yet</span></div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ( cmdInvoke != NULL )</div>
<div class="line">            {</div>
<div class="line">                xmlFree (cmdInvoke) ;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> ( autoload != NULL )</div>
<div class="line">            {</div>
<div class="line">                xmlFree (autoload) ;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> ( compName != NULL )</div>
<div class="line">            {</div>
<div class="line">                xmlFree (compName) ;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> ( result != NULL )</div>
<div class="line">    {</div>
<div class="line">        xmlXPathFreeObject (result) ;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (<span class="keyword">true</span>) ;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->

      <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
   </div></body>
</html>
