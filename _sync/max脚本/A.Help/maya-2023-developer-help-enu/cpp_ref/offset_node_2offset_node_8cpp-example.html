<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
      <title>C++ API Reference: offsetNode/offsetNode.cpp</title>
      
	  
      
      
      
      
      
      
      
    

</head>
   <body height="100%"><div class="body_content" id="body-content"><link rel="stylesheet" type="text/css" href="cpp_ref/navtree.css"><link rel="stylesheet" type="text/css" href="cpp_ref/doxygen.css"><link rel="stylesheet" type="text/css" href="cpp_ref/tabs.css"><link rel="stylesheet" type="text/css" href="style/adsk.cpm.css"><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('offset_node_2offset_node_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
      <div>
         <div class="head">
            <h1>C++ API Reference: offsetNode/offsetNode.cpp</h1>
         </div>

<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->

  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="#!/url=./cpp_ref/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="#!/url=./cpp_ref/pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="#!/url=./cpp_ref/modules.html"><span>Modules</span></a></li>
      <li><a href="#!/url=./cpp_ref/namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="#!/url=./cpp_ref/annotated.html"><span>Classes</span></a></li>
      <li><a href="#!/url=./cpp_ref/examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="cpp_ref/search/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="cpp_ref/search/close.png" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>

<div id="doc-content">
<!-- window showing the filter options -->


<!-- iframe showing the search results (closed by default) -->


<div class="header">
  <div class="headertitle">
<div class="title">offsetNode/offsetNode.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 2015 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk</span></div>
<div class="line"><span class="comment">// license agreement provided at the time of installation or download,</span></div>
<div class="line"><span class="comment">// or which otherwise accompanies this software in either electronic</span></div>
<div class="line"><span class="comment">// or hard copy form.</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// DESCRIPTION:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Produces the dependency graph node &quot;offsetNode&quot;.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This plug-in demonstrates how to create a user-defined weighted deformer</span></div>
<div class="line"><span class="comment">// with an associated shape. A deformer is a node which takes any number of</span></div>
<div class="line"><span class="comment">// input geometries, deforms them, and places the output into the output</span></div>
<div class="line"><span class="comment">// geometry attribute. This example plug-in defines a new deformer node</span></div>
<div class="line"><span class="comment">// that offsets vertices according to their CV&#39;s weights. The weights are set</span></div>
<div class="line"><span class="comment">// using the set editor or the percent command.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// The offset node example below is not meant to be a practical deformer to</span></div>
<div class="line"><span class="comment">// be used: it&#39;s only function is to explain certain concepts and give examples</span></div>
<div class="line"><span class="comment">// on how to use the API.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// The node moves all verts of the deforming geometry up along the y-axis</span></div>
<div class="line"><span class="comment">// in the local coordinate system of an external transform.</span></div>
<div class="line"><span class="comment">// Furthermore it optionally randomizes this offset slightly by looking up</span></div>
<div class="line"><span class="comment">// a random value in a table of user specified size based on the vertId.</span></div>
<div class="line"><span class="comment">// The size of the table is set by the user by defining the number of chunks.</span></div>
<div class="line"><span class="comment">// Is is important in this example for the GPU implementation that the table</span></div>
<div class="line"><span class="comment">// itself is not animatable, but the effect of it through the chunkEnvelope</span></div>
<div class="line"><span class="comment">// can be.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// To use this node:</span></div>
<div class="line"><span class="comment">//  - create a plane or some other object</span></div>
<div class="line"><span class="comment">//  - type: &quot;deformer -type offset&quot;</span></div>
<div class="line"><span class="comment">//  - a locator is created by the command, and you can use this locator</span></div>
<div class="line"><span class="comment">//    to control the direction of the offset. The object&#39;s CV&#39;s will be offset</span></div>
<div class="line"><span class="comment">//    by the value of the weights of the CV&#39;s (the default will be the weight * some constant)</span></div>
<div class="line"><span class="comment">//    in the direction of the y-vector of the locator</span></div>
<div class="line"><span class="comment">//  - you can edit the weights using either the component editor or by using</span></div>
<div class="line"><span class="comment">//    the percent command (eg. percent -v .5 offset1;)</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use this script to create a simple example with the offset node:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  loadPlugin offsetNode;</span></div>
<div class="line"><span class="comment">//  polyTorus -r 1 -sr 0.5 -tw 0 -sx 50 -sy 50 -ax 0 1 0 -cuv 1 -ch 1;</span></div>
<div class="line"><span class="comment">//  deformer -type &quot;offset&quot;;</span></div>
<div class="line"><span class="comment">//  setKeyframe -v 0 -at rotateZ -t 1 transform1;</span></div>
<div class="line"><span class="comment">//  setKeyframe -v 180 -at rotateZ -t 60 transform1;</span></div>
<div class="line"><span class="comment">//  select -cl;</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MIOStream.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MStringArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPxDeformerNode.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MItGeometry.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPxLocatorNode.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnNumericAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnMatrixAttribute.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnMatrixData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnFloatArrayData.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnPlugin.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnDependencyNode.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MTypeId.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPlug.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDataBlock.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDataHandle.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MArrayDataHandle.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPoint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MVector.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MMatrix.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MMatrixArray.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDagModifier.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPxGPUStandardDeformer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGPUDeformerRegistry.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MOpenCLBuffer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MOpenCLInfo.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MOpenCLUtils.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MViewport2Renderer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnMesh.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;clew/clew.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>offset : <span class="keyword">public</span> <a name="_a0"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_deformer_node.html">MPxDeformerNode</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">                        offset();</div>
<div class="line">                    ~offset() <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span>  <span class="keywordtype">void</span>*       creator();</div>
<div class="line">    <span class="keyword">static</span>  <a name="_a1"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a>     initialize();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// deformation function</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> <a name="a2"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_geometry_filter.html#a30d9732c7497ec1c8c7e431eaa5d61b6">deform</a>(<a name="_a3"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block,</div>
<div class="line">                   <a name="_a4"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html">MItGeometry</a>&amp; iter,</div>
<div class="line">                   <span class="keyword">const</span> <a name="_a5"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a>&amp; mat,</div>
<div class="line">                   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> multiIndex) <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// when the accessory is deleted, this node will clean itself up</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a name="_a6"></a><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>&amp;            <a name="a7"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_geometry_filter.html#a7abe9ec4327fca72caeea3c8d31299b2">accessoryAttribute</a>() <span class="keyword">const override</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create accessory nodes when the node is created</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a>             <a name="a8"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_geometry_filter.html#ab3cfade1b7f20f2d16fb805eb8126995">accessoryNodeSetup</a>(<a name="_a9"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_modifier.html">MDagModifier</a>&amp; cmd) <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Communicate fixed setup data to the GPU node</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> <a name="a10"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_geometry_filter.html#a3eaede9f36e08ff2eb4cc508f06cf860">getFixedSetupData</a>(<span class="keyword">const</span> <a name="_a11"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>&amp; name) <span class="keyword">override</span>;</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">    <a name="_a12"></a><a class="code" href="#!/url=./cpp_ref/class_m_float_array.html">MFloatArray</a> randomOffsetTable;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// local node attributes</span></div>
<div class="line">    <span class="keyword">static</span> <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> offsetMatrix; <span class="comment">// offset center and axis</span></div>
<div class="line">    <span class="keyword">static</span> <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> chunkCount;   <span class="comment">// The number of chunks we want.</span></div>
<div class="line">    <span class="keyword">static</span> <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> chunkEnvelope; <span class="comment">// The influence of the chunks.</span></div>
<div class="line">    <span class="keyword">static</span> <a name="_a13"></a><a class="code" href="#!/url=./cpp_ref/class_m_type_id.html">MTypeId</a> id;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// path from where the plugin was loaded</span></div>
<div class="line">    <span class="keyword">static</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> pluginPath;</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// local attributes</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_type_id.html">MTypeId</a> offset::id( 0x8000c );</div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> offset::offsetMatrix;</div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> offset::chunkEnvelope;</div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> offset::chunkCount;</div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> offset::pluginPath;</div>
<div class="line"></div>
<div class="line">offset::offset() {}</div>
<div class="line">offset::~offset() {}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span>* offset::creator()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> offset();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> offset::initialize()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// local attribute initialization</span></div>
<div class="line"></div>
<div class="line">    <a name="_a14"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_matrix_attribute.html">MFnMatrixAttribute</a>  mAttr;</div>
<div class="line">    offsetMatrix=mAttr.<a name="a15"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_matrix_attribute.html#acccc043a2ac80be8fe8e32bcc36b8696">create</a>( <span class="stringliteral">&quot;locateMatrix&quot;</span>, <span class="stringliteral">&quot;lm&quot;</span>);</div>
<div class="line">        mAttr.<a name="a16"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709">setStorable</a>(<span class="keyword">false</span>);</div>
<div class="line">        mAttr.<a name="a17"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#ab1986dcbce4e2fd86c5cb0bff5119dc0">setConnectable</a>(<span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">    <a name="_a18"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html">MFnNumericAttribute</a> nAttr;</div>
<div class="line">    chunkEnvelope = nAttr.<a name="a19"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( <span class="stringliteral">&quot;chunkEnvelope&quot;</span>, <span class="stringliteral">&quot;che&quot;</span>, <a name="a20"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a5686197bafb177bdc82550848416a1ad">MFnNumericData::kFloat</a>, 0.0 );</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709">setStorable</a>(<span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">    chunkCount = nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#a5c08a5ce5e7123cc444c95a0e4a50f29">create</a>( <span class="stringliteral">&quot;chunkCount&quot;</span>, <span class="stringliteral">&quot;chc&quot;</span>, <a name="a21"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_data.html#a1d1cfd8ffb84e947f82999c682b666a7a9bb31be73c01d40428195449f62588ac">MFnNumericData::kInt</a>, 0 );</div>
<div class="line">    nAttr.<a name="a22"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#aba21b33176bb831de026b78605c1dcf3">setMin</a>(0);</div>
<div class="line">    nAttr.<a name="a23"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_numeric_attribute.html#adab95fd85497b1dad3a4ba7a842ce9d8">setMax</a>(20);</div>
<div class="line">    nAttr.<a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a8d2be80de133a200a455bf9e2ac1b709">setStorable</a>(<span class="keyword">true</span>);</div>
<div class="line">    <span class="comment">// We do not want this keyable since it is a parameter that alters the</span></div>
<div class="line">    <span class="comment">// internal setup that is communicated to the GPU</span></div>
<div class="line">    nAttr.<a name="a24"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_attribute.html#a9e68a8b4af016b37f6567cfa6d68e551">setKeyable</a>(<span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//  deformation attributes</span></div>
<div class="line">    addAttribute( offsetMatrix);</div>
<div class="line">    addAttribute( chunkEnvelope );</div>
<div class="line">    addAttribute( chunkCount );</div>
<div class="line"></div>
<div class="line">    attributeAffects( offset::offsetMatrix, offset::outputGeom );</div>
<div class="line">    attributeAffects( offset::chunkEnvelope, offset::outputGeom );</div>
<div class="line">    attributeAffects( offset::chunkCount, offset::outputGeom );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a name="a25"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html#a02ab596f4febca68da503aaf8dde3a80af0536797208144380691e2b376ffc1d1">MStatus::kSuccess</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a></div>
<div class="line">offset::deform( <a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block,</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html">MItGeometry</a>&amp; iter,</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a>&amp; <span class="comment">/*m*/</span>,</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> multiIndex)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> returnStatus;</div>
<div class="line">    <span class="comment">// Envelope data from the base class.</span></div>
<div class="line">    <span class="comment">// The envelope is simply a scale factor.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a name="_a26"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html">MDataHandle</a> envData = block.<a name="a27"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_block.html#af4a356799acd4ed070d372ed7cfb4706">inputValue</a>(envelope, &amp;returnStatus);</div>
<div class="line">    <span class="keywordflow">if</span> (MS::kSuccess != returnStatus)</div>
<div class="line">        <span class="keywordflow">return</span> returnStatus;</div>
<div class="line">    <span class="keywordtype">float</span> env = envData.<a name="a28"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a43df510424a7de372dd130315d9f223c">asFloat</a>();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html">MDataHandle</a> chunkEnvelopeData = block.<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html#af4a356799acd4ed070d372ed7cfb4706">inputValue</a>( chunkEnvelope, &amp;returnStatus );</div>
<div class="line">    <span class="keywordtype">float</span> chunkWeight = chunkEnvelopeData.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a43df510424a7de372dd130315d9f223c">asFloat</a>();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html">MDataHandle</a> chunkCountData = block.<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html#af4a356799acd4ed070d372ed7cfb4706">inputValue</a>( chunkCount, &amp;returnStatus );</div>
<div class="line">    <span class="keywordtype">int</span> numChunks = chunkCountData.<a name="a29"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a4c3fb2724eadb8e8a3cca8ff1af10dfd">asInt</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (numChunks != randomOffsetTable.length()) {</div>
<div class="line">        <span class="comment">// We are rebuilding the randomOffsetTable. This happens rarely</span></div>
<div class="line">        <span class="comment">// and only because a change to the setup is made, in this case</span></div>
<div class="line">        <span class="comment">// by altering the non-animatable chunkCount attribute</span></div>
<div class="line">        srand(numChunks*827);</div>
<div class="line">        randomOffsetTable.setLength(numChunks);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; numChunks; ++i) {</div>
<div class="line">            <span class="keywordtype">float</span> r = (rand() % 1001)/500.0 - 1.0;</div>
<div class="line">            randomOffsetTable.set(r, i);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Get the matrix which is used to define the direction and scale</span></div>
<div class="line">    <span class="comment">// of the offset.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html">MDataHandle</a> matData = block.<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html#af4a356799acd4ed070d372ed7cfb4706">inputValue</a>(offsetMatrix, &amp;returnStatus );</div>
<div class="line">    <span class="keywordflow">if</span> (MS::kSuccess != returnStatus) <span class="keywordflow">return</span> returnStatus;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> omat = matData.<a name="a30"></a><a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#aaa25e9866d30fc06edc510817e32a8f2">asMatrix</a>();</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> omatinv = omat.<a name="a31"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix.html#a8ca5ebc404566e2c4a16d4754772e082">inverse</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> useRandomOffset = (numChunks &gt; 0 &amp;&amp; chunkWeight &gt; 0.0);</div>
<div class="line">    <span class="comment">// iterate through each point in the geometry</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">for</span> ( ; !iter.<a name="a32"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html#a8b6dbf6fbab6f4e7bf50a309124cbf4c">isDone</a>(); iter.<a name="a33"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html#a73616f002814b8abe6d921db72d7a496">next</a>()) {</div>
<div class="line">        <a name="_a34"></a><a class="code" href="#!/url=./cpp_ref/class_m_point.html">MPoint</a> pt = iter.<a name="a35"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html#a5880c110ed81dd4da0289ccdca5c1592">position</a>();</div>
<div class="line">        pt *= omatinv;</div>
<div class="line">        <span class="keywordtype">float</span> weight = weightValue(block,multiIndex,iter.<a name="a36"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html#ae85767d1d26fc7491279d1f2c277b499">index</a>());</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (useRandomOffset)</div>
<div class="line">            weight *= (1.0 + chunkWeight*randomOffsetTable[iter.<a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html#ae85767d1d26fc7491279d1f2c277b499">index</a>()%numChunks]);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// offset algorithm</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        pt.<a name="a37"></a><a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab927965981178aa1fba979a37168db2a">y</a> = pt.<a class="code" href="#!/url=./cpp_ref/class_m_point.html#ab927965981178aa1fba979a37168db2a">y</a> + env*weight;</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// end of offset algorithm</span></div>
<div class="line"></div>
<div class="line">        pt *= omat;</div>
<div class="line">        iter.<a name="a38"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_geometry.html#aab29469f67fee14833472410a17de18f">setPosition</a>(pt);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> returnStatus;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">/* override */</span></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a>&amp;</div>
<div class="line">offset::accessoryAttribute() const</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//    This method returns a the attribute to which an accessory</span></div>
<div class="line"><span class="comment">//    shape is connected. If the accessory shape is deleted, the deformer</span></div>
<div class="line"><span class="comment">//    node will automatically be deleted.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  This method is optional.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> offset::offsetMatrix;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* override */</span></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a></div>
<div class="line">offset::accessoryNodeSetup(<a class="code" href="#!/url=./cpp_ref/class_m_dag_modifier.html">MDagModifier</a>&amp; cmd)</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      This method is called when the deformer is created by the</span></div>
<div class="line"><span class="comment">//      &quot;deformer&quot; command. You can add to the cmds in the MDagModifier</span></div>
<div class="line"><span class="comment">//      cmd in order to hook up any additional nodes that your node needs</span></div>
<div class="line"><span class="comment">//      to operate.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//      In this example, we create a locator and attach its matrix attribute</span></div>
<div class="line"><span class="comment">//      to the matrix input on the offset node. The locator is used to</span></div>
<div class="line"><span class="comment">//      set the direction and scale of the random field.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      This method is optional.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> result;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// hook up the accessory node</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> objLoc = cmd.<a name="a39"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_modifier.html#ae169eb7f1ddc00f53ba69ac2d1815950">createNode</a>(<a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>(<span class="stringliteral">&quot;locator&quot;</span>),</div>
<div class="line">                                    <a name="a40"></a><a class="code" href="#!/url=./cpp_ref/class_m_object.html#af2a707b4254eb54763167aeced863e63">MObject::kNullObj</a>,</div>
<div class="line">                                    &amp;result);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (MS::kSuccess == result) {</div>
<div class="line">        <a name="_a41"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> fnLoc(objLoc);</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> attrName;</div>
<div class="line">        attrName.<a name="a42"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html#acee761fe098fc30a5ac1437e3aca5bc0">set</a>(<span class="stringliteral">&quot;matrix&quot;</span>);</div>
<div class="line">        <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> attrMat = fnLoc.attribute(attrName);</div>
<div class="line"></div>
<div class="line">        result = cmd.<a name="a43"></a><a class="code" href="#!/url=./cpp_ref/class_m_d_g_modifier.html#afbd18f066f70fcd1864ddb4af91f3c7b">connect</a>(objLoc,attrMat,this-&gt;thisMObject(),offset::offsetMatrix);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* override */</span></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a></div>
<div class="line">offset::getFixedSetupData(<span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a>&amp; name)</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      This method is called when the GPU deformer wants certain setup data</span></div>
<div class="line"><span class="comment">//      identified by the string name.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//      In this example, the node has created an internal randomOffsetTable</span></div>
<div class="line"><span class="comment">//      which we want to pass to the GPU node. This allows the GPU node to remain</span></div>
<div class="line"><span class="comment">//      ignorant of how this table is being calculated and thereby avoids code</span></div>
<div class="line"><span class="comment">//      duplication that would be hard to keep in sync between the CPU and GPU.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      This method is optional.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;randomOffsetTable&quot;</span>) {</div>
<div class="line">        <a name="_a44"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_float_array_data.html">MFnFloatArrayData</a> fn;</div>
<div class="line">        <span class="keywordflow">return</span> fn.<a name="a45"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_float_array_data.html#af1adb4abaf5243c6c0749bcca7b5c418">create</a>(randomOffsetTable);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="#!/url=./cpp_ref/class_m_object.html#af2a707b4254eb54763167aeced863e63">MObject::kNullObj</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// -----------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// the GPU override implementation of the offsetNode</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// -----------------------------------------------------------------------------</span></div>
<div class="line"><span class="keyword">class </span>offsetGPUDeformer : <span class="keyword">public</span> <a name="_a46"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_g_p_u_standard_deformer.html">MPxGPUStandardDeformer</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Virtual methods from MPxGPUDeformer</span></div>
<div class="line">    offsetGPUDeformer();</div>
<div class="line">    ~offsetGPUDeformer() <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line">    MPxGPUDeformer::DeformerStatus <a name="a47"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_g_p_u_deformer.html#a070259639bc552fd702c9e8e042f0331">evaluate</a>(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a name="_a48"></a><a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a name="_a49"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; outputPlug, <span class="keyword">const</span> <a name="_a50"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug_array.html">MPlugArray</a>&amp; inputPlugs, <span class="keyword">const</span> <a name="_a51"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_data.html">MGPUDeformerData</a>&amp; inputData, <a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_data.html">MGPUDeformerData</a>&amp; outputData) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a name="a52"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_g_p_u_standard_deformer.html#a62c367816998938c7ebcbb93130aa0a0">terminate</a>() <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> <a name="_a53"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registration_info.html">MGPUDeformerRegistrationInfo</a>* getGPUDeformerInfo();</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> validateNodeInGraph(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp;, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug, <a name="_a54"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>* messages);</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> validateNodeValues(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp;, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug, <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>* messages);</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="comment">// helper methods</span></div>
<div class="line">    <span class="keywordtype">bool</span> extractOffsetMatrix(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug);</div>
<div class="line">    <span class="keywordtype">bool</span> extractRandomOffsetTable(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug);</div>
<div class="line"></div>
<div class="line">    cl_int enqueueDeformation(<a name="_a55"></a><a class="code" href="#!/url=./cpp_ref/class_m_auto_c_l_event.html">MAutoCLEvent</a>&amp; syncEvent, <span class="keyword">const</span> <a name="_a56"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html">MGPUDeformerBuffer</a>&amp; inputPositions, <a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html">MGPUDeformerBuffer</a>&amp; outputPositions);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Storage for data on the GPU</span></div>
<div class="line">    <a name="_a57"></a><a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_buffer.html">MOpenCLBuffer</a> fOffsetMatrixBuffer;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_buffer.html">MOpenCLBuffer</a> fRandomOffsetTableBuffer;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fRandomOffsetTableSize;</div>
<div class="line">    <span class="keywordtype">float</span> fChunkEnvelope;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Kernel</span></div>
<div class="line">    <a name="_a58"></a><a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_kernel_info.html">MOpenCLKernelInfo</a> fKernelInfo;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>offsetNodeGPUDeformerInfo : <span class="keyword">public</span> <a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registration_info.html">MGPUDeformerRegistrationInfo</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    offsetNodeGPUDeformerInfo() {}</div>
<div class="line">    ~offsetNodeGPUDeformerInfo()<span class="keyword"> override</span>{}</div>
<div class="line"></div>
<div class="line">    <a name="_a59"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_g_p_u_deformer.html">MPxGPUDeformer</a>* <a name="a60"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registration_info.html#a69ee4850048ea760d9e03f2deaf957e4">createGPUDeformer</a>()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">new</span> offsetGPUDeformer();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a61"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registration_info.html#af612f89c960cf432dc7be0d3f1be8d93">validateNodeInGraph</a>(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug, <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>* messages)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">return</span> offsetGPUDeformer::validateNodeInGraph(block, evaluationNode, plug, messages);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a62"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registration_info.html#a5211d6842c7677f9730a9c76cb258568">validateNodeValues</a>(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug, <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>* messages)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">return</span> offsetGPUDeformer::validateNodeValues(block, evaluationNode, plug, messages);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registration_info.html">MGPUDeformerRegistrationInfo</a>* offsetGPUDeformer::getGPUDeformerInfo()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> offsetNodeGPUDeformerInfo theOne;</div>
<div class="line">    <span class="keywordflow">return</span> &amp;theOne;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">offsetGPUDeformer::offsetGPUDeformer()</div>
<div class="line">    : <a class="code" href="#!/url=./cpp_ref/class_m_px_g_p_u_standard_deformer.html">MPxGPUStandardDeformer</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Remember the ctor must be fast.  No heavy work should be done here.</span></div>
<div class="line">    <span class="comment">// Maya may allocate one of these and then never use it.</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">offsetGPUDeformer::~offsetGPUDeformer()</div>
<div class="line">{</div>
<div class="line">    terminate();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* static */</span></div>
<div class="line"><span class="keywordtype">bool</span> offsetGPUDeformer::validateNodeInGraph(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug, <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>* messages)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// offsetGPUDeformer supports everything on the offset node except chunkEnvelope</span></div>
<div class="line">    <span class="comment">// chunkEnvelope is handled in validateNodeValues because we support some values</span></div>
<div class="line">    <span class="comment">// but not others.</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* static */</span></div>
<div class="line"><span class="keywordtype">bool</span> offsetGPUDeformer::validateNodeValues(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug, <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a>* messages)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// As an example offsetGPUDeformer has conditional support for the chunkEnvelope</span></div>
<div class="line">    <span class="comment">// attribute. The offsetGPUDeformer supports the underlying depend node only if</span></div>
<div class="line">    <span class="comment">// chunkEnvelop is 0.0 or larger. Otherwise, the underlying node is not supported.</span></div>
<div class="line">    <span class="comment">// Note that in additional to testing the value of the attribute here we have also</span></div>
<div class="line">    <span class="comment">// registered it as a conditional attribute in offsetNodeGPUDeformerInfo.</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> node = plug.<a name="a63"></a><a class="code" href="#!/url=./cpp_ref/class_m_plug.html#ae024049dad815f2f186e6a4fead8be51">node</a>();</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html">MFnDependencyNode</a> fnNode(node);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check the values of the conditional attributes we added to make sure they are still at</span></div>
<div class="line">    <span class="comment">// values that allow this node to be valid on the GPU. In this case we will check to see</span></div>
<div class="line">    <span class="comment">// if chunkEnvelope is smaller than 0.0 and if so we disqualify this node.</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a> chunkEnvelopePlug(node, offset::chunkEnvelope);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html">MDataHandle</a> chunkEnvelopeData;</div>
<div class="line">    chunkEnvelopePlug.getValue(chunkEnvelopeData);</div>
<div class="line">    <span class="keywordflow">if</span> (chunkEnvelopeData.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a43df510424a7de372dd130315d9f223c">asFloat</a>() &lt; 0.0)</div>
<div class="line">    {</div>
<div class="line">        <a name="a64"></a><a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_info.html#a8682346bb79641242ffc37e0b163f136">MOpenCLInfo::appendMessage</a>(messages, <span class="stringliteral">&quot;Offset %s not supported by deformer evaluator because chunkEnvelope is smaller than 0.0&quot;</span>, fnNode.name().asChar());</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cl_int offsetGPUDeformer::enqueueDeformation(</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_auto_c_l_event.html">MAutoCLEvent</a>&amp; syncEvent,</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html">MGPUDeformerBuffer</a>&amp; inputPositions,</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html">MGPUDeformerBuffer</a>&amp; outputPositions)</div>
<div class="line">{</div>
<div class="line">    cl_int err = CL_SUCCESS;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count = affectCount();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_auto_c_l_event.html">MAutoCLEvent</a> syncInputEvent = syncEvent;</div>
<div class="line">    syncEvent = <a class="code" href="#!/url=./cpp_ref/class_m_auto_c_l_event.html">MAutoCLEvent</a>();</div>
<div class="line"></div>
<div class="line">    MGPUEventList eventList;</div>
<div class="line">    eventList.<a name="a65"></a><a class="code" href="#!/url=./cpp_ref/class_m_auto_c_l_event_list.html#a8692d830f89f7fb213410850e6e1bec6">add</a>(syncInputEvent);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set all of our kernel parameters.  Input buffer and output buffer may be changing every frame so always set them.</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> parameterId = 0;</div>
<div class="line">    err = fKernelInfo.setKernelArgBuffer(parameterId++, outputPositions.<a name="a66"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html#a1978a75e975b7269214d00fef1c5f910">buffer</a>(), err);</div>
<div class="line">    err = fKernelInfo.setKernelArgBuffer(parameterId++, inputPositions.<a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_buffer.html#a1978a75e975b7269214d00fef1c5f910">buffer</a>(), err);</div>
<div class="line">    err = fKernelInfo.setKernelArgBuffer(parameterId++, weightsBuffer(), err, hasEnvelopeWeights());</div>
<div class="line">    err = fKernelInfo.setKernelArgBuffer(parameterId++, affectMapBuffer(), err, !isIdentityMap());</div>
<div class="line">    err = fKernelInfo.setKernelArgBuffer(parameterId++, fOffsetMatrixBuffer, err);</div>
<div class="line">    err = fKernelInfo.setKernelArgBuffer(parameterId++, fRandomOffsetTableBuffer, err);</div>
<div class="line">    err = fKernelInfo.setKernelArg&lt;cl_uint&gt;(parameterId++, fRandomOffsetTableSize, err);</div>
<div class="line">    err = fKernelInfo.setKernelArg&lt;cl_float&gt;(parameterId++, envelope(), err);</div>
<div class="line">    err = fKernelInfo.setKernelArg&lt;cl_float&gt;(parameterId++, fChunkEnvelope, err);</div>
<div class="line">    err = fKernelInfo.setKernelArg&lt;cl_uint&gt;(parameterId++, count, err);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// run the kernel</span></div>
<div class="line">    <span class="keywordflow">return</span> CL_SUCCESS == err ? fKernelInfo.enqueueKernel(eventList, syncEvent) : err;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MPxGPUDeformer::DeformerStatus offsetGPUDeformer::evaluate(</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block,                          <span class="comment">// data block for &quot;this&quot; node</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode,      <span class="comment">// evaluation node representing &quot;this&quot; node</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug,                          <span class="comment">// the multi index we&#39;re working on.  There will be a separate instance created per multi index</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug_array.html">MPlugArray</a> &amp; inputPlugs,              <span class="comment">// the input plugs which have GPU data in inputData</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_data.html">MGPUDeformerData</a>&amp; inputData,          <span class="comment">// the input data provided by Maya or other upstream GPU Deformers</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_data.html">MGPUDeformerData</a>&amp; outputData                <span class="comment">// the output data to be passed to the rendering system or other downstream GPU Deformers</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_auto_c_l_event.html">MAutoCLEvent</a> syncEvent;</div>
<div class="line">    MPxGPUDeformer::DeformerStatus ds = prepareEvaluation(block, evaluationNode, plug, inputPlugs, inputData, outputData, syncEvent);</div>
<div class="line">    <span class="keywordflow">if</span> (ds != MPxGPUDeformer::kDeformerSuccess)</div>
<div class="line">        <span class="keywordflow">return</span> ds;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*bool subsetChanged =*/</span> prepareAffectMapBuffer();</div>
<div class="line">    <span class="comment">/*bool weightsChanged =*/</span> prepareWeightsBuffer(evaluationNode);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// In case the implementation needs to respond to changes in the subset or</span></div>
<div class="line">    <span class="comment">// topology the return value of prepareAffectMapBuffer can be used to</span></div>
<div class="line">    <span class="comment">// trigger the appropriate actions.</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// In case the implementation needs to respond to changes in envelope weights</span></div>
<div class="line">    <span class="comment">// the return value of prepareWeightsBuffer can be used to trigger the</span></div>
<div class="line">    <span class="comment">// appropriate actions.</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// This node is deforming affectCount() of fullCount() verts.</span></div>
<div class="line">    <span class="comment">// isIdentityMap() tells us whether we are fully deforming the geometry or not.</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// The envelope for the deformer is envelope() and hasEnvelopeWeights() tells</span></div>
<div class="line">    <span class="comment">// us whether we have per vertex weight.</span></div>
<div class="line"></div>
<div class="line">    extractOffsetMatrix(block, evaluationNode, plug);</div>
<div class="line">    extractRandomOffsetTable(block, evaluationNode, plug);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html">MDataHandle</a> chunkEnvelopeData = block.<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html#af4a356799acd4ed070d372ed7cfb4706">inputValue</a>(offset::chunkEnvelope, &amp;status );</div>
<div class="line">    fChunkEnvelope = (MS::kSuccess != status) ? 1.0 : chunkEnvelopeData.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#a43df510424a7de372dd130315d9f223c">asFloat</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Now that all the data we care about is on the GPU, setup and run the OpenCL Kernel</span></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> openCLKernelFile = offset::pluginPath + <span class="stringliteral">&quot;/offset.cl&quot;</span>;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> openCLKernelName(<span class="stringliteral">&quot;offset&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!fKernelInfo.loadOrUpdate(openCLKernelFile, openCLKernelName, affectCount()))</div>
<div class="line">        <span class="keywordflow">return</span> MPxGPUDeformer::kDeformerFailure;</div>
<div class="line"></div>
<div class="line">    cl_int err = CL_SUCCESS;</div>
<div class="line">    err = initializeOutputPositions(syncEvent);</div>
<div class="line">    <span class="keywordflow">if</span> ( err != CL_SUCCESS )</div>
<div class="line">        <span class="keywordflow">return</span> MPxGPUDeformer::kDeformerFailure;</div>
<div class="line"></div>
<div class="line">    err = enqueueDeformation(syncEvent, inputPositions(), outputPositions());</div>
<div class="line">    <span class="keywordflow">if</span> ( err != CL_SUCCESS )</div>
<div class="line">        <span class="keywordflow">return</span> MPxGPUDeformer::kDeformerFailure;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> finishEvaluation(syncEvent, outputData);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> offsetGPUDeformer::terminate()</div>
<div class="line">{</div>
<div class="line">    fOffsetMatrixBuffer.reset();</div>
<div class="line">    fRandomOffsetTableBuffer.reset();</div>
<div class="line">    fKernelInfo.reset();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_px_g_p_u_standard_deformer.html#a62c367816998938c7ebcbb93130aa0a0">MPxGPUStandardDeformer::terminate</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> offsetGPUDeformer::extractOffsetMatrix(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// I pass the offset matrix to OpenCL using a buffer as well.  I also send down the inverse matrix to avoid calculating it many times on the GPU</span></div>
<div class="line">    <span class="keywordflow">if</span> (!isBufferUpdateNeeded(fOffsetMatrixBuffer, evaluationNode, offset::offsetMatrix))</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// we are up to date</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> status;</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html">MDataHandle</a> matData = block.<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html#af4a356799acd4ed070d372ed7cfb4706">inputValue</a>(offset::offsetMatrix, &amp;status );</div>
<div class="line">    <span class="keywordflow">if</span> (MS::kSuccess != status)</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_matrix.html">MMatrix</a> omat = matData.<a class="code" href="#!/url=./cpp_ref/class_m_data_handle.html#aaa25e9866d30fc06edc510817e32a8f2">asMatrix</a>();</div>
<div class="line">    <span class="comment">// Convert the matrix from Maya format to the format the OpenCL kernel expects</span></div>
<div class="line">    <a name="_a67"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix_array.html">MMatrixArray</a> array(2);</div>
<div class="line">    array.set(omat.<a name="a68"></a><a class="code" href="#!/url=./cpp_ref/class_m_matrix.html#a6fadbac6023eb9d361176a87b73063dc">transpose</a>(), 0);</div>
<div class="line">    array.set(omat.<a class="code" href="#!/url=./cpp_ref/class_m_matrix.html#a8ca5ebc404566e2c4a16d4754772e082">inverse</a>().<a class="code" href="#!/url=./cpp_ref/class_m_matrix.html#a6fadbac6023eb9d361176a87b73063dc">transpose</a>(), 1);</div>
<div class="line"></div>
<div class="line">    cl_int err = <a name="a69"></a><a class="code" href="#!/url=./cpp_ref/class_m_open_c_l_utils.html#a6ea49f6d5096c12d24cd1e3e0204accb">MOpenCLUtils::uploadToGPU</a>(array, fOffsetMatrixBuffer, MOpenCLUtils::kBlocking);</div>
<div class="line">    <span class="keywordflow">return</span> (err == CL_SUCCESS);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> offsetGPUDeformer::extractRandomOffsetTable(<a class="code" href="#!/url=./cpp_ref/class_m_data_block.html">MDataBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_evaluation_node.html">MEvaluationNode</a>&amp; evaluationNode, <span class="keyword">const</span> <a class="code" href="#!/url=./cpp_ref/class_m_plug.html">MPlug</a>&amp; plug)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!isBufferUpdateNeeded(fRandomOffsetTableBuffer, evaluationNode, offset::chunkCount))</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// we are up to date</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// The randomOffsetTable on the CPU node has been modified so now go ask the CPU for its data.</span></div>
<div class="line">    <span class="comment">// Then upload it to a GPU buffer we can use in our kernel.</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Deeper dive explanation:</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// We could of course instead replicate the code that generates the randomOffsetTable based on the node parameters</span></div>
<div class="line">    <span class="comment">// here. But that would add a lot of maintenance costs to make sure we do the identical work to avoid mismatches</span></div>
<div class="line">    <span class="comment">// between the CPU and GPU implementation. The getFixedSetupData call below allows us to tunnel through to get</span></div>
<div class="line">    <span class="comment">// the exact data we want. This will move all logic to the CPU and the only responsibility of the GPU node is to</span></div>
<div class="line">    <span class="comment">// upload it and use it in the kernel.</span></div>
<div class="line">    <span class="comment">// This should of course only be done for data that does not depend in any way on any animated attributes. The</span></div>
<div class="line">    <span class="comment">// data should already be present on the CPU node and it should not cause any computation to be done in the</span></div>
<div class="line">    <span class="comment">// graph on the CPU.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">    cl_int err = CL_SUCCESS;</div>
<div class="line">    err = uploadFixedSetupData(<span class="stringliteral">&quot;randomOffsetTable&quot;</span>, fRandomOffsetTableBuffer, err, &amp;fRandomOffsetTableSize);</div>
<div class="line">    <span class="keywordflow">return</span> (err == CL_SUCCESS);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// standard initialization procedures</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> initializePlugin( <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> obj )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> result;</div>
<div class="line">    <a name="_a70"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_plugin.html">MFnPlugin</a> plugin( obj, PLUGIN_COMPANY, <span class="stringliteral">&quot;3.0&quot;</span>, <span class="stringliteral">&quot;Any&quot;</span>);</div>
<div class="line">    result = plugin.registerNode( <span class="stringliteral">&quot;offset&quot;</span>, offset::id, offset::creator,</div>
<div class="line">                                  offset::initialize, <a name="a71"></a><a class="code" href="#!/url=./cpp_ref/class_m_px_node.html#a1d1cfd8ffb84e947f82999c682b666a7a397b2fe312ffa55c207f8f9b12f616d3">MPxNode::kDeformerNode</a> );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> nodeClassName(<span class="stringliteral">&quot;offset&quot;</span>);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> registrantId(<span class="stringliteral">&quot;mayaPluginExample&quot;</span>);</div>
<div class="line">    <a name="a72"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registry.html#adea377dddd00bec03a6cdf70360f567f">MGPUDeformerRegistry::registerGPUDeformerCreator</a>(</div>
<div class="line">        nodeClassName,</div>
<div class="line">        registrantId,</div>
<div class="line">        offsetGPUDeformer::getGPUDeformerInfo());</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Specify the attributes which can determine the validaty of the GPU</span></div>
<div class="line">    <span class="comment">// deformer based on their value.</span></div>
<div class="line">    <a name="a73"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registry.html#a2e96bdde07077e4af65457c6edb9c11a">MGPUDeformerRegistry::addConditionalAttribute</a>(</div>
<div class="line">            nodeClassName,</div>
<div class="line">            registrantId,</div>
<div class="line">            offset::chunkEnvelope);</div>
<div class="line"></div>
<div class="line">    offset::pluginPath = plugin.loadPath();</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> uninitializePlugin( <a class="code" href="#!/url=./cpp_ref/class_m_object.html">MObject</a> obj)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> result;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> nodeClassName(<span class="stringliteral">&quot;offset&quot;</span>);</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> registrantId(<span class="stringliteral">&quot;mayaPluginExample&quot;</span>);</div>
<div class="line">    <a name="a74"></a><a class="code" href="#!/url=./cpp_ref/class_m_g_p_u_deformer_registry.html#aa290ea8dc9cb67e1056f132b8e441d5f">MGPUDeformerRegistry::deregisterGPUDeformerCreator</a>(</div>
<div class="line">        nodeClassName,</div>
<div class="line">        registrantId);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_fn_plugin.html">MFnPlugin</a> plugin(obj);</div>
<div class="line">    result = plugin.deregisterNode(offset::id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->

      <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
   </div></body>
</html>
