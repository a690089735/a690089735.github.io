<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
      <title>C++ API Reference: ik2Bsolver/AwMatrix.cpp</title>
      
	  
      
      
      
      
      
      
      
    

</head>
   <body height="100%"><div class="body_content" id="body-content"><link rel="stylesheet" type="text/css" href="cpp_ref/navtree.css"><link rel="stylesheet" type="text/css" href="cpp_ref/doxygen.css"><link rel="stylesheet" type="text/css" href="cpp_ref/tabs.css"><link rel="stylesheet" type="text/css" href="style/adsk.cpm.css"><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('ik2_bsolver_2_aw_matrix_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
      <div>
         <div class="head">
            <h1>C++ API Reference: ik2Bsolver/AwMatrix.cpp</h1>
         </div>

<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->

  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="#!/url=./cpp_ref/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="#!/url=./cpp_ref/pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="#!/url=./cpp_ref/modules.html"><span>Modules</span></a></li>
      <li><a href="#!/url=./cpp_ref/namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="#!/url=./cpp_ref/annotated.html"><span>Classes</span></a></li>
      <li><a href="#!/url=./cpp_ref/examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="cpp_ref/search/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="cpp_ref/search/close.png" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>

<div id="doc-content">
<!-- window showing the filter options -->


<!-- iframe showing the search results (closed by default) -->


<div class="header">
  <div class="headertitle">
<div class="title">ik2Bsolver/AwMatrix.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 1995,2006,2008 Autodesk, Inc. All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk</span></div>
<div class="line"><span class="comment">// license agreement provided at the time of installation or download,</span></div>
<div class="line"><span class="comment">// or which otherwise accompanies this software in either electronic</span></div>
<div class="line"><span class="comment">// or hard copy form.</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  CLASS:    AwMatrix</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// *****************************************************************************</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  CLASS DESCRIPTION (AwMatrix)</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  This class is a standard 4x4 double matrix.  Simple operations</span></div>
<div class="line"><span class="comment">//  such as multiplication, inversion and transposition are supported.</span></div>
<div class="line"><span class="comment">//  An indexing function is supplied, but if required, users can</span></div>
<div class="line"><span class="comment">//  access the matrix elements directly.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// *****************************************************************************</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MIOStream.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define  COMPILE_OUTSIDE_MAYA</span></div>
<div class="line"><span class="preprocessor">#include &lt;AwMath.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;AwPoint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;AwVector.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;AwMatrix.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define DET2X2(a,b,c,d) (a*d-b*c)</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define DET3X3(a1,a2,a3,b1,b2,b3,c1,c2,c3) </span><span class="comment">/* | a1 b1 c1 | */</span><span class="preprocessor"> \</span></div>
<div class="line"><span class="preprocessor">           ( a1 * DET2X2( b2, b3, c2, c3 ) </span><span class="comment">/* | a2 b2 c2 | */</span><span class="preprocessor"> \</span></div>
<div class="line"><span class="preprocessor">           - b1 * DET2X2( a2, a3, c2, c3 ) </span><span class="comment">/* | a3 b3 c3 | */</span><span class="preprocessor"> \</span></div>
<div class="line"><span class="preprocessor">           + c1 * DET2X2( a2, a3, b2, b3 ) )</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Initialize constant</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keyword">const</span> AwMatrix AwMatrix::identity;</div>
<div class="line"></div>
<div class="line">AwMatrix &amp;AwMatrix::setToIdentity()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description: </span></div>
<div class="line"><span class="comment">//      Sets the matrix to the identity.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    matrix[0][0] = 1.0;</div>
<div class="line">    matrix[0][1] = 0.0;</div>
<div class="line">    matrix[0][2] = 0.0;</div>
<div class="line">    matrix[0][3] = 0.0;</div>
<div class="line">    matrix[1][0] = 0.0;</div>
<div class="line">    matrix[1][1] = 1.0;</div>
<div class="line">    matrix[1][2] = 0.0;</div>
<div class="line">    matrix[1][3] = 0.0;</div>
<div class="line">    matrix[2][0] = 0.0;</div>
<div class="line">    matrix[2][1] = 0.0;</div>
<div class="line">    matrix[2][2] = 1.0;</div>
<div class="line">    matrix[2][3] = 0.0;</div>
<div class="line">    matrix[3][0] = 0.0;</div>
<div class="line">    matrix[3][1] = 0.0;</div>
<div class="line">    matrix[3][2] = 0.0;</div>
<div class="line">    matrix[3][3] = 1.0;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">AwMatrix AwMatrix::operator*(<span class="keyword">const</span> AwMatrix &amp;right) <span class="keyword">const</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description: </span></div>
<div class="line"><span class="comment">//      Returns the matrix that is the inner product of the two argument matrices.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Note:</span></div>
<div class="line"><span class="comment">//      This routine has been hand scheduled for MIPS R4x00 CPU&#39;s</span></div>
<div class="line"><span class="comment">//      Don&#39;t rearrange this code unless you know what your doing.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{ </div>
<div class="line">    AwMatrix result;</div>
<div class="line">    <span class="keywordtype">double</span> *a = (<span class="keywordtype">double</span> *) result.matrix;</div>
<div class="line">    <span class="keywordtype">double</span> *b = (<span class="keywordtype">double</span> *) this-&gt;matrix;</div>
<div class="line">    <span class="keywordtype">double</span> *c = (<span class="keywordtype">double</span> *) right.matrix;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">double</span> i0, i1, i2, i3, i4, i5, i6, i7;</div>
<div class="line"></div>
<div class="line">    if (a == c) {</div>
<div class="line">        <span class="keywordtype">double</span> c0, c4, c8, c12;</div>
<div class="line"></div>
<div class="line">        c0 = c[0]; c4 = c[4]; c8 = c[8]; c12 = c[12];</div>
<div class="line">        i0 = b[0] * c0; i1 = b[1] * c4; i2 = b[2] * c8; i3 = b[3] * c12;</div>
<div class="line">        i4 = b[4] * c0; i5 = b[5] * c4; i6 = b[6] * c8; i7 = b[7] * c12;</div>
<div class="line">        a[0] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[4] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">        i0 = b[8]  * c0; i1 = b[9]  * c4; i2 = b[10] * c8; i3 = b[11] * c12;</div>
<div class="line">        i4 = b[12] * c0; i5 = b[13] * c4; i6 = b[14] * c8; i7 = b[15] * c12;</div>
<div class="line">        a[8]  = i0 + i1 + i2 + i3;</div>
<div class="line">        a[12] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">        c0 = c[1]; c4 = c[5]; c8 = c[9]; c12 = c[13];</div>
<div class="line">        i0 = b[0] * c0; i1 = b[1] * c4; i2 = b[2] * c8; i3 = b[3] * c12;</div>
<div class="line">        i4 = b[4] * c0; i5 = b[5] * c4; i6 = b[6] * c8; i7 = b[7] * c12;</div>
<div class="line">        a[1] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[5] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">        i0 = b[8]  * c0; i1 = b[9]  * c4; i2 = b[10] * c8; i3 = b[11] * c12;</div>
<div class="line">        i4 = b[12] * c0; i5 = b[13] * c4; i6 = b[14] * c8; i7 = b[15] * c12;</div>
<div class="line">        a[9]  = i0 + i1 + i2 + i3;</div>
<div class="line">        a[13] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">        c0 = c[2]; c4 = c[6]; c8 = c[10]; c12 = c[14];</div>
<div class="line">        i0 = b[0] * c0; i1 = b[1] * c4; i2 = b[2] * c8; i3 = b[3] * c12;</div>
<div class="line">        i4 = b[4] * c0; i5 = b[5] * c4; i6 = b[6] * c8; i7 = b[7] * c12;</div>
<div class="line">        a[2] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[6] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">        i0 = b[8]  * c0; i1 = b[9]  * c4; i2 = b[10] * c8; i3 = b[11] * c12;</div>
<div class="line">        i4 = b[12] * c0; i5 = b[13] * c4; i6 = b[14] * c8; i7 = b[15] * c12;</div>
<div class="line">        a[10] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[14] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">        c0 = c[3]; c4 = c[7]; c8 = c[11]; c12 = c[15];</div>
<div class="line">        i0 = b[0] * c0; i1 = b[1] * c4; i2 = b[2] * c8; i3 = b[3] * c12;</div>
<div class="line">        i4 = b[4] * c0; i5 = b[5] * c4; i6 = b[6] * c8; i7 = b[7] * c12;</div>
<div class="line">        a[3] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[7] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">        i0 = b[8]  * c0; i1 = b[9]  * c4; i2 = b[10] * c8; i3 = b[11] * c12;</div>
<div class="line">        i4 = b[12] * c0; i5 = b[13] * c4; i6 = b[14] * c8; i7 = b[15] * c12;</div>
<div class="line">        a[11] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[15] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordtype">double</span> b0, b1, b2, b3;</div>
<div class="line"></div>
<div class="line">        b0 = b[0]; b1 = b[1]; b2 = b[2]; b3 = b[3];</div>
<div class="line">        i0 = b0 * c[0]; i1 = b1 * c[4]; i2 = b2 * c[8]; i3 = b3 * c[12];</div>
<div class="line">        i4 = b0 * c[1]; i5 = b1 * c[5]; i6 = b2 * c[9]; i7 = b3 * c[13];</div>
<div class="line">        a[0] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[1] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">        i0 = b0 * c[2]; i1 = b1 * c[6]; i2 = b2 * c[10]; i3 = b3 * c[14];</div>
<div class="line">        i4 = b0 * c[3]; i5 = b1 * c[7]; i6 = b2 * c[11]; i7 = b3 * c[15];</div>
<div class="line">        a[2] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[3] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">        b0 = b[4]; b1 = b[5]; b2 = b[6]; b3 = b[7];</div>
<div class="line">        i0 = b0 * c[0]; i1 = b1 * c[4]; i2 = b2 * c[8]; i3 = b3 * c[12];</div>
<div class="line">        i4 = b0 * c[1]; i5 = b1 * c[5]; i6 = b2 * c[9]; i7 = b3 * c[13];</div>
<div class="line">        a[4] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[5] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">        i0 = b0 * c[2]; i1 = b1 * c[6]; i2 = b2 * c[10]; i3 = b3 * c[14];</div>
<div class="line">        i4 = b0 * c[3]; i5 = b1 * c[7]; i6 = b2 * c[11]; i7 = b3 * c[15];</div>
<div class="line">        a[6] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[7] = i4 + i5 + i6 + i7;</div>
<div class="line">    </div>
<div class="line">        b0 = b[8]; b1 = b[9]; b2 = b[10]; b3 = b[11];</div>
<div class="line">        i0 = b0 * c[0]; i1 = b1 * c[4]; i2 = b2 * c[8]; i3 = b3 * c[12];</div>
<div class="line">        i4 = b0 * c[1]; i5 = b1 * c[5]; i6 = b2 * c[9]; i7 = b3 * c[13];</div>
<div class="line">        a[8] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[9] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">        i0 = b0 * c[2]; i1 = b1 * c[6]; i2 = b2 * c[10]; i3 = b3 * c[14];</div>
<div class="line">        i4 = b0 * c[3]; i5 = b1 * c[7]; i6 = b2 * c[11]; i7 = b3 * c[15];</div>
<div class="line">        a[10] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[11] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">        b0 = b[12]; b1 = b[13]; b2 = b[14]; b3 = b[15];</div>
<div class="line">        i0 = b0 * c[0]; i1 = b1 * c[4]; i2 = b2 * c[8]; i3 = b3 * c[12];</div>
<div class="line">        i4 = b0 * c[1]; i5 = b1 * c[5]; i6 = b2 * c[9]; i7 = b3 * c[13];</div>
<div class="line">        a[12] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[13] = i4 + i5 + i6 + i7;</div>
<div class="line"></div>
<div class="line">        i0 = b0 * c[2]; i1 = b1 * c[6]; i2 = b2 * c[10]; i3 = b3 * c[14];</div>
<div class="line">        i4 = b0 * c[3]; i5 = b1 * c[7]; i6 = b2 * c[11]; i7 = b3 * c[15];</div>
<div class="line">        a[14] = i0 + i1 + i2 + i3;</div>
<div class="line">        a[15] = i4 + i5 + i6 + i7;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">AwMatrix &amp;AwMatrix::invertIt()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description: </span></div>
<div class="line"><span class="comment">//      Sets the matrix to be its own inverse.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Notes:  </span></div>
<div class="line"><span class="comment">//      If the matrix is singular, return the identity matrix;</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Create an identity matrix on which to mirror all of our operations.</span></div>
<div class="line">    <span class="comment">// The identity matrix is it&#39;s own inverse.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    AwMatrix inv;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> i, j, k;</div>
<div class="line">    <span class="keywordtype">double</span> factor, divisor, temp;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// phase one:  eliminate all the numbers under the diagonal.  This is done</span></div>
<div class="line">    <span class="comment">// in a loop, considering successively smaller matrices as the top-left</span></div>
<div class="line">    <span class="comment">// corner of each is set to 1.  (This does not need to be done for the</span></div>
<div class="line">    <span class="comment">// last row, clearly)</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {</div>
<div class="line">        <span class="comment">// step one:  find the largest value in column i;</span></div>
<div class="line">        <span class="comment">// swap that row to be row i</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordtype">int</span> bigOne = i;</div>
<div class="line">        <span class="keywordflow">for</span> (j = i; j &lt; 4; j++){</div>
<div class="line">            <span class="keywordflow">if</span> (matrix[j][i] * matrix[j][i] &gt;</div>
<div class="line">                matrix[bigOne][i] * matrix[bigOne][i]) {</div>
<div class="line">                bigOne = j;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (bigOne != i) {</div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; 4; j++) {</div>
<div class="line">                temp = matrix[bigOne][j];</div>
<div class="line">                matrix[bigOne][j] = matrix[i][j];</div>
<div class="line">                matrix[i][j] = temp;</div>
<div class="line">                temp = inv.matrix[bigOne][j];</div>
<div class="line">                inv.matrix[bigOne][j] = inv.matrix[i][j];</div>
<div class="line">                inv.matrix[i][j] = temp;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    </div>
<div class="line">        <span class="comment">//  step two: by appropriate subtraction, eliminate all the numbers</span></div>
<div class="line">        <span class="comment">//  under the diagonal element i.  Singular elements in the matrix</span></div>
<div class="line">        <span class="comment">//  are skipped.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span> (matrix[i][i] &gt; 1.0e-15 || matrix[i][i] &lt; -1.0e-15) {</div>
<div class="line">            <span class="keywordflow">for</span> (j = i + 1; j &lt; 4; j++) {</div>
<div class="line">                factor = matrix[j][i] / matrix[i][i];</div>
<div class="line">                <span class="keywordflow">for</span> (k = 0; k &lt; 4; k++) {</div>
<div class="line">                    matrix[j][k] -= matrix[i][k] * factor;</div>
<div class="line">                    inv.matrix[j][k] -= inv.matrix[i][k] * factor;</div>
<div class="line">                }</div>
<div class="line">                <span class="comment">// set the column value to exactly zero in case</span></div>
<div class="line">                <span class="comment">// numeric roundoff left it a very tiny number</span></div>
<div class="line">                matrix[j][i] = 0.0;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// phase two: set all the diagonal values to 1</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {</div>
<div class="line">        divisor = matrix[i][i];</div>
<div class="line">        <span class="keywordflow">if</span> (divisor &gt; 1.0e-15 || divisor &lt; -1.0e-15) {</div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; 4; j++) {</div>
<div class="line">                matrix[i][j] = matrix[i][j] / divisor;</div>
<div class="line">                inv.matrix[i][j] = inv.matrix[i][j] / divisor;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// set the diagonal to 1.0 exactly to avoid</span></div>
<div class="line">            <span class="comment">// possible round-off error</span></div>
<div class="line">            matrix[i][i] = 1.0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// phase three: eliminate all the zeros above the diagonal</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (j = i + 1; j &lt; 4; j++) {</div>
<div class="line">            factor = matrix[i][j];</div>
<div class="line">            <span class="keywordflow">for</span> (k = 0; k &lt; 4; k++) {</div>
<div class="line">                matrix[i][k] -= matrix[j][k] * factor;</div>
<div class="line">                inv.matrix[i][k] -= inv.matrix[j][k] * factor;</div>
<div class="line">            }</div>
<div class="line">            matrix[i][j] = 0.0; <span class="comment">// in case of round-off error</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// At this point inv should contain the correct inverse matrix to the</span></div>
<div class="line">    <span class="comment">// original matrix we started with.  Copy it to this matrix.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    *<span class="keyword">this</span> = inv;</div>
<div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">AwMatrix &amp;AwMatrix::transposeIt()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description: </span></div>
<div class="line"><span class="comment">//      Sets the matrix to be its own transpose.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i, j;</div>
<div class="line">    <span class="keywordtype">double</span> temp;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++){</div>
<div class="line">        <span class="keywordflow">for</span> (j = i + 1; j &lt; 4; j++) {</div>
<div class="line">            temp = matrix[i][j];</div>
<div class="line">            matrix[i][j] = matrix[j][i];</div>
<div class="line">            matrix[j][i] = temp;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> AwMatrix::isEquivalent(<span class="keyword">const</span> AwMatrix &amp;otherM, <span class="keywordtype">double</span> tolerance) <span class="keyword">const</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      This method returns true if this matrix is equal, within some</span></div>
<div class="line"><span class="comment">//      given tolerance, to otherM.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Notes:</span></div>
<div class="line"><span class="comment">//      tolerance is asserted to be non-negative, and defaults to</span></div>
<div class="line"><span class="comment">//      kMatrixEquivalentTolerance.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    assert(tolerance &gt;= 0.0);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> (</div>
<div class="line">        fabs(matrix[0][0] - otherM.matrix[0][0]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[0][1] - otherM.matrix[0][1]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[0][2] - otherM.matrix[0][2]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[0][3] - otherM.matrix[0][3]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[1][0] - otherM.matrix[1][0]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[1][1] - otherM.matrix[1][1]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[1][2] - otherM.matrix[1][2]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[1][3] - otherM.matrix[1][3]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[2][0] - otherM.matrix[2][0]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[2][1] - otherM.matrix[2][1]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[2][2] - otherM.matrix[2][2]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[2][3] - otherM.matrix[2][3]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[3][0] - otherM.matrix[3][0]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[3][1] - otherM.matrix[3][1]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[3][2] - otherM.matrix[3][2]) &lt;= tolerance</div>
<div class="line">    &amp;&amp;  fabs(matrix[3][3] - otherM.matrix[3][3]) &lt;= tolerance );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">AwMatrix AwMatrix::operator*(<span class="keywordtype">double</span> mult) <span class="keyword">const</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      This method multiplies the matrix by a constant</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    AwMatrix temp(*<span class="keyword">this</span>);</div>
<div class="line">    temp[0][0] *= mult; temp[0][1] *= mult;</div>
<div class="line">    temp[0][2] *= mult; temp[0][3] *= mult;</div>
<div class="line">    temp[1][0] *= mult; temp[1][1] *= mult;</div>
<div class="line">    temp[1][2] *= mult; temp[1][3] *= mult;</div>
<div class="line">    temp[2][0] *= mult; temp[2][1] *= mult;</div>
<div class="line">    temp[2][2] *= mult; temp[2][3] *= mult;</div>
<div class="line">    temp[3][0] *= mult; temp[3][1] *= mult;</div>
<div class="line">    temp[3][2] *= mult; temp[3][3] *= mult;</div>
<div class="line">    <span class="keywordflow">return</span> temp;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> AwMatrix::operator==(<span class="keyword">const</span> AwMatrix &amp;otherM) <span class="keyword">const</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      This method returns true if this matrix is identically equal to otherM.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> (</div>
<div class="line">        matrix[0][0] == otherM.matrix[0][0]</div>
<div class="line">    &amp;&amp;  matrix[0][1] == otherM.matrix[0][1]</div>
<div class="line">    &amp;&amp;  matrix[0][2] == otherM.matrix[0][2]</div>
<div class="line">    &amp;&amp;  matrix[0][3] == otherM.matrix[0][3]</div>
<div class="line">    &amp;&amp;  matrix[1][0] == otherM.matrix[1][0]</div>
<div class="line">    &amp;&amp;  matrix[1][1] == otherM.matrix[1][1]</div>
<div class="line">    &amp;&amp;  matrix[1][2] == otherM.matrix[1][2]</div>
<div class="line">    &amp;&amp;  matrix[1][3] == otherM.matrix[1][3]</div>
<div class="line">    &amp;&amp;  matrix[2][0] == otherM.matrix[2][0]</div>
<div class="line">    &amp;&amp;  matrix[2][1] == otherM.matrix[2][1]</div>
<div class="line">    &amp;&amp;  matrix[2][2] == otherM.matrix[2][2]</div>
<div class="line">    &amp;&amp;  matrix[2][3] == otherM.matrix[2][3]</div>
<div class="line">    &amp;&amp;  matrix[3][0] == otherM.matrix[3][0]</div>
<div class="line">    &amp;&amp;  matrix[3][1] == otherM.matrix[3][1]</div>
<div class="line">    &amp;&amp;  matrix[3][2] == otherM.matrix[3][2]</div>
<div class="line">    &amp;&amp;  matrix[3][3] == otherM.matrix[3][3] );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> AwMatrix::det3x3() const</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      Return the determinant of the upper-left 3 by 3 submatrix.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> (matrix[0][0] * (matrix[1][1] * matrix[2][2] -</div>
<div class="line">                            matrix[2][1] * matrix[1][2]) -</div>
<div class="line">            matrix[0][1] * (matrix[1][0] * matrix[2][2] -</div>
<div class="line">                            matrix[2][0] * matrix[1][2]) +</div>
<div class="line">            matrix[0][2] * (matrix[1][0] * matrix[2][1] -</div>
<div class="line">                            matrix[2][0] * matrix[1][1]));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> AwMatrix::det4x4() const</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      Return the determinant of this matrix.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">double</span> a1, a2, a3, a4;</div>
<div class="line">    <span class="keywordtype">double</span> b1, b2, b3, b4;</div>
<div class="line">    <span class="keywordtype">double</span> c1, c2, c3, c4;</div>
<div class="line">    <span class="keywordtype">double</span> d1, d2, d3, d4;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// assign to individual variable names to aid selecting correct elements</span></div>
<div class="line">    a1 = matrix[0][0]; b1 = matrix[0][1]; c1 = matrix[0][2]; d1 = matrix[0][3];</div>
<div class="line">    a2 = matrix[1][0]; b2 = matrix[1][1]; c2 = matrix[1][2]; d2 = matrix[1][3];</div>
<div class="line">    a3 = matrix[2][0]; b3 = matrix[2][1]; c3 = matrix[2][2]; d3 = matrix[2][3];</div>
<div class="line">    a4 = matrix[3][0]; b4 = matrix[3][1]; c4 = matrix[3][2]; d4 = matrix[3][3];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> (</div>
<div class="line">        a1 * DET3X3(b2, b3, b4, c2, c3, c4, d2, d3, d4) -</div>
<div class="line">        b1 * DET3X3(a2, a3, a4, c2, c3, c4, d2, d3, d4) +</div>
<div class="line">        c1 * DET3X3(a2, a3, a4, b2, b3, b4, d2, d3, d4) -</div>
<div class="line">        d1 * DET3X3(a2, a3, a4, b2, b3, b4, c2, c3, c4)</div>
<div class="line">    );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> AwMatrix::isOrthogonal() const</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      Return true if the upper 3x3 sub-matrix does not</span></div>
<div class="line"><span class="comment">//      contain non-proportional scaling or skewing.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">    #define rowdot(i,j) (matrix[i][0]*matrix[j][0] + \</span></div>
<div class="line"><span class="preprocessor">                         matrix[i][1]*matrix[j][1] + \</span></div>
<div class="line"><span class="preprocessor">                         matrix[i][2]*matrix[j][2])</span></div>
<div class="line"><span class="preprocessor">    #define rownorm(i)  (rowdot(i,i))</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//  First, test for non-proportional scales since they will</span></div>
<div class="line">    <span class="comment">//  occur more frequently than skewing.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordtype">double</span> norm0 = rownorm(0);</div>
<div class="line">    <span class="keywordflow">return</span> (</div>
<div class="line">        ::equivalent(rownorm(1),  norm0) &amp;&amp;     <span class="comment">// Non-prop scale tests</span></div>
<div class="line">        ::equivalent(rownorm(2),  norm0) &amp;&amp;</div>
<div class="line">        ::equivalent(rowdot(0,1), 0.0)   &amp;&amp;     <span class="comment">// Skewing tests</span></div>
<div class="line">        ::equivalent(rowdot(1,2), 0.0)   &amp;&amp;</div>
<div class="line">        ::equivalent(rowdot(0,2), 0.0)</div>
<div class="line">    );</div>
<div class="line"><span class="preprocessor">    #undef rownorm</span></div>
<div class="line"><span class="preprocessor">    #undef rowdot</span></div>
<div class="line">}   </div>
<div class="line"></div>
<div class="line"><span class="comment">/*friend*/</span> ostream &amp;operator&lt;&lt;(ostream &amp;os, <span class="keyword">const</span> AwMatrix &amp;m)</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      Stream output.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    os &lt;&lt; <span class="stringliteral">&quot;[&quot;</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; ++i) {</div>
<div class="line">        <span class="keywordflow">if</span> (i) os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line">        os &lt;&lt; <span class="stringliteral">&quot;[&quot;</span>;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; ++j) {</div>
<div class="line">            <span class="keywordflow">if</span> (j) os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line">            os &lt;&lt; m[i][j];</div>
<div class="line">        }</div>
<div class="line">        os &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">    os &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> os;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->

      <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
   </div></body>
</html>
