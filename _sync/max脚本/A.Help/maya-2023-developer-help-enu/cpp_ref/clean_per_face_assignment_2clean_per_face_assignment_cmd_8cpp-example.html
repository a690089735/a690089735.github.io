<!-- saved from url=(0024)http://docs.autodesk.com -->
<html>
   <head><script src="../scripts/yepnope.1.5.4-min.js" type="text/javascript"></script><script src="../scripts/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
      <title>C++ API Reference: cleanPerFaceAssignment/cleanPerFaceAssignmentCmd.cpp</title>
      
	  
      
      
      
      
      
      
      
    

</head>
   <body height="100%"><div class="body_content" id="body-content"><link rel="stylesheet" type="text/css" href="cpp_ref/navtree.css"><link rel="stylesheet" type="text/css" href="cpp_ref/doxygen.css"><link rel="stylesheet" type="text/css" href="cpp_ref/tabs.css"><link rel="stylesheet" type="text/css" href="style/adsk.cpm.css"><script type="text/javascript">
var tocSystemNeedsToBeLoaded = typeof(cpp_ref_adsk_ref_toc) == 'undefined';
var weAreIn21 = $('div#main.view-active').length;
var tocPrefix = '';
if (weAreIn21)
{ tocPrefix = 'cpp_ref/'; }
function cpp_ref_initializeToc(forceTrigger) {
    cpp_ref_adsk_ref_toc.initResizable();
    cpp_ref_adsk_ref_toc.initNavTree('clean_per_face_assignment_2clean_per_face_assignment_cmd_8cpp-example.html', tocPrefix);
    dQuery(document).trigger('toc_initialized');
}
if (tocSystemNeedsToBeLoaded)
{
	yepnope([{
	load:[tocPrefix + 'json3.min.js', tocPrefix + 'jquery.js', tocPrefix + 'ref-toc-controller.js', tocPrefix + 'dynsections.js'],
	complete: function() {
	  if (typeof(dQuery) == 'undefined')
	  {
	    dQuery = jQuery.noConflict(true);
	  }
	  else { jQuery.noConflict(true); }
	  $(document).ready(cpp_ref_initializeToc);
	}
 	}])
}
if (!weAreIn21) { // if in AKN...
$(window).load( function() {
    setTimeout( function() {
        var content = $('body > div').not('#body-content');     // take any divs under body that are not id=body-content
        content.each( function() { 
            $(this).css( { 'padding-left': $(this).css('margin-left') } );       // and if they have any padding-left already, move it to margin-left.
        } );
        var width = cpp_ref_adsk_ref_toc.readFromStorage('width');
        content.css({marginLeft:parseInt(width)+6+"px"});
    }, 100);
} ); 
}
</script><script>
 if (!tocSystemNeedsToBeLoaded) { cpp_ref_initializeToc(); }
 </script>
      <div>
         <div class="head">
            <h1>C++ API Reference: cleanPerFaceAssignment/cleanPerFaceAssignmentCmd.cpp</h1>
         </div>

<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->

  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="#!/url=./cpp_ref/index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="#!/url=./cpp_ref/pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="#!/url=./cpp_ref/modules.html"><span>Modules</span></a></li>
      <li><a href="#!/url=./cpp_ref/namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="#!/url=./cpp_ref/annotated.html"><span>Classes</span></a></li>
      <li><a href="#!/url=./cpp_ref/examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="cpp_ref/search/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="cpp_ref/search/close.png" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>

<div id="doc-content">
<!-- window showing the filter options -->


<!-- iframe showing the search results (closed by default) -->


<div class="header">
  <div class="headertitle">
<div class="title">cleanPerFaceAssignment/cleanPerFaceAssignmentCmd.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">//-</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">// Copyright 2015 Autodesk, Inc.  All rights reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Use of this software is subject to the terms of the Autodesk</span></div>
<div class="line"><span class="comment">// license agreement provided at the time of installation or download,</span></div>
<div class="line"><span class="comment">// or which otherwise accompanies this software in either electronic</span></div>
<div class="line"><span class="comment">// or hard copy form.</span></div>
<div class="line"><span class="comment">// ==========================================================================</span></div>
<div class="line"><span class="comment">//+</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// File: cleanPerFaceAssignmentCmd.cpp</span></div>
<div class="line"><span class="comment">// MEL Command: cleanPerFaceAssignment</span></div>
<div class="line"><span class="comment">// Author: Hiroyuki Haga</span></div>
<div class="line"><span class="comment">// </span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;cleanPerFaceAssignmentCmd.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Include Maya libary: General</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MGlobal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MDagPath.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MPlug.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MObjectArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MIntArray.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MStringArray.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Include Maya libary: Selection</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MSelectionList.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MItSelectionList.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Include Maya libary: Nodes</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnDependencyNode.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Include Maya libary: Polygons</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnMesh.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MItMeshPolygon.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Include Maya libary: Sets</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MFnSet.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef MAYA_PRINT_DEBUG_INFO</span></div>
<div class="line"><span class="preprocessor">#include &lt;maya/MIOStream.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><a name="_a0"></a><a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> cleanPerFaceAssignment::doIt( <span class="keyword">const</span> <a name="_a1"></a><a class="code" href="#!/url=./cpp_ref/class_m_arg_list.html">MArgList</a>&amp; )</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      cleanPerfaceAssignment does the followings</span></div>
<div class="line"><span class="comment">//          1. It traces material connections</span></div>
<div class="line"><span class="comment">//          2. If multiple conections to one material is found, it combines them.</span></div>
<div class="line"><span class="comment">//          3. It changes the assignment order</span></div>
<div class="line"><span class="comment">//          4. it returns a string array that can be executed as a MEL command</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Arguments:</span></div>
<div class="line"><span class="comment">//      NONE</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Return Value:</span></div>
<div class="line"><span class="comment">//      It always returns MS:kSuccess as there&#39;s no error handling</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <a class="code" href="#!/url=./cpp_ref/class_m_status.html">MStatus</a> stat = MS::kSuccess;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">//  Get the selection list and using the iterator to trace them</span></div>
<div class="line">    <a name="_a2"></a><a class="code" href="#!/url=./cpp_ref/class_m_selection_list.html">MSelectionList</a> list;</div>
<div class="line">    <a name="a3"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a6d81d38246555884897fb153c93aaf42">MGlobal::getActiveSelectionList</a>( list );</div>
<div class="line">    <a name="_a4"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_selection_list.html">MItSelectionList</a> listIt( list);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> ( listIt.<a name="a5"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_selection_list.html#ac734f26ff1c92ecec3572a31f5e4435c">reset</a>(); !listIt.<a name="a6"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_selection_list.html#ac0f0d6fc806b11d246e05cb94e886b38">isDone</a>() ; listIt.<a name="a7"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_selection_list.html#a73616f002814b8abe6d921db72d7a496">next</a>() ){</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Get the DAG path of each element and extend the path to its shape node</span></div>
<div class="line">        <a name="_a8"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html">MDagPath</a> path;</div>
<div class="line">        listIt.<a name="a9"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_selection_list.html#acea3f9b4576b874442d489458ac310c0">getDagPath</a>( path );</div>
<div class="line">        path.<a name="a10"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a658d9664035ff84ffefa217c0e45cc88">extendToShape</a>();</div>
<div class="line">    </div>
<div class="line">        <span class="comment">// if a DAG Path is MFn::kMesh, it tries to obtain its material</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ( path.<a name="a11"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#addad2b4a38ebd0aef17a153f13f27985">apiType</a>() == <a name="a12"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn.html#a1d1cfd8ffb84e947f82999c682b666a7a19fd562fc0900a60162e6073df36cb62">MFn::kMesh</a> ){</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Create a function set for poly geometries, find faces that are assigned as a set</span></div>
<div class="line">            <a name="_a13"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_mesh.html">MFnMesh</a> meshFn( path );</div>
<div class="line">            <a name="_a14"></a><a class="code" href="#!/url=./cpp_ref/class_m_object_array.html">MObjectArray</a> sets, comps;</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> instanceNumber = path.<a name="a15"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#ac908055bb978bce38fcb5f1af6620760">instanceNumber</a>();</div>
<div class="line">            meshFn.<a name="a16"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dag_node.html#ae19de6f173f69f8753fdca910e208dc7">getConnectedSetsAndMembers</a>( instanceNumber, sets, comps, 1 );</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef MAYA_PRINT_DEBUG_INFO</span></div>
<div class="line">            <span class="comment">// Debug output</span></div>
<div class="line">            <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; sets.<a name="a17"></a><a class="code" href="#!/url=./cpp_ref/class_m_object_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ; i++ ){</div>
<div class="line">                <a name="_a18"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_set.html">MFnSet</a> setFn ( sets[i]);</div>
<div class="line">                <a name="_a19"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html">MItMeshPolygon</a> faceIt( path, comps[i] );</div>
<div class="line"></div>
<div class="line">                cout &lt;&lt; <span class="stringliteral">&quot;--------------&gt;&quot;</span> &lt;&lt; endl;</div>
<div class="line">                cout &lt;&lt; setFn.<a name="a20"></a><a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#a049384adbea0396ea2f03d1ad4d69df1">name</a>() &lt;&lt; endl;</div>
<div class="line">                cout &lt;&lt; <span class="stringliteral">&quot;FaceCount:&quot;</span> &lt;&lt; faceIt.<a name="a21"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#a7c5647ef2c0afdbc571d04a75136d2d8">count</a>() &lt;&lt; endl;</div>
<div class="line">                <span class="keywordflow">for</span> ( faceIt.<a name="a22"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#ac734f26ff1c92ecec3572a31f5e4435c">reset</a>() ; !faceIt.<a name="a23"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#ac0f0d6fc806b11d246e05cb94e886b38">isDone</a>() ; faceIt.<a name="a24"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#a73616f002814b8abe6d921db72d7a496">next</a>() ){</div>
<div class="line">                    cout &lt;&lt; faceIt.<a name="a25"></a><a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#afdd8d04245960d9763609469ed0d21cb">index</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">                }</div>
<div class="line">                cout &lt;&lt; endl;</div>
<div class="line">                cout &lt;&lt; <span class="stringliteral">&quot;&lt;--------------&quot;</span> &lt;&lt; endl;</div>
<div class="line">                </div>
<div class="line">            }</div>
<div class="line"><span class="preprocessor">#endif //MAYA_PRINT_DEBUG_INFO</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">            <span class="comment">// Variable declaration </span></div>
<div class="line">            <a name="_a26"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> SGNames;       <span class="comment">// Stores Shading Group name</span></div>
<div class="line">            <a name="_a27"></a><a class="code" href="#!/url=./cpp_ref/class_m_int_array.html">MIntArray</a> sameConnectionFlag;   <span class="comment">// a flag to check if Shading Group has same names</span></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_int_array.html">MIntArray</a> sameSGFaceCount;  <span class="comment">// storoes the number of faces included in each shading group</span></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> memberFaceNames;   <span class="comment">// stores names of faces included in each shading group</span></div>
<div class="line"></div>
<div class="line">            sameConnectionFlag.<a name="a28"></a><a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#ad5522f028dde0080b753279426415a4a">clear</a>();</div>
<div class="line">            sameSGFaceCount.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#ad5522f028dde0080b753279426415a4a">clear</a>();</div>
<div class="line"></div>
<div class="line">            <span class="comment">// ------------------------------------------------</span></div>
<div class="line">            <span class="comment">// 1    Initialization</span></div>
<div class="line">            <span class="comment">// ------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">// initialization of variables</span></div>
<div class="line">            <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; sets.<a class="code" href="#!/url=./cpp_ref/class_m_object_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ; i++ ){</div>
<div class="line"></div>
<div class="line">                <span class="comment">// SGName Initialization</span></div>
<div class="line">                <span class="comment">//  Append Shading Group name</span></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_fn_set.html">MFnSet</a> setFn ( sets[i] );</div>
<div class="line">                SGNames.<a name="a29"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>( setFn.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#a049384adbea0396ea2f03d1ad4d69df1">name</a>() );</div>
<div class="line"></div>
<div class="line">                <span class="comment">// sameConnectionFlag Initialization</span></div>
<div class="line">                <span class="comment">//  set -1</span></div>
<div class="line">                sameConnectionFlag.<a name="a30"></a><a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a11568087ac2ca16f4106cee62f65afd7">append</a>( -1 );</div>
<div class="line">                </div>
<div class="line">                </div>
<div class="line">                <span class="comment">// sameSGFaceCount Initialization</span></div>
<div class="line">                <span class="comment">//  Set the number of faces included in a Shading Group</span></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html">MItMeshPolygon</a> tempFaceIt ( path, comps[i] );               </div>
<div class="line">                sameSGFaceCount.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a11568087ac2ca16f4106cee62f65afd7">append</a>( tempFaceIt.<a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#a7c5647ef2c0afdbc571d04a75136d2d8">count</a>() );</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">                <span class="comment">// memberFaceNames Initialization</span></div>
<div class="line">                <span class="comment">//  Stores names of faces included in a Shading Group in a way MEL can use</span></div>
<div class="line">                <a name="_a31"></a><a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> aMemberFaceName;</div>
<div class="line"></div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> pathName = path.<a name="a32"></a><a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a7cffb69661adc6ae7ac9e03c297caf01">fullPathName</a>();</div>
<div class="line">                <span class="keywordtype">bool</span> optimizeList = <span class="keyword">true</span>; </div>
<div class="line">                <span class="keywordflow">if</span> (optimizeList)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">int</span> lastIndices[2] = { -1, -1 };</div>
<div class="line">                    <span class="keywordtype">int</span> currentIndex = -1;</div>
<div class="line">                    <span class="keywordtype">bool</span> haveAFace = <span class="keyword">false</span>;</div>
<div class="line">                    <span class="keywordflow">for</span> ( ;!tempFaceIt.<a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#ac0f0d6fc806b11d246e05cb94e886b38">isDone</a>() ; tempFaceIt.<a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#a73616f002814b8abe6d921db72d7a496">next</a>() )</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">if</span> (lastIndices[0] == -1)</div>
<div class="line">                        {</div>
<div class="line">                            lastIndices[0] = tempFaceIt.<a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#afdd8d04245960d9763609469ed0d21cb">index</a>();</div>
<div class="line">                            lastIndices[1] = tempFaceIt.<a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#afdd8d04245960d9763609469ed0d21cb">index</a>();</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">else</span></div>
<div class="line">                        {</div>
<div class="line">                            currentIndex = tempFaceIt.<a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#afdd8d04245960d9763609469ed0d21cb">index</a>();</div>
<div class="line"></div>
<div class="line">                            <span class="comment">// Hit non-contiguous face #. split out a new string</span></div>
<div class="line">                            <span class="keywordflow">if</span> (currentIndex &gt; lastIndices[1] + 1)</div>
<div class="line">                            {</div>
<div class="line">                                aMemberFaceName += (pathName + <span class="stringliteral">&quot;.f[&quot;</span> + lastIndices[0] + <span class="stringliteral">&quot;:&quot;</span> + lastIndices[1] + <span class="stringliteral">&quot;] &quot;</span>);</div>
<div class="line">                                lastIndices[0] = currentIndex;</div>
<div class="line">                                lastIndices[1] = currentIndex;</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">else</span></div>
<div class="line">                                lastIndices[1] = currentIndex;</div>
<div class="line">                        }</div>
<div class="line">                        haveAFace = <span class="keyword">true</span>;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="comment">// Only one member. Add it.</span></div>
<div class="line">                    <span class="keywordflow">if</span> (haveAFace)</div>
<div class="line">                    {</div>
<div class="line">                        aMemberFaceName += (pathName + <span class="stringliteral">&quot;.f[&quot;</span> + lastIndices[0] + <span class="stringliteral">&quot;:&quot;</span> + lastIndices[1] + <span class="stringliteral">&quot;] &quot;</span>);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">for</span> ( ;!tempFaceIt.<a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#ac0f0d6fc806b11d246e05cb94e886b38">isDone</a>() ; tempFaceIt.<a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#a73616f002814b8abe6d921db72d7a496">next</a>() ){</div>
<div class="line">                        aMemberFaceName += (path.<a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a7cffb69661adc6ae7ac9e03c297caf01">fullPathName</a>() + <span class="stringliteral">&quot;.f[&quot;</span> + tempFaceIt.<a class="code" href="#!/url=./cpp_ref/class_m_it_mesh_polygon.html#afdd8d04245960d9763609469ed0d21cb">index</a>() + <span class="stringliteral">&quot;] &quot;</span>);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                memberFaceNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>( aMemberFaceName );</div>
<div class="line"></div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">    </div>
<div class="line">            <span class="comment">// ------------------------------------------------</span></div>
<div class="line">            <span class="comment">// 2    Finding redundant connections</span></div>
<div class="line">            <span class="comment">// ------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">// Scan for multiple connections to a shading group and if it exists</span></div>
<div class="line">            <span class="comment">//  combine them</span></div>
<div class="line">            <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; sets.<a class="code" href="#!/url=./cpp_ref/class_m_object_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ; i++ ){</div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_fn_set.html">MFnSet</a> setFn ( sets[i]);</div>
<div class="line">                <span class="keywordflow">if</span> ( sameConnectionFlag[i] == -1 ){</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; sets.<a class="code" href="#!/url=./cpp_ref/class_m_object_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ; j++ ){</div>
<div class="line">                        <span class="keywordflow">if</span> ( i != j &amp;&amp; sameConnectionFlag[j] == -1 ) {</div>
<div class="line">                            <a class="code" href="#!/url=./cpp_ref/class_m_fn_set.html">MFnSet</a> tempSetFn ( sets[j] );</div>
<div class="line"></div>
<div class="line">                            <span class="keywordflow">if</span> ( setFn.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#a049384adbea0396ea2f03d1ad4d69df1">name</a>() == tempSetFn.<a class="code" href="#!/url=./cpp_ref/class_m_fn_dependency_node.html#a049384adbea0396ea2f03d1ad4d69df1">name</a>() ){</div>
<div class="line">                                sameConnectionFlag[j] = i;</div>
<div class="line">                                sameSGFaceCount[i] += sameSGFaceCount[j];</div>
<div class="line">                                sameSGFaceCount[j] = 0;</div>
<div class="line">                                memberFaceNames[i] += memberFaceNames[j];</div>
<div class="line">                                memberFaceNames[j] = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">                            }</div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                    }</div>
<div class="line">                    sameConnectionFlag[i] = i;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// delete empties</span></div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tail = 0;</div>
<div class="line">            <span class="keywordflow">while</span>( tail &lt; sameConnectionFlag.<a name="a33"></a><a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ){</div>
<div class="line">                <span class="keywordflow">if</span> ( sameSGFaceCount[tail] == 0 ){</div>
<div class="line">                    SGNames.<a name="a34"></a><a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#af05b9926a5e8e7b8e7a9e98a13c839b6">remove</a>( tail );</div>
<div class="line">                    memberFaceNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#af05b9926a5e8e7b8e7a9e98a13c839b6">remove</a>( tail );</div>
<div class="line">                    sameConnectionFlag.<a name="a35"></a><a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#af05b9926a5e8e7b8e7a9e98a13c839b6">remove</a>( tail );</div>
<div class="line">                    sameSGFaceCount.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#af05b9926a5e8e7b8e7a9e98a13c839b6">remove</a>( tail );</div>
<div class="line"></div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    tail++;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">            <span class="comment">// ------------------------------------------------</span></div>
<div class="line">            <span class="comment">// 3    Sorting array</span></div>
<div class="line">            <span class="comment">// ------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">// Sorting preprocess</span></div>
<div class="line">            <span class="comment">//      Simply assign ID from the top</span></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_int_array.html">MIntArray</a> sortMapper;</div>
<div class="line">            <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; sameSGFaceCount.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ; i++ ){</div>
<div class="line">                sortMapper.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a11568087ac2ca16f4106cee62f65afd7">append</a>( i );</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordtype">bool</span> needToSort = <span class="keyword">true</span>;</div>
<div class="line">            </div>
<div class="line">            <span class="comment">// Begin sorting</span></div>
<div class="line">            <span class="comment">//      in the order of number of faces </span></div>
<div class="line">            <span class="keywordflow">while</span> ( needToSort ){</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sortCount = 0;</div>
<div class="line">                <span class="keywordflow">if</span> ( sameSGFaceCount.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() &gt; 1 ){</div>
<div class="line">                    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; ( sameSGFaceCount.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() -1 ) ; i++ ){</div>
<div class="line">                        <span class="keywordflow">if</span> ( sameSGFaceCount[sortMapper[i]] &lt; sameSGFaceCount[sortMapper[i+1]] ){</div>
<div class="line">                            <span class="keywordtype">int</span> tmp = sortMapper[i];</div>
<div class="line">                            sortMapper[i] = sortMapper[i+1];</div>
<div class="line">                            sortMapper[i+1] = tmp;</div>
<div class="line">                            sortCount++;</div>
<div class="line">                        } <span class="keywordflow">else</span> {</div>
<div class="line"></div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                    }</div>
<div class="line">                }<span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                </div>
<div class="line">                <span class="comment">// Check if sorting is completed</span></div>
<div class="line">                <span class="keywordflow">if</span> ( sortCount &gt; 0 ){</div>
<div class="line">                    needToSort = <span class="keyword">true</span>; <span class="comment">//another sorting required</span></div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    needToSort = <span class="keyword">false</span>;<span class="comment">//no sorting required and exit loop</span></div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// store the sorted arrary</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">//  Variable declaration</span></div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> sortedSGNames;</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_string_array.html">MStringArray</a> sortedMemberFaceNames;</div>
<div class="line">            <a class="code" href="#!/url=./cpp_ref/class_m_int_array.html">MIntArray</a>   sortedSGFaceCount;</div>
<div class="line"></div>
<div class="line">            <span class="comment">//  Store</span></div>
<div class="line">            <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; sortMapper.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>(); i++ ){</div>
<div class="line">                sortedSGNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>( SGNames[sortMapper[i]] );</div>
<div class="line">                sortedSGFaceCount.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a11568087ac2ca16f4106cee62f65afd7">append</a>( sameSGFaceCount[sortMapper[i]] );</div>
<div class="line">                sortedMemberFaceNames.<a class="code" href="#!/url=./cpp_ref/class_m_string_array.html#a18d06b3d0af1426e654ac2cc1dc86c60">append</a>( memberFaceNames[sortMapper[i]]);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            </div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef MAYA_PRINT_DEBUG_INFO</span></div>
<div class="line">            <span class="comment">// Debug information output</span></div>
<div class="line">            <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; sortedSGFaceCount.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ; i++ ){</div>
<div class="line">                cout &lt;&lt; sortedSGNames[i] &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; sortedSGFaceCount[i] &lt;&lt; endl;</div>
<div class="line">                cout &lt;&lt; sortedMemberFaceNames[i] &lt;&lt; endl;</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; sortMapper.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ; i++ ){</div>
<div class="line">                cout &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; -- &quot;</span> &lt;&lt; sortMapper[i] &lt;&lt; endl;</div>
<div class="line">            }</div>
<div class="line"><span class="preprocessor">#endif //MAYA_PRINT_DEBUG_INFO</span></div>
<div class="line">            </div>
<div class="line">            <span class="comment">// ------------------------------------------------</span></div>
<div class="line">            <span class="comment">// 4    Output</span></div>
<div class="line">            <span class="comment">// ------------------------------------------------</span></div>
<div class="line">            <span class="comment">//  This outputs a MEL executable string array</span></div>
<div class="line">            <span class="comment">//  This is to enable step by step excution when it can&#39;t be solved to normally </span></div>
<div class="line">            </div>
<div class="line">            <span class="keywordtype">bool</span> executeImmediate = <span class="keyword">true</span>;</div>
<div class="line">            <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; sortedSGFaceCount.<a class="code" href="#!/url=./cpp_ref/class_m_int_array.html#a580388f31f60c46fac867ca48a48da1e">length</a>() ; i++ ){</div>
<div class="line">                </div>
<div class="line">                <a class="code" href="#!/url=./cpp_ref/class_m_string.html">MString</a> resultString;</div>
<div class="line">                <span class="keywordflow">if</span> ( i == 0 ){</div>
<div class="line"></div>
<div class="line">                    <span class="comment">// Add object base selection MEL command </span></div>
<div class="line">                    resultString = (<span class="stringliteral">&quot;select -r &quot;</span> + path.<a class="code" href="#!/url=./cpp_ref/class_m_dag_path.html#a7cffb69661adc6ae7ac9e03c297caf01">fullPathName</a>()  +<span class="stringliteral">&quot;;&quot;</span> );</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">// Add component base selection MEL command </span></div>
<div class="line">                    resultString = (<span class="stringliteral">&quot;select -r &quot;</span> + sortedMemberFaceNames[i] + <span class="stringliteral">&quot;;&quot;</span>);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (executeImmediate )</div>
<div class="line">                    <a name="a36"></a><a class="code" href="#!/url=./cpp_ref/class_m_global.html#a09e405631e7cf680f8ac9d934ad73434">MGlobal::executeCommand</a>( resultString );</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Add a meterial assignemnet MEL comand </span></div>
<div class="line">                <span class="keywordflow">if</span> (executeImmediate)</div>
<div class="line">                {</div>
<div class="line">                    resultString = (<span class="stringliteral">&quot;sets -e -forceElement &quot;</span> + sortedSGNames[i] + <span class="stringliteral">&quot;;&quot;</span>);</div>
<div class="line">                    <a class="code" href="#!/url=./cpp_ref/class_m_global.html#a09e405631e7cf680f8ac9d934ad73434">MGlobal::executeCommand</a>( resultString );</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                    resultString += (<span class="stringliteral">&quot;sets -e -forceElement &quot;</span> + sortedSGNames[i] + <span class="stringliteral">&quot;;&quot;</span>);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Append to the result</span></div>
<div class="line">                <span class="keywordflow">if</span> (!executeImmediate)</div>
<div class="line">                    appendToResult( resultString );</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> stat; <span class="comment">// TODO: Error handling/Additional ASSERT required. BCurrently it always returns MS::kSuccess</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span>* cleanPerFaceAssignment::creator()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      this method exists to give Maya a way to create new objects</span></div>
<div class="line"><span class="comment">//      of this type. </span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Return Value:</span></div>
<div class="line"><span class="comment">//      a new object of this type</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> cleanPerFaceAssignment();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cleanPerFaceAssignment::cleanPerFaceAssignment()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      cleanPerFaceAssignment constructor</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{}</div>
<div class="line"></div>
<div class="line">cleanPerFaceAssignment::~cleanPerFaceAssignment()</div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Description:</span></div>
<div class="line"><span class="comment">//      cleanPerFaceAssignment destructor</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->

      <div class="footer-block"><a href="../html/ac.cmtdialog.htm" class="comments-anchor" target="_blank"><span class="comments-link">Please send us your comment about this page</span></a></div></div>
   </div></body>
</html>
